{"version":3,"sources":["../../../ts/foamflask_frontend.ts"],"sourcesContent":["/**\n * FOAMFlask Frontend * \n\n * Background Color Palette: https://coolors.co/gradient-maker/b6f0ff-ffb1b9?position=0,100&opacity=100,100&type=linear&rotation=180\n\n * When making changes to the frontend, always edit foamflask_frontend.ts and build foamflask_frontend.js using `npm run build`\n */\n\nimport { generateContours as generateContoursFn, loadContourMesh } from \"./frontend/isosurface.js\";\nimport * as Plotly from \"plotly.js\";\n\n// âš¡ Bolt Optimization: Lazy load Plotly.js\nlet plotlyPromise: Promise<void> | null = null;\n\nconst ensurePlotlyLoaded = (): Promise<void> => {\n  if ((window as any).Plotly) return Promise.resolve();\n  if (plotlyPromise) return plotlyPromise;\n\n  plotlyPromise = new Promise((resolve, reject) => {\n    const script = document.createElement(\"script\");\n    script.src = \"https://cdn.plot.ly/plotly-2.27.0.min.js\";\n    script.onload = () => resolve();\n    script.onerror = () => {\n      plotlyPromise = null; // Reset on error so we can retry\n      reject(new Error(\"Failed to load Plotly\"));\n    };\n    document.head.appendChild(script);\n  });\n  return plotlyPromise;\n};\n\n// CSRF Protection Helpers\nconst getCookie = (name: string): string | null => {\n  const v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');\n  return v ? v[2] : null;\n};\n\n// Monkey patch fetch to include CSRF token\nconst originalFetch = window.fetch;\nwindow.fetch = async (input, init) => {\n  // Only inject for same-origin requests or relative URLs to prevent leaking token\n  const url = typeof input === 'string' ? input : (input instanceof URL ? input.toString() : (input instanceof Request ? input.url : ''));\n  const isRelative = url.startsWith('/');\n  const isSameOrigin = url.startsWith(window.location.origin);\n\n  if (isRelative || isSameOrigin) {\n    const method = (init?.method || \"GET\").toUpperCase();\n    if (method !== \"GET\" && method !== \"HEAD\") {\n      const token = getCookie(\"csrf_token\");\n      if (token) {\n        init = init || {};\n        if (init.headers instanceof Headers) {\n          init.headers.append(\"X-CSRFToken\", token);\n        } else if (Array.isArray(init.headers)) {\n          (init.headers as string[][]).push([\"X-CSRFToken\", token]);\n        } else {\n          init.headers = { ...init.headers, \"X-CSRFToken\": token };\n        }\n      }\n    }\n  }\n  return originalFetch(input, init);\n};\n\n// --- Interfaces ---\n// Global Window Interface\ndeclare global {\n  interface Window {\n    switchGeometryTab: (tab: \"upload\" | \"resources\") => void;\n    fetchResourceGeometry: (btn?: HTMLElement) => void;\n    switchPage: (pageId: string) => void;\n    toggleMobileMenu: () => void;\n    uploadGeometry: (btn?: HTMLElement) => void;\n    refreshGeometryList: (btn?: HTMLElement) => void;\n    generateBlockMeshDict: (btn?: HTMLElement) => void;\n    generateSnappyHexMeshDict: (btn?: HTMLElement) => void;\n    runCommand: (cmd: string, btn?: HTMLElement) => void;\n    clearMeshingOutput: () => void;\n    copyMeshingOutput: () => void;\n    downloadMeshingLog: () => void;\n    refreshMeshes: (btn?: HTMLElement) => void;\n    viewMesh: () => void;\n    copyRunOutput: () => void;\n    confirmRunCommand: (cmd: string, btn?: HTMLElement) => void;\n    switchPostView: (view: \"landing\" | \"contour\") => void;\n    scrollToLogTop: () => void;\n    downloadLog: () => void;\n    fetchRunHistory: (btn?: HTMLElement) => void;\n  }\n}\n\ninterface RunRecord {\n  id: number;\n  case_name: string;\n  tutorial: string;\n  command: string;\n  status: string;\n  start_time: string;\n  end_time?: string;\n  execution_duration?: number;\n}\n\ninterface RunHistoryResponse extends ApiResponse {\n  runs: RunRecord[];\n}\n\ninterface ApiResponse {\n  error?: string;\n  output?: string;\n  success?: boolean;\n  message?: string;\n}\n\ninterface CaseRootResponse extends ApiResponse {\n  caseDir: string;\n}\n\ninterface DockerConfigResponse extends ApiResponse {\n  dockerImage: string;\n  openfoamVersion: string;\n}\n\ninterface TutorialLoadResponse extends ApiResponse {\n  caseDir: string;\n}\n\ninterface CaseListResponse extends ApiResponse {\n  cases: string[];\n}\n\ninterface MeshFile {\n  path: string;\n  name: string;\n  size?: number;\n  relative_path?: string;\n}\n\ninterface AvailableMeshesResponse extends ApiResponse {\n  meshes: MeshFile[];\n}\n\ninterface MeshInfo {\n  n_points: number;\n  n_cells: number;\n  bounds: number[];\n  center?: number[];\n  length?: number;\n  volume?: number;\n  array_names?: string[];\n  point_arrays?: string[];\n  cell_arrays?: string[];\n  success: boolean;\n  error?: string;\n}\n\ninterface MeshScreenshotResponse extends ApiResponse {\n  image?: string;\n}\n\ninterface PlotData extends ApiResponse {\n  time?: number[];\n  p?: number[];\n  Ux?: number[];\n  Uy?: number[];\n  Uz?: number[];\n  U_mag?: number[];\n  nut?: number[];\n  nuTilda?: number[];\n  k?: number[];\n  epsilon?: number[];\n  omega?: number[];\n  [key: string]: any;\n}\n\ninterface LatestDataResponse extends ApiResponse {\n  time?: number;\n  p?: number;\n  U_mag?: number;\n  Ux?: number;\n  Uy?: number;\n  Uz?: number;\n  [key: string]: any;\n}\n\ninterface ResidualsResponse extends ApiResponse {\n  time?: number[];\n  Ux?: number[];\n  Uy?: number[];\n  Uz?: number[];\n  p?: number[];\n  h?: number[];\n  T?: number[];\n  rho?: number[];\n  p_rgh?: number[];\n  k?: number[];\n  epsilon?: number[];\n  omega?: number[];\n}\n\ninterface PlotTrace {\n  name?: string;\n  visible?: boolean | \"legendonly\";\n  x?: any[];\n  y?: any[];\n  type?: string;\n  mode?: string;\n  line?: any;\n}\n\n// Types\ntype CameraView = \"front\" | \"back\" | \"left\" | \"right\" | \"top\" | \"bottom\";\n\n// Shared Interface for Interactive Viewers\ninterface ViewerConfig {\n  iframeId: string;\n  placeholderId: string;\n  loadingMessage: string;\n  apiUrl: string;\n  apiBody: any;\n  btnElement?: HTMLElement;\n  btnLoadingText?: string; // Optional custom text for button during load\n  imageId?: string; // Optional: ID of static image to hide (Mesh tab)\n  onSuccess?: () => void;\n  onError?: (error: unknown) => void;\n}\n\n// Common function to load interactive viewers\nconst loadInteractiveViewerCommon = async (config: ViewerConfig): Promise<void> => {\n  const iframe = document.getElementById(config.iframeId) as HTMLIFrameElement;\n  const placeholder = document.getElementById(config.placeholderId);\n  const btn = config.btnElement as HTMLButtonElement | undefined;\n\n  if (!iframe || !placeholder) return;\n\n  let originalBtnText = \"\";\n  if (btn) {\n    originalBtnText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    const loadingText = config.btnLoadingText || \"Loading...\";\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> ${loadingText}`;\n  }\n\n  showNotification(config.loadingMessage, \"info\");\n\n  try {\n    const res = await fetch(config.apiUrl, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(config.apiBody)\n    });\n\n    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);\n\n    const html = await res.text();\n    iframe.srcdoc = html;\n\n    // UI Updates\n    iframe.classList.remove(\"hidden\");\n    placeholder.classList.add(\"hidden\");\n\n    if (config.imageId) {\n      document.getElementById(config.imageId)?.classList.add(\"hidden\");\n    }\n\n    if (config.onSuccess) config.onSuccess();\n\n  } catch (e) {\n    console.error(\"Viewer load failed:\", e);\n\n    // Reset UI on failure\n    iframe.classList.add(\"hidden\");\n    placeholder.classList.remove(\"hidden\");\n    if (config.imageId) {\n      document.getElementById(config.imageId)?.classList.remove(\"hidden\");\n    }\n\n    if (config.onError) config.onError(e);\n    else showNotification(\"Failed to load viewer\", \"error\"); // Default error if no handler\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.removeAttribute(\"aria-busy\");\n      btn.innerHTML = originalBtnText;\n    }\n  }\n};\n\n// Utility functions\nconst getElement = <T extends HTMLElement>(id: string): T | null => {\n  return document.getElementById(id) as T | null;\n};\n\nconst formatBytes = (bytes: number, decimals = 1) => {\n  if (!bytes) return '0 B';\n  const k = 1024;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;\n};\n\nconst getErrorMessage = (error: unknown): string => {\n  if (error instanceof Error) return error.message;\n  return typeof error === \"string\" ? error : \"Unknown error\";\n};\n\n// Detect slow hardware (e.g. integrated graphics)\nconst detectSlowHardware = (): boolean => {\n  try {\n    const canvas = document.createElement('canvas');\n    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n    if (!gl) return true; // Assume slow if no WebGL\n\n    const debugInfo = (gl as WebGLRenderingContext).getExtension('WEBGL_debug_renderer_info');\n    if (!debugInfo) return false;\n\n    const renderer = (gl as WebGLRenderingContext).getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\n    if (!renderer) return false;\n\n    // Check for common integrated/software renderers\n    const slowRenderers = ['intel', 'swiftshader', 'llvmpipe', 'mesa', 'software'];\n    return slowRenderers.some(r => renderer.toLowerCase().includes(r));\n  } catch (e) {\n    return false; // Fail safe\n  }\n};\n\n// Clear Console Log\nconst clearLog = async (): Promise<void> => {\n  const outputDiv = document.getElementById(\"output\");\n  if (outputDiv) {\n    // ðŸŽ¨ Palette UX Improvement: Prevent accidental data loss\n    const confirmed = await showConfirmModal(\"Clear Console Log\", \"Are you sure you want to clear the console log? This cannot be undone.\");\n    if (!confirmed) return;\n\n    outputDiv.innerHTML = OUTPUT_PLACEHOLDER;\n    cachedLogHTML = \"\"; // âš¡ Bolt Optimization: clear cache\n    try {\n      localStorage.removeItem(CONSOLE_LOG_KEY);\n    } catch (e) {\n      // Ignore local storage errors\n    }\n    outputBuffer.length = 0; // Clear buffer\n    showNotification(\"Console log cleared\", \"info\", NOTIFY_MEDIUM);\n  }\n};\n\n// Helper: Show temporary success state on a button\nconst temporarilyShowSuccess = (btn: HTMLButtonElement, originalHTML: string, message: string = \"Success!\"): void => {\n  btn.disabled = false;\n  btn.removeAttribute(\"aria-busy\");\n  btn.classList.remove(\"opacity-75\", \"cursor-wait\");\n\n  // Visual feedback: Green Checkmark\n  // Note: Using !bg-green-600 to override any existing background colors\n  btn.innerHTML = `\n    <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 inline-block mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n    </svg>\n    <span>${message}</span>\n  `;\n\n  // Apply success styles\n  const successClasses = [\"!bg-green-600\", \"!border-green-600\", \"!text-white\", \"cursor-default\"];\n  btn.classList.add(...successClasses);\n\n  setTimeout(() => {\n    btn.innerHTML = originalHTML;\n    btn.classList.remove(...successClasses);\n  }, 2000);\n};\n\n// Generic Copy to Clipboard Helper\nconst copyTextFromElement = (elementId: string, successMessage: string, btnElement?: HTMLElement): void => {\n  const el = document.getElementById(elementId);\n  if (!el) return;\n\n  // innerText preserves newlines better than textContent\n  const text = el.innerText;\n  if (!text.trim()) {\n    showNotification(\"Content is empty\", \"info\", NOTIFY_MEDIUM);\n    return;\n  }\n\n  const onSuccess = () => {\n    showNotification(successMessage, \"success\", NOTIFY_MEDIUM);\n    if (btnElement) {\n      const originalHTML = btnElement.innerHTML;\n      const originalTitle = btnElement.getAttribute('title');\n\n      // Visual feedback on the button\n      btnElement.innerHTML = `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 text-green-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n          <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" />\n        </svg>\n        <span class=\"text-green-600 font-medium\">Copied!</span>\n      `;\n      btnElement.setAttribute('title', 'Copied to clipboard');\n\n      // Revert after 2 seconds\n      setTimeout(() => {\n        btnElement.innerHTML = originalHTML;\n        if (originalTitle) btnElement.setAttribute('title', originalTitle);\n        else btnElement.removeAttribute('title');\n      }, 2000);\n    }\n  };\n\n  if (navigator.clipboard && navigator.clipboard.writeText) {\n    navigator.clipboard.writeText(text).then(onSuccess).catch(() => fallbackCopyText(text, successMessage, onSuccess));\n  } else {\n    fallbackCopyText(text, successMessage, onSuccess);\n  }\n};\n\nconst fallbackCopyText = (text: string, successMessage: string, onSuccess?: () => void): void => {\n  try {\n    const textArea = document.createElement(\"textarea\");\n    textArea.value = text;\n    textArea.style.position = \"fixed\";\n    textArea.style.left = \"-9999px\";\n    textArea.style.top = \"0\";\n    document.body.appendChild(textArea);\n    textArea.focus();\n    textArea.select();\n\n    const successful = document.execCommand('copy');\n    document.body.removeChild(textArea);\n\n    if (successful) {\n      if (onSuccess) onSuccess();\n      else showNotification(successMessage, \"success\", NOTIFY_MEDIUM);\n    } else {\n      showNotification(\"Failed to copy\", \"error\");\n    }\n  } catch (err) {\n    showNotification(\"Failed to copy\", \"error\");\n  }\n};\n\n// Copy Console Log\nconst copyLogToClipboard = (btnElement?: HTMLElement): void => {\n  const outputDiv = document.getElementById(\"output\");\n  if (outputDiv && outputDiv.querySelector(\".output-placeholder\")) {\n    showNotification(\"Log is empty\", \"warning\", NOTIFY_MEDIUM);\n    return;\n  }\n  copyTextFromElement(\"output\", \"Log copied to clipboard\", btnElement);\n};\n\n// Download Console Log\nconst downloadLog = (): void => {\n  const outputDiv = document.getElementById(\"output\");\n  if (!outputDiv) {\n    showNotification(\"Console output not found\", \"error\");\n    return;\n  }\n\n  // Check for placeholder\n  const placeholder = outputDiv.querySelector(\".output-placeholder\");\n  if (placeholder) {\n    showNotification(\"Log is empty\", \"warning\", NOTIFY_SHORT);\n    return;\n  }\n\n  // Use innerText to preserve line breaks from divs\n  const text = outputDiv.innerText || outputDiv.textContent || \"\";\n\n  if (!text.trim()) {\n    showNotification(\"Log is empty\", \"warning\", NOTIFY_SHORT);\n    return;\n  }\n\n  try {\n    const blob = new Blob([text], { type: \"text/plain\" });\n    const url = URL.createObjectURL(blob);\n\n    // Create timestamped filename\n    const now = new Date();\n    // Format: YYYY-MM-DDTHH-mm-ss\n    const timestamp = now.toISOString().replace(/[:.]/g, '-').slice(0, 19);\n    const filename = `foamflask_log_${timestamp}.txt`;\n\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n\n    // Cleanup\n    setTimeout(() => {\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n    }, 100);\n\n    showNotification(\"Log download started\", \"success\", NOTIFY_SHORT);\n  } catch (e) {\n    console.error(e);\n    showNotification(\"Failed to download log\", \"error\");\n  }\n};\n\n// Copy Input to Clipboard\nconst copyInputToClipboard = (elementId: string, btnElement?: HTMLElement): void => {\n  const el = document.getElementById(elementId) as HTMLInputElement;\n  if (!el || !el.value) return;\n\n  const text = el.value;\n\n  const onSuccess = () => {\n    showNotification(\"Copied to clipboard\", \"success\", NOTIFY_SHORT);\n    if (btnElement) {\n      if (btnElement.dataset.isCopying) return;\n      btnElement.dataset.isCopying = \"true\";\n\n      const originalHTML = btnElement.innerHTML;\n      // Visual feedback: Green Checkmark\n      btnElement.innerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 text-green-600\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /></svg>`;\n\n      setTimeout(() => {\n        btnElement.innerHTML = originalHTML;\n        delete btnElement.dataset.isCopying;\n      }, 2000);\n    }\n  };\n\n  if (navigator.clipboard && navigator.clipboard.writeText) {\n    navigator.clipboard.writeText(text).then(onSuccess).catch(() => fallbackCopyText(text, \"Copied\", onSuccess));\n  } else {\n    fallbackCopyText(text, \"Copied\", onSuccess);\n  }\n};\n\n// Clear Meshing Output\nconst clearMeshingOutput = async (): Promise<void> => {\n  const div = document.getElementById(\"meshingOutput\");\n  if (div) {\n    // ðŸŽ¨ Palette UX Improvement: Prevent accidental data loss\n    const confirmed = await showConfirmModal(\"Clear Meshing Output\", \"Are you sure you want to clear the meshing output?\");\n    if (!confirmed) return;\n\n    div.innerText = \"Ready...\";\n    div.scrollTop = 0; // Reset scroll position\n    showNotification(\"Meshing output cleared\", \"info\", NOTIFY_MEDIUM);\n  }\n};\n\n// Copy Meshing Output\nconst copyMeshingOutput = (btnElement?: HTMLElement): void => {\n  copyTextFromElement(\"meshingOutput\", \"Meshing output copied\", btnElement);\n};\n\n// Download Meshing Log\nconst downloadMeshingLog = (): void => {\n  const outputDiv = document.getElementById(\"meshingOutput\");\n  if (!outputDiv) {\n    showNotification(\"Meshing output not found\", \"error\");\n    return;\n  }\n\n  // Use innerText to preserve line breaks from divs\n  const text = outputDiv.innerText || outputDiv.textContent || \"\";\n\n  if (!text.trim() || text.trim() === \"Ready...\") {\n    showNotification(\"Log is empty\", \"warning\", NOTIFY_SHORT);\n    return;\n  }\n\n  try {\n    const blob = new Blob([text], { type: \"text/plain\" });\n    const url = URL.createObjectURL(blob);\n\n    // Create timestamped filename\n    const now = new Date();\n    // Format: YYYY-MM-DDTHH-mm-ss\n    const timestamp = now.toISOString().replace(/[:.]/g, '-').slice(0, 19);\n    const filename = `meshing_log_${timestamp}.txt`;\n\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n\n    // Cleanup\n    setTimeout(() => {\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n    }, 100);\n\n    showNotification(\"Meshing log download started\", \"success\", NOTIFY_SHORT);\n  } catch (e) {\n    console.error(e);\n    showNotification(\"Failed to download meshing log\", \"error\");\n  }\n};\n\n// Storage for Console Log\nconst CONSOLE_LOG_KEY = \"foamflask_console_log\";\n\nconst OUTPUT_PLACEHOLDER = `<div class=\"output-placeholder h-full flex flex-col items-center justify-center text-gray-400 select-none opacity-50\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-16 w-16 mb-3\" fill=\"none\" viewBox=\"0 0 24 24\"\n  stroke=\"currentColor\">\n  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\"\n    d=\"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n</svg>\n<span class=\"text-sm font-medium\">Ready for output...</span>\n</div>`;\n\n// Global state\nlet caseDir: string = \"\";\nlet dockerImage: string = \"\";\nlet openfoamVersion: string = \"\";\nlet activeCase: string | null = null;\n\n// Page management\nlet currentPage: string = \"setup\";\n\n// Mesh visualization state\nlet currentMeshPath: string | null = null;\nlet availableMeshes: MeshFile[] = [];\nlet isInteractiveMode: boolean = true; // Default to interactive mode\n\n// Geometry State\nlet selectedGeometry: string | null = null;\n\n// Notification constants\nconst NOTIFY_SHORT = 1500;\nconst NOTIFY_MEDIUM = 5000;\nconst NOTIFY_LONG = 8000;\nconst NOTIFY_DEFAULT = 10000;\n\n// System constants\nconst POLL_INTERVAL = 5000;\nconst DEBOUNCE_DELAY = 5000;\nconst MAX_LOG_SIZE = 100000;\n\n// Notification management\nlet notificationId: number = 0;\nlet lastErrorNotificationTime: number = 0;\nconst ERROR_NOTIFICATION_COOLDOWN: number = 5 * 60 * 1000;\n\n// Plotting variables\nlet plotUpdateInterval: ReturnType<typeof setInterval> | null = null;\n// let wsConnection: WebSocket | null = null; // WebSocket removed in favor of polling // âš¡ Bolt Optimization: WebSocket for realtime data\nlet plotsVisible: boolean = true;\nlet aeroVisible: boolean = false;\nlet isUpdatingPlots: boolean = false;\nlet pendingPlotUpdate: boolean = false;\nlet isSimulationRunning: boolean = false; // Controls polling loop\nlet plotsInViewport: boolean = true;\nlet isFirstPlotLoad: boolean = true;\n\n// Request management\nlet abortControllers = new Map<string, AbortController>();\ninterface CacheEntry {\n  data: any;\n  timestamp: number;\n  etag?: string | null;\n  lastModified?: string | null;\n}\nlet requestCache = new Map<string, CacheEntry>();\nconst CACHE_DURATION: number = 1000;\n\nconst outputBuffer: { message: string; type: string }[] = [];\nlet outputFlushTimer: ReturnType<typeof setTimeout> | null = null;\nlet saveLogTimer: ReturnType<typeof setTimeout> | null = null;\n\n// âš¡ Bolt Optimization: maintain off-DOM cache to avoid expensive innerHTML access\nlet cachedLogHTML: string = \"\";\n\n// Save log to local storage (Debounced)\nconst saveLogToStorage = (): void => {\n  try {\n    // âš¡ Bolt Optimization: Write from string variable instead of reading DOM\n    localStorage.setItem(CONSOLE_LOG_KEY, cachedLogHTML);\n  } catch (e) {\n    console.warn(\"Failed to save console log to local storage (likely quota exceeded).\");\n  }\n};\n\nconst saveLogDebounced = (): void => {\n  if (saveLogTimer) clearTimeout(saveLogTimer);\n  saveLogTimer = setTimeout(saveLogToStorage, DEBOUNCE_DELAY);\n};\n\n// Colors\nconst plotlyColors = {\n  blue: \"#1dbde6\",\n  orange: \"#ff7f0e\",\n  green: \"#2ca02c\",\n  red: \"#d62728\",\n  purple: \"#9467bd\",\n  brown: \"#8c564b\",\n  pink: \"#e377c2\",\n  gray: \"#7f7f7f\",\n  yellow: \"#bcbd22\",\n  teal: \"#17becf\",\n  cyan: \"#17becf\",\n  magenta: \"#e377c2\",\n};\n\nconst plotLayout: Partial<Plotly.Layout> = {\n  font: { family: \"Inter, sans-serif\", size: 12 },\n  plot_bgcolor: \"rgba(255, 255, 255, 0)\",\n  paper_bgcolor: \"rgba(255, 255, 255, 0)\",\n  margin: { l: 50, r: 20, t: 60, b: 80, pad: 5 },\n  height: 400,\n  autosize: true,\n  showlegend: true,\n  legend: {\n    orientation: \"h\" as const,\n    y: -0.3,\n    x: 0.5,\n    xanchor: \"center\" as const,\n    yanchor: \"top\" as const,\n    // bgcolor: \"rgba(255, 0, 0, 0)\",\n    borderwidth: 0,\n  },\n  xaxis: { showgrid: false, linewidth: 1 },\n  yaxis: { showgrid: false, linewidth: 1 },\n};\n\nconst plotConfig: Partial<Plotly.Config> = {\n  responsive: true,\n  displayModeBar: false,\n  staticPlot: false,\n  scrollZoom: true,\n  doubleClick: \"reset+autosize\" as const,\n  showTips: false,\n  modeBarButtonsToRemove: [\n    \"zoom2d\", \"pan2d\", \"select2d\", \"lasso2d\", \"zoomIn2d\", \"zoomOut2d\", \"autoScale2d\", \"resetScale2d\",\n    \"hoverClosestCartesian\", \"hoverCompareCartesian\", \"zoom3d\", \"pan3d\", \"orbitRotation\", \"tableRotation\",\n    \"handleDrag3d\", \"resetCameraDefault3d\", \"resetCameraLastSave3d\", \"hoverClosest3d\",\n    \"sendDataToCloud\", \"toggleSpikelines\", \"setBackground\", \"toggleHover\", \"resetViews\", \"toImage\"\n  ] as any,\n  displaylogo: false,\n};\n\nconst lineStyle = { width: 2, opacity: 0.9 };\n\nconst createBoldTitle = (text: string): { text: string; font?: any } => ({\n  text: `<b>${text}</b>`,\n  font: { ...plotLayout.font, size: 22 },\n});\n\n// Helper: Download plot as PNG\nconst downloadPlotAsPNG = async (\n  plotIdOrDiv: string | any,\n  filename: string = \"plot.png\"\n): Promise<void> => {\n  try {\n    await ensurePlotlyLoaded();\n  } catch (e) {\n    showNotification(\"Failed to load plotting library\", \"error\");\n    return;\n  }\n\n  // Handle both string ID (from HTML) or direct element\n  const plotDiv = typeof plotIdOrDiv === \"string\"\n    ? document.getElementById(plotIdOrDiv)\n    : plotIdOrDiv;\n\n  if (!plotDiv) {\n    console.error(`Plot element not found: ${plotIdOrDiv}`);\n    return;\n  }\n\n  // Plotly.toImage options (layout overrides are not supported here directly)\n  Plotly.toImage(plotDiv, {\n    format: \"png\",\n    width: plotDiv.offsetWidth,\n    height: plotDiv.offsetHeight,\n    scale: 2, // Higher resolution\n  }).then((dataUrl: string) => {\n    const link = document.createElement(\"a\");\n    link.href = dataUrl;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }).catch((err: any) => {\n    console.error(\"Error downloading plot:\", err);\n  });\n};\n\n// Helper: Save current legend visibility\nconst getLegendVisibility = (\n  plotDiv: HTMLElement\n): Record<string, boolean | \"legendonly\"> => {\n  try {\n    const plotData = (plotDiv as any).data;\n    if (!Array.isArray(plotData)) {\n      return {};\n    }\n\n    const visibility: Record<string, boolean | \"legendonly\"> = {};\n\n    for (const trace of plotData) {\n      const name = trace.name ?? \"\";\n      if (!name) {\n        continue;\n      }\n\n      // trace.visible may be boolean | \"legendonly\" | undefined\n      const vis = trace.visible;\n\n      // Preserve \"legendonly\" state instead of converting it to false\n      visibility[name] = vis === \"legendonly\" ? \"legendonly\" : (vis ?? true);\n    }\n\n    return visibility;\n  } catch (error) {\n    console.warn(\"Error getting legend visibility:\", error);\n    return {};\n  }\n};\n\n// Helper: Attach white-bg download button to a plot\nconst attachWhiteBGDownloadButton = (plotDiv: any): void => {\n  if (!plotDiv || plotDiv.dataset.whiteButtonAdded) return;\n  // plotDiv.layout.paper_bgcolor = \"white\"; // Disable white BG enforcement\n  // plotDiv.layout.plot_bgcolor = \"white\";\n  plotDiv.dataset.whiteButtonAdded = \"true\";\n  const configWithWhiteBG = { ...plotDiv.fullLayout?.config, ...plotConfig };\n  configWithWhiteBG.toImageButtonOptions = {\n    format: \"png\",\n    filename: `${plotDiv.id}whitebg`,\n    height: plotDiv.clientHeight,\n    width: plotDiv.clientWidth,\n    scale: 2,\n  };\n\n  void Plotly.react(plotDiv, plotDiv.data, plotDiv.layout, configWithWhiteBG)\n    .then(() => {\n      plotDiv.dataset.whiteButtonAdded = \"true\";\n    })\n    .catch((err: unknown) => {\n      console.error(\"Plotly update failed:\", err);\n    });\n};\n\nconst downloadPlotData = (plotId: string, filename: string): void => {\n  const plotDiv = document.getElementById(plotId) as any;\n  if (!plotDiv || !plotDiv.data) return;\n  const traces = plotDiv.data;\n  traces.forEach((trace: any, index: number) => {\n    if (!trace.x || !trace.y) return;\n    let csvContent = \"x,y\\n\";\n    for (let i = 0; i < trace.x.length; i++) {\n      const x = trace.x[i] ?? \"\";\n      const y = trace.y[i] ?? \"\";\n      csvContent += `${x},${y}\\n`;\n    }\n    const traceName = trace.name?.replace(/\\s+/g, \"\").toLowerCase() || `trace${index + 1}`;\n    const traceFilename = filename.replace(\".csv\", `${traceName}.csv`);\n    try {\n      const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8\" });\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement(\"a\");\n      link.href = url;\n      link.download = traceFilename;\n      document.body.appendChild(link);\n      link.click();\n      setTimeout(() => {\n        document.body.removeChild(link);\n        window.URL.revokeObjectURL(url);\n      }, 100);\n    } catch (error: unknown) {\n      console.error(`FOAMFlask Error downloading ${traceName} data`, error);\n    }\n  });\n};\n\n// Page Switching\nconst switchPage = (pageName: string, updateUrl: boolean = true): void => {\n  console.log(`switchPage called with: ${pageName}`);\n\n  // Update URL\n  if (updateUrl) {\n    const url = new URL(window.location.href);\n    url.pathname = pageName === \"setup\" ? \"/\" : `/${pageName}`;\n    window.history.pushState({ page: pageName }, \"\", url);\n  }\n\n  const pages = [\"setup\", \"geometry\", \"meshing\", \"visualizer\", \"run\", \"plots\", \"post\"];\n  pages.forEach((page) => {\n    const pageElement = document.getElementById(`page-${page}`);\n    const navButton = document.getElementById(`nav-${page}`);\n    const mobileNavButton = document.getElementById(`mobile-nav-${page}`);\n\n    if (pageElement) pageElement.classList.add(\"hidden\");\n\n    // Desktop Reset\n    if (navButton) {\n      // navButton.classList.remove(\"bg-cyan-700\", \"text-white\"); // BG handled by pill\n      navButton.classList.remove(\"text-white\");\n      navButton.classList.add(\"text-gray-900\", \"hover:bg-gray-100/50\");\n      navButton.removeAttribute(\"aria-current\");\n    }\n\n    // Mobile Reset\n    if (mobileNavButton) {\n      mobileNavButton.classList.remove(\"bg-cyan-700\", \"text-white\");\n      mobileNavButton.classList.add(\"text-gray-700\", \"hover:text-cyan-800\", \"hover:bg-gray-50\");\n      mobileNavButton.removeAttribute(\"aria-current\");\n    }\n  });\n\n  const selectedPage = document.getElementById(`page-${pageName}`);\n  const selectedNav = document.getElementById(`nav-${pageName}`);\n  const selectedMobileNav = document.getElementById(`mobile-nav-${pageName}`);\n  const navPill = document.getElementById(\"nav-pill\");\n  const noCaseState = document.getElementById(\"no-case-state\");\n\n  // Palette UX: Enforce Active Case\n  const isProtectedPage = pageName !== \"setup\";\n  const hasActiveCase = !!activeCase;\n\n  if (isProtectedPage && !hasActiveCase) {\n    // Show empty state\n    if (noCaseState) noCaseState.classList.remove(\"hidden\");\n    // Keep page hidden (it was hidden by loop above)\n  } else {\n    // Show page content\n    if (noCaseState) noCaseState.classList.add(\"hidden\");\n    if (selectedPage) selectedPage.classList.remove(\"hidden\");\n  }\n\n  if (selectedNav) {\n    // Update Text Color\n    // selectedNav.classList.remove(\"text-gray-900\", \"hover:bg-gray-100\");\n    // selectedNav.classList.add(\"bg-cyan-700\", \"text-white\");\n    selectedNav.classList.remove(\"text-gray-900\", \"hover:bg-gray-100/50\");\n    selectedNav.classList.add(\"text-white\");\n    selectedNav.setAttribute(\"aria-current\", \"page\");\n\n    // Move Pill\n    if (navPill) {\n      navPill.style.opacity = \"1\";\n      navPill.style.left = `${selectedNav.offsetLeft}px`;\n      navPill.style.width = `${selectedNav.offsetWidth}px`;\n    }\n  }\n\n  if (selectedMobileNav) {\n    selectedMobileNav.classList.remove(\"text-gray-700\", \"hover:text-cyan-800\", \"hover:bg-gray-50\");\n    selectedMobileNav.classList.add(\"bg-cyan-700\", \"text-white\");\n    selectedMobileNav.setAttribute(\"aria-current\", \"page\");\n  }\n\n  // Skip data refresh if we are showing the empty state (no active case)\n  if (isProtectedPage && !hasActiveCase) return;\n\n  // Auto-refresh lists based on page\n  switch (pageName) {\n    case \"geometry\":\n      refreshGeometryList();\n      break;\n    case \"meshing\":\n      refreshGeometryList().then(() => {\n        const shmSelect = document.getElementById(\"shmObjectList\") as HTMLSelectElement;\n        const geoSelect = document.getElementById(\"geometrySelect\") as HTMLSelectElement;\n        if (shmSelect && geoSelect) {\n          shmSelect.innerHTML = geoSelect.innerHTML;\n        }\n      });\n      break;\n    case \"visualizer\":\n      const visualizerContainer = document.getElementById(\"page-visualizer\");\n      if (visualizerContainer && !visualizerContainer.hasAttribute(\"data-initialized\")) {\n        visualizerContainer.setAttribute(\"data-initialized\", \"true\");\n        refreshMeshList();\n      }\n      break;\n    case \"run\":\n      fetchRunHistory();\n      break;\n    case \"plots\":\n      const plotsContainer = document.getElementById(\"plotsContainer\");\n      if (plotsContainer) {\n        plotsContainer.classList.remove(\"hidden\");\n        if (isFirstPlotLoad) {\n          const loader = document.getElementById(\"plotsLoading\");\n          if (loader) loader.classList.remove(\"hidden\");\n        }\n        if (!plotsContainer.hasAttribute(\"data-initialized\")) {\n          plotsContainer.setAttribute(\"data-initialized\", \"true\");\n          if (!plotUpdateInterval) startPlotUpdates();\n        }\n      }\n      const aeroBtn = document.getElementById(\"toggleAeroBtn\");\n      if (aeroBtn) aeroBtn.classList.remove(\"hidden\");\n      break;\n    case \"post\":\n      const postContainer = document.getElementById(\"page-post\");\n      if (postContainer && !postContainer.hasAttribute(\"data-initialized\")) {\n        postContainer.setAttribute(\"data-initialized\", \"true\");\n        refreshPostList();\n      }\n      break;\n  }\n};\n\nconst setMobileMenuState = (isOpen: boolean): void => {\n  const menu = document.getElementById(\"mobile-menu\");\n  const btn = document.getElementById(\"mobile-menu-btn\");\n  const icon = document.getElementById(\"mobile-menu-icon\");\n\n  if (menu) {\n    if (isOpen) {\n      menu.classList.remove(\"hidden\");\n      btn?.setAttribute(\"aria-expanded\", \"true\");\n      // Switch to X icon\n      icon?.setAttribute(\"d\", \"M6 18L18 6M6 6l12 12\");\n    } else {\n      menu.classList.add(\"hidden\");\n      btn?.setAttribute(\"aria-expanded\", \"false\");\n      // Switch to Hamburger icon\n      icon?.setAttribute(\"d\", \"M4 6h16M4 12h16M4 18h16\");\n    }\n  }\n};\n\nconst toggleMobileMenu = () => {\n  const menu = document.getElementById(\"mobile-menu\");\n  if (menu) {\n    const isHidden = menu.classList.contains(\"hidden\");\n    setMobileMenuState(isHidden);\n  }\n};\n(window as any).toggleMobileMenu = toggleMobileMenu;\n\n// Show notification\nconst showNotification = (\n  message: string,\n  type: \"success\" | \"error\" | \"warning\" | \"info\",\n  duration: number = NOTIFY_DEFAULT\n): number | null => {\n  // If a notification with the same message already exists, do not show another one\n  // This prevents spamming the user with the same message\n  if (document.querySelector(`.notification .message-slot[data-message=\"${message}\"]`)) {\n    return null;\n  }\n\n  const container = document.getElementById(\"notificationContainer\");\n  const template = document.getElementById(\"notification-template\") as HTMLTemplateElement;\n\n  if (!container || !template) return null;\n\n  const id = ++notificationId;\n  const clone = template.content.cloneNode(true) as DocumentFragment;\n  const notification = clone.querySelector(\".notification\") as HTMLElement;\n\n  if (!notification) return null;\n\n  notification.id = `notification-${id}`;\n\n  // Set ARIA role for accessibility\n  if (type === \"error\" || type === \"warning\") {\n    notification.setAttribute(\"role\", \"alert\");\n  } else {\n    notification.setAttribute(\"role\", \"status\");\n  }\n\n  // Set colors\n  const colors = {\n    success: \"bg-green-500/80 text-white backdrop-blur-md border border-white/20 shadow-xl\",\n    error: \"bg-red-500/80 text-white backdrop-blur-md border border-white/20 shadow-xl\",\n    warning: \"bg-yellow-500/80 text-white backdrop-blur-md border border-white/20 shadow-xl\",\n    info: \"bg-cyan-600/80 text-white backdrop-blur-md border border-white/20 shadow-xl\",\n  };\n  notification.className += ` ${colors[type]}`;\n\n  // Set icon and message safely\n  const icons = { success: \"âœ“\", error: \"âœ—\", warning: \"âš \", info: \"â„¹\" };\n  const iconSlot = notification.querySelector(\".icon-slot\");\n  const messageSlot = notification.querySelector(\".message-slot\");\n\n  if (iconSlot) iconSlot.textContent = icons[type];\n  if (messageSlot) {\n    messageSlot.textContent = message;\n    // Add data attribute to help with duplicate detection\n    messageSlot.setAttribute(\"data-message\", message);\n  }\n\n  // Handle duration and progress bar\n  if (duration > 0) {\n    const progressBar = notification.querySelector(\".progress-bar\") as HTMLElement;\n    if (progressBar) {\n      progressBar.classList.remove(\"hidden\");\n      progressBar.style.width = \"100%\";\n      progressBar.style.transition = `width ${duration}ms linear`;\n\n      // Trigger reflow to ensure transition works\n      requestAnimationFrame(() => {\n        progressBar.style.width = \"0%\";\n      });\n    }\n\n    // Countdown logic\n    // Add fade-out class 300ms before removal\n    const fadeTime = Math.max(0, duration - 300);\n\n    // Timer for fade out animation\n    const fadeTimer = setTimeout(() => {\n      notification.classList.add(\"fade-out\");\n    }, fadeTime);\n\n    // Timer for actual removal\n    const countdownInterval = setTimeout(() => {\n      removeNotification(id);\n    }, duration);\n\n    notification.dataset.timerId = countdownInterval.toString();\n    notification.dataset.fadeTimerId = fadeTimer.toString();\n  }\n\n  // Setup close button for all notifications\n  const closeBtn = notification.querySelector(\".close-btn\") as HTMLElement;\n  if (closeBtn) {\n    closeBtn.onclick = (e) => {\n      e.stopPropagation();\n      removeNotification(id);\n    };\n  }\n\n  container.appendChild(notification);\n  return id;\n};\n\nconst removeNotification = (id: number): void => {\n  const notification = document.getElementById(`notification-${id}`);\n  if (notification) {\n    if (notification.dataset.timerId)\n      clearTimeout(parseInt(notification.dataset.timerId, 10));\n    if (notification.dataset.fadeTimerId)\n      clearTimeout(parseInt(notification.dataset.fadeTimerId, 10));\n\n    // Ensure fade-out class is present for manual dismissals\n    notification.classList.add(\"fade-out\");\n\n    // Wait for animation then remove\n    setTimeout(() => notification.remove(), 300);\n  }\n};\n\n// Confirmation Modal\nconst showConfirmModal = (title: string, message: string): Promise<boolean> => {\n  return new Promise((resolve) => {\n    // Capture previous focus to restore later\n    const previousActiveElement = document.activeElement as HTMLElement;\n\n    const modal = document.createElement(\"div\");\n    modal.className = \"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-gray-900/50 backdrop-blur-sm transition-opacity opacity-0\";\n    modal.setAttribute(\"role\", \"dialog\");\n    modal.setAttribute(\"aria-modal\", \"true\");\n    modal.setAttribute(\"aria-labelledby\", \"confirm-title\");\n    modal.setAttribute(\"aria-describedby\", \"confirm-desc\");\n\n    modal.innerHTML = `\n      <div class=\"bg-white rounded-xl shadow-2xl max-w-md w-full overflow-hidden transform scale-95 transition-transform duration-200\">\n        <div class=\"p-6\">\n          <h3 id=\"confirm-title\" class=\"text-xl font-bold text-gray-900 mb-2\">${title}</h3>\n          <p id=\"confirm-desc\" class=\"text-gray-600 mb-6\">${message}</p>\n          <div class=\"flex justify-end gap-3\">\n            <button id=\"confirm-cancel\" class=\"px-4 py-2 rounded-lg text-gray-700 hover:bg-gray-100 font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300\">Cancel</button>\n            <button id=\"confirm-ok\" class=\"px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 shadow-sm\">Confirm</button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    document.body.appendChild(modal);\n\n    // Animation\n    requestAnimationFrame(() => {\n      modal.classList.remove(\"opacity-0\");\n      modal.querySelector(\"div\")?.classList.remove(\"scale-95\");\n      modal.querySelector(\"div\")?.classList.add(\"scale-100\");\n    });\n\n    const close = (result: boolean) => {\n      modal.classList.add(\"opacity-0\");\n      setTimeout(() => modal.remove(), 200);\n      resolve(result);\n      document.removeEventListener(\"keydown\", handleKey);\n      // Restore focus\n      if (previousActiveElement && typeof previousActiveElement.focus === \"function\") {\n        previousActiveElement.focus();\n      }\n    };\n\n    const cancelBtn = modal.querySelector(\"#confirm-cancel\") as HTMLElement;\n    const okBtn = modal.querySelector(\"#confirm-ok\") as HTMLElement;\n\n    const handleKey = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") close(false);\n      // Only trigger confirm on Enter if we are not on the Cancel button\n      if (e.key === \"Enter\" && document.activeElement !== cancelBtn) close(true);\n\n      // Focus Trap\n      if (e.key === \"Tab\") {\n        e.preventDefault();\n        const focusableElements = [cancelBtn, okBtn];\n        const firstElement = focusableElements[0];\n        const lastElement = focusableElements[focusableElements.length - 1];\n\n        if (e.shiftKey) {\n          if (document.activeElement === firstElement) {\n            lastElement.focus();\n          } else {\n            // Find previous element or default to last\n            const idx = focusableElements.indexOf(document.activeElement as HTMLElement);\n            if (idx > 0) focusableElements[idx - 1].focus();\n            else lastElement.focus();\n          }\n        } else {\n          if (document.activeElement === lastElement) {\n            firstElement.focus();\n          } else {\n            // Find next element or default to first\n            const idx = focusableElements.indexOf(document.activeElement as HTMLElement);\n            if (idx >= 0 && idx < focusableElements.length - 1) focusableElements[idx + 1].focus();\n            else firstElement.focus();\n          }\n        }\n      }\n    };\n    document.addEventListener(\"keydown\", handleKey);\n\n    cancelBtn.onclick = () => close(false);\n    okBtn.onclick = () => close(true);\n\n    // Focus management\n    setTimeout(() => cancelBtn.focus(), 50);\n  });\n};\n\n// Network\nconst fetchWithCache = async <T = any>(\n  url: string,\n  options: RequestInit = {}\n): Promise<T> => {\n  // Robust access to cache\n  let cacheMap = requestCache;\n  if (!cacheMap) {\n    // Fallback to window global if local is lost (module reload issue)\n    if ((window as any)._requestCache) cacheMap = (window as any)._requestCache;\n    else {\n      cacheMap = new Map<string, CacheEntry>();\n      if (typeof window !== 'undefined') (window as any)._requestCache = cacheMap;\n    }\n    requestCache = cacheMap;\n  }\n\n  if (!cacheMap) {\n    cacheMap = new Map<string, CacheEntry>();\n    requestCache = cacheMap;\n  }\n\n  const cacheKey = `${url}${JSON.stringify(options)}`;\n  const cached = cacheMap.get(cacheKey);\n  // 1. Local Cache Check\n  if (cached && Date.now() - cached.timestamp < CACHE_DURATION)\n    return cached.data as T;\n\n  if (abortControllers.has(url)) abortControllers.get(url)?.abort();\n  const controller = new AbortController();\n  abortControllers.set(url, controller);\n\n  try {\n    // 2. Prepare headers for Conditional GET\n    // âš¡ Bolt Optimization: Use manual Conditional GET to avoid JSON parsing for 304 responses\n    const fetchOptions = { ...options, signal: controller.signal };\n    if (cached) {\n      const headers = new Headers(fetchOptions.headers || {});\n      if (cached.etag) headers.set(\"If-None-Match\", cached.etag);\n      if (cached.lastModified) headers.set(\"If-Modified-Since\", cached.lastModified);\n      fetchOptions.headers = headers;\n    }\n\n    const response = await fetch(url, fetchOptions);\n\n    // 3. Handle 304 Not Modified\n    // Browser might handle 304 transparently (returning 200), but if we force headers or cache is disabled,\n    // we get 304. We handle it explicitly to save JSON parsing cost.\n    if (response.status === 304 && cached) {\n      cached.timestamp = Date.now();\n      // Update headers if provided\n      const newEtag = response.headers.get(\"ETag\");\n      const newLastModified = response.headers.get(\"Last-Modified\");\n      if (newEtag) cached.etag = newEtag;\n      if (newLastModified) cached.lastModified = newLastModified;\n\n      cacheMap.set(cacheKey, cached);\n      return cached.data as T;\n    }\n\n    if (!response.ok) {\n      let errorMessage = `HTTP error! status: ${response.status}`;\n      try {\n        const errorData = await response.json();\n        if (errorData.message) errorMessage = errorData.message;\n        else if (errorData.error) errorMessage = errorData.error;\n        else if (errorData.output) errorMessage = errorData.output;\n      } catch (e) {\n        // Ignore json parse error\n      }\n      throw new Error(errorMessage);\n    }\n    const data = await response.json();\n\n    // Check cacheMap again in case it was lost during await (unlikely with local var but safe)\n    if (!cacheMap) cacheMap = requestCache || (window as any)._requestCache || new Map();\n\n    cacheMap.set(cacheKey, {\n      data,\n      timestamp: Date.now(),\n      etag: response.headers.get(\"ETag\"),\n      lastModified: response.headers.get(\"Last-Modified\")\n    });\n    return data as T;\n  } finally {\n    abortControllers.delete(url);\n  }\n};\n\n// Logging\nconst appendOutput = (message: string, type: string): void => {\n  outputBuffer.push({ message, type });\n  // âš¡ Bolt Optimization: Throttle updates to ~30fps (32ms) instead of debouncing\n  if (!outputFlushTimer) {\n    outputFlushTimer = setTimeout(flushOutputBuffer, 32);\n  }\n};\n\nconst limitLogSize = (): void => {\n  const container = document.getElementById(\"output\");\n  if (!container) return;\n\n  const MAX_NODES = 2500;\n  const PRUNE_TARGET = 2000;\n\n  if (container.childElementCount > MAX_NODES) {\n    const toRemove = container.childElementCount - PRUNE_TARGET;\n    // âš¡ Bolt Optimization: Batch removal using Range to minimize layout thrashing\n    // Traversing to find the boundary is O(N) but avoids N layout invalidations (reflows) caused by repeated removeChild\n    const range = document.createRange();\n    range.setStart(container, 0);\n\n    let boundary = container.firstElementChild;\n    for (let i = 0; i < toRemove && boundary; i++) {\n      boundary = boundary.nextElementSibling;\n    }\n\n    if (boundary) {\n      range.setEndBefore(boundary);\n      range.deleteContents();\n    } else {\n      // If we traversed past the end, clear everything (fallback)\n      container.innerHTML = \"\";\n    }\n  }\n};\n\nconst flushOutputBuffer = (): void => {\n  if (outputBuffer.length === 0) {\n    outputFlushTimer = null;\n    return;\n  }\n  const container = document.getElementById(\"output\");\n  if (!container) {\n    outputFlushTimer = null;\n    return;\n  }\n\n  // Remove placeholder if present\n  const placeholder = container.querySelector(\".output-placeholder\");\n  if (placeholder) {\n    placeholder.remove();\n  }\n\n  // âš¡ Bolt Optimization: Check scroll position BEFORE appending to avoid layout thrashing\n  // Check if user is near bottom (within 50px tolerance)\n  const isAtBottom = container.scrollHeight - container.scrollTop - container.clientHeight <= 50;\n\n  let newHtmlChunks = \"\"; // âš¡ Bolt Optimization: Accumulate HTML for cache\n\n  // Helper for manual HTML escaping (significantly faster than browser serialization)\n  const escapeHtml = (str: string) => {\n    return str\n      .replace(/&/g, \"&amp;\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\")\n      .replace(/\"/g, \"&quot;\")\n      .replace(/'/g, \"&#039;\");\n  };\n\n  outputBuffer.forEach(({ message, type }) => {\n    // Determine class name\n    let className = \"text-green-700\";\n    if (type === \"stderr\") className = \"text-red-600\";\n    else if (type === \"tutorial\") className = \"text-cyan-600 font-semibold\";\n    else if (type === \"info\") className = \"text-yellow-600 italic\";\n\n    // âš¡ Bolt Optimization: Direct string construction + insertAdjacentHTML\n    // Removes overhead of document.createElement() and .textContent assignments (O(N) -> O(1) DOM touches)\n    const safeMessage = escapeHtml(message);\n    newHtmlChunks += `<div class=\"${className}\">${safeMessage}</div>`;\n  });\n\n  container.insertAdjacentHTML(\"beforeend\", newHtmlChunks);\n  // âš¡ Bolt Optimization: Limit DOM size\n  limitLogSize();\n\n  cachedLogHTML += newHtmlChunks; // âš¡ Bolt Optimization: Append to cache\n\n  // âš¡ Bolt Optimization: Cap the size of cachedLogHTML to prevent memory issues and localStorage quota errors\n  const MAX_LOG_LENGTH = MAX_LOG_SIZE; // 100KB\n  if (cachedLogHTML.length > MAX_LOG_LENGTH * 1.5) {\n    const slice = cachedLogHTML.slice(-MAX_LOG_LENGTH);\n    // Ensure we cut at a clean tag boundary\n    const firstDiv = slice.indexOf(\"<div\");\n    if (firstDiv !== -1) {\n      cachedLogHTML = slice.substring(firstDiv);\n    }\n  }\n\n  // Only force scroll if user was already at the bottom\n  if (isAtBottom) {\n    container.scrollTop = container.scrollHeight;\n  }\n\n  outputBuffer.length = 0;\n  outputFlushTimer = null;\n\n  // Save to LocalStorage (Debounced)\n  saveLogDebounced();\n};\n\n// Setup Functions\n\n\nconst setDockerConfig = async (image: string, version: string, btnElement?: HTMLElement): Promise<void> => {\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n  let success = false;\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>Updating...`;\n  }\n\n  try {\n    dockerImage = image;\n    openfoamVersion = version;\n    const response = await fetch(\"/set_docker_config\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ dockerImage, openfoamVersion }) });\n    const data = await response.json() as DockerConfigResponse;\n    if (!response.ok) throw new Error(data.output || data.message || \"Unknown error\");\n\n    dockerImage = data.dockerImage;\n    openfoamVersion = data.openfoamVersion;\n\n    const openfoamRootInput = document.getElementById(\"openfoamRoot\");\n    if (openfoamRootInput instanceof HTMLInputElement) {\n      openfoamRootInput.value = `${dockerImage} OpenFOAM ${openfoamVersion}`;\n    }\n\n    showNotification(\"Docker config updated\", \"success\");\n    success = true;\n  } catch (e) {\n    showNotification(`Failed to set Docker config: ${getErrorMessage(e)}`, \"error\");\n  } finally {\n    if (btn) {\n      if (success) {\n        temporarilyShowSuccess(btn, originalText, \"Updated!\");\n      } else {\n        btn.disabled = false;\n        btn.removeAttribute(\"aria-busy\");\n        btn.innerHTML = originalText;\n      }\n    }\n  }\n};\n\nconst loadTutorial = async (): Promise<void> => {\n  const btn = document.getElementById(\"loadTutorialBtn\") as HTMLButtonElement | null;\n  const originalText = btn ? btn.innerHTML : \"Import Tutorial\";\n  let success = false;\n\n  try {\n    if (btn) {\n      btn.disabled = true;\n      btn.setAttribute(\"aria-busy\", \"true\");\n      btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>Importing...`;\n    }\n\n    const tutorialSelect = document.getElementById(\"tutorialSelect\") as HTMLSelectElement;\n    const selected = tutorialSelect.value;\n    if (selected) localStorage.setItem(\"lastSelectedTutorial\", selected);\n    showNotification(\"Importing tutorial...\", \"info\");\n    const response = await fetch(\"/load_tutorial\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ tutorial: selected }) });\n    const data = await response.json() as TutorialLoadResponse;\n    if (!response.ok) throw new Error(data.output || data.message || \"Unknown error\");\n\n    if (data.output) {\n      data.output.split(\"\\n\").forEach((line: string) => {\n        if (line.trim()) appendOutput(line.trim(), \"info\");\n      });\n    }\n\n    showNotification(\"Tutorial imported\", \"success\");\n    await refreshCaseList();\n    const importedName = selected.split('/').pop();\n    if (importedName) {\n      selectCase(importedName);\n      const select = document.getElementById(\"caseSelect\") as HTMLSelectElement;\n      if (select) select.value = importedName;\n      // UX: Default to \"From Resources\" tab for imported tutorials\n      switchGeometryTab(\"resources\");\n\n      // Background fetch of plot data and residuals to warm up cache\n      // We don't await these to avoid blocking the UI\n      void fetch(`/api/plot_data?tutorial=${encodeURIComponent(importedName)}`).catch(() => { });\n      void fetch(`/api/residuals?tutorial=${encodeURIComponent(importedName)}`).catch(() => { });\n    }\n    success = true;\n  } catch (e) {\n    showNotification(`Failed to load tutorial: ${getErrorMessage(e)}`, \"error\");\n  } finally {\n    if (btn) {\n      if (success) {\n        temporarilyShowSuccess(btn, originalText, \"Imported!\");\n      } else {\n        btn.disabled = false;\n        btn.removeAttribute(\"aria-busy\");\n        btn.innerHTML = originalText;\n      }\n    }\n  }\n};\n\n// Toggle Section Visibility\nconst toggleSection = (id: string): void => {\n  const section = document.getElementById(id);\n  const toggleIcon = document.getElementById(`${id}Toggle`);\n\n  if (!section || !toggleIcon) return;\n\n  const isHidden = section.classList.contains(\"hidden\");\n\n  if (isHidden) {\n    section.classList.remove(\"hidden\");\n    toggleIcon.textContent = \"â–¼\";\n    toggleIcon.classList.remove(\"-rotate-90\");\n    // If it's a button (accessible version), update aria-expanded\n    const toggleBtn = toggleIcon.parentElement?.tagName === \"BUTTON\" ? toggleIcon.parentElement : null;\n    if (toggleBtn) toggleBtn.setAttribute(\"aria-expanded\", \"true\");\n  } else {\n    section.classList.add(\"hidden\");\n    toggleIcon.textContent = \"â–¶\";\n    toggleIcon.classList.add(\"-rotate-90\");\n    // If it's a button (accessible version), update aria-expanded\n    const toggleBtn = toggleIcon.parentElement?.tagName === \"BUTTON\" ? toggleIcon.parentElement : null;\n    if (toggleBtn) toggleBtn.setAttribute(\"aria-expanded\", \"false\");\n  }\n};\n\n// Case Management\nconst updateActiveCaseBadge = () => {\n  const badge = document.getElementById(\"activeCaseBadge\");\n  if (badge) {\n    if (activeCase) {\n      badge.textContent = activeCase;\n      badge.classList.remove(\"hidden\");\n      badge.title = `Active Case: ${activeCase} (Click to change)`;\n      badge.setAttribute(\"aria-label\", `Current active case: ${activeCase}. Click to go to setup.`);\n    } else {\n      badge.textContent = \"No Case\";\n      badge.classList.remove(\"hidden\");\n      badge.title = \"No Active Case (Click to Select)\";\n      badge.setAttribute(\"aria-label\", \"No active case selected. Click to go to setup.\");\n    }\n  }\n};\n\nconst refreshCaseList = async (btnElement?: HTMLElement) => {\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.classList.add(\"opacity-75\", \"cursor-wait\");\n    // Preserve the icon if it exists, but spin it\n    if (btn.querySelector(\"svg\")) {\n      // Since we know the structure from HTML, we can just replace innerHTML for simplicity\n      // or toggle a class. But let's follow the pattern used elsewhere.\n      // However, the Refresh button has text \"â†» Refresh\".\n      btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path></svg> Refreshing...`;\n    } else {\n      // Fallback or just standard spinner\n      btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> Refreshing...`;\n    }\n  }\n\n  try {\n    const response = await fetch(\"/api/cases/list\");\n    if (!response.ok) throw new Error(\"Failed to fetch cases\");\n    const data = await response.json() as CaseListResponse;\n    const select = document.getElementById(\"caseSelect\") as HTMLSelectElement;\n    if (select && data.cases) {\n      const current = select.value;\n      if (data.cases.length === 0) {\n        select.innerHTML = '<option value=\"\" disabled selected>No cases found</option>';\n      } else {\n        select.innerHTML = '<option value=\"\">-- Select a Case --</option>';\n        data.cases.forEach(c => {\n          const opt = document.createElement(\"option\");\n          opt.value = c;\n          opt.textContent = c;\n          select.appendChild(opt);\n        });\n        if (current && data.cases.includes(current)) select.value = current;\n        else if (activeCase && data.cases.includes(activeCase)) select.value = activeCase;\n      }\n\n      // ðŸŽ¨ Sync Active Case: If current activeCase is missing, clear it\n      if (activeCase && !data.cases.includes(activeCase)) {\n        console.log(`Sync: Active case ${activeCase} no longer found. Clearing.`);\n        activeCase = null;\n        localStorage.removeItem(\"lastSelectedCase\");\n        updateActiveCaseBadge();\n      }\n    }\n    // Only show success notification if invoked manually (via button)\n    if (btn) showNotification(\"Case list refreshed\", \"success\", NOTIFY_MEDIUM);\n  } catch (e) {\n    console.error(e);\n    if (btn) showNotification(\"Failed to refresh case list\", \"error\");\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.removeAttribute(\"aria-busy\");\n      btn.classList.remove(\"opacity-75\", \"cursor-wait\");\n      btn.innerHTML = originalText;\n    }\n  }\n};\n\nconst selectCase = (val: string) => {\n  activeCase = val;\n  localStorage.setItem(\"lastSelectedCase\", val);\n  updateActiveCaseBadge();\n};\n\nconst createNewCase = async () => {\n  const caseName = (document.getElementById(\"newCaseName\") as HTMLInputElement).value;\n  if (!caseName) { showNotification(\"Enter case name\", \"warning\"); return; }\n\n  const btn = document.getElementById(\"createCaseBtn\") as HTMLButtonElement | null;\n  const originalText = btn ? btn.innerHTML : \"Create Case\";\n  let success = false;\n\n  if (btn) {\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> Creating...`;\n  }\n\n  showNotification(`Creating case ${caseName}...`, \"info\");\n  try {\n    const response = await fetch(\"/api/case/create\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ caseName }) });\n    const data = await response.json();\n    if (data.success) {\n      showNotification(\"Case created\", \"success\");\n      (document.getElementById(\"newCaseName\") as HTMLInputElement).value = \"\";\n      await refreshCaseList();\n      selectCase(caseName);\n      const select = document.getElementById(\"caseSelect\") as HTMLSelectElement;\n      if (select) select.value = caseName;\n      success = true;\n    } else { showNotification(data.message || \"Failed\", \"error\"); }\n  } catch (e) { showNotification(\"Error creating case\", \"error\"); }\n  finally {\n    if (btn) {\n      if (success) {\n        temporarilyShowSuccess(btn, originalText, \"Created!\");\n      } else {\n        btn.disabled = false;\n        btn.removeAttribute(\"aria-busy\");\n        btn.innerHTML = originalText;\n      }\n    }\n  }\n};\n\nconst confirmRunCommand = async (cmd: string, btnElement?: HTMLElement): Promise<void> => {\n  // Check for destructive commands\n  if (cmd.includes(\"Allclean\") || cmd.includes(\"clean\")) {\n    const confirmed = await showConfirmModal(\"Run Command\", `Are you sure you want to run '${cmd}'? This may delete generated files.`);\n    if (!confirmed) return;\n  }\n  runCommand(cmd, btnElement);\n};\n\nconst getStatusIcon = (status: string): string => {\n  if (status === \"Completed\") return `<svg class=\"w-3.5 h-3.5 mr-1.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path></svg>`;\n  if (status === \"Failed\") return `<svg class=\"w-3.5 h-3.5 mr-1.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path></svg>`;\n  if (status === \"Running\") return `<svg class=\"animate-spin w-3.5 h-3.5 mr-1.5\" fill=\"none\" viewBox=\"0 0 24 24\" aria-hidden=\"true\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>`;\n  return \"\";\n};\n\nconst fetchRunHistory = async (btnElement?: HTMLElement) => {\n  const container = document.getElementById(\"runHistoryList\");\n  if (!container) return;\n\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.classList.add(\"cursor-wait\", \"opacity-75\");\n    // Use smaller spinner for this small button\n    btn.innerHTML = `<svg class=\"animate-spin h-3 w-3 inline-block mr-1\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path></svg> Refreshing...`;\n  }\n\n  try {\n    const response = await fetch(\"/api/runs\");\n    if (!response.ok) throw new Error(\"Failed to fetch runs\");\n    const data = await response.json() as RunHistoryResponse;\n\n    if (data.runs && data.runs.length > 0) {\n      container.innerHTML = data.runs.map(run => {\n        let statusColor = \"bg-gray-100 text-gray-800\";\n        if (run.status === \"Completed\") statusColor = \"bg-green-100 text-green-800\";\n        else if (run.status === \"Failed\") statusColor = \"bg-red-100 text-red-800\";\n        else if (run.status === \"Running\") statusColor = \"bg-blue-100 text-blue-800\";\n\n        const startTime = new Date(run.start_time).toLocaleString();\n        const duration = run.execution_duration ? `${run.execution_duration.toFixed(2)}s` : \"-\";\n\n        return `\n          <tr class=\"hover:bg-gray-50 transition-colors border-b last:border-b-0 border-gray-100\">\n            <td class=\"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900\">#${run.id}</td>\n            <td class=\"px-4 py-3 whitespace-nowrap text-sm text-gray-600\">${run.command}</td>\n            <td class=\"px-4 py-3 whitespace-nowrap\">\n              <span class=\"px-2 py-0.5 inline-flex items-center text-xs leading-5 font-semibold rounded-full ${statusColor}\">\n                ${getStatusIcon(run.status)}\n                ${run.status}\n              </span>\n            </td>\n            <td class=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\">${duration}</td>\n            <td class=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\">${startTime}</td>\n          </tr>\n        `;\n      }).join(\"\");\n    } else {\n      container.innerHTML = `<tr><td colspan=\"5\" class=\"px-4 py-4 text-center text-sm text-gray-500\">No run history available</td></tr>`;\n    }\n\n    if (btn) showNotification(\"Run history refreshed\", \"success\", NOTIFY_SHORT);\n  } catch (e) {\n    console.error(\"Error fetching run history:\", e);\n    container.innerHTML = `<tr><td colspan=\"5\" class=\"px-4 py-4 text-center text-sm text-red-500\">Failed to load history</td></tr>`;\n    if (btn) showNotification(\"Failed to refresh run history\", \"error\");\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.classList.remove(\"cursor-wait\", \"opacity-75\");\n      btn.innerHTML = originalText;\n    }\n  }\n};\n(window as any).fetchRunHistory = fetchRunHistory;\n\nconst runCommand = async (cmd: string, btnElement?: HTMLElement): Promise<void> => {\n  if (!cmd) { showNotification(\"No command specified\", \"error\"); return; }\n\n  // Use tutorial select if activeCase is not set, or prefer tutorial select for \"Run\" tab\n  const selectedTutorial = (document.getElementById(\"tutorialSelect\") as HTMLSelectElement)?.value || activeCase;\n\n  if (!selectedTutorial) { showNotification(\"Select case and command\", \"error\"); return; }\n\n  let originalText = \"\";\n  const btn = btnElement as HTMLButtonElement;\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>Running...`;\n  }\n\n  // Optimistically refresh list to show \"Running\" state\n  // We wait a tick to allow the backend (previous implementation step) to create the record\n  setTimeout(fetchRunHistory, 500);\n\n  try {\n    showNotification(`Running ${cmd}...`, \"info\");\n    const response = await fetch(\"/run\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ caseDir, tutorial: selectedTutorial, command: cmd }) });\n    if (!response.ok) throw new Error();\n    const reader = response.body?.getReader();\n    const decoder = new TextDecoder();\n\n    // Start polling immediately when command starts\n    isSimulationRunning = true;\n    startPlotUpdates();\n\n    let buffer = \"\";\n    while (true) {\n      const { done, value } = (await reader?.read()) || { done: true, value: undefined };\n      if (done) {\n        if (buffer) appendOutput(buffer, \"stdout\"); // Flush remaining buffer\n        showNotification(\"Simulation completed successfully\", \"success\");\n        flushOutputBuffer();\n        break;\n      }\n\n      // âš¡ Bolt Optimization: Stream decoding and buffering for split packets\n      const text = decoder.decode(value, { stream: true });\n      buffer += text;\n\n      const lines = buffer.split(\"\\n\");\n      // Keep the last part in buffer as it might be incomplete\n      buffer = lines.pop() || \"\";\n\n      lines.forEach(line => {\n        // Filter out backend HTML artifacts if any remain (transition period)\n        const cleanLine = line.replace(/<br>/g, \"\").trim();\n        if (cleanLine) appendOutput(cleanLine, \"stdout\");\n      });\n    }\n  } catch (err) {\n    console.error(err); // Keep console error for debugging\n    showNotification(`Error: ${err}`, \"error\");\n  } finally {\n    const btn = btnElement as HTMLButtonElement;\n    if (btn) {\n      btn.disabled = false;\n      btn.removeAttribute(\"aria-busy\");\n      btn.innerHTML = originalText;\n    }\n    isSimulationRunning = false;\n    updatePlots(); // Final update to catch last data\n    fetchRunHistory(); // Refresh history table\n  }\n};\n\n// Realtime Plotting Functions\nconst togglePlots = (): void => {\n  plotsVisible = !plotsVisible;\n  const container = document.getElementById(\"plotsContainer\");\n  const btn = document.getElementById(\"togglePlotsBtn\");\n  const aeroBtn = document.getElementById(\"toggleAeroBtn\");\n  if (plotsVisible) {\n    container?.classList.remove(\"hidden\");\n    if (btn) btn.textContent = \"Hide Plots\";\n    aeroBtn?.classList.remove(\"hidden\");\n    startPlotUpdates();\n    setupIntersectionObserver();\n  } else {\n    container?.classList.add(\"hidden\");\n    if (btn) btn.textContent = \"Show Plots\";\n    aeroBtn?.classList.add(\"hidden\");\n    stopPlotUpdates();\n  }\n};\n\nconst setupIntersectionObserver = (): void => {\n  const plotsContainer = document.getElementById(\"plotsContainer\");\n  if (!plotsContainer || plotsContainer.dataset.observerSetup) return;\n  const observer = new IntersectionObserver(\n    (entries) => {\n      entries.forEach((entry) => {\n        plotsInViewport = entry.isIntersecting;\n      });\n    },\n    { threshold: 0.1, rootMargin: \"50px\" }\n  );\n  observer.observe(plotsContainer);\n  plotsContainer.dataset.observerSetup = \"true\";\n};\n\nconst toggleAeroPlots = (): void => {\n  aeroVisible = !aeroVisible;\n  const container = document.getElementById(\"aeroContainer\");\n  const btn = document.getElementById(\"toggleAeroBtn\");\n  if (aeroVisible) {\n    container?.classList.remove(\"hidden\");\n    if (btn) btn.textContent = \"Hide Aero Plots\";\n    updateAeroPlots();\n  } else {\n    container?.classList.add(\"hidden\");\n    if (btn) btn.textContent = \"Show Aero Plots\";\n  }\n};\n\nconst startPlotUpdates = (): void => {\n  const selectedTutorial = (document.getElementById(\"tutorialSelect\") as HTMLSelectElement)?.value;\n  if (!selectedTutorial) return;\n\n  // Flask-Only: Use polling directly\n  updatePlots();\n  startPolling();\n};\n\nconst startPolling = (): void => {\n  if (plotUpdateInterval) return;\n  plotUpdateInterval = setInterval(() => {\n    // âš¡ Bolt Optimization: Pause polling when tab is hidden\n    if (document.hidden) return;\n\n    // Stop if simulation not running\n    if (!isSimulationRunning) {\n      stopPlotUpdates();\n      return;\n    }\n\n    if (!plotsInViewport) return;\n    if (!isUpdatingPlots) updatePlots();\n    else pendingPlotUpdate = true;\n  }, POLL_INTERVAL);\n};\n\nconst stopPlotUpdates = (): void => {\n  if (plotUpdateInterval) {\n    clearInterval(plotUpdateInterval);\n    plotUpdateInterval = null;\n  }\n};\n\nconst updateResidualsPlot = async (tutorial: string, injectedData?: ResidualsResponse): Promise<void> => {\n  try {\n    await ensurePlotlyLoaded();\n\n    let data = injectedData;\n    if (!data) {\n      data = await fetchWithCache<ResidualsResponse>(\n        `/api/residuals?tutorial=${encodeURIComponent(tutorial)}`\n      );\n    }\n\n    if (data.error || !data.time || data.time.length === 0) {\n      return;\n    }\n    const traces: any[] = [];\n    const fields = [\"Ux\", \"Uy\", \"Uz\", \"p\", \"h\", \"T\", \"rho\", \"p_rgh\", \"k\", \"epsilon\", \"omega\"] as const;\n    const colors = [\n      plotlyColors.blue,\n      plotlyColors.red,\n      plotlyColors.green,\n      plotlyColors.magenta,\n      plotlyColors.cyan,\n      plotlyColors.orange,\n      plotlyColors.purple,\n      plotlyColors.brown,\n      plotlyColors.pink,\n      plotlyColors.gray,\n      plotlyColors.yellow,\n    ];\n    fields.forEach((field, idx) => {\n      const fieldData = (data as any)[field];\n      if (fieldData && fieldData.length > 0) {\n        traces.push({\n          x: Array.from({ length: fieldData.length }, (_, i) => i + 1),\n          y: fieldData,\n          type: \"scattergl\",\n          mode: \"lines\",\n          name: field,\n          line: { color: colors[idx], width: 2.5, shape: \"linear\" },\n        });\n      }\n    });\n    if (traces.length > 0) {\n      const residualsPlotDiv = getElement<HTMLElement>(\"residuals-plot\");\n\n      if (residualsPlotDiv) {\n        const layout = {\n          ...plotLayout,\n          title: createBoldTitle(\"Residuals\"),\n          xaxis: {\n            title: { text: \"Iteration\" },\n            showline: true,\n            mirror: \"all\",\n            showgrid: false,\n          },\n          yaxis: {\n            title: { text: \"Residual\" },\n            type: \"log\",\n            showline: true,\n            mirror: \"all\",\n            showgrid: true,\n            gridwidth: 1,\n            gridcolor: \"rgba(0,0,0,0.1)\",\n          },\n        };\n        void Plotly.react(residualsPlotDiv, traces as any, layout as any, {\n          ...plotConfig,\n          displayModeBar: true,\n          scrollZoom: false,\n        }).then(() => attachWhiteBGDownloadButton(residualsPlotDiv));\n      }\n    }\n  } catch (error: unknown) {\n    console.error(\"FOAMFlask Error updating residuals\", error);\n  }\n};\n\nconst updateAeroPlots = async (preFetchedData?: PlotData): Promise<void> => {\n  const selectedTutorial = (\n    document.getElementById(\"tutorialSelect\") as HTMLSelectElement\n  )?.value;\n  if (!selectedTutorial) return;\n  try {\n    await ensurePlotlyLoaded();\n\n    let data = preFetchedData;\n\n    // âš¡ Bolt Optimization: Use pre-fetched data if available to save a network request\n    if (!data) {\n      const response = await fetch(\n        `/api/plot_data?tutorial=${encodeURIComponent(selectedTutorial)}`\n      );\n      data = await response.json() as PlotData;\n    }\n\n    if (data.error) return;\n\n    // Cp plot\n    if (\n      Array.isArray(data.p) &&\n      Array.isArray(data.time) &&\n      data.p.length === data.time.length &&\n      data.p.length > 0\n    ) {\n      const pinf = 101325;\n      const rho = 1.225;\n      const uinf =\n        Array.isArray(data.U_mag) && data.U_mag.length ? data.U_mag[0] : 1.0;\n      const qinf = 0.5 * rho * uinf * uinf;\n      const cp = data.p.map((pval: number) => (pval - pinf) / qinf);\n      const cpDiv = document.getElementById(\"cp-plot\");\n      if (cpDiv) {\n        const cpTrace: any = {\n          x: data.time,\n          y: cp,\n          type: \"scattergl\",\n          mode: \"lines+markers\",\n          name: \"Cp\",\n          line: { color: plotlyColors.red, width: 2.5 },\n        };\n        void Plotly.react(\n          cpDiv,\n          [cpTrace as any],\n          {\n            ...plotLayout,\n            title: createBoldTitle(\"Pressure Coefficient\"),\n            xaxis: {\n              ...plotLayout.xaxis,\n              title: { text: \"Time (s)\" },\n            },\n            yaxis: {\n              ...plotLayout.yaxis,\n              title: { text: \"Cp\" },\n            },\n          },\n          plotConfig\n        )\n          .then(() => {\n            attachWhiteBGDownloadButton(cpDiv);\n          })\n          .catch((err: unknown) => {\n            console.error(\"Plotly update failed:\", err);\n          });\n      }\n    }\n\n    // Velocity profile 3D plot\n    if (\n      Array.isArray(data.Ux) &&\n      Array.isArray(data.Uy) &&\n      Array.isArray(data.Uz)\n    ) {\n      const velocityDiv = document.getElementById(\"velocity-profile-plot\");\n      if (velocityDiv) {\n        const velocityTrace: any = {\n          x: data.Ux,\n          y: data.Uy,\n          z: data.Uz,\n          type: \"scatter3d\",\n          mode: \"markers\",\n          name: \"Velocity\",\n          marker: { color: plotlyColors.blue, size: 5 },\n        };\n        void Plotly.react(\n          velocityDiv,\n          [velocityTrace as any],\n          {\n            ...plotLayout,\n            title: createBoldTitle(\"Velocity Profile\"),\n            scene: {\n              xaxis: { title: { text: \"Ux\" } },\n              yaxis: { title: { text: \"Uy\" } },\n              zaxis: { title: { text: \"Uz\" } },\n            },\n          },\n          plotConfig\n        )\n          .then(() => {\n            attachWhiteBGDownloadButton(velocityDiv);\n          })\n          .catch((err: unknown) => {\n            console.error(\"Plotly update failed:\", err);\n          });\n      }\n    }\n  } catch (error: unknown) {\n    console.error(\"FOAMFlask Error updating aero plots\", error);\n  }\n};\n\nconst updatePlots = async (injectedData?: PlotData): Promise<void> => {\n  const selectedTutorial = (\n    document.getElementById(\"tutorialSelect\") as HTMLSelectElement\n  )?.value;\n  console.log(\"DEBUG: updatePlots polling for tutorial:\", selectedTutorial); // Debug log\n  if (!selectedTutorial || isUpdatingPlots) {\n    if (!selectedTutorial) console.warn(\"DEBUG: No tutorial selected, skipping update.\");\n    return;\n  }\n\n  // âš¡ Bolt Optimization: Lazy load Plotly\n  try {\n    await ensurePlotlyLoaded();\n  } catch (e) {\n    showNotification(\"Failed to load plotting library\", \"error\");\n    return;\n  }\n\n  isUpdatingPlots = true;\n\n  try {\n    let data = injectedData;\n    if (!data) {\n      // âš¡ Bolt Optimization: Use fast API endpoint\n      data = await fetchWithCache<PlotData>(\n        `/api/plot_data?tutorial=${encodeURIComponent(selectedTutorial)}`\n      );\n    }\n\n    if (data.error) {\n      console.error(\"FOAMFlask Error fetching plot data\", data.error);\n      // Only show notification if explicit fetch failed, to avoid WS spam\n      if (!injectedData) showNotification(\"Error fetching plot data\", \"error\");\n      return;\n    }\n\n    // Pressure plot\n    if (data.p && data.time) {\n      const pressureDiv = getElement<HTMLElement>(\"pressure-plot\");\n      if (!pressureDiv) {\n        console.error(\"Pressure plot element not found\");\n        return;\n      }\n\n      const legendVisibility = getLegendVisibility(pressureDiv);\n\n      const pressureTrace: PlotTrace = {\n        x: data.time,\n        y: data.p,\n        type: \"scattergl\",\n        mode: \"lines\",\n        name: \"Pressure\",\n        line: { color: plotlyColors.blue, ...lineStyle, width: 2.5 },\n      };\n\n      if (pressureTrace.name && legendVisibility.hasOwnProperty(pressureTrace.name)) {\n        pressureTrace.visible = legendVisibility[pressureTrace.name] as\n          | boolean\n          | \"legendonly\";\n      }\n\n      void Plotly.react(\n        pressureDiv,\n        [pressureTrace as any],\n        {\n          ...plotLayout,\n          title: createBoldTitle(\"Pressure vs Time\"),\n          xaxis: {\n            ...plotLayout.xaxis,\n            title: { text: \"Time (s)\" },\n          },\n          yaxis: {\n            ...plotLayout.yaxis,\n            title: { text: \"Pressure (Pa)\" },\n          },\n        },\n        plotConfig\n      )\n        .then(() => {\n          attachWhiteBGDownloadButton(pressureDiv);\n        })\n        .catch((err: unknown) => {\n          console.error(\"Plotly update failed:\", err);\n        });\n    }\n\n    // Velocity plot\n    if (data.U_mag && data.time) {\n      const velocityDiv = getElement<HTMLElement>(\"velocity-plot\");\n      if (!velocityDiv) {\n        console.error(\"Velocity plot element not found\");\n        return;\n      }\n\n      const legendVisibility = getLegendVisibility(velocityDiv as any);\n\n      const traces: PlotTrace[] = [\n        {\n          x: data.time,\n          y: data.U_mag,\n          type: \"scattergl\",\n          mode: \"lines\",\n          name: \"|U|\",\n          line: { color: plotlyColors.red, ...lineStyle, width: 2.5 },\n        },\n      ];\n\n      if (data.Ux) {\n        traces.push({\n          x: data.time,\n          y: data.Ux,\n          type: \"scattergl\",\n          mode: \"lines\",\n          name: \"Ux\",\n          line: {\n            color: plotlyColors.blue,\n            ...lineStyle,\n            dash: \"dash\",\n            width: 2.5,\n          },\n        });\n      }\n\n      if (data.Uy) {\n        traces.push({\n          x: data.time,\n          y: data.Uy,\n          type: \"scattergl\",\n          mode: \"lines\",\n          name: \"Uy\",\n          line: {\n            color: plotlyColors.green,\n            ...lineStyle,\n            dash: \"dot\",\n            width: 2.5,\n          },\n        });\n      }\n\n      if (data.Uz) {\n        traces.push({\n          x: data.time,\n          y: data.Uz,\n          type: \"scattergl\",\n          mode: \"lines\",\n          name: \"Uz\",\n          line: {\n            color: plotlyColors.purple,\n            ...lineStyle,\n            dash: \"dashdot\",\n            width: 2.5,\n          },\n        });\n      }\n\n      // Apply saved visibility safely\n      traces.forEach((tr) => {\n        if (tr.name && Object.prototype.hasOwnProperty.call(legendVisibility, tr.name)) {\n          tr.visible = legendVisibility[tr.name] as boolean | \"legendonly\";\n        }\n      });\n\n      void Plotly.react(\n        velocityDiv,\n        traces as any,\n        {\n          ...plotLayout,\n          title: createBoldTitle(\"Velocity vs Time\"),\n          xaxis: {\n            ...plotLayout.xaxis,\n            title: { text: \"Time (s)\" },\n          },\n          yaxis: {\n            ...plotLayout.yaxis,\n            title: { text: \"Velocity (m/s)\" },\n          },\n        },\n        plotConfig\n      ).then(() => {\n        attachWhiteBGDownloadButton(velocityDiv);\n      });\n    }\n\n    // Turbulence plot\n    const turbulenceTrace: PlotTrace[] = [];\n    if (data.nut && data.time) {\n      turbulenceTrace.push({\n        x: data.time,\n        y: data.nut,\n        type: \"scattergl\",\n        mode: \"lines\",\n        name: \"nut\",\n        line: { color: plotlyColors.teal, ...lineStyle, width: 2.5 },\n      });\n    }\n    if (data.nuTilda && data.time) {\n      turbulenceTrace.push({\n        x: data.time,\n        y: data.nuTilda,\n        type: \"scattergl\",\n        mode: \"lines\",\n        name: \"nuTilda\",\n        line: { color: plotlyColors.cyan, ...lineStyle, width: 2.5 },\n      });\n    }\n    if (data.k && data.time) {\n      turbulenceTrace.push({\n        x: data.time,\n        y: data.k,\n        type: \"scattergl\",\n        mode: \"lines\",\n        name: \"k\",\n        line: { color: plotlyColors.magenta, ...lineStyle, width: 2.5 },\n      });\n    }\n    if (data.omega && data.time) {\n      turbulenceTrace.push({\n        x: data.time,\n        y: data.omega,\n        type: \"scattergl\",\n        mode: \"lines\",\n        name: \"omega\",\n        line: { color: plotlyColors.brown, ...lineStyle, width: 2.5 },\n      });\n    }\n\n    if (turbulenceTrace.length > 0) {\n      const turbPlotDiv = document.getElementById(\"turbulence-plot\");\n      if (turbPlotDiv) {\n        void Plotly.react(\n          turbPlotDiv,\n          turbulenceTrace as any,\n          {\n            ...plotLayout,\n            title: createBoldTitle(\"Turbulence Properties vs Time\"),\n            xaxis: {\n              ...plotLayout.xaxis,\n              title: { text: \"Time (s)\" },\n            },\n            yaxis: {\n              ...plotLayout.yaxis,\n              title: { text: \"Value\" },\n            },\n          },\n          plotConfig\n        ).then(() => {\n          attachWhiteBGDownloadButton(turbPlotDiv);\n        });\n      }\n    }\n\n    // Update residuals and aero plots in parallel\n    const updatePromises = [updateResidualsPlot(selectedTutorial)];\n    // âš¡ Bolt Optimization: Pass the already fetched data to avoid redundant request\n    if (aeroVisible) updatePromises.push(updateAeroPlots(data));\n    await Promise.allSettled(updatePromises);\n\n    // After all plots are updated\n    if (isFirstPlotLoad) {\n      showNotification(\"Plots loaded successfully\", \"success\", NOTIFY_LONG);\n      isFirstPlotLoad = false;\n    }\n  } catch (error: unknown) {\n    console.error(\"FOAMFlask Error updating plots\", error);\n    const currentTime = Date.now();\n    const selectedTutorial = (\n      document.getElementById(\"tutorialSelect\") as HTMLSelectElement\n    )?.value;\n    if (\n      selectedTutorial &&\n      currentTime - lastErrorNotificationTime > ERROR_NOTIFICATION_COOLDOWN\n    ) {\n      showNotification(\n        `Error updating plots: ${error instanceof Error ? error.message : \"Unknown error\"\n        }`,\n        \"error\"\n      );\n      lastErrorNotificationTime = currentTime;\n    }\n  } finally {\n    isUpdatingPlots = false;\n\n    // FIX: Hide loader after update completes\n    const loader = document.getElementById(\"plotsLoading\");\n    if (loader && !loader.classList.contains(\"hidden\")) {\n      loader.classList.add(\"hidden\");\n    }\n\n    if (pendingPlotUpdate) {\n      pendingPlotUpdate = false;\n      requestAnimationFrame(() => updatePlots());\n    }\n  }\n};\n\n// Geometry Functions\nconst refreshGeometryList = async (btnElement?: HTMLElement) => {\n  if (!activeCase) {\n    showNotification(\"No active case selected to list geometries\", \"warning\", NOTIFY_LONG);\n    return;\n  }\n\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.classList.add(\"opacity-75\", \"cursor-wait\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path></svg> Refreshing...`;\n  }\n\n  try {\n    const response = await fetch(`/api/geometry/list?caseName=${encodeURIComponent(activeCase)}`);\n    const data = await response.json();\n    if (data.success) {\n      const select = document.getElementById(\"geometrySelect\") as HTMLSelectElement;\n      if (select) {\n        select.innerHTML = \"\";\n        if (data.files.length === 0) {\n          const opt = document.createElement(\"option\");\n          opt.disabled = true;\n          opt.textContent = \"No geometry files found\";\n          select.appendChild(opt);\n        } else {\n          // Handle both old format (string[]) and new format ({name, size}[])\n          data.files.forEach((f: any) => {\n            const opt = document.createElement(\"option\");\n            if (typeof f === 'string') {\n              opt.value = f;\n              opt.textContent = f;\n            } else {\n              opt.value = f.name;\n              opt.textContent = `${f.name} (${formatBytes(f.size)})`;\n            }\n            select.appendChild(opt);\n          });\n        }\n      }\n    }\n    if (btn) showNotification(\"Geometry list refreshed\", \"success\", NOTIFY_MEDIUM);\n  } catch (e) {\n    console.error(e);\n    if (btn) showNotification(\"Failed to refresh geometry list\", \"error\");\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.removeAttribute(\"aria-busy\");\n      btn.classList.remove(\"opacity-75\", \"cursor-wait\");\n      btn.innerHTML = originalText;\n    }\n  }\n};\n\n\n\nconst switchGeometryTab = (tab: \"upload\" | \"resources\") => {\n  const track = document.getElementById(\"geometry-track\");\n  const pill = document.getElementById(\"geometry-bg-pill\");\n  const uploadBtn = document.getElementById(\"tab-btn-geo-upload\");\n  const resourceBtn = document.getElementById(\"tab-btn-geo-resources\");\n\n  // Only toggle text styles now, background is handled by the pill\n  const activeTextClasses = [\"text-cyan-800\", \"font-semibold\"];\n  const inactiveTextClasses = [\"text-gray-600\", \"hover:text-gray-800\", \"font-medium\"];\n\n  if (tab === \"upload\") {\n    if (track) track.style.transform = \"translateX(0%)\";\n    if (pill) pill.style.transform = \"translateX(0)\";\n\n    uploadBtn?.classList.remove(...inactiveTextClasses);\n    uploadBtn?.classList.add(...activeTextClasses);\n    uploadBtn?.setAttribute(\"aria-selected\", \"true\");\n\n    resourceBtn?.classList.remove(...activeTextClasses);\n    resourceBtn?.classList.add(...inactiveTextClasses);\n    resourceBtn?.setAttribute(\"aria-selected\", \"false\");\n  } else {\n    if (track) track.style.transform = \"translateX(-100%)\";\n    // Move pill to the second position (100% width + gap)\n    if (pill) pill.style.transform = \"translateX(calc(100% + 0.25rem))\";\n\n    resourceBtn?.classList.remove(...inactiveTextClasses);\n    resourceBtn?.classList.add(...activeTextClasses);\n    resourceBtn?.setAttribute(\"aria-selected\", \"true\");\n\n    uploadBtn?.classList.remove(...activeTextClasses);\n    uploadBtn?.classList.add(...inactiveTextClasses);\n    uploadBtn?.setAttribute(\"aria-selected\", \"false\");\n\n    loadResourceGeometries();\n  }\n};\n\nconst loadResourceGeometries = async (refresh: boolean = false) => {\n  const select = document.getElementById(\"resourceGeometrySelect\") as HTMLSelectElement;\n  if (!select) return;\n\n  // Frontend Cache Check: If we have options (more than just the placeholder/loading) and strict refresh isn't requested\n  if (!refresh && select.options.length > 1) {\n    return;\n  }\n\n  const btn = document.getElementById(\"refreshResourceGeometryBtn\") as HTMLButtonElement | null;\n  const originalIcon = btn ? btn.innerHTML : \"Refresh\";\n\n  if (btn) {\n    btn.disabled = true;\n    btn.classList.add(\"cursor-wait\", \"opacity-75\");\n    btn.innerHTML = `<svg class=\"animate-spin h-3 w-3\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>`;\n  }\n\n  select.innerHTML = '<option>Loading...</option>';\n  try {\n    const url = refresh ? \"/api/resources/geometry/list?refresh=true\" : \"/api/resources/geometry/list\";\n    const res = await fetch(url);\n    const data = await res.json();\n\n    select.innerHTML = '<option value=\"\" disabled selected>Select Geometry</option>';\n    if (data.files && Array.isArray(data.files)) {\n      if (data.files.length === 0) {\n        const opt = document.createElement(\"option\");\n        opt.disabled = true;\n        opt.textContent = \"No geometry files found\";\n        select.appendChild(opt);\n      } else {\n        data.files.forEach((f: string) => {\n          const opt = document.createElement(\"option\");\n          opt.value = f;\n          opt.textContent = f;\n          select.appendChild(opt);\n        });\n      }\n    }\n  } catch (e) {\n    console.error(e);\n    select.innerHTML = '<option>Error loading list</option>';\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.classList.remove(\"cursor-wait\", \"opacity-75\");\n      btn.innerHTML = originalIcon;\n    }\n  }\n};\n\nconst fetchResourceGeometry = async (btnElement?: HTMLElement) => {\n  const select = document.getElementById(\"resourceGeometrySelect\") as HTMLSelectElement;\n  const filename = select?.value;\n  if (!filename || !activeCase) {\n    showNotification(\"Please select a geometry and active case\", \"error\");\n    return;\n  }\n\n  const btn = (btnElement || document.getElementById(\"fetchResourceGeometryBtn\")) as HTMLButtonElement;\n  const originalText = btn ? btn.innerHTML : \"Fetch & Import\";\n\n  if (btn) {\n    btn.disabled = true;\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> Fetching...`;\n  }\n\n  try {\n    const res = await fetch(\"/api/resources/geometry/fetch\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ filename, caseName: activeCase })\n    });\n    const result = await res.json();\n    if (result.success) {\n      showNotification(`Fetched ${filename} successfully`, \"success\");\n      refreshGeometryList();\n    } else {\n      showNotification(result.message || \"Fetch failed\", \"error\");\n    }\n  } catch (e) {\n    showNotification(\"Error fetching geometry\", \"error\");\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.innerHTML = originalText;\n    }\n  }\n};\n(window as any).fetchResourceGeometry = fetchResourceGeometry;\n\nconst setCase = (btnElement?: HTMLElement) => {\n  const caseDirInput = document.getElementById(\"caseDir\") as HTMLInputElement;\n  const caseDir = caseDirInput.value.trim();\n\n  if (!caseDir) {\n    showNotification(\"Please enter a case directory path\", \"warning\");\n    return;\n  }\n\n  const btn = btnElement as HTMLButtonElement | undefined;\n  const originalText = btn ? btn.innerHTML : \"Set Root\";\n  let success = false;\n\n  if (btn) {\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> Setting...`;\n  }\n\n  fetchWithCache(\"/set_case\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({ caseDir }),\n  })\n    .then((data) => {\n      if (data.caseDir) {\n        showNotification(`Case root set to: ${data.caseDir}`, \"success\");\n        refreshCaseList(); // Refresh the list of cases\n        success = true;\n      } else if (data.output) {\n        showNotification(data.output, \"info\"); // Likely an error message from backend\n      }\n    })\n    .catch((err) => {\n      showNotification(`Error setting case root: ${getErrorMessage(err)}`, \"error\");\n    })\n    .finally(() => {\n      if (btn) {\n        if (success) {\n          temporarilyShowSuccess(btn, originalText, \"Set!\");\n        } else {\n          btn.disabled = false;\n          btn.removeAttribute(\"aria-busy\");\n          btn.innerHTML = originalText;\n        }\n      }\n    });\n};\n(window as any).setCase = setCase;\n\nconst openCaseRoot = (btn?: HTMLElement) => {\n  fetchWithCache(\"/open_case_root\", {\n    method: \"POST\",\n  })\n    .then((data) => {\n      if (data.output) {\n        if (data.output.toLowerCase().includes(\"error\") || data.output.toLowerCase().includes(\"failed\")) {\n          showNotification(data.output, \"error\");\n        } else {\n          showNotification(data.output, \"success\");\n        }\n      }\n    })\n    .catch((err) => {\n      showNotification(`Failed to open case root: ${getErrorMessage(err)}`, \"error\");\n    });\n};\n(window as any).openCaseRoot = openCaseRoot;\nwindow.switchGeometryTab = switchGeometryTab;\n\nconst uploadGeometry = async (btnElement?: HTMLElement) => {\n  const input = document.getElementById(\"geometryUpload\") as HTMLInputElement;\n  const btn = (btnElement || document.getElementById(\"uploadGeometryBtn\")) as HTMLButtonElement;\n  const file = input?.files?.[0];\n\n  if (!activeCase) {\n    showNotification(\"Please select an active case first\", \"warning\");\n    return;\n  }\n\n  if (!file) {\n    showNotification(\"Please select a file to upload\", \"warning\");\n    if (input) {\n      input.focus();\n      input.setAttribute(\"aria-invalid\", \"true\");\n      input.addEventListener(\"change\", () => input.removeAttribute(\"aria-invalid\"), { once: true });\n    }\n    return;\n  }\n\n  // Validation: Check file size (Max 500MB)\n  const MAX_SIZE = 500 * 1024 * 1024; // 500MB\n  if (file.size > MAX_SIZE) {\n    const sizeMB = (file.size / (1024 * 1024)).toFixed(1);\n    showNotification(`File too large (${sizeMB}MB). Max 500MB allowed.`, \"error\", NOTIFY_MEDIUM);\n    return;\n  }\n\n  // Validation: Check file extension\n  const allowedExtensions = [\".stl\", \".obj\", \".gz\"];\n  const fileName = file.name.toLowerCase();\n  const isValidExtension = allowedExtensions.some(ext => fileName.endsWith(ext));\n\n  if (!isValidExtension) {\n    showNotification(\"Invalid file type. Allowed: .stl, .obj, .gz\", \"error\", NOTIFY_MEDIUM);\n    return;\n  }\n\n  // UX: Loading state\n  const originalText = btn ? btn.innerHTML : \"Upload\";\n  let success = false;\n  if (btn) {\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> Uploading...`;\n  }\n\n  const formData = new FormData();\n  formData.append(\"file\", file);\n  formData.append(\"caseName\", activeCase);\n\n  try {\n    const response = await fetch(\"/api/geometry/upload\", { method: \"POST\", body: formData });\n    if (!response.ok) throw new Error(\"Upload failed\");\n    showNotification(\"Geometry uploaded successfully\", \"success\");\n    input.value = \"\";\n    refreshGeometryList();\n    success = true;\n  } catch (e) {\n    showNotification(\"Failed to upload geometry\", \"error\");\n  } finally {\n    // Restore button state\n    if (btn) {\n      if (success) {\n        temporarilyShowSuccess(btn, originalText, \"Uploaded!\");\n      } else {\n        btn.disabled = false;\n        btn.removeAttribute(\"aria-busy\");\n        btn.innerHTML = originalText;\n      }\n    }\n  }\n};\n\nconst deleteGeometry = async (btnElement?: HTMLElement) => {\n  const filename = (document.getElementById(\"geometrySelect\") as HTMLSelectElement)?.value;\n  if (!filename || !activeCase) return;\n\n  const confirmed = await showConfirmModal(\"Delete Geometry\", `Are you sure you want to delete ${filename}?`);\n  if (!confirmed) return;\n\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n  let success = false;\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> Deleting...`;\n  }\n\n  try {\n    await fetch(\"/api/geometry/delete\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ caseName: activeCase, filename }) });\n    await refreshGeometryList();\n    showNotification(\"Geometry deleted\", \"success\");\n    success = true;\n  } catch (e) {\n    showNotification(\"Failed\", \"error\");\n  } finally {\n    if (btn) {\n      if (success) {\n        temporarilyShowSuccess(btn, originalText, \"Deleted!\");\n      } else {\n        btn.disabled = false;\n        btn.removeAttribute(\"aria-busy\");\n        btn.innerHTML = originalText;\n      }\n    }\n  }\n};\n\nconst loadGeometryView = async (btnElement?: HTMLElement) => {\n  const filename = (document.getElementById(\"geometrySelect\") as HTMLSelectElement)?.value;\n  if (!filename || !activeCase) return;\n\n  const btn = (btnElement || document.getElementById(\"viewGeometryBtn\")) as HTMLButtonElement;\n\n  // Check for slow hardware\n  let optimize = false;\n  if (detectSlowHardware()) {\n    optimize = await showConfirmModal(\"Optimize for Performance?\", \"Slow graphics hardware detected. Enable geometry optimization (decimation)? This reduces detail but improves frame rate.\");\n  }\n\n  await loadInteractiveViewerCommon({\n    iframeId: \"geometryInteractive\",\n    placeholderId: \"geometryPlaceholder\",\n    loadingMessage: \"Loading...\",\n    apiUrl: \"/api/geometry/view\",\n    apiBody: { caseName: activeCase, filename, optimize },\n    btnElement: btn,\n    btnLoadingText: \"Loading...\"\n  });\n\n  // Info\n  try {\n    const res = await fetch(\"/api/geometry/info\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ caseName: activeCase, filename }) });\n    const info = await res.json();\n    if (info.success) {\n      const div = document.getElementById(\"geometryInfoContent\");\n      if (div) {\n        const b = info.bounds;\n        const fmt = (n: number) => n.toFixed(3);\n        const dx = (b[1] - b[0]).toFixed(3);\n        const dy = (b[3] - b[2]).toFixed(3);\n        const dz = (b[5] - b[4]).toFixed(3);\n\n        const setText = (id: string, text: string) => {\n          const el = document.getElementById(id);\n          if (el) el.textContent = text;\n        };\n\n        setText(\"geo-bound-x-min\", fmt(b[0]));\n        setText(\"geo-bound-x-max\", fmt(b[1]));\n        setText(\"geo-bound-x-len\", dx);\n\n        setText(\"geo-bound-y-min\", fmt(b[2]));\n        setText(\"geo-bound-y-max\", fmt(b[3]));\n        setText(\"geo-bound-y-len\", dy);\n\n        setText(\"geo-bound-z-min\", fmt(b[4]));\n        setText(\"geo-bound-z-max\", fmt(b[5]));\n        setText(\"geo-bound-z-len\", dz);\n      }\n      document.getElementById(\"geometryInfo\")?.classList.remove(\"hidden\");\n    }\n  } catch (e) { }\n};\n\n// Meshing Functions\nconst fillBoundsFromGeometry = async (btnElement?: HTMLElement) => {\n  if (!activeCase) {\n    showNotification(\"Please select an active case first\", \"warning\");\n    return;\n  }\n\n  const filename = (document.getElementById(\"shmObjectList\") as HTMLSelectElement)?.value;\n  if (!filename) {\n    showNotification(\"Please select a geometry object in the 'Object Settings' list below\", \"warning\");\n    return;\n  }\n\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n  let success = false;\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `Auto-filling...`;\n  }\n\n  try {\n    const res = await fetch(\"/api/geometry/info\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ caseName: activeCase, filename }) });\n    const info = await res.json();\n    if (info.success) {\n      const b = info.bounds;\n      const p = 0.1; // 10% padding\n      const dx = b[1] - b[0]; const dy = b[3] - b[2]; const dz = b[5] - b[4];\n\n      const minStr = `${(b[0] - dx * p).toFixed(2)} ${(b[2] - dy * p).toFixed(2)} ${(b[4] - dz * p).toFixed(2)}`;\n      const maxStr = `${(b[1] + dx * p).toFixed(2)} ${(b[3] + dy * p).toFixed(2)} ${(b[5] + dz * p).toFixed(2)}`;\n\n      (document.getElementById(\"bmMin\") as HTMLInputElement).value = minStr;\n      (document.getElementById(\"bmMax\") as HTMLInputElement).value = maxStr;\n\n      showNotification(`Bounds updated from ${filename}`, \"success\");\n    } else {\n      showNotification(\"Failed to get geometry info\", \"error\");\n    }\n  } catch (e) {\n    showNotification(\"Error auto-filling bounds\", \"error\");\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.removeAttribute(\"aria-busy\");\n      btn.innerHTML = originalText;\n    }\n  }\n};\n\nconst generateBlockMeshDict = async (btnElement?: HTMLElement) => {\n  if (!activeCase) {\n    showNotification(\"Please select an active case first\", \"warning\");\n    return;\n  }\n\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n  let success = false;\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> Generating...`;\n  }\n\n  const minVal = (document.getElementById(\"bmMin\") as HTMLInputElement).value.trim().split(/\\s+/).map(Number);\n  const maxVal = (document.getElementById(\"bmMax\") as HTMLInputElement).value.trim().split(/\\s+/).map(Number);\n  const cells = (document.getElementById(\"bmCells\") as HTMLInputElement).value.trim().split(/\\s+/).map(Number);\n  const grading = (document.getElementById(\"bmGrading\") as HTMLInputElement).value.trim().split(/\\s+/).map(Number);\n  try {\n    await fetch(\"/api/meshing/blockMesh/config\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ caseName: activeCase, config: { min_point: minVal, max_point: maxVal, cells, grading } }) });\n    showNotification(\"Generated blockMeshDict\", \"success\");\n  } catch (e) {\n    showNotification(\"Failed to generate blockMeshDict\", \"error\");\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.removeAttribute(\"aria-busy\");\n      btn.innerHTML = originalText;\n    }\n  }\n};\n\nconst generateSnappyHexMeshDict = async (btnElement?: HTMLElement) => {\n  const filename = (document.getElementById(\"shmObjectList\") as HTMLSelectElement)?.value;\n  if (!activeCase) {\n    showNotification(\"Please select an active case first\", \"warning\");\n    return;\n  }\n  if (!filename) {\n    showNotification(\"Please select a geometry object first\", \"warning\");\n    return;\n  }\n\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n  let success = false;\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> Generating...`;\n  }\n\n  // Use default value 0 if element doesn't exist or is empty, though HTML doesn't have shmLevel\n  // The HTML has shmObjRefMin/Max, but not a global shmLevel.\n  // Wait, I am fixing selectShmObject.\n  // The request above was to generate snappyHexMeshDict.\n\n  // The code references shmLevel which doesn't exist in HTML.\n  // I should fix this too? Or just stub selectShmObject.\n  // For now, I'll add selectShmObject.\n\n  const level = 0; // Stub as element might be missing\n  const locationInput = document.getElementById(\"shmLocation\") as HTMLInputElement;\n  const location = locationInput ? locationInput.value.trim().split(/\\s+/).map(Number) : [0, 0, 0];\n  try {\n    await fetch(\"/api/meshing/snappyHexMesh/config\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ caseName: activeCase, config: { stl_filename: filename, refinement_level: level, location_in_mesh: location } }) });\n    showNotification(\"Generated snappyHexMeshDict\", \"success\");\n  } catch (e) {\n    showNotification(\"Failed to generate snappyHexMeshDict\", \"error\");\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.removeAttribute(\"aria-busy\");\n      btn.innerHTML = originalText;\n    }\n  }\n};\n\nconst selectShmObject = () => {\n  const list = document.getElementById(\"shmObjectList\") as HTMLSelectElement;\n  const props = document.getElementById(\"shmObjectProps\");\n  const placeholder = document.getElementById(\"shmObjectPlaceholder\");\n  const nameLabel = document.getElementById(\"shmSelectedObjectName\");\n\n  if (list && list.value) {\n    if (props) props.classList.remove(\"hidden\");\n    if (placeholder) placeholder.classList.add(\"hidden\");\n    if (nameLabel) nameLabel.textContent = list.value;\n    // In a real app, we would fetch existing config for this object here\n  } else {\n    if (props) props.classList.add(\"hidden\");\n    if (placeholder) placeholder.classList.remove(\"hidden\");\n  }\n};\n\nconst updateShmObjectConfig = () => {\n  // Stub for updating object config\n  console.log(\"Updated object config\");\n};\n\nconst runMeshingCommand = async (cmd: string, btnElement?: HTMLElement) => {\n  if (!activeCase) return;\n\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n  let success = false;\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>Running...`;\n  }\n\n  showNotification(`Running ${cmd}`, \"info\");\n  try {\n    const res = await fetch(\"/api/meshing/run\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ caseName: activeCase, command: cmd }) });\n    const data = await res.json();\n\n    if (data.success) {\n      showNotification(\"Meshing completed successfully\", \"success\");\n      success = true;\n    } else {\n      showNotification(data.message || \"Meshing failed\", \"error\");\n    }\n\n    if (data.output) {\n      const div = document.getElementById(\"meshingOutput\");\n      if (div) {\n        div.innerText += `\\n${data.output}`;\n        div.scrollTop = div.scrollHeight; // Auto-scroll to bottom\n      }\n    }\n  } catch (e) {\n    console.error(e);\n    showNotification(\"Meshing failed to execute\", \"error\");\n  } finally {\n    if (btn) {\n      if (success) {\n        temporarilyShowSuccess(btn, originalText, \"Completed!\");\n      } else {\n        btn.disabled = false;\n        btn.removeAttribute(\"aria-busy\");\n        btn.innerHTML = originalText;\n      }\n    }\n  }\n};\n\n// Visualizer\nconst runFoamToVTK = async (btnElement?: HTMLElement) => {\n  if (!activeCase) {\n    showNotification(\"Please select a case first\", \"warning\");\n    return;\n  }\n\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>Running...`;\n  }\n\n  showNotification(\"Running foamToVTK...\", \"info\");\n\n  try {\n    const response = await fetch(\"/run_foamtovtk\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ tutorial: activeCase, caseDir: caseDir }) // passing caseDir global var\n    });\n\n    if (!response.ok) throw new Error(\"Failed to start foamToVTK\");\n\n    const reader = response.body?.getReader();\n    const decoder = new TextDecoder();\n\n    const read = async () => {\n      const { done, value } = (await reader?.read()) || { done: true, value: undefined };\n      if (done) {\n        showNotification(\"foamToVTK completed\", \"success\");\n        flushOutputBuffer();\n        refreshMeshList();\n        return;\n      }\n\n      const text = decoder.decode(value);\n      text.split(\"\\n\").forEach(line => {\n        if (line.trim()) {\n          // Simply append to output, maybe parse for errors if needed\n          const type = /error/i.test(line) ? \"stderr\" : \"stdout\";\n          appendOutput(line, \"stdout\");\n        }\n      });\n      await read();\n    };\n    await read();\n\n  } catch (e) {\n    console.error(e);\n    showNotification(\"Error running foamToVTK\", \"error\");\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.removeAttribute(\"aria-busy\");\n      btn.innerHTML = originalText;\n    }\n  }\n};\n\n\nconst refreshMeshList = async (btnElement?: HTMLElement) => {\n  if (!activeCase) {\n    showNotification(\"No active case selected to list meshes\", \"warning\", NOTIFY_LONG);\n    return;\n  }\n\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.classList.add(\"opacity-75\", \"cursor-wait\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path></svg> Refreshing...`;\n  }\n\n  try {\n    const res = await fetch(`/api/available_meshes?tutorial=${encodeURIComponent(activeCase)}`);\n    const data = await res.json();\n    const select = document.getElementById(\"meshSelect\") as HTMLSelectElement;\n    if (select && data.meshes) {\n      if (data.meshes.length === 0) {\n        select.innerHTML = '<option value=\"\" disabled selected>No mesh files found</option>';\n      } else {\n        select.innerHTML = '<option value=\"\">-- Select a mesh file --</option>';\n        data.meshes.forEach((m: MeshFile) => {\n          const opt = document.createElement(\"option\");\n          opt.value = m.path;\n          opt.textContent = m.size ? `${m.name} (${formatBytes(m.size)})` : m.name;\n          select.appendChild(opt);\n        });\n      }\n    }\n    if (btn) showNotification(\"Mesh list refreshed\", \"success\", NOTIFY_MEDIUM);\n  } catch (e) {\n    console.error(\"Error refreshing mesh list:\", e);\n    showNotification(\"Failed to refresh mesh list\", \"error\");\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.removeAttribute(\"aria-busy\");\n      btn.classList.remove(\"opacity-75\", \"cursor-wait\");\n      btn.innerHTML = originalText;\n    }\n  }\n};\n\nconst loadMeshVisualization = async () => {\n  const select = document.getElementById(\"meshSelect\") as HTMLSelectElement;\n  const path = select?.value;\n  const btn = document.getElementById(\"loadMeshBtn\") as HTMLButtonElement | null;\n\n  if (!path) {\n    showNotification(\"Please select a mesh file to load\", \"warning\");\n    if (select) {\n      select.focus();\n      select.setAttribute(\"aria-invalid\", \"true\");\n      select.addEventListener(\"change\", () => select.removeAttribute(\"aria-invalid\"), { once: true });\n    }\n    return;\n  }\n\n  // UX: Loading state\n  const originalText = btn ? btn.innerHTML : \"Load Mesh\";\n  if (btn) {\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> Loading...`;\n  }\n\n  currentMeshPath = path;\n  try {\n    if (isInteractiveMode) {\n      // Default to interactive viewer\n      await refreshInteractiveViewer();\n    } else {\n      await updateMeshView();\n    }\n  } finally {\n    // Restore button state\n    if (btn) {\n      btn.disabled = false;\n      btn.removeAttribute(\"aria-busy\");\n      btn.innerHTML = originalText;\n    }\n  }\n};\n\nconst updateMeshView = async () => {\n  if (!currentMeshPath) return;\n  const showEdges = (document.getElementById(\"showEdges\") as HTMLInputElement)?.checked ?? true;\n  const color = (document.getElementById(\"meshColor\") as HTMLSelectElement)?.value ?? \"lightblue\";\n  const cameraPosition = (document.getElementById(\"cameraPosition\") as HTMLSelectElement)?.value || null;\n\n  try {\n    const res = await fetch(\"/api/mesh_screenshot\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        file_path: currentMeshPath,\n        width: 800,\n        height: 600,\n        show_edges: showEdges,\n        color: color,\n        camera_position: cameraPosition\n      })\n    });\n    const data = await res.json();\n    if (data.success) {\n      (document.getElementById(\"meshImage\") as HTMLImageElement).src = `data:image/png;base64,${data.image}`;\n      document.getElementById(\"meshImage\")?.classList.remove(\"hidden\");\n      document.getElementById(\"meshPlaceholder\")?.classList.add(\"hidden\");\n      document.getElementById(\"meshControls\")?.classList.remove(\"hidden\");\n      document.getElementById(\"meshActionButtons\")?.classList.add(\"hidden\");\n    }\n  } catch (e) { }\n};\n\nfunction displayMeshInfo(meshInfo: {\n  success: boolean;\n  n_points?: number;\n  n_cells?: number;\n  length?: number;\n  volume?: number;\n  bounds?: number[];\n  center?: number[];\n}): void {\n  const meshInfoDiv = document.getElementById(\"meshInfo\");\n  const meshInfoContent = document.getElementById(\"meshInfoContent\");\n\n  if (!meshInfoDiv || !meshInfoContent) {\n    console.error(\"Mesh info or content element not found\");\n    return;\n  }\n\n  if (!meshInfo || !meshInfo.success) {\n    meshInfoDiv.classList.add(\"hidden\");\n    return;\n  }\n\n  // Format the mesh information\n  const infoItems = [\n    { label: \"Points\", value: meshInfo.n_points?.toLocaleString() || \"N/A\" },\n    { label: \"Cells\", value: meshInfo.n_cells?.toLocaleString() || \"N/A\" },\n    {\n      label: \"Length\",\n      value: meshInfo.length ? meshInfo.length.toFixed(3) : \"N/A\",\n    },\n    {\n      label: \"Volume\",\n      value: meshInfo.volume ? meshInfo.volume.toFixed(3) : \"N/A\",\n    },\n  ];\n\n  meshInfoContent.innerHTML = infoItems\n    .map(\n      (item) =>\n        `<div><strong>${item.label}:</strong> <button type=\"button\" class=\"copyable-value hover:bg-cyan-100 hover:text-cyan-800 px-1 rounded transition-colors\" title=\"Click to copy\">${item.value}</button></div>`\n    )\n    .join(\"\");\n\n  // Add bounds if available\n  if (meshInfo.bounds && Array.isArray(meshInfo.bounds)) {\n    // Space separated for easier pasting into vector fields\n    const boundsStr = `${meshInfo.bounds.map((b) => b.toFixed(2)).join(\" \")}`;\n    meshInfoContent.innerHTML += `<div class=\"col-span-2\"><strong>Bounds:</strong> <button type=\"button\" class=\"copyable-value hover:bg-cyan-100 hover:text-cyan-800 px-1 rounded transition-colors\" title=\"Click to copy\">${boundsStr}</button></div>`;\n  }\n\n  // Add center if available\n  if (meshInfo.center && Array.isArray(meshInfo.center)) {\n    const centerStr = `${meshInfo.center.map((c) => c.toFixed(2)).join(\" \")}`;\n    meshInfoContent.innerHTML += `<div class=\"col-span-2\"><strong>Center:</strong> <button type=\"button\" class=\"copyable-value hover:bg-cyan-100 hover:text-cyan-800 px-1 rounded transition-colors\" title=\"Click to copy\">${centerStr}</button></div>`;\n  }\n\n  meshInfoDiv.classList.remove(\"hidden\");\n}\n\nasync function refreshInteractiveViewer(successMessage: string = \"Interactive mode enabled\"): Promise<void> {\n  const toggleBtn = document.getElementById(\"toggleInteractiveBtn\");\n  const cameraControl = document.getElementById(\"cameraPosition\");\n  const updateBtn = document.getElementById(\"updateViewBtn\");\n\n  if (!toggleBtn || !cameraControl || !updateBtn) return;\n\n  const showEdgesInput = document.getElementById(\"showEdges\") as HTMLInputElement | null;\n  const colorInput = document.getElementById(\"meshColor\") as HTMLInputElement | null;\n\n  if (!showEdgesInput || !colorInput) {\n    showNotification(\"Required mesh controls not found\", \"error\");\n    return;\n  }\n\n  const showEdges = showEdgesInput.checked;\n  const color = colorInput.value;\n\n  // Use common loader\n  await loadInteractiveViewerCommon({\n    iframeId: \"meshInteractive\",\n    placeholderId: \"meshPlaceholder\",\n    imageId: \"meshImage\", // Special handling for mesh tab\n    loadingMessage: \"Loading interactive viewer...\",\n    apiUrl: \"/api/mesh_interactive\",\n    apiBody: {\n      file_path: currentMeshPath,\n      show_edges: showEdges,\n      color: color,\n    },\n    // We don't pass toggleBtn here because we handle its state manually below\n    // (it toggles between Static/Interactive, not just loading)\n\n    onSuccess: () => {\n      // Update button text\n      toggleBtn.textContent = \"Static Mode\";\n      toggleBtn.classList.remove(\"bg-purple-500\", \"hover:bg-purple-600\");\n      toggleBtn.classList.add(\"bg-orange-500\", \"hover:bg-orange-600\");\n\n      // Hide camera position control (not needed in interactive mode)\n      cameraControl.parentElement?.classList.add(\"hidden\");\n      updateBtn.classList.add(\"hidden\");\n      document.getElementById(\"interactiveModeHint\")?.classList.remove(\"hidden\");\n\n      showNotification(successMessage, \"success\", NOTIFY_LONG);\n    },\n    onError: (error) => {\n      const errorMessage = error instanceof Error ? error.message : \"Unknown error\";\n      showNotification(`Failed to load interactive viewer: ${errorMessage}`, \"error\");\n\n      // Reset to static mode\n      isInteractiveMode = false;\n\n      // Safely update UI elements\n      toggleBtn.textContent = \"Interactive Mode\";\n      toggleBtn.classList.remove(\"bg-orange-500\", \"hover:bg-orange-600\");\n      toggleBtn.classList.add(\"bg-purple-500\", \"hover:bg-purple-600\");\n      cameraControl.parentElement?.classList.remove(\"hidden\");\n      updateBtn.classList.remove(\"hidden\");\n      document.getElementById(\"interactiveModeHint\")?.classList.add(\"hidden\");\n    }\n  });\n}\n\nasync function onMeshParamChange(): Promise<void> {\n  if (isInteractiveMode) {\n    await refreshInteractiveViewer(\"Interactive mode updated\");\n  }\n}\n\nasync function toggleInteractiveMode(): Promise<void> {\n  if (!currentMeshPath) {\n    showNotification(\"Please load a mesh first\", \"warning\");\n    return;\n  }\n\n  const meshImage = document.getElementById(\n    \"meshImage\"\n  ) as HTMLImageElement | null;\n  const meshInteractive = document.getElementById(\n    \"meshInteractive\"\n  ) as HTMLIFrameElement | null;\n  const meshPlaceholder = document.getElementById(\"meshPlaceholder\");\n  const toggleBtn = document.getElementById(\"toggleInteractiveBtn\");\n  const cameraControl = document.getElementById(\"cameraPosition\");\n  const updateBtn = document.getElementById(\"updateViewBtn\");\n\n  if (!toggleBtn || !cameraControl || !updateBtn) return; // Guard clause for safety\n\n  // Initialize button state if needed (e.g. on first load)\n  // But since we default to true, the HTML should probably match or we update it here.\n  // actually refreshInteractiveViewer updates the button state on success.\n\n  if (\n    !meshImage ||\n    !meshInteractive ||\n    !meshPlaceholder ||\n    !toggleBtn ||\n    !cameraControl ||\n    !updateBtn\n  ) {\n    showNotification(\"Required mesh elements not found\", \"error\");\n    return;\n  }\n\n  isInteractiveMode = !isInteractiveMode;\n\n  if (isInteractiveMode) {\n    // Switch to interactive mode\n    await refreshInteractiveViewer(\"Interactive mode enabled\");\n  } else {\n    // Switch back to static mode\n    meshInteractive.classList.add(\"hidden\");\n    meshImage.classList.remove(\"hidden\");\n\n    // Update button text\n    toggleBtn.textContent = \"Interactive Mode\";\n    toggleBtn.classList.remove(\"bg-orange-500\", \"hover:bg-orange-600\");\n    toggleBtn.classList.add(\"bg-purple-500\", \"hover:bg-purple-600\");\n\n    // Show camera position control again\n    cameraControl.parentElement?.classList.remove(\"hidden\");\n    updateBtn.classList.remove(\"hidden\");\n    document.getElementById(\"interactiveModeHint\")?.classList.add(\"hidden\");\n\n    showNotification(\"Switched to static mode\", \"info\", NOTIFY_MEDIUM);\n  }\n}\n\n// Set camera view for interactive mode\nfunction setCameraView(view: CameraView): void {\n  const iframe = document.getElementById(\n    \"meshInteractive\"\n  ) as HTMLIFrameElement | null;\n  if (!iframe || !iframe.contentWindow) return;\n\n  try {\n    // Send message to iframe to set camera view\n    iframe.contentWindow.postMessage(\n      {\n        type: \"setCameraView\",\n        view: view,\n      },\n      \"*\"\n    );\n\n    showNotification(`Set view to ${view.toUpperCase()}`, \"info\", NOTIFY_SHORT);\n  } catch (error: unknown) {\n    console.error(\"Error setting camera view:\", error);\n  }\n}\n\n// Reset camera to default view\nfunction resetCamera(): void {\n  const iframe = document.getElementById(\n    \"meshInteractive\"\n  ) as HTMLIFrameElement | null;\n  if (!iframe || !iframe.contentWindow) return;\n\n  try {\n    // Send message to iframe to reset camera\n    iframe.contentWindow.postMessage(\n      {\n        type: \"resetCamera\",\n      },\n      \"*\"\n    );\n\n    showNotification(\"Camera view reset\", \"info\", NOTIFY_SHORT);\n  } catch (error: unknown) {\n    console.error(\"Error resetting camera:\", error);\n  }\n}\n\n// Post Processing\n\ninterface PipelineNode {\n  id: string;\n  type: \"contour\" | \"slice\" | \"streamline\" | \"surface_projection\" | \"root\";\n  name: string;\n  parentId: string | null;\n}\n\n// Initial state: Root node represents the base mesh\nlet postPipeline: PipelineNode[] = [{ id: \"root\", type: \"root\", name: \"Mesh\", parentId: null }];\nlet activePipelineId: string = \"root\";\n\nconst deletePipelineStep = (id: string): void => {\n  if (id === 'root') return; // Cannot delete root\n\n  // Find children recursively and delete them\n  const children = postPipeline.filter(n => n.parentId === id);\n  children.forEach(child => deletePipelineStep(child.id));\n\n  // Remove this node\n  postPipeline = postPipeline.filter(n => n.id !== id);\n\n  // If active node is no longer in pipeline (because it was deleted), reset to root\n  if (!postPipeline.find(n => n.id === activePipelineId)) {\n    selectPipelineStep('root');\n  } else {\n    renderPipeline();\n  }\n};\n(window as any).deletePipelineStep = deletePipelineStep;\n\nconst renderPipeline = (): void => {\n  const container = document.getElementById(\"post-pipeline-view\");\n  if (!container) return;\n\n  // Clear container\n  container.innerHTML = \"\";\n\n  // Render full pipeline (assuming linear for MVP)\n  postPipeline.forEach((node, index) => {\n    // ðŸŽ¨ Palette UX: Accessible Button Group\n    const groupEl = document.createElement(\"div\");\n    const isActive = node.id === activePipelineId;\n\n    // Wrapper styles (Pill shape)\n    const activeWrapper = \"bg-cyan-600 border-cyan-600 shadow-md\";\n    const inactiveWrapper = \"bg-white border-gray-300 hover:bg-gray-50 hover:border-cyan-400\";\n\n    groupEl.className = `inline-flex items-center rounded-full border transition-colors whitespace-nowrap ${isActive ? activeWrapper : inactiveWrapper}`;\n\n    // Icon based on type\n    let icon = \"\";\n    if (node.type === \"root\") icon = `<svg class=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\" /></svg>`;\n    else if (node.type === \"contour\") icon = `<svg class=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7\" /></svg>`;\n    else icon = `<svg class=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><circle cx=\"12\" cy=\"12\" r=\"10\" stroke-width=\"2\"></circle></svg>`;\n\n    // Select Button (Main)\n    const selectBtn = document.createElement(\"button\");\n    const hasDelete = node.type !== 'root';\n    // Rounded corners: Full if root (single button), Left-only if delete button exists\n    const roundedClass = hasDelete ? \"rounded-l-full pr-2\" : \"rounded-full\";\n    // Text Color\n    const textClass = isActive ? \"text-white\" : \"text-gray-700\";\n\n    selectBtn.className = `flex items-center gap-2 px-3 py-1.5 ${roundedClass} ${textClass} text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-cyan-500 transition-colors`;\n    selectBtn.innerHTML = `${icon} <span>${node.name}</span>`;\n    selectBtn.onclick = () => selectPipelineStep(node.id);\n    groupEl.appendChild(selectBtn);\n\n    // Delete Button (Sibling)\n    if (hasDelete) {\n      const delBtn = document.createElement(\"button\");\n      const delTextClass = isActive ? \"text-cyan-200 hover:text-white\" : \"text-gray-400 hover:text-white\";\n\n      delBtn.className = `mr-1 p-1 w-5 h-5 flex items-center justify-center rounded-full hover:bg-red-500 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-red-500 ${delTextClass}`;\n      // Use X icon\n      delBtn.innerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-3 w-3\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fill-rule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clip-rule=\"evenodd\" /></svg>`;\n      delBtn.setAttribute(\"aria-label\", `Delete ${node.name}`);\n      delBtn.title = \"Delete this step\";\n\n      delBtn.onclick = (e) => {\n        e.stopPropagation();\n        if (confirm(`Delete ${node.name}? This will remove all subsequent steps.`)) {\n          deletePipelineStep(node.id);\n        }\n      };\n      groupEl.appendChild(delBtn);\n    }\n\n    container.appendChild(groupEl);\n\n    // Connector (if not last)\n    if (index < postPipeline.length - 1) {\n      const line = document.createElement(\"div\");\n      line.className = \"w-8 h-0.5 bg-gray-300 mx-1 flex-shrink-0\";\n      container.appendChild(line);\n    }\n\n    // Add \"Add\" button if this is the active node (to branch off)\n    if (node.id === activePipelineId) {\n      const line = document.createElement(\"div\");\n      line.className = \"w-8 h-0.5 bg-gray-300 mx-1 flex-shrink-0 border-t-2 border-dashed border-gray-300\";\n      container.appendChild(line);\n\n      const addBtn = document.createElement(\"div\");\n      addBtn.className = \"w-6 h-6 rounded-full bg-gray-100 border border-gray-300 flex items-center justify-center text-gray-400 text-xs\";\n      addBtn.innerHTML = \"+\";\n      addBtn.title = \"Add function to this step\";\n      container.appendChild(addBtn);\n    }\n  });\n};\n\nconst selectPipelineStep = (id: string): void => {\n  activePipelineId = id;\n  const node = postPipeline.find(n => n.id === id);\n  if (!node) return;\n\n  renderPipeline();\n\n  // Show config for this step\n  const landing = document.getElementById(\"post-landing-view\");\n  const contour = document.getElementById(\"post-contour-view\");\n\n  if (!landing || !contour) return;\n\n  // If selecting a \"contour\" node, show contour view\n  if (node.type === \"contour\") {\n    landing.classList.add(\"hidden\");\n    contour.classList.remove(\"hidden\");\n    refreshPostList(); // Refresh VTK list\n  }\n  // If selecting root or any node where we want to add a child (conceptually), show landing\n  // For this simplified logic: clicking a node shows its config.\n  // How do we add new?\n  // Let's say if you click \"Back to Selection\" or select \"Mesh\" (root), you get the landing view to ADD a new child to ROOT.\n  // Actually, standard behavior: selecting a node shows its settings.\n  // To add a new one, we need an \"Add\" mechanism.\n  // For now, let's treat the Landing View as the \"Add Child to Current Node\" view if we are at a leaf or explicitly adding.\n  // But to keep it simple and consistent with previous turn:\n  // If we are at ROOT, show Landing View to start a chain.\n  // If we are at a Leaf, showing the Config View.\n\n  else if (node.type === \"root\") {\n    // Root node -> Show selection to add new filter\n    landing.classList.remove(\"hidden\");\n    contour.classList.add(\"hidden\");\n  }\n  else {\n    // Placeholder for other types\n    landing.classList.add(\"hidden\");\n    contour.classList.add(\"hidden\");\n    // Could show a \"Not implemented\" view here\n  }\n};\n\nconst switchPostView = (view: \"landing\" | \"contour\"): void => {\n  if (view === \"contour\") {\n    // Add a new contour node to the pipeline\n    const newNodeId = `contour_${Date.now()}`;\n    postPipeline.push({\n      id: newNodeId,\n      type: \"contour\",\n      name: \"Contour\",\n      parentId: activePipelineId\n    });\n    selectPipelineStep(newNodeId);\n  } else {\n    // \"Back\" means go to parent or root?\n    // Or just go to root to add another branch?\n    // Let's assume \"Back\" means go up one level\n    const current = postPipeline.find(n => n.id === activePipelineId);\n    if (current && current.parentId) {\n      selectPipelineStep(current.parentId);\n    } else {\n      selectPipelineStep(\"root\");\n    }\n  }\n};\n(window as any).switchPostView = switchPostView;\n\nconst refreshPostList = async (btnElement?: HTMLElement) => {\n  refreshPostListVTK(btnElement);\n};\n\nconst refreshPostListVTK = async (btnElement?: HTMLElement) => {\n  if (!activeCase) {\n    showNotification(\"No active case selected to list VTK files\", \"warning\", NOTIFY_LONG);\n    return;\n  }\n\n  const btn = btnElement as HTMLButtonElement | undefined;\n  let originalText = \"\";\n\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.setAttribute(\"aria-busy\", \"true\");\n    btn.classList.add(\"opacity-75\", \"cursor-wait\");\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path></svg> Refreshing...`;\n  }\n\n  try {\n    const res = await fetch(`/api/available_meshes?tutorial=${encodeURIComponent(activeCase)}`);\n    const data = await res.json();\n    const select = document.getElementById(\"vtkFileSelect\") as HTMLSelectElement;\n    if (select && data.meshes) {\n      if (data.meshes.length === 0) {\n        select.innerHTML = '<option value=\"\" disabled selected>No VTK files found</option>';\n      } else {\n        select.innerHTML = '<option value=\"\">-- Select a VTK file --</option>';\n        data.meshes.forEach((m: MeshFile) => {\n          const opt = document.createElement(\"option\");\n          opt.value = m.path; opt.textContent = m.name; select.appendChild(opt);\n        });\n      }\n    }\n    if (btn) showNotification(\"VTK file list refreshed\", \"success\", NOTIFY_MEDIUM);\n  } catch (e) {\n    console.error(e);\n    if (btn) showNotification(\"Failed to refresh VTK list\", \"error\");\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.removeAttribute(\"aria-busy\");\n      btn.classList.remove(\"opacity-75\", \"cursor-wait\");\n      btn.innerHTML = originalText;\n    }\n  }\n};\n\nconst runPostOperation = async (operation: string) => {\n  // Stub\n};\nconst loadCustomVTKFile = async () => { };\nconst loadContourVTK = async () => {\n  const vtkFileSelect = document.getElementById(\"vtkFileSelect\") as HTMLSelectElement | null;\n  let fileToLoad = \"\";\n\n  if (vtkFileSelect && vtkFileSelect.value) {\n    fileToLoad = vtkFileSelect.value;\n  }\n\n  if (!fileToLoad) {\n    showNotification(\"Please select a VTK file to load.\", \"warning\");\n    return;\n  }\n\n  // Show loading state on button\n  const btn = document.getElementById(\"loadContourVTKBtn\") as HTMLButtonElement | null;\n  let originalText = \"\";\n  if (btn) {\n    originalText = btn.innerHTML;\n    btn.disabled = true;\n    btn.innerHTML = `<svg class=\"animate-spin h-4 w-4 inline-block mr-2\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path></svg> Loading...`;\n  }\n\n  try {\n    await loadContourMesh(fileToLoad);\n    showNotification(\"Contour mesh loaded successfully.\", \"success\");\n  } catch (e) {\n    console.error(e);\n    showNotification(\"Failed to load contour mesh.\", \"error\");\n  } finally {\n    if (btn) {\n      btn.disabled = false;\n      btn.innerHTML = originalText;\n    }\n  }\n};\n(window as any).loadContourVTK = loadContourVTK;\n\n\n// Check startup status\nconst checkStartupStatus = async (): Promise<void> => {\n  const modal = document.createElement(\"div\");\n  modal.id = \"startup-modal\";\n  modal.className = \"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50\";\n  modal.innerHTML = `\n    <div class=\"bg-white p-8 rounded-lg shadow-xl max-w-md w-full text-center\">\n      <div class=\"mb-4\"><svg class=\"animate-spin h-10 w-10 text-blue-500 mx-auto\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg></div>\n      <h2 class=\"text-xl font-bold mb-2\">System Check</h2>\n      <p id=\"startup-message\" class=\"text-gray-600\">Checking Docker permissions...</p>\n    </div>\n  `;\n  document.body.appendChild(modal);\n\n  const pollStatus = async () => {\n    try {\n      const response = await fetch(\"/api/startup_status\");\n      const data = await response.json();\n      const messageEl = document.getElementById(\"startup-message\");\n      if (messageEl) messageEl.textContent = data.message;\n      if (data.status === \"completed\") {\n        modal.remove();\n        return;\n      } else if (data.status === \"failed\") {\n        if (messageEl) {\n          messageEl.className = \"text-red-600\";\n          messageEl.textContent = `Error: ${data.message}. Please check server logs.`;\n        }\n        return;\n      }\n      setTimeout(pollStatus, 1000);\n    } catch (e) {\n      setTimeout(pollStatus, 5000);\n    }\n  };\n  await pollStatus();\n};\n\n// Initialize\nwindow.onload = async () => {\n  try { await checkStartupStatus(); } catch (e) { console.error(e); }\n\n  const outputDiv = document.getElementById(\"output\");\n  if (outputDiv) {\n    // Restore Log\n    const savedLog = localStorage.getItem(CONSOLE_LOG_KEY);\n    if (savedLog) {\n      outputDiv.innerHTML = savedLog;\n      cachedLogHTML = savedLog; // âš¡ Bolt Optimization: Restore cache\n      outputDiv.scrollTop = outputDiv.scrollHeight;\n    }\n  }\n\n  try {\n    const caseRootData = await fetchWithCache<CaseRootResponse>(\"/get_case_root\");\n    const dockerConfigData = await fetchWithCache<DockerConfigResponse>(\"/get_docker_config\");\n    caseDir = caseRootData.caseDir;\n    const caseDirInput = document.getElementById(\"caseDir\") as HTMLInputElement;\n    if (caseDirInput) caseDirInput.value = caseDir;\n    dockerImage = dockerConfigData.dockerImage;\n    openfoamVersion = dockerConfigData.openfoamVersion;\n    const openfoamRootInput = document.getElementById(\"openfoamRoot\") as HTMLInputElement;\n    if (openfoamRootInput) openfoamRootInput.value = `${dockerImage} OpenFOAM ${openfoamVersion}`;\n\n    // Load Cases\n    await refreshCaseList();\n    const savedCase = localStorage.getItem(\"lastSelectedCase\");\n    if (savedCase) {\n      const select = document.getElementById(\"caseSelect\") as HTMLSelectElement;\n      let exists = false;\n      for (let i = 0; i < select.options.length; i++) {\n        if (select.options[i].value === savedCase) { exists = true; break; }\n      }\n      if (exists) {\n        select.value = savedCase;\n        activeCase = savedCase;\n        updateActiveCaseBadge();\n      }\n    }\n\n    // Check if we need to restore any plot state or similar\n    // ...\n\n  } catch (e) { console.error(e); }\n};\n\n\n\n\n\n// Exports\n(window as any).switchPage = switchPage;\n(window as any).setCase = setCase;\n(window as any).setDockerConfig = setDockerConfig;\n(window as any).loadTutorial = loadTutorial;\n(window as any).createNewCase = createNewCase;\n(window as any).selectCase = selectCase;\n(window as any).refreshCaseList = refreshCaseList;\n(window as any).uploadGeometry = uploadGeometry;\n(window as any).deleteGeometry = deleteGeometry;\n(window as any).loadGeometryView = loadGeometryView;\n(window as any).fillBoundsFromGeometry = fillBoundsFromGeometry;\n(window as any).generateBlockMeshDict = generateBlockMeshDict;\n(window as any).generateSnappyHexMeshDict = generateSnappyHexMeshDict;\n(window as any).selectShmObject = selectShmObject;\n(window as any).updateShmObjectConfig = updateShmObjectConfig;\n(window as any).runMeshingCommand = runMeshingCommand;\n(window as any).refreshMeshList = refreshMeshList;\n(window as any).loadMeshVisualization = loadMeshVisualization;\n(window as any).updateMeshView = updateMeshView;\n(window as any).runFoamToVTK = runFoamToVTK;\n(window as any).refreshPostList = refreshPostList;\n(window as any).toggleAeroPlots = toggleAeroPlots;\n(window as any).runCommand = runCommand;\n(window as any).confirmRunCommand = confirmRunCommand;\n(window as any).toggleInteractiveMode = toggleInteractiveMode;\n(window as any).setCameraView = setCameraView;\n(window as any).resetCamera = resetCamera;\n(window as any).downloadPlotData = downloadPlotData;\n(window as any).loadCustomVTKFile = loadCustomVTKFile;\n(window as any).loadContourVTK = loadContourVTK;\n(window as any).generateContours = generateContoursFn;\n(window as any).downloadPlotAsPNG = downloadPlotAsPNG;\n(window as any).showNotification = showNotification;\n(window as any).runPostOperation = runPostOperation;\n(window as any).clearLog = clearLog;\n(window as any).copyLogToClipboard = copyLogToClipboard;\n(window as any).downloadLog = downloadLog;\n(window as any).copyInputToClipboard = copyInputToClipboard;\n(window as any).clearMeshingOutput = clearMeshingOutput;\n(window as any).copyMeshingOutput = copyMeshingOutput;\n(window as any).downloadMeshingLog = downloadMeshingLog;\n(window as any).togglePlots = togglePlots;\n(window as any).toggleSection = toggleSection;\n\n\nconst init = () => {\n  // Palette UX: Optimistically restore active case\n  const savedCase = localStorage.getItem(\"lastSelectedCase\");\n  if (savedCase) {\n    activeCase = savedCase;\n  }\n  updateActiveCaseBadge();\n\n  // Persist Tutorial Selection - Restore FIRST before any page logic runs\n  const tutorialSelect = document.getElementById('tutorialSelect') as HTMLSelectElement;\n  if (tutorialSelect) {\n    // Restore\n    const savedTutorial = localStorage.getItem('lastSelectedTutorial');\n    if (savedTutorial) {\n      // Check if option exists\n      let exists = false;\n      for (let i = 0; i < tutorialSelect.options.length; i++) {\n        if (tutorialSelect.options[i].value === savedTutorial) {\n          exists = true;\n          break;\n        }\n      }\n      if (exists) {\n        tutorialSelect.value = savedTutorial;\n        console.log(\"DEBUG: Restored tutorial selection:\", savedTutorial);\n      } else {\n        console.warn(\"DEBUG: Saved tutorial not found in options:\", savedTutorial);\n      }\n    }\n\n    // Save on change\n    tutorialSelect.addEventListener('change', (e: Event) => {\n      const target = e.target as HTMLSelectElement;\n      localStorage.setItem('lastSelectedTutorial', target.value);\n    });\n  }\n\n  // Determine initial page from URL\n  const path = window.location.pathname;\n  let initialPage = \"setup\";\n  if (path !== \"/\" && path !== \"\") {\n    const pageName = path.substring(1).toLowerCase(); // remove leading slash\n    // check if it's a valid page\n    const pages = [\"setup\", \"geometry\", \"meshing\", \"visualizer\", \"run\", \"plots\", \"post\"];\n    if (pages.includes(pageName)) {\n      initialPage = pageName;\n    }\n  }\n\n  // Handle browser back/forward buttons\n  window.onpopstate = (event) => {\n    if (event.state && event.state.page) {\n      switchPage(event.state.page, false);\n    } else {\n      // Fallback if no state (e.g. initial load turned into history entry?)\n      // or just parse URL again\n      const p = window.location.pathname.substring(1).toLowerCase() || \"setup\";\n      switchPage(p, false);\n    }\n  };\n\n  // Switch to initial page (don't push state for the initial load)\n  switchPage(initialPage, false);\n\n  const navButtons = [\n    { id: 'nav-setup', mobileId: 'mobile-nav-setup', handler: () => switchPage('setup') },\n    { id: 'nav-run', mobileId: 'mobile-nav-run', handler: () => switchPage('run') },\n    { id: 'nav-geometry', mobileId: 'mobile-nav-geometry', handler: () => switchPage('geometry') },\n    { id: 'nav-meshing', mobileId: 'mobile-nav-meshing', handler: () => switchPage('meshing') },\n    { id: 'nav-visualizer', mobileId: 'mobile-nav-visualizer', handler: () => switchPage('visualizer') },\n    { id: 'nav-plots', mobileId: 'mobile-nav-plots', handler: () => switchPage('plots') },\n    { id: 'nav-post', mobileId: 'mobile-nav-post', handler: () => switchPage('post') }\n  ];\n\n  navButtons.forEach(({ id, mobileId, handler }) => {\n    const button = document.getElementById(id);\n    if (button) button.addEventListener('click', handler);\n\n    const mobileButton = document.getElementById(mobileId);\n    if (mobileButton) {\n      mobileButton.addEventListener('click', () => {\n        handler();\n        setMobileMenuState(false);\n      });\n    }\n  });\n\n  const loadTutorialBtn = document.getElementById('loadTutorialBtn');\n  if (loadTutorialBtn) loadTutorialBtn.addEventListener('click', loadTutorial);\n\n  // Check for startup errors\n  const startupError = document.getElementById(\"startup-error\");\n  if (startupError) {\n    const msg = startupError.getAttribute(\"data-message\");\n    if (msg) {\n      showNotification(msg, \"error\", NOTIFY_LONG);\n    }\n  }\n\n  // âš¡ Bolt Optimization: Resume updates immediately when tab becomes visible\n  document.addEventListener(\"visibilitychange\", () => {\n    if (!document.hidden && plotsVisible && plotsInViewport) {\n      if (!isUpdatingPlots) {\n        updatePlots();\n      } else {\n        pendingPlotUpdate = true;\n      }\n    }\n  });\n\n  // Interactive Mode Event Listeners\n  const meshColorSelect = document.getElementById(\"meshColor\");\n  if (meshColorSelect) {\n    meshColorSelect.addEventListener(\"change\", onMeshParamChange);\n  }\n\n  const showEdgesCheck = document.getElementById(\"showEdges\");\n  if (showEdgesCheck) {\n    showEdgesCheck.addEventListener(\"change\", onMeshParamChange);\n  }\n\n  // Auto-format vector inputs\n  ['bmCells', 'bmGrading', 'bmMin', 'bmMax', 'shmLocation'].forEach(setupVectorInputAutoFormat);\n\n  // Scroll Listener for Navbar\n  window.addEventListener(\"scroll\", handleScroll);\n\n  initLogScrollObserver();\n  setupQuickActions();\n  setupCopyableValues();\n  setupLayersDependency();\n  setupGeometryDragDrop();\n};\n\n// UX: Setup dependency between \"Add Layers\" checkbox and \"Surface Layers\" input\nconst setupLayersDependency = () => {\n  const shmLayers = document.getElementById(\"shmLayers\") as HTMLInputElement;\n  const shmObjLayers = document.getElementById(\"shmObjLayers\") as HTMLInputElement;\n\n  if (!shmLayers || !shmObjLayers) return;\n\n  const updateState = () => {\n    const isEnabled = shmLayers.checked;\n    shmObjLayers.disabled = !isEnabled;\n    if (!isEnabled) {\n      shmObjLayers.classList.add(\"cursor-not-allowed\", \"opacity-50\", \"bg-gray-100\");\n      shmObjLayers.setAttribute(\"aria-disabled\", \"true\");\n    } else {\n      shmObjLayers.classList.remove(\"cursor-not-allowed\", \"opacity-50\", \"bg-gray-100\");\n      shmObjLayers.removeAttribute(\"aria-disabled\");\n    }\n  };\n\n  shmLayers.addEventListener(\"change\", updateState);\n  updateState(); // Initialize state\n};\n\nconst handleScroll = (): void => {\n  const navbar = document.getElementById(\"navbar\");\n  if (!navbar) return;\n\n  if (window.scrollY > 10) {\n    if (navbar.classList.contains(\"glass\")) {\n      navbar.classList.remove(\"glass\");\n      navbar.classList.add(\"glass-plot\");\n    }\n  } else {\n    if (navbar.classList.contains(\"glass-plot\")) {\n      navbar.classList.remove(\"glass-plot\");\n      navbar.classList.add(\"glass\");\n    }\n  }\n};\n\n// Auto-format Vector Inputs (comma to space)\nconst setupVectorInputAutoFormat = (elementId: string) => {\n  const el = document.getElementById(elementId) as HTMLInputElement;\n  if (el) {\n    // Add transition class for smooth color change if not present\n    if (!el.classList.contains('transition-colors')) {\n      el.classList.add('transition-colors', 'duration-500');\n    }\n\n    el.addEventListener('blur', () => {\n      let val = el.value;\n      // Replace commas with spaces\n      val = val.replace(/,/g, ' ');\n      // Collapse multiple spaces\n      val = val.replace(/\\s+/g, ' ');\n      val = val.trim();\n\n      if (val !== el.value && val.length > 0) {\n        el.value = val;\n\n        // ðŸŽ¨ Palette UX Improvement: Visual feedback for auto-formatting\n        // Flash input green\n        const originalClasses = el.className;\n        el.classList.add('border-green-500', 'ring-1', 'ring-green-500', 'bg-green-50');\n\n        // Update help text if available\n        const helpId = el.getAttribute('aria-describedby');\n        const helpEl = helpId ? document.getElementById(helpId) : null;\n\n        if (helpEl) {\n          // Store original state if not already stored (prevent race condition)\n          if (!helpEl.dataset.originalText) {\n            helpEl.dataset.originalText = helpEl.textContent || \"\";\n            helpEl.dataset.originalClass = helpEl.className;\n          }\n\n          // Clear any pending restore timer\n          if (helpEl.dataset.restoreTimer) {\n            clearTimeout(parseInt(helpEl.dataset.restoreTimer, 10));\n          }\n\n          // Set feedback state\n          helpEl.textContent = \"âœ¨ Auto-formatted to space-separated\";\n          helpEl.className = \"text-xs text-green-600 font-medium mt-1 transition-all duration-300\";\n          helpEl.style.opacity = '1';\n\n          // Revert input styles and help text after delay\n          const timerId = window.setTimeout(() => {\n            el.classList.remove('border-green-500', 'ring-1', 'ring-green-500', 'bg-green-50');\n\n            // Fade out help text\n            helpEl.style.opacity = '0';\n\n            setTimeout(() => {\n              // Restore original help text\n              helpEl.textContent = helpEl.dataset.originalText || \"\";\n              helpEl.className = helpEl.dataset.originalClass || \"\";\n              helpEl.style.opacity = '1';\n\n              // Cleanup data attributes\n              delete helpEl.dataset.originalText;\n              delete helpEl.dataset.originalClass;\n              delete helpEl.dataset.restoreTimer;\n            }, 300);\n          }, 2000);\n\n          helpEl.dataset.restoreTimer = timerId.toString();\n        } else {\n          // Just revert input styles if no help text\n          setTimeout(() => {\n            el.classList.remove('border-green-500', 'ring-1', 'ring-green-500', 'bg-green-50');\n          }, 2000);\n        }\n      }\n    });\n  }\n};\n\n// Scroll to Bottom Logic\nconst scrollToLogBottom = (): void => {\n  const output = document.getElementById(\"output\");\n  if (output) {\n    // Check if scrollTo options are supported (native smooth scroll)\n    try {\n      output.scrollTo({ top: output.scrollHeight, behavior: \"smooth\" });\n    } catch (e) {\n      // Fallback for older browsers\n      output.scrollTop = output.scrollHeight;\n    }\n  }\n};\n(window as any).scrollToLogBottom = scrollToLogBottom;\n\n// Scroll to Top Logic\nconst scrollToLogTop = (): void => {\n  const output = document.getElementById(\"output\");\n  if (output) {\n    try {\n      output.scrollTo({ top: 0, behavior: \"smooth\" });\n    } catch (e) {\n      output.scrollTop = 0;\n    }\n  }\n};\n(window as any).scrollToLogTop = scrollToLogTop;\n\nconst initLogScrollObserver = (): void => {\n  const output = document.getElementById(\"output\");\n  const bottomBtn = document.getElementById(\"scrollToBottomBtn\");\n  const topBtn = document.getElementById(\"scrollToTopBtn\");\n\n  if (!output) return;\n\n  const handleLogScroll = () => {\n    // Scroll to Bottom Button Logic\n    if (bottomBtn) {\n      const distanceToBottom = output.scrollHeight - output.scrollTop - output.clientHeight;\n      // Use a small tolerance for \"at bottom\" check, but larger for showing the button\n      const shouldShowBottom = distanceToBottom > 150;\n\n      if (shouldShowBottom) {\n        bottomBtn.classList.remove(\"opacity-0\", \"translate-y-2\", \"pointer-events-none\");\n        bottomBtn.classList.add(\"opacity-100\", \"translate-y-0\", \"pointer-events-auto\");\n      } else {\n        bottomBtn.classList.add(\"opacity-0\", \"translate-y-2\", \"pointer-events-none\");\n        bottomBtn.classList.remove(\"opacity-100\", \"translate-y-0\", \"pointer-events-auto\");\n      }\n    }\n\n    // Scroll to Top Button Logic\n    if (topBtn) {\n      const shouldShowTop = output.scrollTop > 200;\n\n      if (shouldShowTop) {\n        topBtn.classList.remove(\"opacity-0\", \"translate-y-2\", \"pointer-events-none\");\n        topBtn.classList.add(\"opacity-100\", \"translate-y-0\", \"pointer-events-auto\");\n      } else {\n        topBtn.classList.add(\"opacity-0\", \"translate-y-2\", \"pointer-events-none\");\n        topBtn.classList.remove(\"opacity-100\", \"translate-y-0\", \"pointer-events-auto\");\n      }\n    }\n  };\n\n  let ticking = false;\n  output.addEventListener(\"scroll\", () => {\n    if (!ticking) {\n      window.requestAnimationFrame(() => {\n        handleLogScroll();\n        ticking = false;\n      });\n      ticking = true;\n    }\n  });\n};\n\nconst setupCopyableValues = () => {\n  document.addEventListener(\"click\", (e) => {\n    // Check if clicked element or parent is a copyable-value button\n    const target = (e.target as HTMLElement).closest(\".copyable-value\") as HTMLElement;\n    if (!target) return;\n\n    const text = target.textContent?.trim();\n    if (!text) return;\n\n    // Prevent default (focus mostly)\n    e.preventDefault();\n\n    const onSuccess = () => {\n      showNotification(\"Value copied\", \"success\", NOTIFY_SHORT);\n\n      // Visual feedback\n      target.classList.add(\"bg-green-100\", \"text-green-800\");\n      target.classList.remove(\"hover:bg-cyan-100\", \"hover:text-cyan-800\");\n\n      setTimeout(() => {\n        target.classList.remove(\"bg-green-100\", \"text-green-800\");\n        target.classList.add(\"hover:bg-cyan-100\", \"hover:text-cyan-800\");\n      }, 500);\n    };\n\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n      navigator.clipboard.writeText(text).then(onSuccess).catch(() => fallbackCopyText(text, \"Value copied\", onSuccess));\n    } else {\n      fallbackCopyText(text, \"Value copied\", onSuccess);\n    }\n  });\n};\n\n// --- Font Settings Logic ---\n\nlet fontSettingsCleanup: (() => void) | null = null;\nlet fontSettingsTimer: number | null = null;\n\n(window as any).toggleFontSettings = (): void => {\n  const menu = document.getElementById(\"fontSettingsMenu\");\n  const btn = document.getElementById(\"fontSettingsBtn\");\n\n  if (!menu) return;\n\n  const closeMenu = () => {\n    menu.classList.add(\"hidden\");\n    if (btn) btn.setAttribute(\"aria-expanded\", \"false\");\n\n    if (fontSettingsTimer !== null) {\n      clearTimeout(fontSettingsTimer);\n      fontSettingsTimer = null;\n    }\n\n    if (fontSettingsCleanup) {\n      fontSettingsCleanup();\n      fontSettingsCleanup = null;\n    }\n  };\n\n  const isHidden = menu.classList.contains(\"hidden\");\n\n  if (isHidden) {\n    menu.classList.remove(\"hidden\");\n    if (btn) btn.setAttribute(\"aria-expanded\", \"true\");\n\n    const clickHandler = (e: MouseEvent) => {\n      if (!menu.contains(e.target as Node) &&\n        !btn?.contains(e.target as Node)) {\n        closeMenu();\n      }\n    };\n\n    const keyHandler = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        closeMenu();\n        btn?.focus();\n      }\n    };\n\n    // Delay to prevent immediate close if triggered by click\n    fontSettingsTimer = window.setTimeout(() => {\n      fontSettingsTimer = null;\n      document.addEventListener(\"click\", clickHandler);\n      document.addEventListener(\"keydown\", keyHandler);\n    }, 0);\n\n    fontSettingsCleanup = () => {\n      document.removeEventListener(\"click\", clickHandler);\n      document.removeEventListener(\"keydown\", keyHandler);\n    };\n\n  } else {\n    closeMenu();\n  }\n};\n\n(window as any).changePlotFont = async (fontFamily: string): Promise<void> => {\n  if (!fontFamily) return;\n\n  try {\n    await ensurePlotlyLoaded();\n  } catch (e) {\n    return;\n  }\n\n  // Update global layout config\n  if (plotLayout.font) {\n    plotLayout.font.family = fontFamily;\n  }\n\n  // Update existing plots\n  const plotIds = [\n    \"pressure-plot\",\n    \"velocity-plot\",\n    \"turbulence-plot\",\n    \"residuals-plot\",\n    \"cp-plot\",\n    \"velocity-profile-plot\"\n  ];\n\n  plotIds.forEach(id => {\n    const el = document.getElementById(id);\n    if (el && (el as any).data) { // Check if plot exists and has data\n      Plotly.relayout(el, { \"font.family\": fontFamily } as any).catch(err => {\n        console.warn(`Failed to update font for ${id}:`, err);\n      });\n    }\n  });\n\n  // Update input value if it wasn't the trigger\n  const input = document.getElementById(\"customFontInput\") as HTMLInputElement;\n  if (input && input.value !== fontFamily) {\n    input.value = fontFamily;\n  }\n\n  showNotification(`Plot font changed to ${fontFamily.split(',')[0]}`, \"info\", NOTIFY_MEDIUM);\n};\n\n\n(window as any).switchCaseCreationTab = (tab: \"create\" | \"import\"): void => {\n  const track = document.getElementById(\"case-creation-track\");\n  const pill = document.getElementById(\"case-creation-bg-pill\");\n  const createBtn = document.getElementById(\"tab-btn-create\");\n  const importBtn = document.getElementById(\"tab-btn-import\");\n\n  if (!track || !createBtn || !importBtn) return;\n\n  // Only toggle text styles now\n  const activeTextClasses = [\"text-cyan-800\", \"font-semibold\"];\n  const inactiveTextClasses = [\"text-gray-600\", \"hover:text-gray-800\", \"font-medium\"];\n\n  if (tab === \"create\") {\n    track.style.transform = \"translateX(0%)\";\n    if (pill) pill.style.transform = \"translateX(0)\";\n\n    // Active Style for Create\n    createBtn.classList.remove(...inactiveTextClasses);\n    createBtn.classList.add(...activeTextClasses);\n    createBtn.setAttribute(\"aria-selected\", \"true\");\n\n    // Inactive Style for Import\n    importBtn.classList.remove(...activeTextClasses);\n    importBtn.classList.add(...inactiveTextClasses);\n    importBtn.setAttribute(\"aria-selected\", \"false\");\n\n    // Focus Input (UX Improvement)\n    const input = document.getElementById(\"newCaseName\") as HTMLInputElement;\n    if (input && tab === \"create\") setTimeout(() => input.focus(), 300); // Wait for transition\n  } else {\n    track.style.transform = \"translateX(-100%)\";\n    if (pill) pill.style.transform = \"translateX(calc(100% + 0.25rem))\";\n\n    // Active Style for Import\n    importBtn.classList.remove(...inactiveTextClasses);\n    importBtn.classList.add(...activeTextClasses);\n    importBtn.setAttribute(\"aria-selected\", \"true\");\n\n    // Inactive Style for Create\n    createBtn.classList.remove(...activeTextClasses);\n    createBtn.classList.add(...inactiveTextClasses);\n    createBtn.setAttribute(\"aria-selected\", \"false\");\n\n    // Focus Input (UX Improvement)\n    const select = document.getElementById(\"tutorialSelect\") as HTMLSelectElement;\n    // Ensure we only focus if the tab is visible and it's the right element\n    if (select && tab === \"import\") setTimeout(() => select.focus(), 300); // Wait for transition\n  }\n};\n\nconst setupQuickActions = () => {\n  const bindings = [\n    { input: \"tutorialSelect\", btn: \"loadTutorialBtn\", events: [\"keydown\"] },\n    { input: \"caseDir\", btn: \"setRootBtn\", events: [\"keydown\"] },\n    { input: \"geometrySelect\", btn: \"viewGeometryBtn\", events: [\"keydown\", \"dblclick\"] },\n    { input: \"resourceGeometrySelect\", btn: \"fetchResourceGeometryBtn\", events: [\"keydown\"] },\n    { input: \"meshSelect\", btn: \"loadMeshBtn\", events: [\"keydown\"] },\n    { input: \"vtkFileSelect\", btn: \"loadContourVTKBtn\", events: [\"keydown\"] },\n  ];\n\n  bindings.forEach(({ input, btn, events }) => {\n    const inputEl = document.getElementById(input);\n    const btnEl = document.getElementById(btn);\n    if (!inputEl || !btnEl) return;\n\n    if (events.includes(\"keydown\")) {\n      inputEl.addEventListener(\"keydown\", (e) => {\n        if ((e as KeyboardEvent).key === \"Enter\") {\n          e.preventDefault(); // Prevent form submission if any\n          btnEl.click();\n        }\n      });\n    }\n\n    if (events.includes(\"dblclick\")) {\n      inputEl.addEventListener(\"dblclick\", () => {\n        btnEl.click();\n      });\n    }\n  });\n};\n\nconst setupGeometryDragDrop = () => {\n  const dropZone = document.getElementById('geo-drop-zone');\n  const input = document.getElementById('geometryUpload') as HTMLInputElement;\n  const nameDisplay = document.getElementById('geo-file-name');\n  const overlay = document.getElementById('geo-drop-overlay');\n\n  if (!dropZone || !input) return;\n\n  const showFile = () => {\n    if (input.files && input.files[0]) {\n      if (nameDisplay) {\n        // ðŸŽ¨ Palette UX: Add remove button to allow clearing selection\n        nameDisplay.innerHTML = `\n          <div class=\"flex items-center justify-center gap-2\">\n            <span>Selected: ${input.files[0].name}</span>\n            <button type=\"button\" id=\"remove-file-btn\" class=\"text-cyan-700 hover:text-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 rounded p-0.5 transition-colors\" aria-label=\"Remove file\" title=\"Remove file\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n          </div>\n        `;\n        nameDisplay.classList.remove('hidden');\n\n        // Add event listener to remove button\n        const removeBtn = document.getElementById(\"remove-file-btn\");\n        if (removeBtn) {\n          removeBtn.addEventListener(\"click\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            input.value = \"\"; // Clear file input\n            nameDisplay.classList.add(\"hidden\");\n            nameDisplay.innerHTML = \"\";\n            // Also notify user\n            showNotification(\"File selection cleared\", \"info\", NOTIFY_SHORT);\n          });\n        }\n      }\n    }\n  };\n\n  input.addEventListener('change', showFile);\n\n  let dragCounter = 0;\n\n  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {\n    dropZone.addEventListener(eventName, (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n    });\n  });\n\n  dropZone.addEventListener('dragenter', () => {\n    dragCounter++;\n    if (dragCounter === 1) {\n      dropZone.classList.add('border-cyan-500');\n      if (overlay) {\n        overlay.classList.remove('opacity-0', 'scale-95');\n        overlay.classList.add('opacity-100', 'scale-100');\n      }\n    }\n  });\n\n  dropZone.addEventListener('dragleave', () => {\n    dragCounter--;\n    if (dragCounter === 0) {\n      dropZone.classList.remove('border-cyan-500');\n      if (overlay) {\n        overlay.classList.remove('opacity-100', 'scale-100');\n        overlay.classList.add('opacity-0', 'scale-95');\n      }\n    }\n  });\n\n  dropZone.addEventListener('drop', (e: DragEvent) => {\n    dragCounter = 0;\n    dropZone.classList.remove('border-cyan-500');\n    if (overlay) {\n      overlay.classList.remove('opacity-100', 'scale-100');\n      overlay.classList.add('opacity-0', 'scale-95');\n    }\n\n    const dt = e.dataTransfer;\n    if (dt && dt.files) {\n      input.files = dt.files;\n      showFile();\n    }\n  });\n};\n\n// Fullscreen Toggle\n(window as any).toggleFullscreen = (containerId: string, btn: HTMLElement) => {\n  const container = document.getElementById(containerId);\n  if (!container) return;\n\n  // Icons\n  const expandIcon = `<svg class=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\" /></svg>`;\n  const compressIcon = `<svg class=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 14h6v6M10 14L4 20M20 14h-6v6M14 14l6 20M4 10h6V4M10 10L4 4M20 10h-6V4M14 10l6-4\" /></svg>`;\n\n  const updateUI = () => {\n    // Check if this container is the one in fullscreen\n    if (document.fullscreenElement === container) {\n      btn.innerHTML = compressIcon;\n      btn.setAttribute(\"aria-label\", \"Exit Fullscreen\");\n      btn.setAttribute(\"title\", \"Exit Fullscreen\");\n      // Add background to ensure it's not transparent in fullscreen\n      container.classList.add(\"bg-white\", \"flex\", \"flex-col\");\n    } else {\n      btn.innerHTML = expandIcon;\n      btn.setAttribute(\"aria-label\", \"Enter Fullscreen\");\n      btn.setAttribute(\"title\", \"Enter Fullscreen\");\n      container.classList.remove(\"bg-white\", \"flex\", \"flex-col\");\n    }\n  };\n\n  // Bind event listener if not already bound\n  if (!(container as any)._fsListenerAttached) {\n    document.addEventListener(\"fullscreenchange\", updateUI);\n    (container as any)._fsListenerAttached = true;\n  }\n\n  if (!document.fullscreenElement) {\n    container.requestFullscreen().catch(err => {\n      console.error(`Error attempting to enable full-screen mode: ${err.message}`);\n    });\n  } else {\n    document.exitFullscreen();\n  }\n};\n\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n(window as any)._fetchWithCache = fetchWithCache;\n(window as any)._requestCache = requestCache;\n\nconst resetState = () => {\n  requestCache = new Map<string, CacheEntry>();\n  activeCase = null;\n  caseDir = \"\";\n  dockerImage = \"\";\n  openfoamVersion = \"\";\n  currentMeshPath = null;\n  availableMeshes = [];\n  isInteractiveMode = true;\n  selectedGeometry = null;\n  postPipeline = [{ id: \"root\", type: \"root\", name: \"Mesh\", parentId: null }];\n  activePipelineId = \"root\";\n  outputBuffer.length = 0;\n  cachedLogHTML = \"\";\n};\n(window as any)._resetState = resetState;\n\nexport { init, fetchWithCache, requestCache, setCase, refreshCaseList, uploadGeometry, deleteGeometry, resetState };\n"],"names":["generateContours","generateContoursFn","loadContourMesh","Plotly","plotlyPromise","ensurePlotlyLoaded","window","Promise","resolve","reject","script","document","createElement","src","onload","onerror","Error","head","appendChild","getCookie","name","v","cookie","match","originalFetch","fetch","input","init","url","URL","toString","Request","isRelative","startsWith","isSameOrigin","location","origin","method","toUpperCase","token","headers","Headers","append","Array","isArray","push","loadInteractiveViewerCommon","config","iframe","getElementById","iframeId","placeholder","placeholderId","btn","btnElement","originalBtnText","innerHTML","disabled","setAttribute","loadingText","btnLoadingText","showNotification","loadingMessage","res","apiUrl","body","JSON","stringify","apiBody","ok","status","html","text","srcdoc","classList","remove","add","imageId","onSuccess","e","console","error","onError","removeAttribute","getElement","id","formatBytes","bytes","decimals","k","dm","sizes","i","Math","floor","log","parseFloat","pow","toFixed","getErrorMessage","message","detectSlowHardware","canvas","gl","getContext","debugInfo","getExtension","renderer","getParameter","UNMASKED_RENDERER_WEBGL","slowRenderers","some","r","toLowerCase","includes","clearLog","outputDiv","confirmed","showConfirmModal","OUTPUT_PLACEHOLDER","cachedLogHTML","localStorage","removeItem","CONSOLE_LOG_KEY","outputBuffer","length","NOTIFY_MEDIUM","temporarilyShowSuccess","originalHTML","successClasses","setTimeout","copyTextFromElement","elementId","successMessage","el","innerText","trim","originalTitle","getAttribute","navigator","clipboard","writeText","then","catch","fallbackCopyText","textArea","value","style","position","left","top","focus","select","successful","execCommand","removeChild","err","copyLogToClipboard","querySelector","downloadLog","NOTIFY_SHORT","textContent","blob","Blob","type","createObjectURL","now","Date","timestamp","toISOString","replace","slice","filename","link","href","download","click","revokeObjectURL","copyInputToClipboard","dataset","isCopying","clearMeshingOutput","div","scrollTop","copyMeshingOutput","downloadMeshingLog","caseDir","dockerImage","openfoamVersion","activeCase","currentPage","currentMeshPath","availableMeshes","isInteractiveMode","selectedGeometry","NOTIFY_LONG","NOTIFY_DEFAULT","POLL_INTERVAL","DEBOUNCE_DELAY","MAX_LOG_SIZE","notificationId","lastErrorNotificationTime","ERROR_NOTIFICATION_COOLDOWN","plotUpdateInterval","plotsVisible","aeroVisible","isUpdatingPlots","pendingPlotUpdate","isSimulationRunning","plotsInViewport","isFirstPlotLoad","abortControllers","Map","requestCache","CACHE_DURATION","outputFlushTimer","saveLogTimer","saveLogToStorage","setItem","warn","saveLogDebounced","clearTimeout","plotlyColors","blue","orange","green","red","purple","brown","pink","gray","yellow","teal","cyan","magenta","plotLayout","font","family","size","plot_bgcolor","paper_bgcolor","margin","l","t","b","pad","height","autosize","showlegend","legend","orientation","y","x","xanchor","yanchor","borderwidth","xaxis","showgrid","linewidth","yaxis","plotConfig","responsive","displayModeBar","staticPlot","scrollZoom","doubleClick","showTips","modeBarButtonsToRemove","displaylogo","lineStyle","width","opacity","createBoldTitle","downloadPlotAsPNG","plotIdOrDiv","plotDiv","toImage","format","offsetWidth","offsetHeight","scale","dataUrl","getLegendVisibility","plotData","data","visibility","trace","vis","visible","attachWhiteBGDownloadButton","whiteButtonAdded","configWithWhiteBG","fullLayout","toImageButtonOptions","clientHeight","clientWidth","react","layout","downloadPlotData","plotId","traces","forEach","index","csvContent","traceName","traceFilename","switchPage","pageName","updateUrl","pathname","history","pushState","page","pages","pageElement","navButton","mobileNavButton","selectedPage","selectedNav","selectedMobileNav","navPill","noCaseState","isProtectedPage","hasActiveCase","offsetLeft","refreshGeometryList","shmSelect","geoSelect","visualizerContainer","hasAttribute","refreshMeshList","fetchRunHistory","plotsContainer","loader","startPlotUpdates","aeroBtn","postContainer","refreshPostList","setMobileMenuState","isOpen","menu","icon","toggleMobileMenu","isHidden","contains","duration","container","template","clone","content","cloneNode","notification","colors","success","warning","info","className","icons","iconSlot","messageSlot","progressBar","transition","requestAnimationFrame","fadeTime","max","fadeTimer","countdownInterval","removeNotification","timerId","fadeTimerId","closeBtn","onclick","stopPropagation","parseInt","title","previousActiveElement","activeElement","modal","close","result","removeEventListener","handleKey","cancelBtn","okBtn","key","preventDefault","focusableElements","firstElement","lastElement","shiftKey","idx","indexOf","addEventListener","fetchWithCache","options","cacheMap","_requestCache","cacheKey","cached","get","has","abort","controller","AbortController","set","fetchOptions","signal","etag","lastModified","response","newEtag","newLastModified","errorMessage","errorData","json","output","delete","appendOutput","flushOutputBuffer","limitLogSize","MAX_NODES","PRUNE_TARGET","childElementCount","toRemove","range","createRange","setStart","boundary","firstElementChild","nextElementSibling","setEndBefore","deleteContents","isAtBottom","scrollHeight","newHtmlChunks","escapeHtml","str","safeMessage","insertAdjacentHTML","MAX_LOG_LENGTH","firstDiv","substring","setDockerConfig","image","version","originalText","openfoamRootInput","HTMLInputElement","loadTutorial","tutorialSelect","selected","tutorial","split","line","refreshCaseList","importedName","pop","selectCase","switchGeometryTab","encodeURIComponent","toggleSection","section","toggleIcon","toggleBtn","parentElement","tagName","updateActiveCaseBadge","badge","cases","current","c","opt","val","createNewCase","caseName","confirmRunCommand","cmd","runCommand","getStatusIcon","runs","map","run","statusColor","startTime","start_time","toLocaleString","execution_duration","command","join","selectedTutorial","reader","getReader","decoder","TextDecoder","buffer","done","read","undefined","decode","stream","lines","cleanLine","updatePlots","togglePlots","setupIntersectionObserver","stopPlotUpdates","observerSetup","observer","IntersectionObserver","entries","entry","isIntersecting","threshold","rootMargin","observe","toggleAeroPlots","updateAeroPlots","startPolling","setInterval","hidden","clearInterval","updateResidualsPlot","injectedData","time","fields","field","fieldData","from","_","mode","color","shape","residualsPlotDiv","showline","mirror","gridwidth","gridcolor","preFetchedData","p","pinf","rho","uinf","U_mag","qinf","cp","pval","cpDiv","cpTrace","Ux","Uy","Uz","velocityDiv","velocityTrace","z","marker","scene","zaxis","pressureDiv","legendVisibility","pressureTrace","hasOwnProperty","dash","tr","Object","prototype","call","turbulenceTrace","nut","nuTilda","omega","turbPlotDiv","updatePromises","allSettled","currentTime","files","f","tab","track","pill","uploadBtn","resourceBtn","activeTextClasses","inactiveTextClasses","transform","loadResourceGeometries","refresh","originalIcon","fetchResourceGeometry","setCase","caseDirInput","finally","openCaseRoot","uploadGeometry","file","once","MAX_SIZE","sizeMB","allowedExtensions","fileName","isValidExtension","ext","endsWith","formData","FormData","deleteGeometry","loadGeometryView","optimize","bounds","fmt","n","dx","dy","dz","setText","fillBoundsFromGeometry","minStr","maxStr","generateBlockMeshDict","minVal","Number","maxVal","cells","grading","min_point","max_point","generateSnappyHexMeshDict","level","locationInput","stl_filename","refinement_level","location_in_mesh","selectShmObject","list","props","nameLabel","updateShmObjectConfig","runMeshingCommand","runFoamToVTK","test","meshes","m","path","loadMeshVisualization","refreshInteractiveViewer","updateMeshView","showEdges","checked","cameraPosition","file_path","show_edges","camera_position","displayMeshInfo","meshInfo","meshInfoDiv","meshInfoContent","infoItems","label","n_points","n_cells","volume","item","boundsStr","center","centerStr","cameraControl","updateBtn","showEdgesInput","colorInput","onMeshParamChange","toggleInteractiveMode","meshImage","meshInteractive","meshPlaceholder","setCameraView","view","contentWindow","postMessage","resetCamera","postPipeline","parentId","activePipelineId","deletePipelineStep","children","filter","child","find","selectPipelineStep","renderPipeline","node","groupEl","isActive","activeWrapper","inactiveWrapper","selectBtn","hasDelete","roundedClass","textClass","delBtn","delTextClass","confirm","addBtn","landing","contour","switchPostView","newNodeId","refreshPostListVTK","runPostOperation","operation","loadCustomVTKFile","loadContourVTK","vtkFileSelect","fileToLoad","checkStartupStatus","pollStatus","messageEl","savedLog","getItem","caseRootData","dockerConfigData","savedCase","exists","savedTutorial","target","initialPage","onpopstate","event","state","navButtons","mobileId","handler","button","mobileButton","loadTutorialBtn","startupError","msg","meshColorSelect","showEdgesCheck","setupVectorInputAutoFormat","handleScroll","initLogScrollObserver","setupQuickActions","setupCopyableValues","setupLayersDependency","setupGeometryDragDrop","shmLayers","shmObjLayers","updateState","isEnabled","navbar","scrollY","originalClasses","helpId","helpEl","originalClass","restoreTimer","scrollToLogBottom","scrollTo","behavior","scrollToLogTop","bottomBtn","topBtn","handleLogScroll","distanceToBottom","shouldShowBottom","shouldShowTop","ticking","closest","fontSettingsCleanup","fontSettingsTimer","toggleFontSettings","closeMenu","clickHandler","keyHandler","changePlotFont","fontFamily","plotIds","relayout","switchCaseCreationTab","createBtn","importBtn","bindings","events","inputEl","btnEl","dropZone","nameDisplay","overlay","showFile","removeBtn","dragCounter","eventName","dt","dataTransfer","toggleFullscreen","containerId","expandIcon","compressIcon","updateUI","fullscreenElement","_fsListenerAttached","requestFullscreen","exitFullscreen","readyState","_fetchWithCache","resetState","_resetState"],"mappings":"AAAA;;;;;;CAMC,GAED,SAASA,oBAAoBC,kBAAkB,EAAEC,eAAe,QAAQ,2BAA2B;AACnG,YAAYC,YAAY,YAAY;AAEpC,2CAA2C;AAC3C,IAAIC,gBAAsC;AAE1C,MAAMC,qBAAqB;IACzB,IAAI,AAACC,OAAeH,MAAM,EAAE,OAAOI,QAAQC,OAAO;IAClD,IAAIJ,eAAe,OAAOA;IAE1BA,gBAAgB,IAAIG,QAAQ,CAACC,SAASC;QACpC,MAAMC,SAASC,SAASC,aAAa,CAAC;QACtCF,OAAOG,GAAG,GAAG;QACbH,OAAOI,MAAM,GAAG,IAAMN;QACtBE,OAAOK,OAAO,GAAG;YACfX,gBAAgB,MAAM,iCAAiC;YACvDK,OAAO,IAAIO,MAAM;QACnB;QACAL,SAASM,IAAI,CAACC,WAAW,CAACR;IAC5B;IACA,OAAON;AACT;AAEA,0BAA0B;AAC1B,MAAMe,YAAY,CAACC;IACjB,MAAMC,IAAIV,SAASW,MAAM,CAACC,KAAK,CAAC,YAAYH,OAAO;IACnD,OAAOC,IAAIA,CAAC,CAAC,EAAE,GAAG;AACpB;AAEA,2CAA2C;AAC3C,MAAMG,gBAAgBlB,OAAOmB,KAAK;AAClCnB,OAAOmB,KAAK,GAAG,OAAOC,OAAOC;IAC3B,iFAAiF;IACjF,MAAMC,MAAM,OAAOF,UAAU,WAAWA,QAASA,iBAAiBG,MAAMH,MAAMI,QAAQ,KAAMJ,iBAAiBK,UAAUL,MAAME,GAAG,GAAG;IACnI,MAAMI,aAAaJ,IAAIK,UAAU,CAAC;IAClC,MAAMC,eAAeN,IAAIK,UAAU,CAAC3B,OAAO6B,QAAQ,CAACC,MAAM;IAE1D,IAAIJ,cAAcE,cAAc;QAC9B,MAAMG,SAAS,AAACV,CAAAA,MAAMU,UAAU,KAAI,EAAGC,WAAW;QAClD,IAAID,WAAW,SAASA,WAAW,QAAQ;YACzC,MAAME,QAAQpB,UAAU;YACxB,IAAIoB,OAAO;gBACTZ,OAAOA,QAAQ,CAAC;gBAChB,IAAIA,KAAKa,OAAO,YAAYC,SAAS;oBACnCd,KAAKa,OAAO,CAACE,MAAM,CAAC,eAAeH;gBACrC,OAAO,IAAII,MAAMC,OAAO,CAACjB,KAAKa,OAAO,GAAG;oBACrCb,KAAKa,OAAO,CAAgBK,IAAI,CAAC;wBAAC;wBAAeN;qBAAM;gBAC1D,OAAO;oBACLZ,KAAKa,OAAO,GAAG;wBAAE,GAAGb,KAAKa,OAAO;wBAAE,eAAeD;oBAAM;gBACzD;YACF;QACF;IACF;IACA,OAAOf,cAAcE,OAAOC;AAC9B;AAoKA,8CAA8C;AAC9C,MAAMmB,8BAA8B,OAAOC;IACzC,MAAMC,SAASrC,SAASsC,cAAc,CAACF,OAAOG,QAAQ;IACtD,MAAMC,cAAcxC,SAASsC,cAAc,CAACF,OAAOK,aAAa;IAChE,MAAMC,MAAMN,OAAOO,UAAU;IAE7B,IAAI,CAACN,UAAU,CAACG,aAAa;IAE7B,IAAII,kBAAkB;IACtB,IAAIF,KAAK;QACPE,kBAAkBF,IAAIG,SAAS;QAC/BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9B,MAAMC,cAAcZ,OAAOa,cAAc,IAAI;QAC7CP,IAAIG,SAAS,GAAG,CAAC,mZAAmZ,EAAEG,aAAa;IACrb;IAEAE,iBAAiBd,OAAOe,cAAc,EAAE;IAExC,IAAI;QACF,MAAMC,MAAM,MAAMtC,MAAMsB,OAAOiB,MAAM,EAAE;YACrC3B,QAAQ;YACRG,SAAS;gBAAE,gBAAgB;YAAmB;YAC9CyB,MAAMC,KAAKC,SAAS,CAACpB,OAAOqB,OAAO;QACrC;QAEA,IAAI,CAACL,IAAIM,EAAE,EAAE,MAAM,IAAIrD,MAAM,CAAC,oBAAoB,EAAE+C,IAAIO,MAAM,EAAE;QAEhE,MAAMC,OAAO,MAAMR,IAAIS,IAAI;QAC3BxB,OAAOyB,MAAM,GAAGF;QAEhB,aAAa;QACbvB,OAAO0B,SAAS,CAACC,MAAM,CAAC;QACxBxB,YAAYuB,SAAS,CAACE,GAAG,CAAC;QAE1B,IAAI7B,OAAO8B,OAAO,EAAE;YAClBlE,SAASsC,cAAc,CAACF,OAAO8B,OAAO,GAAGH,UAAUE,IAAI;QACzD;QAEA,IAAI7B,OAAO+B,SAAS,EAAE/B,OAAO+B,SAAS;IAExC,EAAE,OAAOC,GAAG;QACVC,QAAQC,KAAK,CAAC,uBAAuBF;QAErC,sBAAsB;QACtB/B,OAAO0B,SAAS,CAACE,GAAG,CAAC;QACrBzB,YAAYuB,SAAS,CAACC,MAAM,CAAC;QAC7B,IAAI5B,OAAO8B,OAAO,EAAE;YAClBlE,SAASsC,cAAc,CAACF,OAAO8B,OAAO,GAAGH,UAAUC,OAAO;QAC5D;QAEA,IAAI5B,OAAOmC,OAAO,EAAEnC,OAAOmC,OAAO,CAACH;aAC9BlB,iBAAiB,yBAAyB,UAAU,8BAA8B;IACzF,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAI8B,eAAe,CAAC;YACpB9B,IAAIG,SAAS,GAAGD;QAClB;IACF;AACF;AAEA,oBAAoB;AACpB,MAAM6B,aAAa,CAAwBC;IACzC,OAAO1E,SAASsC,cAAc,CAACoC;AACjC;AAEA,MAAMC,cAAc,CAACC,OAAeC,WAAW,CAAC;IAC9C,IAAI,CAACD,OAAO,OAAO;IACnB,MAAME,IAAI;IACV,MAAMC,KAAKF,WAAW,IAAI,IAAIA;IAC9B,MAAMG,QAAQ;QAAC;QAAK;QAAM;QAAM;QAAM;KAAK;IAC3C,MAAMC,IAAIC,KAAKC,KAAK,CAACD,KAAKE,GAAG,CAACR,SAASM,KAAKE,GAAG,CAACN;IAChD,OAAO,GAAGO,WAAW,AAACT,CAAAA,QAAQM,KAAKI,GAAG,CAACR,GAAGG,EAAC,EAAGM,OAAO,CAACR,KAAK,CAAC,EAAEC,KAAK,CAACC,EAAE,EAAE;AAC1E;AAEA,MAAMO,kBAAkB,CAAClB;IACvB,IAAIA,iBAAiBjE,OAAO,OAAOiE,MAAMmB,OAAO;IAChD,OAAO,OAAOnB,UAAU,WAAWA,QAAQ;AAC7C;AAEA,kDAAkD;AAClD,MAAMoB,qBAAqB;IACzB,IAAI;QACF,MAAMC,SAAS3F,SAASC,aAAa,CAAC;QACtC,MAAM2F,KAAKD,OAAOE,UAAU,CAAC,YAAYF,OAAOE,UAAU,CAAC;QAC3D,IAAI,CAACD,IAAI,OAAO,MAAM,0BAA0B;QAEhD,MAAME,YAAY,AAACF,GAA6BG,YAAY,CAAC;QAC7D,IAAI,CAACD,WAAW,OAAO;QAEvB,MAAME,WAAW,AAACJ,GAA6BK,YAAY,CAACH,UAAUI,uBAAuB;QAC7F,IAAI,CAACF,UAAU,OAAO;QAEtB,iDAAiD;QACjD,MAAMG,gBAAgB;YAAC;YAAS;YAAe;YAAY;YAAQ;SAAW;QAC9E,OAAOA,cAAcC,IAAI,CAACC,CAAAA,IAAKL,SAASM,WAAW,GAAGC,QAAQ,CAACF;IACjE,EAAE,OAAOjC,GAAG;QACV,OAAO,OAAO,YAAY;IAC5B;AACF;AAEA,oBAAoB;AACpB,MAAMoC,WAAW;IACf,MAAMC,YAAYzG,SAASsC,cAAc,CAAC;IAC1C,IAAImE,WAAW;QACb,0DAA0D;QAC1D,MAAMC,YAAY,MAAMC,iBAAiB,qBAAqB;QAC9D,IAAI,CAACD,WAAW;QAEhBD,UAAU5D,SAAS,GAAG+D;QACtBC,gBAAgB,IAAI,mCAAmC;QACvD,IAAI;YACFC,aAAaC,UAAU,CAACC;QAC1B,EAAE,OAAO5C,GAAG;QACV,8BAA8B;QAChC;QACA6C,aAAaC,MAAM,GAAG,GAAG,eAAe;QACxChE,iBAAiB,uBAAuB,QAAQiE;IAClD;AACF;AAEA,mDAAmD;AACnD,MAAMC,yBAAyB,CAAC1E,KAAwB2E,cAAsB5B,UAAkB,UAAU;IACxG/C,IAAII,QAAQ,GAAG;IACfJ,IAAI8B,eAAe,CAAC;IACpB9B,IAAIqB,SAAS,CAACC,MAAM,CAAC,cAAc;IAEnC,mCAAmC;IACnC,uEAAuE;IACvEtB,IAAIG,SAAS,GAAG,CAAC;;;;UAIT,EAAE4C,QAAQ;EAClB,CAAC;IAED,uBAAuB;IACvB,MAAM6B,iBAAiB;QAAC;QAAiB;QAAqB;QAAe;KAAiB;IAC9F5E,IAAIqB,SAAS,CAACE,GAAG,IAAIqD;IAErBC,WAAW;QACT7E,IAAIG,SAAS,GAAGwE;QAChB3E,IAAIqB,SAAS,CAACC,MAAM,IAAIsD;IAC1B,GAAG;AACL;AAEA,mCAAmC;AACnC,MAAME,sBAAsB,CAACC,WAAmBC,gBAAwB/E;IACtE,MAAMgF,KAAK3H,SAASsC,cAAc,CAACmF;IACnC,IAAI,CAACE,IAAI;IAET,uDAAuD;IACvD,MAAM9D,OAAO8D,GAAGC,SAAS;IACzB,IAAI,CAAC/D,KAAKgE,IAAI,IAAI;QAChB3E,iBAAiB,oBAAoB,QAAQiE;QAC7C;IACF;IAEA,MAAMhD,YAAY;QAChBjB,iBAAiBwE,gBAAgB,WAAWP;QAC5C,IAAIxE,YAAY;YACd,MAAM0E,eAAe1E,WAAWE,SAAS;YACzC,MAAMiF,gBAAgBnF,WAAWoF,YAAY,CAAC;YAE9C,gCAAgC;YAChCpF,WAAWE,SAAS,GAAG,CAAC;;;;;MAKxB,CAAC;YACDF,WAAWI,YAAY,CAAC,SAAS;YAEjC,yBAAyB;YACzBwE,WAAW;gBACT5E,WAAWE,SAAS,GAAGwE;gBACvB,IAAIS,eAAenF,WAAWI,YAAY,CAAC,SAAS+E;qBAC/CnF,WAAW6B,eAAe,CAAC;YAClC,GAAG;QACL;IACF;IAEA,IAAIwD,UAAUC,SAAS,IAAID,UAAUC,SAAS,CAACC,SAAS,EAAE;QACxDF,UAAUC,SAAS,CAACC,SAAS,CAACrE,MAAMsE,IAAI,CAAChE,WAAWiE,KAAK,CAAC,IAAMC,iBAAiBxE,MAAM6D,gBAAgBvD;IACzG,OAAO;QACLkE,iBAAiBxE,MAAM6D,gBAAgBvD;IACzC;AACF;AAEA,MAAMkE,mBAAmB,CAACxE,MAAc6D,gBAAwBvD;IAC9D,IAAI;QACF,MAAMmE,WAAWtI,SAASC,aAAa,CAAC;QACxCqI,SAASC,KAAK,GAAG1E;QACjByE,SAASE,KAAK,CAACC,QAAQ,GAAG;QAC1BH,SAASE,KAAK,CAACE,IAAI,GAAG;QACtBJ,SAASE,KAAK,CAACG,GAAG,GAAG;QACrB3I,SAASsD,IAAI,CAAC/C,WAAW,CAAC+H;QAC1BA,SAASM,KAAK;QACdN,SAASO,MAAM;QAEf,MAAMC,aAAa9I,SAAS+I,WAAW,CAAC;QACxC/I,SAASsD,IAAI,CAAC0F,WAAW,CAACV;QAE1B,IAAIQ,YAAY;YACd,IAAI3E,WAAWA;iBACVjB,iBAAiBwE,gBAAgB,WAAWP;QACnD,OAAO;YACLjE,iBAAiB,kBAAkB;QACrC;IACF,EAAE,OAAO+F,KAAK;QACZ/F,iBAAiB,kBAAkB;IACrC;AACF;AAEA,mBAAmB;AACnB,MAAMgG,qBAAqB,CAACvG;IAC1B,MAAM8D,YAAYzG,SAASsC,cAAc,CAAC;IAC1C,IAAImE,aAAaA,UAAU0C,aAAa,CAAC,wBAAwB;QAC/DjG,iBAAiB,gBAAgB,WAAWiE;QAC5C;IACF;IACAK,oBAAoB,UAAU,2BAA2B7E;AAC3D;AAEA,uBAAuB;AACvB,MAAMyG,cAAc;IAClB,MAAM3C,YAAYzG,SAASsC,cAAc,CAAC;IAC1C,IAAI,CAACmE,WAAW;QACdvD,iBAAiB,4BAA4B;QAC7C;IACF;IAEA,wBAAwB;IACxB,MAAMV,cAAciE,UAAU0C,aAAa,CAAC;IAC5C,IAAI3G,aAAa;QACfU,iBAAiB,gBAAgB,WAAWmG;QAC5C;IACF;IAEA,kDAAkD;IAClD,MAAMxF,OAAO4C,UAAUmB,SAAS,IAAInB,UAAU6C,WAAW,IAAI;IAE7D,IAAI,CAACzF,KAAKgE,IAAI,IAAI;QAChB3E,iBAAiB,gBAAgB,WAAWmG;QAC5C;IACF;IAEA,IAAI;QACF,MAAME,OAAO,IAAIC,KAAK;YAAC3F;SAAK,EAAE;YAAE4F,MAAM;QAAa;QACnD,MAAMxI,MAAMC,IAAIwI,eAAe,CAACH;QAEhC,8BAA8B;QAC9B,MAAMI,MAAM,IAAIC;QAChB,8BAA8B;QAC9B,MAAMC,YAAYF,IAAIG,WAAW,GAAGC,OAAO,CAAC,SAAS,KAAKC,KAAK,CAAC,GAAG;QACnE,MAAMC,WAAW,CAAC,cAAc,EAAEJ,UAAU,IAAI,CAAC;QAEjD,MAAMK,OAAOlK,SAASC,aAAa,CAAC;QACpCiK,KAAKC,IAAI,GAAGlJ;QACZiJ,KAAKE,QAAQ,GAAGH;QAChBjK,SAASsD,IAAI,CAAC/C,WAAW,CAAC2J;QAC1BA,KAAKG,KAAK;QAEV,UAAU;QACV9C,WAAW;YACTvH,SAASsD,IAAI,CAAC0F,WAAW,CAACkB;YAC1BvK,OAAOuB,GAAG,CAACoJ,eAAe,CAACrJ;QAC7B,GAAG;QAEHiC,iBAAiB,wBAAwB,WAAWmG;IACtD,EAAE,OAAOjF,GAAG;QACVC,QAAQC,KAAK,CAACF;QACdlB,iBAAiB,0BAA0B;IAC7C;AACF;AAEA,0BAA0B;AAC1B,MAAMqH,uBAAuB,CAAC9C,WAAmB9E;IAC/C,MAAMgF,KAAK3H,SAASsC,cAAc,CAACmF;IACnC,IAAI,CAACE,MAAM,CAACA,GAAGY,KAAK,EAAE;IAEtB,MAAM1E,OAAO8D,GAAGY,KAAK;IAErB,MAAMpE,YAAY;QAChBjB,iBAAiB,uBAAuB,WAAWmG;QACnD,IAAI1G,YAAY;YACd,IAAIA,WAAW6H,OAAO,CAACC,SAAS,EAAE;YAClC9H,WAAW6H,OAAO,CAACC,SAAS,GAAG;YAE/B,MAAMpD,eAAe1E,WAAWE,SAAS;YACzC,mCAAmC;YACnCF,WAAWE,SAAS,GAAG,CAAC,4RAA4R,CAAC;YAErT0E,WAAW;gBACT5E,WAAWE,SAAS,GAAGwE;gBACvB,OAAO1E,WAAW6H,OAAO,CAACC,SAAS;YACrC,GAAG;QACL;IACF;IAEA,IAAIzC,UAAUC,SAAS,IAAID,UAAUC,SAAS,CAACC,SAAS,EAAE;QACxDF,UAAUC,SAAS,CAACC,SAAS,CAACrE,MAAMsE,IAAI,CAAChE,WAAWiE,KAAK,CAAC,IAAMC,iBAAiBxE,MAAM,UAAUM;IACnG,OAAO;QACLkE,iBAAiBxE,MAAM,UAAUM;IACnC;AACF;AAEA,uBAAuB;AACvB,MAAMuG,qBAAqB;IACzB,MAAMC,MAAM3K,SAASsC,cAAc,CAAC;IACpC,IAAIqI,KAAK;QACP,0DAA0D;QAC1D,MAAMjE,YAAY,MAAMC,iBAAiB,wBAAwB;QACjE,IAAI,CAACD,WAAW;QAEhBiE,IAAI/C,SAAS,GAAG;QAChB+C,IAAIC,SAAS,GAAG,GAAG,wBAAwB;QAC3C1H,iBAAiB,0BAA0B,QAAQiE;IACrD;AACF;AAEA,sBAAsB;AACtB,MAAM0D,oBAAoB,CAAClI;IACzB6E,oBAAoB,iBAAiB,yBAAyB7E;AAChE;AAEA,uBAAuB;AACvB,MAAMmI,qBAAqB;IACzB,MAAMrE,YAAYzG,SAASsC,cAAc,CAAC;IAC1C,IAAI,CAACmE,WAAW;QACdvD,iBAAiB,4BAA4B;QAC7C;IACF;IAEA,kDAAkD;IAClD,MAAMW,OAAO4C,UAAUmB,SAAS,IAAInB,UAAU6C,WAAW,IAAI;IAE7D,IAAI,CAACzF,KAAKgE,IAAI,MAAMhE,KAAKgE,IAAI,OAAO,YAAY;QAC9C3E,iBAAiB,gBAAgB,WAAWmG;QAC5C;IACF;IAEA,IAAI;QACF,MAAME,OAAO,IAAIC,KAAK;YAAC3F;SAAK,EAAE;YAAE4F,MAAM;QAAa;QACnD,MAAMxI,MAAMC,IAAIwI,eAAe,CAACH;QAEhC,8BAA8B;QAC9B,MAAMI,MAAM,IAAIC;QAChB,8BAA8B;QAC9B,MAAMC,YAAYF,IAAIG,WAAW,GAAGC,OAAO,CAAC,SAAS,KAAKC,KAAK,CAAC,GAAG;QACnE,MAAMC,WAAW,CAAC,YAAY,EAAEJ,UAAU,IAAI,CAAC;QAE/C,MAAMK,OAAOlK,SAASC,aAAa,CAAC;QACpCiK,KAAKC,IAAI,GAAGlJ;QACZiJ,KAAKE,QAAQ,GAAGH;QAChBjK,SAASsD,IAAI,CAAC/C,WAAW,CAAC2J;QAC1BA,KAAKG,KAAK;QAEV,UAAU;QACV9C,WAAW;YACTvH,SAASsD,IAAI,CAAC0F,WAAW,CAACkB;YAC1BvK,OAAOuB,GAAG,CAACoJ,eAAe,CAACrJ;QAC7B,GAAG;QAEHiC,iBAAiB,gCAAgC,WAAWmG;IAC9D,EAAE,OAAOjF,GAAG;QACVC,QAAQC,KAAK,CAACF;QACdlB,iBAAiB,kCAAkC;IACrD;AACF;AAEA,0BAA0B;AAC1B,MAAM8D,kBAAkB;AAExB,MAAMJ,qBAAqB,CAAC;;;;;;;MAOtB,CAAC;AAEP,eAAe;AACf,IAAImE,UAAkB;AACtB,IAAIC,cAAsB;AAC1B,IAAIC,kBAA0B;AAC9B,IAAIC,aAA4B;AAEhC,kBAAkB;AAClB,IAAIC,cAAsB;AAE1B,2BAA2B;AAC3B,IAAIC,kBAAiC;AACrC,IAAIC,kBAA8B,EAAE;AACpC,IAAIC,oBAA6B,MAAM,8BAA8B;AAErE,iBAAiB;AACjB,IAAIC,mBAAkC;AAEtC,yBAAyB;AACzB,MAAMlC,eAAe;AACrB,MAAMlC,gBAAgB;AACtB,MAAMqE,cAAc;AACpB,MAAMC,iBAAiB;AAEvB,mBAAmB;AACnB,MAAMC,gBAAgB;AACtB,MAAMC,iBAAiB;AACvB,MAAMC,eAAe;AAErB,0BAA0B;AAC1B,IAAIC,iBAAyB;AAC7B,IAAIC,4BAAoC;AACxC,MAAMC,8BAAsC,IAAI,KAAK;AAErD,qBAAqB;AACrB,IAAIC,qBAA4D;AAChE,0IAA0I;AAC1I,IAAIC,eAAwB;AAC5B,IAAIC,cAAuB;AAC3B,IAAIC,kBAA2B;AAC/B,IAAIC,oBAA6B;AACjC,IAAIC,sBAA+B,OAAO,wBAAwB;AAClE,IAAIC,kBAA2B;AAC/B,IAAIC,kBAA2B;AAE/B,qBAAqB;AACrB,IAAIC,mBAAmB,IAAIC;AAO3B,IAAIC,eAAe,IAAID;AACvB,MAAME,iBAAyB;AAE/B,MAAM1F,eAAoD,EAAE;AAC5D,IAAI2F,mBAAyD;AAC7D,IAAIC,eAAqD;AAEzD,kFAAkF;AAClF,IAAIhG,gBAAwB;AAE5B,wCAAwC;AACxC,MAAMiG,mBAAmB;IACvB,IAAI;QACF,yEAAyE;QACzEhG,aAAaiG,OAAO,CAAC/F,iBAAiBH;IACxC,EAAE,OAAOzC,GAAG;QACVC,QAAQ2I,IAAI,CAAC;IACf;AACF;AAEA,MAAMC,mBAAmB;IACvB,IAAIJ,cAAcK,aAAaL;IAC/BA,eAAetF,WAAWuF,kBAAkBnB;AAC9C;AAEA,SAAS;AACT,MAAMwB,eAAe;IACnBC,MAAM;IACNC,QAAQ;IACRC,OAAO;IACPC,KAAK;IACLC,QAAQ;IACRC,OAAO;IACPC,MAAM;IACNC,MAAM;IACNC,QAAQ;IACRC,MAAM;IACNC,MAAM;IACNC,SAAS;AACX;AAEA,MAAMC,aAAqC;IACzCC,MAAM;QAAEC,QAAQ;QAAqBC,MAAM;IAAG;IAC9CC,cAAc;IACdC,eAAe;IACfC,QAAQ;QAAEC,GAAG;QAAIlI,GAAG;QAAImI,GAAG;QAAIC,GAAG;QAAIC,KAAK;IAAE;IAC7CC,QAAQ;IACRC,UAAU;IACVC,YAAY;IACZC,QAAQ;QACNC,aAAa;QACbC,GAAG,CAAC;QACJC,GAAG;QACHC,SAAS;QACTC,SAAS;QACT,iCAAiC;QACjCC,aAAa;IACf;IACAC,OAAO;QAAEC,UAAU;QAAOC,WAAW;IAAE;IACvCC,OAAO;QAAEF,UAAU;QAAOC,WAAW;IAAE;AACzC;AAEA,MAAME,aAAqC;IACzCC,YAAY;IACZC,gBAAgB;IAChBC,YAAY;IACZC,YAAY;IACZC,aAAa;IACbC,UAAU;IACVC,wBAAwB;QACtB;QAAU;QAAS;QAAY;QAAW;QAAY;QAAa;QAAe;QAClF;QAAyB;QAAyB;QAAU;QAAS;QAAiB;QACtF;QAAgB;QAAwB;QAAyB;QACjE;QAAmB;QAAoB;QAAiB;QAAe;QAAc;KACtF;IACDC,aAAa;AACf;AAEA,MAAMC,YAAY;IAAEC,OAAO;IAAGC,SAAS;AAAI;AAE3C,MAAMC,kBAAkB,CAACxM,OAAgD,CAAA;QACvEA,MAAM,CAAC,GAAG,EAAEA,KAAK,IAAI,CAAC;QACtBoK,MAAM;YAAE,GAAGD,WAAWC,IAAI;YAAEE,MAAM;QAAG;IACvC,CAAA;AAEA,+BAA+B;AAC/B,MAAMmC,oBAAoB,OACxBC,aACAtG,WAAmB,UAAU;IAE7B,IAAI;QACF,MAAMvK;IACR,EAAE,OAAO0E,GAAG;QACVlB,iBAAiB,mCAAmC;QACpD;IACF;IAEA,sDAAsD;IACtD,MAAMsN,UAAU,OAAOD,gBAAgB,WACnCvQ,SAASsC,cAAc,CAACiO,eACxBA;IAEJ,IAAI,CAACC,SAAS;QACZnM,QAAQC,KAAK,CAAC,CAAC,wBAAwB,EAAEiM,aAAa;QACtD;IACF;IAEA,4EAA4E;IAC5E/Q,OAAOiR,OAAO,CAACD,SAAS;QACtBE,QAAQ;QACRP,OAAOK,QAAQG,WAAW;QAC1BhC,QAAQ6B,QAAQI,YAAY;QAC5BC,OAAO;IACT,GAAG1I,IAAI,CAAC,CAAC2I;QACP,MAAM5G,OAAOlK,SAASC,aAAa,CAAC;QACpCiK,KAAKC,IAAI,GAAG2G;QACZ5G,KAAKE,QAAQ,GAAGH;QAChBjK,SAASsD,IAAI,CAAC/C,WAAW,CAAC2J;QAC1BA,KAAKG,KAAK;QACVrK,SAASsD,IAAI,CAAC0F,WAAW,CAACkB;IAC5B,GAAG9B,KAAK,CAAC,CAACa;QACR5E,QAAQC,KAAK,CAAC,2BAA2B2E;IAC3C;AACF;AAEA,yCAAyC;AACzC,MAAM8H,sBAAsB,CAC1BP;IAEA,IAAI;QACF,MAAMQ,WAAW,AAACR,QAAgBS,IAAI;QACtC,IAAI,CAACjP,MAAMC,OAAO,CAAC+O,WAAW;YAC5B,OAAO,CAAC;QACV;QAEA,MAAME,aAAqD,CAAC;QAE5D,KAAK,MAAMC,SAASH,SAAU;YAC5B,MAAMvQ,OAAO0Q,MAAM1Q,IAAI,IAAI;YAC3B,IAAI,CAACA,MAAM;gBACT;YACF;YAEA,0DAA0D;YAC1D,MAAM2Q,MAAMD,MAAME,OAAO;YAEzB,gEAAgE;YAChEH,UAAU,CAACzQ,KAAK,GAAG2Q,QAAQ,eAAe,eAAgBA,OAAO;QACnE;QAEA,OAAOF;IACT,EAAE,OAAO5M,OAAO;QACdD,QAAQ2I,IAAI,CAAC,oCAAoC1I;QACjD,OAAO,CAAC;IACV;AACF;AAEA,oDAAoD;AACpD,MAAMgN,8BAA8B,CAACd;IACnC,IAAI,CAACA,WAAWA,QAAQhG,OAAO,CAAC+G,gBAAgB,EAAE;IAClD,0EAA0E;IAC1E,yCAAyC;IACzCf,QAAQhG,OAAO,CAAC+G,gBAAgB,GAAG;IACnC,MAAMC,oBAAoB;QAAE,GAAGhB,QAAQiB,UAAU,EAAErP,MAAM;QAAE,GAAGqN,UAAU;IAAC;IACzE+B,kBAAkBE,oBAAoB,GAAG;QACvChB,QAAQ;QACRzG,UAAU,GAAGuG,QAAQ9L,EAAE,CAAC,OAAO,CAAC;QAChCiK,QAAQ6B,QAAQmB,YAAY;QAC5BxB,OAAOK,QAAQoB,WAAW;QAC1Bf,OAAO;IACT;IAEA,KAAKrR,OAAOqS,KAAK,CAACrB,SAASA,QAAQS,IAAI,EAAET,QAAQsB,MAAM,EAAEN,mBACtDrJ,IAAI,CAAC;QACJqI,QAAQhG,OAAO,CAAC+G,gBAAgB,GAAG;IACrC,GACCnJ,KAAK,CAAC,CAACa;QACN5E,QAAQC,KAAK,CAAC,yBAAyB2E;IACzC;AACJ;AAEA,MAAM8I,mBAAmB,CAACC,QAAgB/H;IACxC,MAAMuG,UAAUxQ,SAASsC,cAAc,CAAC0P;IACxC,IAAI,CAACxB,WAAW,CAACA,QAAQS,IAAI,EAAE;IAC/B,MAAMgB,SAASzB,QAAQS,IAAI;IAC3BgB,OAAOC,OAAO,CAAC,CAACf,OAAYgB;QAC1B,IAAI,CAAChB,MAAMlC,CAAC,IAAI,CAACkC,MAAMnC,CAAC,EAAE;QAC1B,IAAIoD,aAAa;QACjB,IAAK,IAAInN,IAAI,GAAGA,IAAIkM,MAAMlC,CAAC,CAAC/H,MAAM,EAAEjC,IAAK;YACvC,MAAMgK,IAAIkC,MAAMlC,CAAC,CAAChK,EAAE,IAAI;YACxB,MAAM+J,IAAImC,MAAMnC,CAAC,CAAC/J,EAAE,IAAI;YACxBmN,cAAc,GAAGnD,EAAE,CAAC,EAAED,EAAE,EAAE,CAAC;QAC7B;QACA,MAAMqD,YAAYlB,MAAM1Q,IAAI,EAAEsJ,QAAQ,QAAQ,IAAIzD,iBAAiB,CAAC,KAAK,EAAE6L,QAAQ,GAAG;QACtF,MAAMG,gBAAgBrI,SAASF,OAAO,CAAC,QAAQ,GAAGsI,UAAU,IAAI,CAAC;QACjE,IAAI;YACF,MAAM9I,OAAO,IAAIC,KAAK;gBAAC4I;aAAW,EAAE;gBAAE3I,MAAM;YAAyB;YACrE,MAAMxI,MAAMC,IAAIwI,eAAe,CAACH;YAChC,MAAMW,OAAOlK,SAASC,aAAa,CAAC;YACpCiK,KAAKC,IAAI,GAAGlJ;YACZiJ,KAAKE,QAAQ,GAAGkI;YAChBtS,SAASsD,IAAI,CAAC/C,WAAW,CAAC2J;YAC1BA,KAAKG,KAAK;YACV9C,WAAW;gBACTvH,SAASsD,IAAI,CAAC0F,WAAW,CAACkB;gBAC1BvK,OAAOuB,GAAG,CAACoJ,eAAe,CAACrJ;YAC7B,GAAG;QACL,EAAE,OAAOqD,OAAgB;YACvBD,QAAQC,KAAK,CAAC,CAAC,4BAA4B,EAAE+N,UAAU,KAAK,CAAC,EAAE/N;QACjE;IACF;AACF;AAEA,iBAAiB;AACjB,MAAMiO,aAAa,CAACC,UAAkBC,YAAqB,IAAI;IAC7DpO,QAAQe,GAAG,CAAC,CAAC,wBAAwB,EAAEoN,UAAU;IAEjD,aAAa;IACb,IAAIC,WAAW;QACb,MAAMxR,MAAM,IAAIC,IAAIvB,OAAO6B,QAAQ,CAAC2I,IAAI;QACxClJ,IAAIyR,QAAQ,GAAGF,aAAa,UAAU,MAAM,CAAC,CAAC,EAAEA,UAAU;QAC1D7S,OAAOgT,OAAO,CAACC,SAAS,CAAC;YAAEC,MAAML;QAAS,GAAG,IAAIvR;IACnD;IAEA,MAAM6R,QAAQ;QAAC;QAAS;QAAY;QAAW;QAAc;QAAO;QAAS;KAAO;IACpFA,MAAMZ,OAAO,CAAC,CAACW;QACb,MAAME,cAAc/S,SAASsC,cAAc,CAAC,CAAC,KAAK,EAAEuQ,MAAM;QAC1D,MAAMG,YAAYhT,SAASsC,cAAc,CAAC,CAAC,IAAI,EAAEuQ,MAAM;QACvD,MAAMI,kBAAkBjT,SAASsC,cAAc,CAAC,CAAC,WAAW,EAAEuQ,MAAM;QAEpE,IAAIE,aAAaA,YAAYhP,SAAS,CAACE,GAAG,CAAC;QAE3C,gBAAgB;QAChB,IAAI+O,WAAW;YACb,iFAAiF;YACjFA,UAAUjP,SAAS,CAACC,MAAM,CAAC;YAC3BgP,UAAUjP,SAAS,CAACE,GAAG,CAAC,iBAAiB;YACzC+O,UAAUxO,eAAe,CAAC;QAC5B;QAEA,eAAe;QACf,IAAIyO,iBAAiB;YACnBA,gBAAgBlP,SAAS,CAACC,MAAM,CAAC,eAAe;YAChDiP,gBAAgBlP,SAAS,CAACE,GAAG,CAAC,iBAAiB,uBAAuB;YACtEgP,gBAAgBzO,eAAe,CAAC;QAClC;IACF;IAEA,MAAM0O,eAAelT,SAASsC,cAAc,CAAC,CAAC,KAAK,EAAEkQ,UAAU;IAC/D,MAAMW,cAAcnT,SAASsC,cAAc,CAAC,CAAC,IAAI,EAAEkQ,UAAU;IAC7D,MAAMY,oBAAoBpT,SAASsC,cAAc,CAAC,CAAC,WAAW,EAAEkQ,UAAU;IAC1E,MAAMa,UAAUrT,SAASsC,cAAc,CAAC;IACxC,MAAMgR,cAActT,SAASsC,cAAc,CAAC;IAE5C,kCAAkC;IAClC,MAAMiR,kBAAkBf,aAAa;IACrC,MAAMgB,gBAAgB,CAAC,CAACtI;IAExB,IAAIqI,mBAAmB,CAACC,eAAe;QACrC,mBAAmB;QACnB,IAAIF,aAAaA,YAAYvP,SAAS,CAACC,MAAM,CAAC;IAC9C,iDAAiD;IACnD,OAAO;QACL,oBAAoB;QACpB,IAAIsP,aAAaA,YAAYvP,SAAS,CAACE,GAAG,CAAC;QAC3C,IAAIiP,cAAcA,aAAanP,SAAS,CAACC,MAAM,CAAC;IAClD;IAEA,IAAImP,aAAa;QACf,oBAAoB;QACpB,sEAAsE;QACtE,0DAA0D;QAC1DA,YAAYpP,SAAS,CAACC,MAAM,CAAC,iBAAiB;QAC9CmP,YAAYpP,SAAS,CAACE,GAAG,CAAC;QAC1BkP,YAAYpQ,YAAY,CAAC,gBAAgB;QAEzC,YAAY;QACZ,IAAIsQ,SAAS;YACXA,QAAQ7K,KAAK,CAAC4H,OAAO,GAAG;YACxBiD,QAAQ7K,KAAK,CAACE,IAAI,GAAG,GAAGyK,YAAYM,UAAU,CAAC,EAAE,CAAC;YAClDJ,QAAQ7K,KAAK,CAAC2H,KAAK,GAAG,GAAGgD,YAAYxC,WAAW,CAAC,EAAE,CAAC;QACtD;IACF;IAEA,IAAIyC,mBAAmB;QACrBA,kBAAkBrP,SAAS,CAACC,MAAM,CAAC,iBAAiB,uBAAuB;QAC3EoP,kBAAkBrP,SAAS,CAACE,GAAG,CAAC,eAAe;QAC/CmP,kBAAkBrQ,YAAY,CAAC,gBAAgB;IACjD;IAEA,uEAAuE;IACvE,IAAIwQ,mBAAmB,CAACC,eAAe;IAEvC,mCAAmC;IACnC,OAAQhB;QACN,KAAK;YACHkB;YACA;QACF,KAAK;YACHA,sBAAsBvL,IAAI,CAAC;gBACzB,MAAMwL,YAAY3T,SAASsC,cAAc,CAAC;gBAC1C,MAAMsR,YAAY5T,SAASsC,cAAc,CAAC;gBAC1C,IAAIqR,aAAaC,WAAW;oBAC1BD,UAAU9Q,SAAS,GAAG+Q,UAAU/Q,SAAS;gBAC3C;YACF;YACA;QACF,KAAK;YACH,MAAMgR,sBAAsB7T,SAASsC,cAAc,CAAC;YACpD,IAAIuR,uBAAuB,CAACA,oBAAoBC,YAAY,CAAC,qBAAqB;gBAChFD,oBAAoB9Q,YAAY,CAAC,oBAAoB;gBACrDgR;YACF;YACA;QACF,KAAK;YACHC;YACA;QACF,KAAK;YACH,MAAMC,iBAAiBjU,SAASsC,cAAc,CAAC;YAC/C,IAAI2R,gBAAgB;gBAClBA,eAAelQ,SAAS,CAACC,MAAM,CAAC;gBAChC,IAAIuI,iBAAiB;oBACnB,MAAM2H,SAASlU,SAASsC,cAAc,CAAC;oBACvC,IAAI4R,QAAQA,OAAOnQ,SAAS,CAACC,MAAM,CAAC;gBACtC;gBACA,IAAI,CAACiQ,eAAeH,YAAY,CAAC,qBAAqB;oBACpDG,eAAelR,YAAY,CAAC,oBAAoB;oBAChD,IAAI,CAACiJ,oBAAoBmI;gBAC3B;YACF;YACA,MAAMC,UAAUpU,SAASsC,cAAc,CAAC;YACxC,IAAI8R,SAASA,QAAQrQ,SAAS,CAACC,MAAM,CAAC;YACtC;QACF,KAAK;YACH,MAAMqQ,gBAAgBrU,SAASsC,cAAc,CAAC;YAC9C,IAAI+R,iBAAiB,CAACA,cAAcP,YAAY,CAAC,qBAAqB;gBACpEO,cAActR,YAAY,CAAC,oBAAoB;gBAC/CuR;YACF;YACA;IACJ;AACF;AAEA,MAAMC,qBAAqB,CAACC;IAC1B,MAAMC,OAAOzU,SAASsC,cAAc,CAAC;IACrC,MAAMI,MAAM1C,SAASsC,cAAc,CAAC;IACpC,MAAMoS,OAAO1U,SAASsC,cAAc,CAAC;IAErC,IAAImS,MAAM;QACR,IAAID,QAAQ;YACVC,KAAK1Q,SAAS,CAACC,MAAM,CAAC;YACtBtB,KAAKK,aAAa,iBAAiB;YACnC,mBAAmB;YACnB2R,MAAM3R,aAAa,KAAK;QAC1B,OAAO;YACL0R,KAAK1Q,SAAS,CAACE,GAAG,CAAC;YACnBvB,KAAKK,aAAa,iBAAiB;YACnC,2BAA2B;YAC3B2R,MAAM3R,aAAa,KAAK;QAC1B;IACF;AACF;AAEA,MAAM4R,mBAAmB;IACvB,MAAMF,OAAOzU,SAASsC,cAAc,CAAC;IACrC,IAAImS,MAAM;QACR,MAAMG,WAAWH,KAAK1Q,SAAS,CAAC8Q,QAAQ,CAAC;QACzCN,mBAAmBK;IACrB;AACF;AACCjV,OAAegV,gBAAgB,GAAGA;AAEnC,oBAAoB;AACpB,MAAMzR,mBAAmB,CACvBuC,SACAgE,MACAqL,WAAmBrJ,cAAc;IAEjC,kFAAkF;IAClF,wDAAwD;IACxD,IAAIzL,SAASmJ,aAAa,CAAC,CAAC,0CAA0C,EAAE1D,QAAQ,EAAE,CAAC,GAAG;QACpF,OAAO;IACT;IAEA,MAAMsP,YAAY/U,SAASsC,cAAc,CAAC;IAC1C,MAAM0S,WAAWhV,SAASsC,cAAc,CAAC;IAEzC,IAAI,CAACyS,aAAa,CAACC,UAAU,OAAO;IAEpC,MAAMtQ,KAAK,EAAEmH;IACb,MAAMoJ,QAAQD,SAASE,OAAO,CAACC,SAAS,CAAC;IACzC,MAAMC,eAAeH,MAAM9L,aAAa,CAAC;IAEzC,IAAI,CAACiM,cAAc,OAAO;IAE1BA,aAAa1Q,EAAE,GAAG,CAAC,aAAa,EAAEA,IAAI;IAEtC,kCAAkC;IAClC,IAAI+E,SAAS,WAAWA,SAAS,WAAW;QAC1C2L,aAAarS,YAAY,CAAC,QAAQ;IACpC,OAAO;QACLqS,aAAarS,YAAY,CAAC,QAAQ;IACpC;IAEA,aAAa;IACb,MAAMsS,SAAS;QACbC,SAAS;QACThR,OAAO;QACPiR,SAAS;QACTC,MAAM;IACR;IACAJ,aAAaK,SAAS,IAAI,CAAC,CAAC,EAAEJ,MAAM,CAAC5L,KAAK,EAAE;IAE5C,8BAA8B;IAC9B,MAAMiM,QAAQ;QAAEJ,SAAS;QAAKhR,OAAO;QAAKiR,SAAS;QAAKC,MAAM;IAAI;IAClE,MAAMG,WAAWP,aAAajM,aAAa,CAAC;IAC5C,MAAMyM,cAAcR,aAAajM,aAAa,CAAC;IAE/C,IAAIwM,UAAUA,SAASrM,WAAW,GAAGoM,KAAK,CAACjM,KAAK;IAChD,IAAImM,aAAa;QACfA,YAAYtM,WAAW,GAAG7D;QAC1B,sDAAsD;QACtDmQ,YAAY7S,YAAY,CAAC,gBAAgB0C;IAC3C;IAEA,mCAAmC;IACnC,IAAIqP,WAAW,GAAG;QAChB,MAAMe,cAAcT,aAAajM,aAAa,CAAC;QAC/C,IAAI0M,aAAa;YACfA,YAAY9R,SAAS,CAACC,MAAM,CAAC;YAC7B6R,YAAYrN,KAAK,CAAC2H,KAAK,GAAG;YAC1B0F,YAAYrN,KAAK,CAACsN,UAAU,GAAG,CAAC,MAAM,EAAEhB,SAAS,SAAS,CAAC;YAE3D,4CAA4C;YAC5CiB,sBAAsB;gBACpBF,YAAYrN,KAAK,CAAC2H,KAAK,GAAG;YAC5B;QACF;QAEA,kBAAkB;QAClB,0CAA0C;QAC1C,MAAM6F,WAAW9Q,KAAK+Q,GAAG,CAAC,GAAGnB,WAAW;QAExC,+BAA+B;QAC/B,MAAMoB,YAAY3O,WAAW;YAC3B6N,aAAarR,SAAS,CAACE,GAAG,CAAC;QAC7B,GAAG+R;QAEH,2BAA2B;QAC3B,MAAMG,oBAAoB5O,WAAW;YACnC6O,mBAAmB1R;QACrB,GAAGoQ;QAEHM,aAAa5K,OAAO,CAAC6L,OAAO,GAAGF,kBAAkBhV,QAAQ;QACzDiU,aAAa5K,OAAO,CAAC8L,WAAW,GAAGJ,UAAU/U,QAAQ;IACvD;IAEA,2CAA2C;IAC3C,MAAMoV,WAAWnB,aAAajM,aAAa,CAAC;IAC5C,IAAIoN,UAAU;QACZA,SAASC,OAAO,GAAG,CAACpS;YAClBA,EAAEqS,eAAe;YACjBL,mBAAmB1R;QACrB;IACF;IAEAqQ,UAAUxU,WAAW,CAAC6U;IACtB,OAAO1Q;AACT;AAEA,MAAM0R,qBAAqB,CAAC1R;IAC1B,MAAM0Q,eAAepV,SAASsC,cAAc,CAAC,CAAC,aAAa,EAAEoC,IAAI;IACjE,IAAI0Q,cAAc;QAChB,IAAIA,aAAa5K,OAAO,CAAC6L,OAAO,EAC9BnJ,aAAawJ,SAAStB,aAAa5K,OAAO,CAAC6L,OAAO,EAAE;QACtD,IAAIjB,aAAa5K,OAAO,CAAC8L,WAAW,EAClCpJ,aAAawJ,SAAStB,aAAa5K,OAAO,CAAC8L,WAAW,EAAE;QAE1D,yDAAyD;QACzDlB,aAAarR,SAAS,CAACE,GAAG,CAAC;QAE3B,iCAAiC;QACjCsD,WAAW,IAAM6N,aAAapR,MAAM,IAAI;IAC1C;AACF;AAEA,qBAAqB;AACrB,MAAM2C,mBAAmB,CAACgQ,OAAelR;IACvC,OAAO,IAAI7F,QAAQ,CAACC;QAClB,0CAA0C;QAC1C,MAAM+W,wBAAwB5W,SAAS6W,aAAa;QAEpD,MAAMC,QAAQ9W,SAASC,aAAa,CAAC;QACrC6W,MAAMrB,SAAS,GAAG;QAClBqB,MAAM/T,YAAY,CAAC,QAAQ;QAC3B+T,MAAM/T,YAAY,CAAC,cAAc;QACjC+T,MAAM/T,YAAY,CAAC,mBAAmB;QACtC+T,MAAM/T,YAAY,CAAC,oBAAoB;QAEvC+T,MAAMjU,SAAS,GAAG,CAAC;;;8EAGuD,EAAE8T,MAAM;0DAC5B,EAAElR,QAAQ;;;;;;;IAOhE,CAAC;QAEDzF,SAASsD,IAAI,CAAC/C,WAAW,CAACuW;QAE1B,YAAY;QACZf,sBAAsB;YACpBe,MAAM/S,SAAS,CAACC,MAAM,CAAC;YACvB8S,MAAM3N,aAAa,CAAC,QAAQpF,UAAUC,OAAO;YAC7C8S,MAAM3N,aAAa,CAAC,QAAQpF,UAAUE,IAAI;QAC5C;QAEA,MAAM8S,QAAQ,CAACC;YACbF,MAAM/S,SAAS,CAACE,GAAG,CAAC;YACpBsD,WAAW,IAAMuP,MAAM9S,MAAM,IAAI;YACjCnE,QAAQmX;YACRhX,SAASiX,mBAAmB,CAAC,WAAWC;YACxC,gBAAgB;YAChB,IAAIN,yBAAyB,OAAOA,sBAAsBhO,KAAK,KAAK,YAAY;gBAC9EgO,sBAAsBhO,KAAK;YAC7B;QACF;QAEA,MAAMuO,YAAYL,MAAM3N,aAAa,CAAC;QACtC,MAAMiO,QAAQN,MAAM3N,aAAa,CAAC;QAElC,MAAM+N,YAAY,CAAC9S;YACjB,IAAIA,EAAEiT,GAAG,KAAK,UAAUN,MAAM;YAC9B,mEAAmE;YACnE,IAAI3S,EAAEiT,GAAG,KAAK,WAAWrX,SAAS6W,aAAa,KAAKM,WAAWJ,MAAM;YAErE,aAAa;YACb,IAAI3S,EAAEiT,GAAG,KAAK,OAAO;gBACnBjT,EAAEkT,cAAc;gBAChB,MAAMC,oBAAoB;oBAACJ;oBAAWC;iBAAM;gBAC5C,MAAMI,eAAeD,iBAAiB,CAAC,EAAE;gBACzC,MAAME,cAAcF,iBAAiB,CAACA,kBAAkBrQ,MAAM,GAAG,EAAE;gBAEnE,IAAI9C,EAAEsT,QAAQ,EAAE;oBACd,IAAI1X,SAAS6W,aAAa,KAAKW,cAAc;wBAC3CC,YAAY7O,KAAK;oBACnB,OAAO;wBACL,2CAA2C;wBAC3C,MAAM+O,MAAMJ,kBAAkBK,OAAO,CAAC5X,SAAS6W,aAAa;wBAC5D,IAAIc,MAAM,GAAGJ,iBAAiB,CAACI,MAAM,EAAE,CAAC/O,KAAK;6BACxC6O,YAAY7O,KAAK;oBACxB;gBACF,OAAO;oBACL,IAAI5I,SAAS6W,aAAa,KAAKY,aAAa;wBAC1CD,aAAa5O,KAAK;oBACpB,OAAO;wBACL,wCAAwC;wBACxC,MAAM+O,MAAMJ,kBAAkBK,OAAO,CAAC5X,SAAS6W,aAAa;wBAC5D,IAAIc,OAAO,KAAKA,MAAMJ,kBAAkBrQ,MAAM,GAAG,GAAGqQ,iBAAiB,CAACI,MAAM,EAAE,CAAC/O,KAAK;6BAC/E4O,aAAa5O,KAAK;oBACzB;gBACF;YACF;QACF;QACA5I,SAAS6X,gBAAgB,CAAC,WAAWX;QAErCC,UAAUX,OAAO,GAAG,IAAMO,MAAM;QAChCK,MAAMZ,OAAO,GAAG,IAAMO,MAAM;QAE5B,mBAAmB;QACnBxP,WAAW,IAAM4P,UAAUvO,KAAK,IAAI;IACtC;AACF;AAEA,UAAU;AACV,MAAMkP,iBAAiB,OACrB7W,KACA8W,UAAuB,CAAC,CAAC;IAEzB,yBAAyB;IACzB,IAAIC,WAAWtL;IACf,IAAI,CAACsL,UAAU;QACb,mEAAmE;QACnE,IAAI,AAACrY,OAAesY,aAAa,EAAED,WAAW,AAACrY,OAAesY,aAAa;aACtE;YACHD,WAAW,IAAIvL;YACf,IAAI,OAAO9M,WAAW,aAAa,AAACA,OAAesY,aAAa,GAAGD;QACrE;QACAtL,eAAesL;IACjB;IAEA,IAAI,CAACA,UAAU;QACbA,WAAW,IAAIvL;QACfC,eAAesL;IACjB;IAEA,MAAME,WAAW,GAAGjX,MAAMsC,KAAKC,SAAS,CAACuU,UAAU;IACnD,MAAMI,SAASH,SAASI,GAAG,CAACF;IAC5B,uBAAuB;IACvB,IAAIC,UAAUvO,KAAKD,GAAG,KAAKwO,OAAOtO,SAAS,GAAG8C,gBAC5C,OAAOwL,OAAOlH,IAAI;IAEpB,IAAIzE,iBAAiB6L,GAAG,CAACpX,MAAMuL,iBAAiB4L,GAAG,CAACnX,MAAMqX;IAC1D,MAAMC,aAAa,IAAIC;IACvBhM,iBAAiBiM,GAAG,CAACxX,KAAKsX;IAE1B,IAAI;QACF,yCAAyC;QACzC,0FAA0F;QAC1F,MAAMG,eAAe;YAAE,GAAGX,OAAO;YAAEY,QAAQJ,WAAWI,MAAM;QAAC;QAC7D,IAAIR,QAAQ;YACV,MAAMtW,UAAU,IAAIC,QAAQ4W,aAAa7W,OAAO,IAAI,CAAC;YACrD,IAAIsW,OAAOS,IAAI,EAAE/W,QAAQ4W,GAAG,CAAC,iBAAiBN,OAAOS,IAAI;YACzD,IAAIT,OAAOU,YAAY,EAAEhX,QAAQ4W,GAAG,CAAC,qBAAqBN,OAAOU,YAAY;YAC7EH,aAAa7W,OAAO,GAAGA;QACzB;QAEA,MAAMiX,WAAW,MAAMhY,MAAMG,KAAKyX;QAElC,6BAA6B;QAC7B,wGAAwG;QACxG,iEAAiE;QACjE,IAAII,SAASnV,MAAM,KAAK,OAAOwU,QAAQ;YACrCA,OAAOtO,SAAS,GAAGD,KAAKD,GAAG;YAC3B,6BAA6B;YAC7B,MAAMoP,UAAUD,SAASjX,OAAO,CAACuW,GAAG,CAAC;YACrC,MAAMY,kBAAkBF,SAASjX,OAAO,CAACuW,GAAG,CAAC;YAC7C,IAAIW,SAASZ,OAAOS,IAAI,GAAGG;YAC3B,IAAIC,iBAAiBb,OAAOU,YAAY,GAAGG;YAE3ChB,SAASS,GAAG,CAACP,UAAUC;YACvB,OAAOA,OAAOlH,IAAI;QACpB;QAEA,IAAI,CAAC6H,SAASpV,EAAE,EAAE;YAChB,IAAIuV,eAAe,CAAC,oBAAoB,EAAEH,SAASnV,MAAM,EAAE;YAC3D,IAAI;gBACF,MAAMuV,YAAY,MAAMJ,SAASK,IAAI;gBACrC,IAAID,UAAUzT,OAAO,EAAEwT,eAAeC,UAAUzT,OAAO;qBAClD,IAAIyT,UAAU5U,KAAK,EAAE2U,eAAeC,UAAU5U,KAAK;qBACnD,IAAI4U,UAAUE,MAAM,EAAEH,eAAeC,UAAUE,MAAM;YAC5D,EAAE,OAAOhV,GAAG;YACV,0BAA0B;YAC5B;YACA,MAAM,IAAI/D,MAAM4Y;QAClB;QACA,MAAMhI,OAAO,MAAM6H,SAASK,IAAI;QAEhC,2FAA2F;QAC3F,IAAI,CAACnB,UAAUA,WAAWtL,gBAAgB,AAAC/M,OAAesY,aAAa,IAAI,IAAIxL;QAE/EuL,SAASS,GAAG,CAACP,UAAU;YACrBjH;YACApH,WAAWD,KAAKD,GAAG;YACnBiP,MAAME,SAASjX,OAAO,CAACuW,GAAG,CAAC;YAC3BS,cAAcC,SAASjX,OAAO,CAACuW,GAAG,CAAC;QACrC;QACA,OAAOnH;IACT,SAAU;QACRzE,iBAAiB6M,MAAM,CAACpY;IAC1B;AACF;AAEA,UAAU;AACV,MAAMqY,eAAe,CAAC7T,SAAiBgE;IACrCxC,aAAa/E,IAAI,CAAC;QAAEuD;QAASgE;IAAK;IAClC,+EAA+E;IAC/E,IAAI,CAACmD,kBAAkB;QACrBA,mBAAmBrF,WAAWgS,mBAAmB;IACnD;AACF;AAEA,MAAMC,eAAe;IACnB,MAAMzE,YAAY/U,SAASsC,cAAc,CAAC;IAC1C,IAAI,CAACyS,WAAW;IAEhB,MAAM0E,YAAY;IAClB,MAAMC,eAAe;IAErB,IAAI3E,UAAU4E,iBAAiB,GAAGF,WAAW;QAC3C,MAAMG,WAAW7E,UAAU4E,iBAAiB,GAAGD;QAC/C,8EAA8E;QAC9E,qHAAqH;QACrH,MAAMG,QAAQ7Z,SAAS8Z,WAAW;QAClCD,MAAME,QAAQ,CAAChF,WAAW;QAE1B,IAAIiF,WAAWjF,UAAUkF,iBAAiB;QAC1C,IAAK,IAAIhV,IAAI,GAAGA,IAAI2U,YAAYI,UAAU/U,IAAK;YAC7C+U,WAAWA,SAASE,kBAAkB;QACxC;QAEA,IAAIF,UAAU;YACZH,MAAMM,YAAY,CAACH;YACnBH,MAAMO,cAAc;QACtB,OAAO;YACL,4DAA4D;YAC5DrF,UAAUlS,SAAS,GAAG;QACxB;IACF;AACF;AAEA,MAAM0W,oBAAoB;IACxB,IAAItS,aAAaC,MAAM,KAAK,GAAG;QAC7B0F,mBAAmB;QACnB;IACF;IACA,MAAMmI,YAAY/U,SAASsC,cAAc,CAAC;IAC1C,IAAI,CAACyS,WAAW;QACdnI,mBAAmB;QACnB;IACF;IAEA,gCAAgC;IAChC,MAAMpK,cAAcuS,UAAU5L,aAAa,CAAC;IAC5C,IAAI3G,aAAa;QACfA,YAAYwB,MAAM;IACpB;IAEA,wFAAwF;IACxF,uDAAuD;IACvD,MAAMqW,aAAatF,UAAUuF,YAAY,GAAGvF,UAAUnK,SAAS,GAAGmK,UAAUpD,YAAY,IAAI;IAE5F,IAAI4I,gBAAgB,IAAI,iDAAiD;IAEzE,oFAAoF;IACpF,MAAMC,aAAa,CAACC;QAClB,OAAOA,IACJ1Q,OAAO,CAAC,MAAM,SACdA,OAAO,CAAC,MAAM,QACdA,OAAO,CAAC,MAAM,QACdA,OAAO,CAAC,MAAM,UACdA,OAAO,CAAC,MAAM;IACnB;IAEA9C,aAAaiL,OAAO,CAAC,CAAC,EAAEzM,OAAO,EAAEgE,IAAI,EAAE;QACrC,uBAAuB;QACvB,IAAIgM,YAAY;QAChB,IAAIhM,SAAS,UAAUgM,YAAY;aAC9B,IAAIhM,SAAS,YAAYgM,YAAY;aACrC,IAAIhM,SAAS,QAAQgM,YAAY;QAEtC,uEAAuE;QACvE,uGAAuG;QACvG,MAAMiF,cAAcF,WAAW/U;QAC/B8U,iBAAiB,CAAC,YAAY,EAAE9E,UAAU,EAAE,EAAEiF,YAAY,MAAM,CAAC;IACnE;IAEA3F,UAAU4F,kBAAkB,CAAC,aAAaJ;IAC1C,sCAAsC;IACtCf;IAEA3S,iBAAiB0T,eAAe,uCAAuC;IAEvE,4GAA4G;IAC5G,MAAMK,iBAAiBhP,cAAc,QAAQ;IAC7C,IAAI/E,cAAcK,MAAM,GAAG0T,iBAAiB,KAAK;QAC/C,MAAM5Q,QAAQnD,cAAcmD,KAAK,CAAC,CAAC4Q;QACnC,wCAAwC;QACxC,MAAMC,WAAW7Q,MAAM4N,OAAO,CAAC;QAC/B,IAAIiD,aAAa,CAAC,GAAG;YACnBhU,gBAAgBmD,MAAM8Q,SAAS,CAACD;QAClC;IACF;IAEA,sDAAsD;IACtD,IAAIR,YAAY;QACdtF,UAAUnK,SAAS,GAAGmK,UAAUuF,YAAY;IAC9C;IAEArT,aAAaC,MAAM,GAAG;IACtB0F,mBAAmB;IAEnB,mCAAmC;IACnCK;AACF;AAEA,kBAAkB;AAGlB,MAAM8N,kBAAkB,OAAOC,OAAeC,SAAiBtY;IAC7D,MAAMD,MAAMC;IACZ,IAAIuY,eAAe;IACnB,IAAI5F,UAAU;IAEd,IAAI5S,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,6ZAA6Z,CAAC;IACjb;IAEA,IAAI;QACFmI,cAAcgQ;QACd/P,kBAAkBgQ;QAClB,MAAMnC,WAAW,MAAMhY,MAAM,sBAAsB;YAAEY,QAAQ;YAAQG,SAAS;gBAAE,gBAAgB;YAAmB;YAAGyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEwH;gBAAaC;YAAgB;QAAG;QAC7K,MAAMgG,OAAO,MAAM6H,SAASK,IAAI;QAChC,IAAI,CAACL,SAASpV,EAAE,EAAE,MAAM,IAAIrD,MAAM4Q,KAAKmI,MAAM,IAAInI,KAAKxL,OAAO,IAAI;QAEjEuF,cAAciG,KAAKjG,WAAW;QAC9BC,kBAAkBgG,KAAKhG,eAAe;QAEtC,MAAMkQ,oBAAoBnb,SAASsC,cAAc,CAAC;QAClD,IAAI6Y,6BAA6BC,kBAAkB;YACjDD,kBAAkB5S,KAAK,GAAG,GAAGyC,YAAY,UAAU,EAAEC,iBAAiB;QACxE;QAEA/H,iBAAiB,yBAAyB;QAC1CoS,UAAU;IACZ,EAAE,OAAOlR,GAAG;QACVlB,iBAAiB,CAAC,6BAA6B,EAAEsC,gBAAgBpB,IAAI,EAAE;IACzE,SAAU;QACR,IAAI1B,KAAK;YACP,IAAI4S,SAAS;gBACXlO,uBAAuB1E,KAAKwY,cAAc;YAC5C,OAAO;gBACLxY,IAAII,QAAQ,GAAG;gBACfJ,IAAI8B,eAAe,CAAC;gBACpB9B,IAAIG,SAAS,GAAGqY;YAClB;QACF;IACF;AACF;AAEA,MAAMG,eAAe;IACnB,MAAM3Y,MAAM1C,SAASsC,cAAc,CAAC;IACpC,MAAM4Y,eAAexY,MAAMA,IAAIG,SAAS,GAAG;IAC3C,IAAIyS,UAAU;IAEd,IAAI;QACF,IAAI5S,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAIK,YAAY,CAAC,aAAa;YAC9BL,IAAIG,SAAS,GAAG,CAAC,8ZAA8Z,CAAC;QAClb;QAEA,MAAMyY,iBAAiBtb,SAASsC,cAAc,CAAC;QAC/C,MAAMiZ,WAAWD,eAAe/S,KAAK;QACrC,IAAIgT,UAAUzU,aAAaiG,OAAO,CAAC,wBAAwBwO;QAC3DrY,iBAAiB,yBAAyB;QAC1C,MAAM4V,WAAW,MAAMhY,MAAM,kBAAkB;YAAEY,QAAQ;YAAQG,SAAS;gBAAE,gBAAgB;YAAmB;YAAGyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEgY,UAAUD;YAAS;QAAG;QAC/J,MAAMtK,OAAO,MAAM6H,SAASK,IAAI;QAChC,IAAI,CAACL,SAASpV,EAAE,EAAE,MAAM,IAAIrD,MAAM4Q,KAAKmI,MAAM,IAAInI,KAAKxL,OAAO,IAAI;QAEjE,IAAIwL,KAAKmI,MAAM,EAAE;YACfnI,KAAKmI,MAAM,CAACqC,KAAK,CAAC,MAAMvJ,OAAO,CAAC,CAACwJ;gBAC/B,IAAIA,KAAK7T,IAAI,IAAIyR,aAAaoC,KAAK7T,IAAI,IAAI;YAC7C;QACF;QAEA3E,iBAAiB,qBAAqB;QACtC,MAAMyY;QACN,MAAMC,eAAeL,SAASE,KAAK,CAAC,KAAKI,GAAG;QAC5C,IAAID,cAAc;YAChBE,WAAWF;YACX,MAAM/S,SAAS7I,SAASsC,cAAc,CAAC;YACvC,IAAIuG,QAAQA,OAAON,KAAK,GAAGqT;YAC3B,6DAA6D;YAC7DG,kBAAkB;YAElB,+DAA+D;YAC/D,gDAAgD;YAChD,KAAKjb,MAAM,CAAC,wBAAwB,EAAEkb,mBAAmBJ,eAAe,EAAExT,KAAK,CAAC,KAAQ;YACxF,KAAKtH,MAAM,CAAC,wBAAwB,EAAEkb,mBAAmBJ,eAAe,EAAExT,KAAK,CAAC,KAAQ;QAC1F;QACAkN,UAAU;IACZ,EAAE,OAAOlR,GAAG;QACVlB,iBAAiB,CAAC,yBAAyB,EAAEsC,gBAAgBpB,IAAI,EAAE;IACrE,SAAU;QACR,IAAI1B,KAAK;YACP,IAAI4S,SAAS;gBACXlO,uBAAuB1E,KAAKwY,cAAc;YAC5C,OAAO;gBACLxY,IAAII,QAAQ,GAAG;gBACfJ,IAAI8B,eAAe,CAAC;gBACpB9B,IAAIG,SAAS,GAAGqY;YAClB;QACF;IACF;AACF;AAEA,4BAA4B;AAC5B,MAAMe,gBAAgB,CAACvX;IACrB,MAAMwX,UAAUlc,SAASsC,cAAc,CAACoC;IACxC,MAAMyX,aAAanc,SAASsC,cAAc,CAAC,GAAGoC,GAAG,MAAM,CAAC;IAExD,IAAI,CAACwX,WAAW,CAACC,YAAY;IAE7B,MAAMvH,WAAWsH,QAAQnY,SAAS,CAAC8Q,QAAQ,CAAC;IAE5C,IAAID,UAAU;QACZsH,QAAQnY,SAAS,CAACC,MAAM,CAAC;QACzBmY,WAAW7S,WAAW,GAAG;QACzB6S,WAAWpY,SAAS,CAACC,MAAM,CAAC;QAC5B,8DAA8D;QAC9D,MAAMoY,YAAYD,WAAWE,aAAa,EAAEC,YAAY,WAAWH,WAAWE,aAAa,GAAG;QAC9F,IAAID,WAAWA,UAAUrZ,YAAY,CAAC,iBAAiB;IACzD,OAAO;QACLmZ,QAAQnY,SAAS,CAACE,GAAG,CAAC;QACtBkY,WAAW7S,WAAW,GAAG;QACzB6S,WAAWpY,SAAS,CAACE,GAAG,CAAC;QACzB,8DAA8D;QAC9D,MAAMmY,YAAYD,WAAWE,aAAa,EAAEC,YAAY,WAAWH,WAAWE,aAAa,GAAG;QAC9F,IAAID,WAAWA,UAAUrZ,YAAY,CAAC,iBAAiB;IACzD;AACF;AAEA,kBAAkB;AAClB,MAAMwZ,wBAAwB;IAC5B,MAAMC,QAAQxc,SAASsC,cAAc,CAAC;IACtC,IAAIka,OAAO;QACT,IAAItR,YAAY;YACdsR,MAAMlT,WAAW,GAAG4B;YACpBsR,MAAMzY,SAAS,CAACC,MAAM,CAAC;YACvBwY,MAAM7F,KAAK,GAAG,CAAC,aAAa,EAAEzL,WAAW,kBAAkB,CAAC;YAC5DsR,MAAMzZ,YAAY,CAAC,cAAc,CAAC,qBAAqB,EAAEmI,WAAW,uBAAuB,CAAC;QAC9F,OAAO;YACLsR,MAAMlT,WAAW,GAAG;YACpBkT,MAAMzY,SAAS,CAACC,MAAM,CAAC;YACvBwY,MAAM7F,KAAK,GAAG;YACd6F,MAAMzZ,YAAY,CAAC,cAAc;QACnC;IACF;AACF;AAEA,MAAM4Y,kBAAkB,OAAOhZ;IAC7B,MAAMD,MAAMC;IACZ,IAAIuY,eAAe;IAEnB,IAAIxY,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIqB,SAAS,CAACE,GAAG,CAAC,cAAc;QAChC,8CAA8C;QAC9C,IAAIvB,IAAIyG,aAAa,CAAC,QAAQ;YAC5B,sFAAsF;YACtF,kEAAkE;YAClE,oDAAoD;YACpDzG,IAAIG,SAAS,GAAG,CAAC,8VAA8V,CAAC;QAClX,OAAO;YACL,oCAAoC;YACpCH,IAAIG,SAAS,GAAG,CAAC,qZAAqZ,CAAC;QACza;IACF;IAEA,IAAI;QACF,MAAMiW,WAAW,MAAMhY,MAAM;QAC7B,IAAI,CAACgY,SAASpV,EAAE,EAAE,MAAM,IAAIrD,MAAM;QAClC,MAAM4Q,OAAO,MAAM6H,SAASK,IAAI;QAChC,MAAMtQ,SAAS7I,SAASsC,cAAc,CAAC;QACvC,IAAIuG,UAAUoI,KAAKwL,KAAK,EAAE;YACxB,MAAMC,UAAU7T,OAAON,KAAK;YAC5B,IAAI0I,KAAKwL,KAAK,CAACvV,MAAM,KAAK,GAAG;gBAC3B2B,OAAOhG,SAAS,GAAG;YACrB,OAAO;gBACLgG,OAAOhG,SAAS,GAAG;gBACnBoO,KAAKwL,KAAK,CAACvK,OAAO,CAACyK,CAAAA;oBACjB,MAAMC,MAAM5c,SAASC,aAAa,CAAC;oBACnC2c,IAAIrU,KAAK,GAAGoU;oBACZC,IAAItT,WAAW,GAAGqT;oBAClB9T,OAAOtI,WAAW,CAACqc;gBACrB;gBACA,IAAIF,WAAWzL,KAAKwL,KAAK,CAAClW,QAAQ,CAACmW,UAAU7T,OAAON,KAAK,GAAGmU;qBACvD,IAAIxR,cAAc+F,KAAKwL,KAAK,CAAClW,QAAQ,CAAC2E,aAAarC,OAAON,KAAK,GAAG2C;YACzE;YAEA,kEAAkE;YAClE,IAAIA,cAAc,CAAC+F,KAAKwL,KAAK,CAAClW,QAAQ,CAAC2E,aAAa;gBAClD7G,QAAQe,GAAG,CAAC,CAAC,kBAAkB,EAAE8F,WAAW,2BAA2B,CAAC;gBACxEA,aAAa;gBACbpE,aAAaC,UAAU,CAAC;gBACxBwV;YACF;QACF;QACA,kEAAkE;QAClE,IAAI7Z,KAAKQ,iBAAiB,uBAAuB,WAAWiE;IAC9D,EAAE,OAAO/C,GAAG;QACVC,QAAQC,KAAK,CAACF;QACd,IAAI1B,KAAKQ,iBAAiB,+BAA+B;IAC3D,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAI8B,eAAe,CAAC;YACpB9B,IAAIqB,SAAS,CAACC,MAAM,CAAC,cAAc;YACnCtB,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AAEA,MAAMY,aAAa,CAACe;IAClB3R,aAAa2R;IACb/V,aAAaiG,OAAO,CAAC,oBAAoB8P;IACzCN;AACF;AAEA,MAAMO,gBAAgB;IACpB,MAAMC,WAAW,AAAC/c,SAASsC,cAAc,CAAC,eAAoCiG,KAAK;IACnF,IAAI,CAACwU,UAAU;QAAE7Z,iBAAiB,mBAAmB;QAAY;IAAQ;IAEzE,MAAMR,MAAM1C,SAASsC,cAAc,CAAC;IACpC,MAAM4Y,eAAexY,MAAMA,IAAIG,SAAS,GAAG;IAC3C,IAAIyS,UAAU;IAEd,IAAI5S,KAAK;QACPA,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,4YAA4Y,CAAC;IACha;IAEAK,iBAAiB,CAAC,cAAc,EAAE6Z,SAAS,GAAG,CAAC,EAAE;IACjD,IAAI;QACF,MAAMjE,WAAW,MAAMhY,MAAM,oBAAoB;YAAEY,QAAQ;YAAQG,SAAS;gBAAE,gBAAgB;YAAmB;YAAGyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEuZ;YAAS;QAAG;QACvJ,MAAM9L,OAAO,MAAM6H,SAASK,IAAI;QAChC,IAAIlI,KAAKqE,OAAO,EAAE;YAChBpS,iBAAiB,gBAAgB;YAChClD,SAASsC,cAAc,CAAC,eAAoCiG,KAAK,GAAG;YACrE,MAAMoT;YACNG,WAAWiB;YACX,MAAMlU,SAAS7I,SAASsC,cAAc,CAAC;YACvC,IAAIuG,QAAQA,OAAON,KAAK,GAAGwU;YAC3BzH,UAAU;QACZ,OAAO;YAAEpS,iBAAiB+N,KAAKxL,OAAO,IAAI,UAAU;QAAU;IAChE,EAAE,OAAOrB,GAAG;QAAElB,iBAAiB,uBAAuB;IAAU,SACxD;QACN,IAAIR,KAAK;YACP,IAAI4S,SAAS;gBACXlO,uBAAuB1E,KAAKwY,cAAc;YAC5C,OAAO;gBACLxY,IAAII,QAAQ,GAAG;gBACfJ,IAAI8B,eAAe,CAAC;gBACpB9B,IAAIG,SAAS,GAAGqY;YAClB;QACF;IACF;AACF;AAEA,MAAM8B,oBAAoB,OAAOC,KAAata;IAC5C,iCAAiC;IACjC,IAAIsa,IAAI1W,QAAQ,CAAC,eAAe0W,IAAI1W,QAAQ,CAAC,UAAU;QACrD,MAAMG,YAAY,MAAMC,iBAAiB,eAAe,CAAC,8BAA8B,EAAEsW,IAAI,mCAAmC,CAAC;QACjI,IAAI,CAACvW,WAAW;IAClB;IACAwW,WAAWD,KAAKta;AAClB;AAEA,MAAMwa,gBAAgB,CAACxZ;IACrB,IAAIA,WAAW,aAAa,OAAO,CAAC,+MAA+M,CAAC;IACpP,IAAIA,WAAW,UAAU,OAAO,CAAC,qNAAqN,CAAC;IACvP,IAAIA,WAAW,WAAW,OAAO,CAAC,gXAAgX,CAAC;IACnZ,OAAO;AACT;AAEA,MAAMqQ,kBAAkB,OAAOrR;IAC7B,MAAMoS,YAAY/U,SAASsC,cAAc,CAAC;IAC1C,IAAI,CAACyS,WAAW;IAEhB,MAAMrS,MAAMC;IACZ,IAAIuY,eAAe;IAEnB,IAAIxY,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIqB,SAAS,CAACE,GAAG,CAAC,eAAe;QACjC,4CAA4C;QAC5CvB,IAAIG,SAAS,GAAG,CAAC,8VAA8V,CAAC;IAClX;IAEA,IAAI;QACF,MAAMiW,WAAW,MAAMhY,MAAM;QAC7B,IAAI,CAACgY,SAASpV,EAAE,EAAE,MAAM,IAAIrD,MAAM;QAClC,MAAM4Q,OAAO,MAAM6H,SAASK,IAAI;QAEhC,IAAIlI,KAAKmM,IAAI,IAAInM,KAAKmM,IAAI,CAAClW,MAAM,GAAG,GAAG;YACrC6N,UAAUlS,SAAS,GAAGoO,KAAKmM,IAAI,CAACC,GAAG,CAACC,CAAAA;gBAClC,IAAIC,cAAc;gBAClB,IAAID,IAAI3Z,MAAM,KAAK,aAAa4Z,cAAc;qBACzC,IAAID,IAAI3Z,MAAM,KAAK,UAAU4Z,cAAc;qBAC3C,IAAID,IAAI3Z,MAAM,KAAK,WAAW4Z,cAAc;gBAEjD,MAAMC,YAAY,IAAI5T,KAAK0T,IAAIG,UAAU,EAAEC,cAAc;gBACzD,MAAM5I,WAAWwI,IAAIK,kBAAkB,GAAG,GAAGL,IAAIK,kBAAkB,CAACpY,OAAO,CAAC,GAAG,CAAC,CAAC,GAAG;gBAEpF,OAAO,CAAC;;uFAEuE,EAAE+X,IAAI5Y,EAAE,CAAC;0EACtB,EAAE4Y,IAAIM,OAAO,CAAC;;6GAEqB,EAAEL,YAAY;gBAC3G,EAAEJ,cAAcG,IAAI3Z,MAAM,EAAE;gBAC5B,EAAE2Z,IAAI3Z,MAAM,CAAC;;;0EAG6C,EAAEmR,SAAS;0EACX,EAAE0I,UAAU;;QAE9E,CAAC;YACH,GAAGK,IAAI,CAAC;QACV,OAAO;YACL9I,UAAUlS,SAAS,GAAG,CAAC,0GAA0G,CAAC;QACpI;QAEA,IAAIH,KAAKQ,iBAAiB,yBAAyB,WAAWmG;IAChE,EAAE,OAAOjF,GAAG;QACVC,QAAQC,KAAK,CAAC,+BAA+BF;QAC7C2Q,UAAUlS,SAAS,GAAG,CAAC,uGAAuG,CAAC;QAC/H,IAAIH,KAAKQ,iBAAiB,iCAAiC;IAC7D,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAIqB,SAAS,CAACC,MAAM,CAAC,eAAe;YACpCtB,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AACCvb,OAAeqU,eAAe,GAAGA;AAElC,MAAMkJ,aAAa,OAAOD,KAAata;IACrC,IAAI,CAACsa,KAAK;QAAE/Z,iBAAiB,wBAAwB;QAAU;IAAQ;IAEvE,wFAAwF;IACxF,MAAM4a,mBAAmB,AAAC9d,SAASsC,cAAc,CAAC,mBAAyCiG,SAAS2C;IAEpG,IAAI,CAAC4S,kBAAkB;QAAE5a,iBAAiB,2BAA2B;QAAU;IAAQ;IAEvF,IAAIgY,eAAe;IACnB,MAAMxY,MAAMC;IAEZ,IAAID,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,4ZAA4Z,CAAC;IAChb;IAEA,sDAAsD;IACtD,0FAA0F;IAC1F0E,WAAWyM,iBAAiB;IAE5B,IAAI;QACF9Q,iBAAiB,CAAC,QAAQ,EAAE+Z,IAAI,GAAG,CAAC,EAAE;QACtC,MAAMnE,WAAW,MAAMhY,MAAM,QAAQ;YAAEY,QAAQ;YAAQG,SAAS;gBAAE,gBAAgB;YAAmB;YAAGyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEuH;gBAASyQ,UAAUsC;gBAAkBF,SAASX;YAAI;QAAG;QACpL,IAAI,CAACnE,SAASpV,EAAE,EAAE,MAAM,IAAIrD;QAC5B,MAAM0d,SAASjF,SAASxV,IAAI,EAAE0a;QAC9B,MAAMC,UAAU,IAAIC;QAEpB,gDAAgD;QAChD7R,sBAAsB;QACtB8H;QAEA,IAAIgK,SAAS;QACb,MAAO,KAAM;YACX,MAAM,EAAEC,IAAI,EAAE7V,KAAK,EAAE,GAAG,AAAC,MAAMwV,QAAQM,UAAW;gBAAED,MAAM;gBAAM7V,OAAO+V;YAAU;YACjF,IAAIF,MAAM;gBACR,IAAID,QAAQ7E,aAAa6E,QAAQ,WAAW,yBAAyB;gBACrEjb,iBAAiB,qCAAqC;gBACtDqW;gBACA;YACF;YAEA,uEAAuE;YACvE,MAAM1V,OAAOoa,QAAQM,MAAM,CAAChW,OAAO;gBAAEiW,QAAQ;YAAK;YAClDL,UAAUta;YAEV,MAAM4a,QAAQN,OAAO1C,KAAK,CAAC;YAC3B,yDAAyD;YACzD0C,SAASM,MAAM5C,GAAG,MAAM;YAExB4C,MAAMvM,OAAO,CAACwJ,CAAAA;gBACZ,sEAAsE;gBACtE,MAAMgD,YAAYhD,KAAK3R,OAAO,CAAC,SAAS,IAAIlC,IAAI;gBAChD,IAAI6W,WAAWpF,aAAaoF,WAAW;YACzC;QACF;IACF,EAAE,OAAOzV,KAAK;QACZ5E,QAAQC,KAAK,CAAC2E,MAAM,mCAAmC;QACvD/F,iBAAiB,CAAC,OAAO,EAAE+F,KAAK,EAAE;IACpC,SAAU;QACR,MAAMvG,MAAMC;QACZ,IAAID,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAI8B,eAAe,CAAC;YACpB9B,IAAIG,SAAS,GAAGqY;QAClB;QACA7O,sBAAsB;QACtBsS,eAAe,kCAAkC;QACjD3K,mBAAmB,wBAAwB;IAC7C;AACF;AAEA,8BAA8B;AAC9B,MAAM4K,cAAc;IAClB3S,eAAe,CAACA;IAChB,MAAM8I,YAAY/U,SAASsC,cAAc,CAAC;IAC1C,MAAMI,MAAM1C,SAASsC,cAAc,CAAC;IACpC,MAAM8R,UAAUpU,SAASsC,cAAc,CAAC;IACxC,IAAI2J,cAAc;QAChB8I,WAAWhR,UAAUC,OAAO;QAC5B,IAAItB,KAAKA,IAAI4G,WAAW,GAAG;QAC3B8K,SAASrQ,UAAUC,OAAO;QAC1BmQ;QACA0K;IACF,OAAO;QACL9J,WAAWhR,UAAUE,IAAI;QACzB,IAAIvB,KAAKA,IAAI4G,WAAW,GAAG;QAC3B8K,SAASrQ,UAAUE,IAAI;QACvB6a;IACF;AACF;AAEA,MAAMD,4BAA4B;IAChC,MAAM5K,iBAAiBjU,SAASsC,cAAc,CAAC;IAC/C,IAAI,CAAC2R,kBAAkBA,eAAezJ,OAAO,CAACuU,aAAa,EAAE;IAC7D,MAAMC,WAAW,IAAIC,qBACnB,CAACC;QACCA,QAAQhN,OAAO,CAAC,CAACiN;YACf7S,kBAAkB6S,MAAMC,cAAc;QACxC;IACF,GACA;QAAEC,WAAW;QAAKC,YAAY;IAAO;IAEvCN,SAASO,OAAO,CAACtL;IACjBA,eAAezJ,OAAO,CAACuU,aAAa,GAAG;AACzC;AAEA,MAAMS,kBAAkB;IACtBtT,cAAc,CAACA;IACf,MAAM6I,YAAY/U,SAASsC,cAAc,CAAC;IAC1C,MAAMI,MAAM1C,SAASsC,cAAc,CAAC;IACpC,IAAI4J,aAAa;QACf6I,WAAWhR,UAAUC,OAAO;QAC5B,IAAItB,KAAKA,IAAI4G,WAAW,GAAG;QAC3BmW;IACF,OAAO;QACL1K,WAAWhR,UAAUE,IAAI;QACzB,IAAIvB,KAAKA,IAAI4G,WAAW,GAAG;IAC7B;AACF;AAEA,MAAM6K,mBAAmB;IACvB,MAAM2J,mBAAoB9d,SAASsC,cAAc,CAAC,mBAAyCiG;IAC3F,IAAI,CAACuV,kBAAkB;IAEvB,mCAAmC;IACnCa;IACAe;AACF;AAEA,MAAMA,eAAe;IACnB,IAAI1T,oBAAoB;IACxBA,qBAAqB2T,YAAY;QAC/B,wDAAwD;QACxD,IAAI3f,SAAS4f,MAAM,EAAE;QAErB,iCAAiC;QACjC,IAAI,CAACvT,qBAAqB;YACxByS;YACA;QACF;QAEA,IAAI,CAACxS,iBAAiB;QACtB,IAAI,CAACH,iBAAiBwS;aACjBvS,oBAAoB;IAC3B,GAAGV;AACL;AAEA,MAAMoT,kBAAkB;IACtB,IAAI9S,oBAAoB;QACtB6T,cAAc7T;QACdA,qBAAqB;IACvB;AACF;AAEA,MAAM8T,sBAAsB,OAAOtE,UAAkBuE;IACnD,IAAI;QACF,MAAMrgB;QAEN,IAAIuR,OAAO8O;QACX,IAAI,CAAC9O,MAAM;YACTA,OAAO,MAAM6G,eACX,CAAC,wBAAwB,EAAEkE,mBAAmBR,WAAW;QAE7D;QAEA,IAAIvK,KAAK3M,KAAK,IAAI,CAAC2M,KAAK+O,IAAI,IAAI/O,KAAK+O,IAAI,CAAC9Y,MAAM,KAAK,GAAG;YACtD;QACF;QACA,MAAM+K,SAAgB,EAAE;QACxB,MAAMgO,SAAS;YAAC;YAAM;YAAM;YAAM;YAAK;YAAK;YAAK;YAAO;YAAS;YAAK;YAAW;SAAQ;QACzF,MAAM5K,SAAS;YACblI,aAAaC,IAAI;YACjBD,aAAaI,GAAG;YAChBJ,aAAaG,KAAK;YAClBH,aAAaY,OAAO;YACpBZ,aAAaW,IAAI;YACjBX,aAAaE,MAAM;YACnBF,aAAaK,MAAM;YACnBL,aAAaM,KAAK;YAClBN,aAAaO,IAAI;YACjBP,aAAaQ,IAAI;YACjBR,aAAaS,MAAM;SACpB;QACDqS,OAAO/N,OAAO,CAAC,CAACgO,OAAOvI;YACrB,MAAMwI,YAAY,AAAClP,IAAY,CAACiP,MAAM;YACtC,IAAIC,aAAaA,UAAUjZ,MAAM,GAAG,GAAG;gBACrC+K,OAAO/P,IAAI,CAAC;oBACV+M,GAAGjN,MAAMoe,IAAI,CAAC;wBAAElZ,QAAQiZ,UAAUjZ,MAAM;oBAAC,GAAG,CAACmZ,GAAGpb,IAAMA,IAAI;oBAC1D+J,GAAGmR;oBACH1W,MAAM;oBACN6W,MAAM;oBACN7f,MAAMyf;oBACNxE,MAAM;wBAAE6E,OAAOlL,MAAM,CAACsC,IAAI;wBAAExH,OAAO;wBAAKqQ,OAAO;oBAAS;gBAC1D;YACF;QACF;QACA,IAAIvO,OAAO/K,MAAM,GAAG,GAAG;YACrB,MAAMuZ,mBAAmBhc,WAAwB;YAEjD,IAAIgc,kBAAkB;gBACpB,MAAM3O,SAAS;oBACb,GAAG9D,UAAU;oBACb2I,OAAOtG,gBAAgB;oBACvBhB,OAAO;wBACLsH,OAAO;4BAAE9S,MAAM;wBAAY;wBAC3B6c,UAAU;wBACVC,QAAQ;wBACRrR,UAAU;oBACZ;oBACAE,OAAO;wBACLmH,OAAO;4BAAE9S,MAAM;wBAAW;wBAC1B4F,MAAM;wBACNiX,UAAU;wBACVC,QAAQ;wBACRrR,UAAU;wBACVsR,WAAW;wBACXC,WAAW;oBACb;gBACF;gBACA,KAAKrhB,OAAOqS,KAAK,CAAC4O,kBAAkBxO,QAAeH,QAAe;oBAChE,GAAGrC,UAAU;oBACbE,gBAAgB;oBAChBE,YAAY;gBACd,GAAG1H,IAAI,CAAC,IAAMmJ,4BAA4BmP;YAC5C;QACF;IACF,EAAE,OAAOnc,OAAgB;QACvBD,QAAQC,KAAK,CAAC,sCAAsCA;IACtD;AACF;AAEA,MAAMmb,kBAAkB,OAAOqB;IAC7B,MAAMhD,mBACJ9d,SAASsC,cAAc,CAAC,mBACvBiG;IACH,IAAI,CAACuV,kBAAkB;IACvB,IAAI;QACF,MAAMpe;QAEN,IAAIuR,OAAO6P;QAEX,mFAAmF;QACnF,IAAI,CAAC7P,MAAM;YACT,MAAM6H,WAAW,MAAMhY,MACrB,CAAC,wBAAwB,EAAEkb,mBAAmB8B,mBAAmB;YAEnE7M,OAAO,MAAM6H,SAASK,IAAI;QAC5B;QAEA,IAAIlI,KAAK3M,KAAK,EAAE;QAEhB,UAAU;QACV,IACEtC,MAAMC,OAAO,CAACgP,KAAK8P,CAAC,KACpB/e,MAAMC,OAAO,CAACgP,KAAK+O,IAAI,KACvB/O,KAAK8P,CAAC,CAAC7Z,MAAM,KAAK+J,KAAK+O,IAAI,CAAC9Y,MAAM,IAClC+J,KAAK8P,CAAC,CAAC7Z,MAAM,GAAG,GAChB;YACA,MAAM8Z,OAAO;YACb,MAAMC,MAAM;YACZ,MAAMC,OACJlf,MAAMC,OAAO,CAACgP,KAAKkQ,KAAK,KAAKlQ,KAAKkQ,KAAK,CAACja,MAAM,GAAG+J,KAAKkQ,KAAK,CAAC,EAAE,GAAG;YACnE,MAAMC,OAAO,MAAMH,MAAMC,OAAOA;YAChC,MAAMG,KAAKpQ,KAAK8P,CAAC,CAAC1D,GAAG,CAAC,CAACiE,OAAiB,AAACA,CAAAA,OAAON,IAAG,IAAKI;YACxD,MAAMG,QAAQvhB,SAASsC,cAAc,CAAC;YACtC,IAAIif,OAAO;gBACT,MAAMC,UAAe;oBACnBvS,GAAGgC,KAAK+O,IAAI;oBACZhR,GAAGqS;oBACH5X,MAAM;oBACN6W,MAAM;oBACN7f,MAAM;oBACNib,MAAM;wBAAE6E,OAAOpT,aAAaI,GAAG;wBAAE4C,OAAO;oBAAI;gBAC9C;gBACA,KAAK3Q,OAAOqS,KAAK,CACf0P,OACA;oBAACC;iBAAe,EAChB;oBACE,GAAGxT,UAAU;oBACb2I,OAAOtG,gBAAgB;oBACvBhB,OAAO;wBACL,GAAGrB,WAAWqB,KAAK;wBACnBsH,OAAO;4BAAE9S,MAAM;wBAAW;oBAC5B;oBACA2L,OAAO;wBACL,GAAGxB,WAAWwB,KAAK;wBACnBmH,OAAO;4BAAE9S,MAAM;wBAAK;oBACtB;gBACF,GACA4L,YAECtH,IAAI,CAAC;oBACJmJ,4BAA4BiQ;gBAC9B,GACCnZ,KAAK,CAAC,CAACa;oBACN5E,QAAQC,KAAK,CAAC,yBAAyB2E;gBACzC;YACJ;QACF;QAEA,2BAA2B;QAC3B,IACEjH,MAAMC,OAAO,CAACgP,KAAKwQ,EAAE,KACrBzf,MAAMC,OAAO,CAACgP,KAAKyQ,EAAE,KACrB1f,MAAMC,OAAO,CAACgP,KAAK0Q,EAAE,GACrB;YACA,MAAMC,cAAc5hB,SAASsC,cAAc,CAAC;YAC5C,IAAIsf,aAAa;gBACf,MAAMC,gBAAqB;oBACzB5S,GAAGgC,KAAKwQ,EAAE;oBACVzS,GAAGiC,KAAKyQ,EAAE;oBACVI,GAAG7Q,KAAK0Q,EAAE;oBACVlY,MAAM;oBACN6W,MAAM;oBACN7f,MAAM;oBACNshB,QAAQ;wBAAExB,OAAOpT,aAAaC,IAAI;wBAAEe,MAAM;oBAAE;gBAC9C;gBACA,KAAK3O,OAAOqS,KAAK,CACf+P,aACA;oBAACC;iBAAqB,EACtB;oBACE,GAAG7T,UAAU;oBACb2I,OAAOtG,gBAAgB;oBACvB2R,OAAO;wBACL3S,OAAO;4BAAEsH,OAAO;gCAAE9S,MAAM;4BAAK;wBAAE;wBAC/B2L,OAAO;4BAAEmH,OAAO;gCAAE9S,MAAM;4BAAK;wBAAE;wBAC/Boe,OAAO;4BAAEtL,OAAO;gCAAE9S,MAAM;4BAAK;wBAAE;oBACjC;gBACF,GACA4L,YAECtH,IAAI,CAAC;oBACJmJ,4BAA4BsQ;gBAC9B,GACCxZ,KAAK,CAAC,CAACa;oBACN5E,QAAQC,KAAK,CAAC,yBAAyB2E;gBACzC;YACJ;QACF;IACF,EAAE,OAAO3E,OAAgB;QACvBD,QAAQC,KAAK,CAAC,uCAAuCA;IACvD;AACF;AAEA,MAAMqa,cAAc,OAAOoB;IACzB,MAAMjC,mBACJ9d,SAASsC,cAAc,CAAC,mBACvBiG;IACHlE,QAAQe,GAAG,CAAC,4CAA4C0Y,mBAAmB,YAAY;IACvF,IAAI,CAACA,oBAAoB3R,iBAAiB;QACxC,IAAI,CAAC2R,kBAAkBzZ,QAAQ2I,IAAI,CAAC;QACpC;IACF;IAEA,wCAAwC;IACxC,IAAI;QACF,MAAMtN;IACR,EAAE,OAAO0E,GAAG;QACVlB,iBAAiB,mCAAmC;QACpD;IACF;IAEAiJ,kBAAkB;IAElB,IAAI;QACF,IAAI8E,OAAO8O;QACX,IAAI,CAAC9O,MAAM;YACT,6CAA6C;YAC7CA,OAAO,MAAM6G,eACX,CAAC,wBAAwB,EAAEkE,mBAAmB8B,mBAAmB;QAErE;QAEA,IAAI7M,KAAK3M,KAAK,EAAE;YACdD,QAAQC,KAAK,CAAC,sCAAsC2M,KAAK3M,KAAK;YAC9D,oEAAoE;YACpE,IAAI,CAACyb,cAAc7c,iBAAiB,4BAA4B;YAChE;QACF;QAEA,gBAAgB;QAChB,IAAI+N,KAAK8P,CAAC,IAAI9P,KAAK+O,IAAI,EAAE;YACvB,MAAMkC,cAAczd,WAAwB;YAC5C,IAAI,CAACyd,aAAa;gBAChB7d,QAAQC,KAAK,CAAC;gBACd;YACF;YAEA,MAAM6d,mBAAmBpR,oBAAoBmR;YAE7C,MAAME,gBAA2B;gBAC/BnT,GAAGgC,KAAK+O,IAAI;gBACZhR,GAAGiC,KAAK8P,CAAC;gBACTtX,MAAM;gBACN6W,MAAM;gBACN7f,MAAM;gBACNib,MAAM;oBAAE6E,OAAOpT,aAAaC,IAAI;oBAAE,GAAG8C,SAAS;oBAAEC,OAAO;gBAAI;YAC7D;YAEA,IAAIiS,cAAc3hB,IAAI,IAAI0hB,iBAAiBE,cAAc,CAACD,cAAc3hB,IAAI,GAAG;gBAC7E2hB,cAAc/Q,OAAO,GAAG8Q,gBAAgB,CAACC,cAAc3hB,IAAI,CAAC;YAG9D;YAEA,KAAKjB,OAAOqS,KAAK,CACfqQ,aACA;gBAACE;aAAqB,EACtB;gBACE,GAAGpU,UAAU;gBACb2I,OAAOtG,gBAAgB;gBACvBhB,OAAO;oBACL,GAAGrB,WAAWqB,KAAK;oBACnBsH,OAAO;wBAAE9S,MAAM;oBAAW;gBAC5B;gBACA2L,OAAO;oBACL,GAAGxB,WAAWwB,KAAK;oBACnBmH,OAAO;wBAAE9S,MAAM;oBAAgB;gBACjC;YACF,GACA4L,YAECtH,IAAI,CAAC;gBACJmJ,4BAA4B4Q;YAC9B,GACC9Z,KAAK,CAAC,CAACa;gBACN5E,QAAQC,KAAK,CAAC,yBAAyB2E;YACzC;QACJ;QAEA,gBAAgB;QAChB,IAAIgI,KAAKkQ,KAAK,IAAIlQ,KAAK+O,IAAI,EAAE;YAC3B,MAAM4B,cAAcnd,WAAwB;YAC5C,IAAI,CAACmd,aAAa;gBAChBvd,QAAQC,KAAK,CAAC;gBACd;YACF;YAEA,MAAM6d,mBAAmBpR,oBAAoB6Q;YAE7C,MAAM3P,SAAsB;gBAC1B;oBACEhD,GAAGgC,KAAK+O,IAAI;oBACZhR,GAAGiC,KAAKkQ,KAAK;oBACb1X,MAAM;oBACN6W,MAAM;oBACN7f,MAAM;oBACNib,MAAM;wBAAE6E,OAAOpT,aAAaI,GAAG;wBAAE,GAAG2C,SAAS;wBAAEC,OAAO;oBAAI;gBAC5D;aACD;YAED,IAAIc,KAAKwQ,EAAE,EAAE;gBACXxP,OAAO/P,IAAI,CAAC;oBACV+M,GAAGgC,KAAK+O,IAAI;oBACZhR,GAAGiC,KAAKwQ,EAAE;oBACVhY,MAAM;oBACN6W,MAAM;oBACN7f,MAAM;oBACNib,MAAM;wBACJ6E,OAAOpT,aAAaC,IAAI;wBACxB,GAAG8C,SAAS;wBACZoS,MAAM;wBACNnS,OAAO;oBACT;gBACF;YACF;YAEA,IAAIc,KAAKyQ,EAAE,EAAE;gBACXzP,OAAO/P,IAAI,CAAC;oBACV+M,GAAGgC,KAAK+O,IAAI;oBACZhR,GAAGiC,KAAKyQ,EAAE;oBACVjY,MAAM;oBACN6W,MAAM;oBACN7f,MAAM;oBACNib,MAAM;wBACJ6E,OAAOpT,aAAaG,KAAK;wBACzB,GAAG4C,SAAS;wBACZoS,MAAM;wBACNnS,OAAO;oBACT;gBACF;YACF;YAEA,IAAIc,KAAK0Q,EAAE,EAAE;gBACX1P,OAAO/P,IAAI,CAAC;oBACV+M,GAAGgC,KAAK+O,IAAI;oBACZhR,GAAGiC,KAAK0Q,EAAE;oBACVlY,MAAM;oBACN6W,MAAM;oBACN7f,MAAM;oBACNib,MAAM;wBACJ6E,OAAOpT,aAAaK,MAAM;wBAC1B,GAAG0C,SAAS;wBACZoS,MAAM;wBACNnS,OAAO;oBACT;gBACF;YACF;YAEA,gCAAgC;YAChC8B,OAAOC,OAAO,CAAC,CAACqQ;gBACd,IAAIA,GAAG9hB,IAAI,IAAI+hB,OAAOC,SAAS,CAACJ,cAAc,CAACK,IAAI,CAACP,kBAAkBI,GAAG9hB,IAAI,GAAG;oBAC9E8hB,GAAGlR,OAAO,GAAG8Q,gBAAgB,CAACI,GAAG9hB,IAAI,CAAC;gBACxC;YACF;YAEA,KAAKjB,OAAOqS,KAAK,CACf+P,aACA3P,QACA;gBACE,GAAGjE,UAAU;gBACb2I,OAAOtG,gBAAgB;gBACvBhB,OAAO;oBACL,GAAGrB,WAAWqB,KAAK;oBACnBsH,OAAO;wBAAE9S,MAAM;oBAAW;gBAC5B;gBACA2L,OAAO;oBACL,GAAGxB,WAAWwB,KAAK;oBACnBmH,OAAO;wBAAE9S,MAAM;oBAAiB;gBAClC;YACF,GACA4L,YACAtH,IAAI,CAAC;gBACLmJ,4BAA4BsQ;YAC9B;QACF;QAEA,kBAAkB;QAClB,MAAMe,kBAA+B,EAAE;QACvC,IAAI1R,KAAK2R,GAAG,IAAI3R,KAAK+O,IAAI,EAAE;YACzB2C,gBAAgBzgB,IAAI,CAAC;gBACnB+M,GAAGgC,KAAK+O,IAAI;gBACZhR,GAAGiC,KAAK2R,GAAG;gBACXnZ,MAAM;gBACN6W,MAAM;gBACN7f,MAAM;gBACNib,MAAM;oBAAE6E,OAAOpT,aAAaU,IAAI;oBAAE,GAAGqC,SAAS;oBAAEC,OAAO;gBAAI;YAC7D;QACF;QACA,IAAIc,KAAK4R,OAAO,IAAI5R,KAAK+O,IAAI,EAAE;YAC7B2C,gBAAgBzgB,IAAI,CAAC;gBACnB+M,GAAGgC,KAAK+O,IAAI;gBACZhR,GAAGiC,KAAK4R,OAAO;gBACfpZ,MAAM;gBACN6W,MAAM;gBACN7f,MAAM;gBACNib,MAAM;oBAAE6E,OAAOpT,aAAaW,IAAI;oBAAE,GAAGoC,SAAS;oBAAEC,OAAO;gBAAI;YAC7D;QACF;QACA,IAAIc,KAAKnM,CAAC,IAAImM,KAAK+O,IAAI,EAAE;YACvB2C,gBAAgBzgB,IAAI,CAAC;gBACnB+M,GAAGgC,KAAK+O,IAAI;gBACZhR,GAAGiC,KAAKnM,CAAC;gBACT2E,MAAM;gBACN6W,MAAM;gBACN7f,MAAM;gBACNib,MAAM;oBAAE6E,OAAOpT,aAAaY,OAAO;oBAAE,GAAGmC,SAAS;oBAAEC,OAAO;gBAAI;YAChE;QACF;QACA,IAAIc,KAAK6R,KAAK,IAAI7R,KAAK+O,IAAI,EAAE;YAC3B2C,gBAAgBzgB,IAAI,CAAC;gBACnB+M,GAAGgC,KAAK+O,IAAI;gBACZhR,GAAGiC,KAAK6R,KAAK;gBACbrZ,MAAM;gBACN6W,MAAM;gBACN7f,MAAM;gBACNib,MAAM;oBAAE6E,OAAOpT,aAAaM,KAAK;oBAAE,GAAGyC,SAAS;oBAAEC,OAAO;gBAAI;YAC9D;QACF;QAEA,IAAIwS,gBAAgBzb,MAAM,GAAG,GAAG;YAC9B,MAAM6b,cAAc/iB,SAASsC,cAAc,CAAC;YAC5C,IAAIygB,aAAa;gBACf,KAAKvjB,OAAOqS,KAAK,CACfkR,aACAJ,iBACA;oBACE,GAAG3U,UAAU;oBACb2I,OAAOtG,gBAAgB;oBACvBhB,OAAO;wBACL,GAAGrB,WAAWqB,KAAK;wBACnBsH,OAAO;4BAAE9S,MAAM;wBAAW;oBAC5B;oBACA2L,OAAO;wBACL,GAAGxB,WAAWwB,KAAK;wBACnBmH,OAAO;4BAAE9S,MAAM;wBAAQ;oBACzB;gBACF,GACA4L,YACAtH,IAAI,CAAC;oBACLmJ,4BAA4ByR;gBAC9B;YACF;QACF;QAEA,8CAA8C;QAC9C,MAAMC,iBAAiB;YAAClD,oBAAoBhC;SAAkB;QAC9D,gFAAgF;QAChF,IAAI5R,aAAa8W,eAAe9gB,IAAI,CAACud,gBAAgBxO;QACrD,MAAMrR,QAAQqjB,UAAU,CAACD;QAEzB,8BAA8B;QAC9B,IAAIzW,iBAAiB;YACnBrJ,iBAAiB,6BAA6B,WAAWsI;YACzDe,kBAAkB;QACpB;IACF,EAAE,OAAOjI,OAAgB;QACvBD,QAAQC,KAAK,CAAC,kCAAkCA;QAChD,MAAM4e,cAActZ,KAAKD,GAAG;QAC5B,MAAMmU,mBACJ9d,SAASsC,cAAc,CAAC,mBACvBiG;QACH,IACEuV,oBACAoF,cAAcpX,4BAA4BC,6BAC1C;YACA7I,iBACE,CAAC,sBAAsB,EAAEoB,iBAAiBjE,QAAQiE,MAAMmB,OAAO,GAAG,iBAChE,EACF;YAEFqG,4BAA4BoX;QAC9B;IACF,SAAU;QACR/W,kBAAkB;QAElB,0CAA0C;QAC1C,MAAM+H,SAASlU,SAASsC,cAAc,CAAC;QACvC,IAAI4R,UAAU,CAACA,OAAOnQ,SAAS,CAAC8Q,QAAQ,CAAC,WAAW;YAClDX,OAAOnQ,SAAS,CAACE,GAAG,CAAC;QACvB;QAEA,IAAImI,mBAAmB;YACrBA,oBAAoB;YACpB2J,sBAAsB,IAAM4I;QAC9B;IACF;AACF;AAEA,qBAAqB;AACrB,MAAMjL,sBAAsB,OAAO/Q;IACjC,IAAI,CAACuI,YAAY;QACfhI,iBAAiB,8CAA8C,WAAWsI;QAC1E;IACF;IAEA,MAAM9I,MAAMC;IACZ,IAAIuY,eAAe;IAEnB,IAAIxY,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIqB,SAAS,CAACE,GAAG,CAAC,cAAc;QAChCvB,IAAIG,SAAS,GAAG,CAAC,8VAA8V,CAAC;IAClX;IAEA,IAAI;QACF,MAAMiW,WAAW,MAAMhY,MAAM,CAAC,4BAA4B,EAAEkb,mBAAmB9Q,aAAa;QAC5F,MAAM+F,OAAO,MAAM6H,SAASK,IAAI;QAChC,IAAIlI,KAAKqE,OAAO,EAAE;YAChB,MAAMzM,SAAS7I,SAASsC,cAAc,CAAC;YACvC,IAAIuG,QAAQ;gBACVA,OAAOhG,SAAS,GAAG;gBACnB,IAAIoO,KAAKkS,KAAK,CAACjc,MAAM,KAAK,GAAG;oBAC3B,MAAM0V,MAAM5c,SAASC,aAAa,CAAC;oBACnC2c,IAAI9Z,QAAQ,GAAG;oBACf8Z,IAAItT,WAAW,GAAG;oBAClBT,OAAOtI,WAAW,CAACqc;gBACrB,OAAO;oBACL,oEAAoE;oBACpE3L,KAAKkS,KAAK,CAACjR,OAAO,CAAC,CAACkR;wBAClB,MAAMxG,MAAM5c,SAASC,aAAa,CAAC;wBACnC,IAAI,OAAOmjB,MAAM,UAAU;4BACzBxG,IAAIrU,KAAK,GAAG6a;4BACZxG,IAAItT,WAAW,GAAG8Z;wBACpB,OAAO;4BACLxG,IAAIrU,KAAK,GAAG6a,EAAE3iB,IAAI;4BAClBmc,IAAItT,WAAW,GAAG,GAAG8Z,EAAE3iB,IAAI,CAAC,EAAE,EAAEkE,YAAYye,EAAEjV,IAAI,EAAE,CAAC,CAAC;wBACxD;wBACAtF,OAAOtI,WAAW,CAACqc;oBACrB;gBACF;YACF;QACF;QACA,IAAIla,KAAKQ,iBAAiB,2BAA2B,WAAWiE;IAClE,EAAE,OAAO/C,GAAG;QACVC,QAAQC,KAAK,CAACF;QACd,IAAI1B,KAAKQ,iBAAiB,mCAAmC;IAC/D,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAI8B,eAAe,CAAC;YACpB9B,IAAIqB,SAAS,CAACC,MAAM,CAAC,cAAc;YACnCtB,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AAIA,MAAMa,oBAAoB,CAACsH;IACzB,MAAMC,QAAQtjB,SAASsC,cAAc,CAAC;IACtC,MAAMihB,OAAOvjB,SAASsC,cAAc,CAAC;IACrC,MAAMkhB,YAAYxjB,SAASsC,cAAc,CAAC;IAC1C,MAAMmhB,cAAczjB,SAASsC,cAAc,CAAC;IAE5C,iEAAiE;IACjE,MAAMohB,oBAAoB;QAAC;QAAiB;KAAgB;IAC5D,MAAMC,sBAAsB;QAAC;QAAiB;QAAuB;KAAc;IAEnF,IAAIN,QAAQ,UAAU;QACpB,IAAIC,OAAOA,MAAM9a,KAAK,CAACob,SAAS,GAAG;QACnC,IAAIL,MAAMA,KAAK/a,KAAK,CAACob,SAAS,GAAG;QAEjCJ,WAAWzf,UAAUC,UAAU2f;QAC/BH,WAAWzf,UAAUE,OAAOyf;QAC5BF,WAAWzgB,aAAa,iBAAiB;QAEzC0gB,aAAa1f,UAAUC,UAAU0f;QACjCD,aAAa1f,UAAUE,OAAO0f;QAC9BF,aAAa1gB,aAAa,iBAAiB;IAC7C,OAAO;QACL,IAAIugB,OAAOA,MAAM9a,KAAK,CAACob,SAAS,GAAG;QACnC,sDAAsD;QACtD,IAAIL,MAAMA,KAAK/a,KAAK,CAACob,SAAS,GAAG;QAEjCH,aAAa1f,UAAUC,UAAU2f;QACjCF,aAAa1f,UAAUE,OAAOyf;QAC9BD,aAAa1gB,aAAa,iBAAiB;QAE3CygB,WAAWzf,UAAUC,UAAU0f;QAC/BF,WAAWzf,UAAUE,OAAO0f;QAC5BH,WAAWzgB,aAAa,iBAAiB;QAEzC8gB;IACF;AACF;AAEA,MAAMA,yBAAyB,OAAOC,UAAmB,KAAK;IAC5D,MAAMjb,SAAS7I,SAASsC,cAAc,CAAC;IACvC,IAAI,CAACuG,QAAQ;IAEb,uHAAuH;IACvH,IAAI,CAACib,WAAWjb,OAAOkP,OAAO,CAAC7Q,MAAM,GAAG,GAAG;QACzC;IACF;IAEA,MAAMxE,MAAM1C,SAASsC,cAAc,CAAC;IACpC,MAAMyhB,eAAerhB,MAAMA,IAAIG,SAAS,GAAG;IAE3C,IAAIH,KAAK;QACPA,IAAII,QAAQ,GAAG;QACfJ,IAAIqB,SAAS,CAACE,GAAG,CAAC,eAAe;QACjCvB,IAAIG,SAAS,GAAG,CAAC,qXAAqX,CAAC;IACzY;IAEAgG,OAAOhG,SAAS,GAAG;IACnB,IAAI;QACF,MAAM5B,MAAM6iB,UAAU,8CAA8C;QACpE,MAAM1gB,MAAM,MAAMtC,MAAMG;QACxB,MAAMgQ,OAAO,MAAM7N,IAAI+V,IAAI;QAE3BtQ,OAAOhG,SAAS,GAAG;QACnB,IAAIoO,KAAKkS,KAAK,IAAInhB,MAAMC,OAAO,CAACgP,KAAKkS,KAAK,GAAG;YAC3C,IAAIlS,KAAKkS,KAAK,CAACjc,MAAM,KAAK,GAAG;gBAC3B,MAAM0V,MAAM5c,SAASC,aAAa,CAAC;gBACnC2c,IAAI9Z,QAAQ,GAAG;gBACf8Z,IAAItT,WAAW,GAAG;gBAClBT,OAAOtI,WAAW,CAACqc;YACrB,OAAO;gBACL3L,KAAKkS,KAAK,CAACjR,OAAO,CAAC,CAACkR;oBAClB,MAAMxG,MAAM5c,SAASC,aAAa,CAAC;oBACnC2c,IAAIrU,KAAK,GAAG6a;oBACZxG,IAAItT,WAAW,GAAG8Z;oBAClBva,OAAOtI,WAAW,CAACqc;gBACrB;YACF;QACF;IACF,EAAE,OAAOxY,GAAG;QACVC,QAAQC,KAAK,CAACF;QACdyE,OAAOhG,SAAS,GAAG;IACrB,SAAU;QACR,IAAIH,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAIqB,SAAS,CAACC,MAAM,CAAC,eAAe;YACpCtB,IAAIG,SAAS,GAAGkhB;QAClB;IACF;AACF;AAEA,MAAMC,wBAAwB,OAAOrhB;IACnC,MAAMkG,SAAS7I,SAASsC,cAAc,CAAC;IACvC,MAAM2H,WAAWpB,QAAQN;IACzB,IAAI,CAAC0B,YAAY,CAACiB,YAAY;QAC5BhI,iBAAiB,4CAA4C;QAC7D;IACF;IAEA,MAAMR,MAAOC,cAAc3C,SAASsC,cAAc,CAAC;IACnD,MAAM4Y,eAAexY,MAAMA,IAAIG,SAAS,GAAG;IAE3C,IAAIH,KAAK;QACPA,IAAII,QAAQ,GAAG;QACfJ,IAAIG,SAAS,GAAG,CAAC,4YAA4Y,CAAC;IACha;IAEA,IAAI;QACF,MAAMO,MAAM,MAAMtC,MAAM,iCAAiC;YACvDY,QAAQ;YACRG,SAAS;gBAAE,gBAAgB;YAAmB;YAC9CyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEyG;gBAAU8S,UAAU7R;YAAW;QACxD;QACA,MAAM8L,SAAS,MAAM5T,IAAI+V,IAAI;QAC7B,IAAInC,OAAO1B,OAAO,EAAE;YAClBpS,iBAAiB,CAAC,QAAQ,EAAE+G,SAAS,aAAa,CAAC,EAAE;YACrDyJ;QACF,OAAO;YACLxQ,iBAAiB8T,OAAOvR,OAAO,IAAI,gBAAgB;QACrD;IACF,EAAE,OAAOrB,GAAG;QACVlB,iBAAiB,2BAA2B;IAC9C,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AACCvb,OAAeqkB,qBAAqB,GAAGA;AAExC,MAAMC,UAAU,CAACthB;IACf,MAAMuhB,eAAelkB,SAASsC,cAAc,CAAC;IAC7C,MAAMyI,UAAUmZ,aAAa3b,KAAK,CAACV,IAAI;IAEvC,IAAI,CAACkD,SAAS;QACZ7H,iBAAiB,sCAAsC;QACvD;IACF;IAEA,MAAMR,MAAMC;IACZ,MAAMuY,eAAexY,MAAMA,IAAIG,SAAS,GAAG;IAC3C,IAAIyS,UAAU;IAEd,IAAI5S,KAAK;QACPA,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,6ZAA6Z,CAAC;IACjb;IAEAiV,eAAe,aAAa;QAC1BpW,QAAQ;QACRG,SAAS;YACP,gBAAgB;QAClB;QACAyB,MAAMC,KAAKC,SAAS,CAAC;YAAEuH;QAAQ;IACjC,GACG5C,IAAI,CAAC,CAAC8I;QACL,IAAIA,KAAKlG,OAAO,EAAE;YAChB7H,iBAAiB,CAAC,kBAAkB,EAAE+N,KAAKlG,OAAO,EAAE,EAAE;YACtD4Q,mBAAmB,4BAA4B;YAC/CrG,UAAU;QACZ,OAAO,IAAIrE,KAAKmI,MAAM,EAAE;YACtBlW,iBAAiB+N,KAAKmI,MAAM,EAAE,SAAS,uCAAuC;QAChF;IACF,GACChR,KAAK,CAAC,CAACa;QACN/F,iBAAiB,CAAC,yBAAyB,EAAEsC,gBAAgByD,MAAM,EAAE;IACvE,GACCkb,OAAO,CAAC;QACP,IAAIzhB,KAAK;YACP,IAAI4S,SAAS;gBACXlO,uBAAuB1E,KAAKwY,cAAc;YAC5C,OAAO;gBACLxY,IAAII,QAAQ,GAAG;gBACfJ,IAAI8B,eAAe,CAAC;gBACpB9B,IAAIG,SAAS,GAAGqY;YAClB;QACF;IACF;AACJ;AACCvb,OAAeskB,OAAO,GAAGA;AAE1B,MAAMG,eAAe,CAAC1hB;IACpBoV,eAAe,mBAAmB;QAChCpW,QAAQ;IACV,GACGyG,IAAI,CAAC,CAAC8I;QACL,IAAIA,KAAKmI,MAAM,EAAE;YACf,IAAInI,KAAKmI,MAAM,CAAC9S,WAAW,GAAGC,QAAQ,CAAC,YAAY0K,KAAKmI,MAAM,CAAC9S,WAAW,GAAGC,QAAQ,CAAC,WAAW;gBAC/FrD,iBAAiB+N,KAAKmI,MAAM,EAAE;YAChC,OAAO;gBACLlW,iBAAiB+N,KAAKmI,MAAM,EAAE;YAChC;QACF;IACF,GACChR,KAAK,CAAC,CAACa;QACN/F,iBAAiB,CAAC,0BAA0B,EAAEsC,gBAAgByD,MAAM,EAAE;IACxE;AACJ;AACCtJ,OAAeykB,YAAY,GAAGA;AAC/BzkB,OAAOoc,iBAAiB,GAAGA;AAE3B,MAAMsI,iBAAiB,OAAO1hB;IAC5B,MAAM5B,QAAQf,SAASsC,cAAc,CAAC;IACtC,MAAMI,MAAOC,cAAc3C,SAASsC,cAAc,CAAC;IACnD,MAAMgiB,OAAOvjB,OAAOoiB,OAAO,CAAC,EAAE;IAE9B,IAAI,CAACjY,YAAY;QACfhI,iBAAiB,sCAAsC;QACvD;IACF;IAEA,IAAI,CAACohB,MAAM;QACTphB,iBAAiB,kCAAkC;QACnD,IAAInC,OAAO;YACTA,MAAM6H,KAAK;YACX7H,MAAMgC,YAAY,CAAC,gBAAgB;YACnChC,MAAM8W,gBAAgB,CAAC,UAAU,IAAM9W,MAAMyD,eAAe,CAAC,iBAAiB;gBAAE+f,MAAM;YAAK;QAC7F;QACA;IACF;IAEA,0CAA0C;IAC1C,MAAMC,WAAW,MAAM,OAAO,MAAM,QAAQ;IAC5C,IAAIF,KAAKnW,IAAI,GAAGqW,UAAU;QACxB,MAAMC,SAAS,AAACH,CAAAA,KAAKnW,IAAI,GAAI,CAAA,OAAO,IAAG,CAAC,EAAG5I,OAAO,CAAC;QACnDrC,iBAAiB,CAAC,gBAAgB,EAAEuhB,OAAO,uBAAuB,CAAC,EAAE,SAAStd;QAC9E;IACF;IAEA,mCAAmC;IACnC,MAAMud,oBAAoB;QAAC;QAAQ;QAAQ;KAAM;IACjD,MAAMC,WAAWL,KAAK7jB,IAAI,CAAC6F,WAAW;IACtC,MAAMse,mBAAmBF,kBAAkBte,IAAI,CAACye,CAAAA,MAAOF,SAASG,QAAQ,CAACD;IAEzE,IAAI,CAACD,kBAAkB;QACrB1hB,iBAAiB,+CAA+C,SAASiE;QACzE;IACF;IAEA,oBAAoB;IACpB,MAAM+T,eAAexY,MAAMA,IAAIG,SAAS,GAAG;IAC3C,IAAIyS,UAAU;IACd,IAAI5S,KAAK;QACPA,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,6YAA6Y,CAAC;IACja;IAEA,MAAMkiB,WAAW,IAAIC;IACrBD,SAAShjB,MAAM,CAAC,QAAQuiB;IACxBS,SAAShjB,MAAM,CAAC,YAAYmJ;IAE5B,IAAI;QACF,MAAM4N,WAAW,MAAMhY,MAAM,wBAAwB;YAAEY,QAAQ;YAAQ4B,MAAMyhB;QAAS;QACtF,IAAI,CAACjM,SAASpV,EAAE,EAAE,MAAM,IAAIrD,MAAM;QAClC6C,iBAAiB,kCAAkC;QACnDnC,MAAMwH,KAAK,GAAG;QACdmL;QACA4B,UAAU;IACZ,EAAE,OAAOlR,GAAG;QACVlB,iBAAiB,6BAA6B;IAChD,SAAU;QACR,uBAAuB;QACvB,IAAIR,KAAK;YACP,IAAI4S,SAAS;gBACXlO,uBAAuB1E,KAAKwY,cAAc;YAC5C,OAAO;gBACLxY,IAAII,QAAQ,GAAG;gBACfJ,IAAI8B,eAAe,CAAC;gBACpB9B,IAAIG,SAAS,GAAGqY;YAClB;QACF;IACF;AACF;AAEA,MAAM+J,iBAAiB,OAAOtiB;IAC5B,MAAMsH,WAAYjK,SAASsC,cAAc,CAAC,mBAAyCiG;IACnF,IAAI,CAAC0B,YAAY,CAACiB,YAAY;IAE9B,MAAMxE,YAAY,MAAMC,iBAAiB,mBAAmB,CAAC,gCAAgC,EAAEsD,SAAS,CAAC,CAAC;IAC1G,IAAI,CAACvD,WAAW;IAEhB,MAAMhE,MAAMC;IACZ,IAAIuY,eAAe;IACnB,IAAI5F,UAAU;IAEd,IAAI5S,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,mZAAmZ,CAAC;IACva;IAEA,IAAI;QACF,MAAM/B,MAAM,wBAAwB;YAAEY,QAAQ;YAAQG,SAAS;gBAAE,gBAAgB;YAAmB;YAAGyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEuZ,UAAU7R;gBAAYjB;YAAS;QAAG;QAChK,MAAMyJ;QACNxQ,iBAAiB,oBAAoB;QACrCoS,UAAU;IACZ,EAAE,OAAOlR,GAAG;QACVlB,iBAAiB,UAAU;IAC7B,SAAU;QACR,IAAIR,KAAK;YACP,IAAI4S,SAAS;gBACXlO,uBAAuB1E,KAAKwY,cAAc;YAC5C,OAAO;gBACLxY,IAAII,QAAQ,GAAG;gBACfJ,IAAI8B,eAAe,CAAC;gBACpB9B,IAAIG,SAAS,GAAGqY;YAClB;QACF;IACF;AACF;AAEA,MAAMgK,mBAAmB,OAAOviB;IAC9B,MAAMsH,WAAYjK,SAASsC,cAAc,CAAC,mBAAyCiG;IACnF,IAAI,CAAC0B,YAAY,CAACiB,YAAY;IAE9B,MAAMxI,MAAOC,cAAc3C,SAASsC,cAAc,CAAC;IAEnD,0BAA0B;IAC1B,IAAI6iB,WAAW;IACf,IAAIzf,sBAAsB;QACxByf,WAAW,MAAMxe,iBAAiB,6BAA6B;IACjE;IAEA,MAAMxE,4BAA4B;QAChCI,UAAU;QACVE,eAAe;QACfU,gBAAgB;QAChBE,QAAQ;QACRI,SAAS;YAAEsZ,UAAU7R;YAAYjB;YAAUkb;QAAS;QACpDxiB,YAAYD;QACZO,gBAAgB;IAClB;IAEA,OAAO;IACP,IAAI;QACF,MAAMG,MAAM,MAAMtC,MAAM,sBAAsB;YAAEY,QAAQ;YAAQG,SAAS;gBAAE,gBAAgB;YAAmB;YAAGyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEuZ,UAAU7R;gBAAYjB;YAAS;QAAG;QAC1K,MAAMuL,OAAO,MAAMpS,IAAI+V,IAAI;QAC3B,IAAI3D,KAAKF,OAAO,EAAE;YAChB,MAAM3K,MAAM3K,SAASsC,cAAc,CAAC;YACpC,IAAIqI,KAAK;gBACP,MAAM8D,IAAI+G,KAAK4P,MAAM;gBACrB,MAAMC,MAAM,CAACC,IAAcA,EAAE/f,OAAO,CAAC;gBACrC,MAAMggB,KAAK,AAAC9W,CAAAA,CAAC,CAAC,EAAE,GAAGA,CAAC,CAAC,EAAE,AAAD,EAAGlJ,OAAO,CAAC;gBACjC,MAAMigB,KAAK,AAAC/W,CAAAA,CAAC,CAAC,EAAE,GAAGA,CAAC,CAAC,EAAE,AAAD,EAAGlJ,OAAO,CAAC;gBACjC,MAAMkgB,KAAK,AAAChX,CAAAA,CAAC,CAAC,EAAE,GAAGA,CAAC,CAAC,EAAE,AAAD,EAAGlJ,OAAO,CAAC;gBAEjC,MAAMmgB,UAAU,CAAChhB,IAAYb;oBAC3B,MAAM8D,KAAK3H,SAASsC,cAAc,CAACoC;oBACnC,IAAIiD,IAAIA,GAAG2B,WAAW,GAAGzF;gBAC3B;gBAEA6hB,QAAQ,mBAAmBL,IAAI5W,CAAC,CAAC,EAAE;gBACnCiX,QAAQ,mBAAmBL,IAAI5W,CAAC,CAAC,EAAE;gBACnCiX,QAAQ,mBAAmBH;gBAE3BG,QAAQ,mBAAmBL,IAAI5W,CAAC,CAAC,EAAE;gBACnCiX,QAAQ,mBAAmBL,IAAI5W,CAAC,CAAC,EAAE;gBACnCiX,QAAQ,mBAAmBF;gBAE3BE,QAAQ,mBAAmBL,IAAI5W,CAAC,CAAC,EAAE;gBACnCiX,QAAQ,mBAAmBL,IAAI5W,CAAC,CAAC,EAAE;gBACnCiX,QAAQ,mBAAmBD;YAC7B;YACAzlB,SAASsC,cAAc,CAAC,iBAAiByB,UAAUC,OAAO;QAC5D;IACF,EAAE,OAAOI,GAAG,CAAE;AAChB;AAEA,oBAAoB;AACpB,MAAMuhB,yBAAyB,OAAOhjB;IACpC,IAAI,CAACuI,YAAY;QACfhI,iBAAiB,sCAAsC;QACvD;IACF;IAEA,MAAM+G,WAAYjK,SAASsC,cAAc,CAAC,kBAAwCiG;IAClF,IAAI,CAAC0B,UAAU;QACb/G,iBAAiB,uEAAuE;QACxF;IACF;IAEA,MAAMR,MAAMC;IACZ,IAAIuY,eAAe;IACnB,IAAI5F,UAAU;IAEd,IAAI5S,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,eAAe,CAAC;IACnC;IAEA,IAAI;QACF,MAAMO,MAAM,MAAMtC,MAAM,sBAAsB;YAAEY,QAAQ;YAAQG,SAAS;gBAAE,gBAAgB;YAAmB;YAAGyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEuZ,UAAU7R;gBAAYjB;YAAS;QAAG;QAC1K,MAAMuL,OAAO,MAAMpS,IAAI+V,IAAI;QAC3B,IAAI3D,KAAKF,OAAO,EAAE;YAChB,MAAM7G,IAAI+G,KAAK4P,MAAM;YACrB,MAAMrE,IAAI,KAAK,cAAc;YAC7B,MAAMwE,KAAK9W,CAAC,CAAC,EAAE,GAAGA,CAAC,CAAC,EAAE;YAAE,MAAM+W,KAAK/W,CAAC,CAAC,EAAE,GAAGA,CAAC,CAAC,EAAE;YAAE,MAAMgX,KAAKhX,CAAC,CAAC,EAAE,GAAGA,CAAC,CAAC,EAAE;YAEtE,MAAMmX,SAAS,GAAG,AAACnX,CAAAA,CAAC,CAAC,EAAE,GAAG8W,KAAKxE,CAAAA,EAAGxb,OAAO,CAAC,GAAG,CAAC,EAAE,AAACkJ,CAAAA,CAAC,CAAC,EAAE,GAAG+W,KAAKzE,CAAAA,EAAGxb,OAAO,CAAC,GAAG,CAAC,EAAE,AAACkJ,CAAAA,CAAC,CAAC,EAAE,GAAGgX,KAAK1E,CAAAA,EAAGxb,OAAO,CAAC,IAAI;YAC1G,MAAMsgB,SAAS,GAAG,AAACpX,CAAAA,CAAC,CAAC,EAAE,GAAG8W,KAAKxE,CAAAA,EAAGxb,OAAO,CAAC,GAAG,CAAC,EAAE,AAACkJ,CAAAA,CAAC,CAAC,EAAE,GAAG+W,KAAKzE,CAAAA,EAAGxb,OAAO,CAAC,GAAG,CAAC,EAAE,AAACkJ,CAAAA,CAAC,CAAC,EAAE,GAAGgX,KAAK1E,CAAAA,EAAGxb,OAAO,CAAC,IAAI;YAEzGvF,SAASsC,cAAc,CAAC,SAA8BiG,KAAK,GAAGqd;YAC9D5lB,SAASsC,cAAc,CAAC,SAA8BiG,KAAK,GAAGsd;YAE/D3iB,iBAAiB,CAAC,oBAAoB,EAAE+G,UAAU,EAAE;QACtD,OAAO;YACL/G,iBAAiB,+BAA+B;QAClD;IACF,EAAE,OAAOkB,GAAG;QACVlB,iBAAiB,6BAA6B;IAChD,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAI8B,eAAe,CAAC;YACpB9B,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AAEA,MAAM4K,wBAAwB,OAAOnjB;IACnC,IAAI,CAACuI,YAAY;QACfhI,iBAAiB,sCAAsC;QACvD;IACF;IAEA,MAAMR,MAAMC;IACZ,IAAIuY,eAAe;IACnB,IAAI5F,UAAU;IAEd,IAAI5S,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,gaAAga,CAAC;IACpb;IAEA,MAAMkjB,SAAS,AAAC/lB,SAASsC,cAAc,CAAC,SAA8BiG,KAAK,CAACV,IAAI,GAAG4T,KAAK,CAAC,OAAO4B,GAAG,CAAC2I;IACpG,MAAMC,SAAS,AAACjmB,SAASsC,cAAc,CAAC,SAA8BiG,KAAK,CAACV,IAAI,GAAG4T,KAAK,CAAC,OAAO4B,GAAG,CAAC2I;IACpG,MAAME,QAAQ,AAAClmB,SAASsC,cAAc,CAAC,WAAgCiG,KAAK,CAACV,IAAI,GAAG4T,KAAK,CAAC,OAAO4B,GAAG,CAAC2I;IACrG,MAAMG,UAAU,AAACnmB,SAASsC,cAAc,CAAC,aAAkCiG,KAAK,CAACV,IAAI,GAAG4T,KAAK,CAAC,OAAO4B,GAAG,CAAC2I;IACzG,IAAI;QACF,MAAMllB,MAAM,iCAAiC;YAAEY,QAAQ;YAAQG,SAAS;gBAAE,gBAAgB;YAAmB;YAAGyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEuZ,UAAU7R;gBAAY9I,QAAQ;oBAAEgkB,WAAWL;oBAAQM,WAAWJ;oBAAQC;oBAAOC;gBAAQ;YAAE;QAAG;QACjOjjB,iBAAiB,2BAA2B;IAC9C,EAAE,OAAOkB,GAAG;QACVlB,iBAAiB,oCAAoC;IACvD,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAI8B,eAAe,CAAC;YACpB9B,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AAEA,MAAMoL,4BAA4B,OAAO3jB;IACvC,MAAMsH,WAAYjK,SAASsC,cAAc,CAAC,kBAAwCiG;IAClF,IAAI,CAAC2C,YAAY;QACfhI,iBAAiB,sCAAsC;QACvD;IACF;IACA,IAAI,CAAC+G,UAAU;QACb/G,iBAAiB,yCAAyC;QAC1D;IACF;IAEA,MAAMR,MAAMC;IACZ,IAAIuY,eAAe;IACnB,IAAI5F,UAAU;IAEd,IAAI5S,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,gaAAga,CAAC;IACpb;IAEA,8FAA8F;IAC9F,4DAA4D;IAC5D,qCAAqC;IACrC,uDAAuD;IAEvD,4DAA4D;IAC5D,uDAAuD;IACvD,qCAAqC;IAErC,MAAM0jB,QAAQ,GAAG,mCAAmC;IACpD,MAAMC,gBAAgBxmB,SAASsC,cAAc,CAAC;IAC9C,MAAMd,WAAWglB,gBAAgBA,cAAcje,KAAK,CAACV,IAAI,GAAG4T,KAAK,CAAC,OAAO4B,GAAG,CAAC2I,UAAU;QAAC;QAAG;QAAG;KAAE;IAChG,IAAI;QACF,MAAMllB,MAAM,qCAAqC;YAAEY,QAAQ;YAAQG,SAAS;gBAAE,gBAAgB;YAAmB;YAAGyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEuZ,UAAU7R;gBAAY9I,QAAQ;oBAAEqkB,cAAcxc;oBAAUyc,kBAAkBH;oBAAOI,kBAAkBnlB;gBAAS;YAAE;QAAG;QAC5P0B,iBAAiB,+BAA+B;IAClD,EAAE,OAAOkB,GAAG;QACVlB,iBAAiB,wCAAwC;IAC3D,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAI8B,eAAe,CAAC;YACpB9B,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AAEA,MAAM0L,kBAAkB;IACtB,MAAMC,OAAO7mB,SAASsC,cAAc,CAAC;IACrC,MAAMwkB,QAAQ9mB,SAASsC,cAAc,CAAC;IACtC,MAAME,cAAcxC,SAASsC,cAAc,CAAC;IAC5C,MAAMykB,YAAY/mB,SAASsC,cAAc,CAAC;IAE1C,IAAIukB,QAAQA,KAAKte,KAAK,EAAE;QACtB,IAAIue,OAAOA,MAAM/iB,SAAS,CAACC,MAAM,CAAC;QAClC,IAAIxB,aAAaA,YAAYuB,SAAS,CAACE,GAAG,CAAC;QAC3C,IAAI8iB,WAAWA,UAAUzd,WAAW,GAAGud,KAAKte,KAAK;IACjD,qEAAqE;IACvE,OAAO;QACL,IAAIue,OAAOA,MAAM/iB,SAAS,CAACE,GAAG,CAAC;QAC/B,IAAIzB,aAAaA,YAAYuB,SAAS,CAACC,MAAM,CAAC;IAChD;AACF;AAEA,MAAMgjB,wBAAwB;IAC5B,kCAAkC;IAClC3iB,QAAQe,GAAG,CAAC;AACd;AAEA,MAAM6hB,oBAAoB,OAAOhK,KAAata;IAC5C,IAAI,CAACuI,YAAY;IAEjB,MAAMxI,MAAMC;IACZ,IAAIuY,eAAe;IACnB,IAAI5F,UAAU;IAEd,IAAI5S,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,4ZAA4Z,CAAC;IAChb;IAEAK,iBAAiB,CAAC,QAAQ,EAAE+Z,KAAK,EAAE;IACnC,IAAI;QACF,MAAM7Z,MAAM,MAAMtC,MAAM,oBAAoB;YAAEY,QAAQ;YAAQG,SAAS;gBAAE,gBAAgB;YAAmB;YAAGyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEuZ,UAAU7R;gBAAY0S,SAASX;YAAI;QAAG;QAC5K,MAAMhM,OAAO,MAAM7N,IAAI+V,IAAI;QAE3B,IAAIlI,KAAKqE,OAAO,EAAE;YAChBpS,iBAAiB,kCAAkC;YACnDoS,UAAU;QACZ,OAAO;YACLpS,iBAAiB+N,KAAKxL,OAAO,IAAI,kBAAkB;QACrD;QAEA,IAAIwL,KAAKmI,MAAM,EAAE;YACf,MAAMzO,MAAM3K,SAASsC,cAAc,CAAC;YACpC,IAAIqI,KAAK;gBACPA,IAAI/C,SAAS,IAAI,CAAC,EAAE,EAAEqJ,KAAKmI,MAAM,EAAE;gBACnCzO,IAAIC,SAAS,GAAGD,IAAI2P,YAAY,EAAE,wBAAwB;YAC5D;QACF;IACF,EAAE,OAAOlW,GAAG;QACVC,QAAQC,KAAK,CAACF;QACdlB,iBAAiB,6BAA6B;IAChD,SAAU;QACR,IAAIR,KAAK;YACP,IAAI4S,SAAS;gBACXlO,uBAAuB1E,KAAKwY,cAAc;YAC5C,OAAO;gBACLxY,IAAII,QAAQ,GAAG;gBACfJ,IAAI8B,eAAe,CAAC;gBACpB9B,IAAIG,SAAS,GAAGqY;YAClB;QACF;IACF;AACF;AAEA,aAAa;AACb,MAAMgM,eAAe,OAAOvkB;IAC1B,IAAI,CAACuI,YAAY;QACfhI,iBAAiB,8BAA8B;QAC/C;IACF;IAEA,MAAMR,MAAMC;IACZ,IAAIuY,eAAe;IAEnB,IAAIxY,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,4ZAA4Z,CAAC;IAChb;IAEAK,iBAAiB,wBAAwB;IAEzC,IAAI;QACF,MAAM4V,WAAW,MAAMhY,MAAM,kBAAkB;YAC7CY,QAAQ;YACRG,SAAS;gBAAE,gBAAgB;YAAmB;YAC9CyB,MAAMC,KAAKC,SAAS,CAAC;gBAAEgY,UAAUtQ;gBAAYH,SAASA;YAAQ,GAAG,6BAA6B;QAChG;QAEA,IAAI,CAAC+N,SAASpV,EAAE,EAAE,MAAM,IAAIrD,MAAM;QAElC,MAAM0d,SAASjF,SAASxV,IAAI,EAAE0a;QAC9B,MAAMC,UAAU,IAAIC;QAEpB,MAAMG,OAAO;YACX,MAAM,EAAED,IAAI,EAAE7V,KAAK,EAAE,GAAG,AAAC,MAAMwV,QAAQM,UAAW;gBAAED,MAAM;gBAAM7V,OAAO+V;YAAU;YACjF,IAAIF,MAAM;gBACRlb,iBAAiB,uBAAuB;gBACxCqW;gBACAxF;gBACA;YACF;YAEA,MAAMlQ,OAAOoa,QAAQM,MAAM,CAAChW;YAC5B1E,KAAK4X,KAAK,CAAC,MAAMvJ,OAAO,CAACwJ,CAAAA;gBACvB,IAAIA,KAAK7T,IAAI,IAAI;oBACf,4DAA4D;oBAC5D,MAAM4B,OAAO,SAAS0d,IAAI,CAACzL,QAAQ,WAAW;oBAC9CpC,aAAaoC,MAAM;gBACrB;YACF;YACA,MAAM2C;QACR;QACA,MAAMA;IAER,EAAE,OAAOja,GAAG;QACVC,QAAQC,KAAK,CAACF;QACdlB,iBAAiB,2BAA2B;IAC9C,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAI8B,eAAe,CAAC;YACpB9B,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AAGA,MAAMnH,kBAAkB,OAAOpR;IAC7B,IAAI,CAACuI,YAAY;QACfhI,iBAAiB,0CAA0C,WAAWsI;QACtE;IACF;IAEA,MAAM9I,MAAMC;IACZ,IAAIuY,eAAe;IAEnB,IAAIxY,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIqB,SAAS,CAACE,GAAG,CAAC,cAAc;QAChCvB,IAAIG,SAAS,GAAG,CAAC,8VAA8V,CAAC;IAClX;IAEA,IAAI;QACF,MAAMO,MAAM,MAAMtC,MAAM,CAAC,+BAA+B,EAAEkb,mBAAmB9Q,aAAa;QAC1F,MAAM+F,OAAO,MAAM7N,IAAI+V,IAAI;QAC3B,MAAMtQ,SAAS7I,SAASsC,cAAc,CAAC;QACvC,IAAIuG,UAAUoI,KAAKmW,MAAM,EAAE;YACzB,IAAInW,KAAKmW,MAAM,CAAClgB,MAAM,KAAK,GAAG;gBAC5B2B,OAAOhG,SAAS,GAAG;YACrB,OAAO;gBACLgG,OAAOhG,SAAS,GAAG;gBACnBoO,KAAKmW,MAAM,CAAClV,OAAO,CAAC,CAACmV;oBACnB,MAAMzK,MAAM5c,SAASC,aAAa,CAAC;oBACnC2c,IAAIrU,KAAK,GAAG8e,EAAEC,IAAI;oBAClB1K,IAAItT,WAAW,GAAG+d,EAAElZ,IAAI,GAAG,GAAGkZ,EAAE5mB,IAAI,CAAC,EAAE,EAAEkE,YAAY0iB,EAAElZ,IAAI,EAAE,CAAC,CAAC,GAAGkZ,EAAE5mB,IAAI;oBACxEoI,OAAOtI,WAAW,CAACqc;gBACrB;YACF;QACF;QACA,IAAIla,KAAKQ,iBAAiB,uBAAuB,WAAWiE;IAC9D,EAAE,OAAO/C,GAAG;QACVC,QAAQC,KAAK,CAAC,+BAA+BF;QAC7ClB,iBAAiB,+BAA+B;IAClD,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAI8B,eAAe,CAAC;YACpB9B,IAAIqB,SAAS,CAACC,MAAM,CAAC,cAAc;YACnCtB,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AAEA,MAAMqM,wBAAwB;IAC5B,MAAM1e,SAAS7I,SAASsC,cAAc,CAAC;IACvC,MAAMglB,OAAOze,QAAQN;IACrB,MAAM7F,MAAM1C,SAASsC,cAAc,CAAC;IAEpC,IAAI,CAACglB,MAAM;QACTpkB,iBAAiB,qCAAqC;QACtD,IAAI2F,QAAQ;YACVA,OAAOD,KAAK;YACZC,OAAO9F,YAAY,CAAC,gBAAgB;YACpC8F,OAAOgP,gBAAgB,CAAC,UAAU,IAAMhP,OAAOrE,eAAe,CAAC,iBAAiB;gBAAE+f,MAAM;YAAK;QAC/F;QACA;IACF;IAEA,oBAAoB;IACpB,MAAMrJ,eAAexY,MAAMA,IAAIG,SAAS,GAAG;IAC3C,IAAIH,KAAK;QACPA,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIG,SAAS,GAAG,CAAC,2YAA2Y,CAAC;IAC/Z;IAEAuI,kBAAkBkc;IAClB,IAAI;QACF,IAAIhc,mBAAmB;YACrB,gCAAgC;YAChC,MAAMkc;QACR,OAAO;YACL,MAAMC;QACR;IACF,SAAU;QACR,uBAAuB;QACvB,IAAI/kB,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAI8B,eAAe,CAAC;YACpB9B,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AAEA,MAAMuM,iBAAiB;IACrB,IAAI,CAACrc,iBAAiB;IACtB,MAAMsc,YAAY,AAAC1nB,SAASsC,cAAc,CAAC,cAAmCqlB,WAAW;IACzF,MAAMpH,QAAQ,AAACvgB,SAASsC,cAAc,CAAC,cAAoCiG,SAAS;IACpF,MAAMqf,iBAAiB,AAAC5nB,SAASsC,cAAc,CAAC,mBAAyCiG,SAAS;IAElG,IAAI;QACF,MAAMnF,MAAM,MAAMtC,MAAM,wBAAwB;YAC9CY,QAAQ;YACRG,SAAS;gBAAE,gBAAgB;YAAmB;YAC9CyB,MAAMC,KAAKC,SAAS,CAAC;gBACnBqkB,WAAWzc;gBACX+E,OAAO;gBACPxB,QAAQ;gBACRmZ,YAAYJ;gBACZnH,OAAOA;gBACPwH,iBAAiBH;YACnB;QACF;QACA,MAAM3W,OAAO,MAAM7N,IAAI+V,IAAI;QAC3B,IAAIlI,KAAKqE,OAAO,EAAE;YACftV,SAASsC,cAAc,CAAC,aAAkCpC,GAAG,GAAG,CAAC,sBAAsB,EAAE+Q,KAAK+J,KAAK,EAAE;YACtGhb,SAASsC,cAAc,CAAC,cAAcyB,UAAUC,OAAO;YACvDhE,SAASsC,cAAc,CAAC,oBAAoByB,UAAUE,IAAI;YAC1DjE,SAASsC,cAAc,CAAC,iBAAiByB,UAAUC,OAAO;YAC1DhE,SAASsC,cAAc,CAAC,sBAAsByB,UAAUE,IAAI;QAC9D;IACF,EAAE,OAAOG,GAAG,CAAE;AAChB;AAEA,SAAS4jB,gBAAgBC,QAQxB;IACC,MAAMC,cAAcloB,SAASsC,cAAc,CAAC;IAC5C,MAAM6lB,kBAAkBnoB,SAASsC,cAAc,CAAC;IAEhD,IAAI,CAAC4lB,eAAe,CAACC,iBAAiB;QACpC9jB,QAAQC,KAAK,CAAC;QACd;IACF;IAEA,IAAI,CAAC2jB,YAAY,CAACA,SAAS3S,OAAO,EAAE;QAClC4S,YAAYnkB,SAAS,CAACE,GAAG,CAAC;QAC1B;IACF;IAEA,8BAA8B;IAC9B,MAAMmkB,YAAY;QAChB;YAAEC,OAAO;YAAU9f,OAAO0f,SAASK,QAAQ,EAAE5K,oBAAoB;QAAM;QACvE;YAAE2K,OAAO;YAAS9f,OAAO0f,SAASM,OAAO,EAAE7K,oBAAoB;QAAM;QACrE;YACE2K,OAAO;YACP9f,OAAO0f,SAAS/gB,MAAM,GAAG+gB,SAAS/gB,MAAM,CAAC3B,OAAO,CAAC,KAAK;QACxD;QACA;YACE8iB,OAAO;YACP9f,OAAO0f,SAASO,MAAM,GAAGP,SAASO,MAAM,CAACjjB,OAAO,CAAC,KAAK;QACxD;KACD;IAED4iB,gBAAgBtlB,SAAS,GAAGulB,UACzB/K,GAAG,CACF,CAACoL,OACC,CAAC,aAAa,EAAEA,KAAKJ,KAAK,CAAC,mJAAmJ,EAAEI,KAAKlgB,KAAK,CAAC,eAAe,CAAC,EAE9MsV,IAAI,CAAC;IAER,0BAA0B;IAC1B,IAAIoK,SAAS7C,MAAM,IAAIpjB,MAAMC,OAAO,CAACgmB,SAAS7C,MAAM,GAAG;QACrD,wDAAwD;QACxD,MAAMsD,YAAY,GAAGT,SAAS7C,MAAM,CAAC/H,GAAG,CAAC,CAAC5O,IAAMA,EAAElJ,OAAO,CAAC,IAAIsY,IAAI,CAAC,MAAM;QACzEsK,gBAAgBtlB,SAAS,IAAI,CAAC,yLAAyL,EAAE6lB,UAAU,eAAe,CAAC;IACrP;IAEA,0BAA0B;IAC1B,IAAIT,SAASU,MAAM,IAAI3mB,MAAMC,OAAO,CAACgmB,SAASU,MAAM,GAAG;QACrD,MAAMC,YAAY,GAAGX,SAASU,MAAM,CAACtL,GAAG,CAAC,CAACV,IAAMA,EAAEpX,OAAO,CAAC,IAAIsY,IAAI,CAAC,MAAM;QACzEsK,gBAAgBtlB,SAAS,IAAI,CAAC,yLAAyL,EAAE+lB,UAAU,eAAe,CAAC;IACrP;IAEAV,YAAYnkB,SAAS,CAACC,MAAM,CAAC;AAC/B;AAEA,eAAewjB,yBAAyB9f,iBAAyB,0BAA0B;IACzF,MAAM0U,YAAYpc,SAASsC,cAAc,CAAC;IAC1C,MAAMumB,gBAAgB7oB,SAASsC,cAAc,CAAC;IAC9C,MAAMwmB,YAAY9oB,SAASsC,cAAc,CAAC;IAE1C,IAAI,CAAC8Z,aAAa,CAACyM,iBAAiB,CAACC,WAAW;IAEhD,MAAMC,iBAAiB/oB,SAASsC,cAAc,CAAC;IAC/C,MAAM0mB,aAAahpB,SAASsC,cAAc,CAAC;IAE3C,IAAI,CAACymB,kBAAkB,CAACC,YAAY;QAClC9lB,iBAAiB,oCAAoC;QACrD;IACF;IAEA,MAAMwkB,YAAYqB,eAAepB,OAAO;IACxC,MAAMpH,QAAQyI,WAAWzgB,KAAK;IAE9B,oBAAoB;IACpB,MAAMpG,4BAA4B;QAChCI,UAAU;QACVE,eAAe;QACfyB,SAAS;QACTf,gBAAgB;QAChBE,QAAQ;QACRI,SAAS;YACPokB,WAAWzc;YACX0c,YAAYJ;YACZnH,OAAOA;QACT;QACA,0EAA0E;QAC1E,4DAA4D;QAE5Dpc,WAAW;YACT,qBAAqB;YACrBiY,UAAU9S,WAAW,GAAG;YACxB8S,UAAUrY,SAAS,CAACC,MAAM,CAAC,iBAAiB;YAC5CoY,UAAUrY,SAAS,CAACE,GAAG,CAAC,iBAAiB;YAEzC,gEAAgE;YAChE4kB,cAAcxM,aAAa,EAAEtY,UAAUE,IAAI;YAC3C6kB,UAAU/kB,SAAS,CAACE,GAAG,CAAC;YACxBjE,SAASsC,cAAc,CAAC,wBAAwByB,UAAUC,OAAO;YAEjEd,iBAAiBwE,gBAAgB,WAAW8D;QAC9C;QACAjH,SAAS,CAACD;YACR,MAAM2U,eAAe3U,iBAAiBjE,QAAQiE,MAAMmB,OAAO,GAAG;YAC9DvC,iBAAiB,CAAC,mCAAmC,EAAE+V,cAAc,EAAE;YAEvE,uBAAuB;YACvB3N,oBAAoB;YAEpB,4BAA4B;YAC5B8Q,UAAU9S,WAAW,GAAG;YACxB8S,UAAUrY,SAAS,CAACC,MAAM,CAAC,iBAAiB;YAC5CoY,UAAUrY,SAAS,CAACE,GAAG,CAAC,iBAAiB;YACzC4kB,cAAcxM,aAAa,EAAEtY,UAAUC,OAAO;YAC9C8kB,UAAU/kB,SAAS,CAACC,MAAM,CAAC;YAC3BhE,SAASsC,cAAc,CAAC,wBAAwByB,UAAUE,IAAI;QAChE;IACF;AACF;AAEA,eAAeglB;IACb,IAAI3d,mBAAmB;QACrB,MAAMkc,yBAAyB;IACjC;AACF;AAEA,eAAe0B;IACb,IAAI,CAAC9d,iBAAiB;QACpBlI,iBAAiB,4BAA4B;QAC7C;IACF;IAEA,MAAMimB,YAAYnpB,SAASsC,cAAc,CACvC;IAEF,MAAM8mB,kBAAkBppB,SAASsC,cAAc,CAC7C;IAEF,MAAM+mB,kBAAkBrpB,SAASsC,cAAc,CAAC;IAChD,MAAM8Z,YAAYpc,SAASsC,cAAc,CAAC;IAC1C,MAAMumB,gBAAgB7oB,SAASsC,cAAc,CAAC;IAC9C,MAAMwmB,YAAY9oB,SAASsC,cAAc,CAAC;IAE1C,IAAI,CAAC8Z,aAAa,CAACyM,iBAAiB,CAACC,WAAW,QAAQ,0BAA0B;IAElF,yDAAyD;IACzD,qFAAqF;IACrF,yEAAyE;IAEzE,IACE,CAACK,aACD,CAACC,mBACD,CAACC,mBACD,CAACjN,aACD,CAACyM,iBACD,CAACC,WACD;QACA5lB,iBAAiB,oCAAoC;QACrD;IACF;IAEAoI,oBAAoB,CAACA;IAErB,IAAIA,mBAAmB;QACrB,6BAA6B;QAC7B,MAAMkc,yBAAyB;IACjC,OAAO;QACL,6BAA6B;QAC7B4B,gBAAgBrlB,SAAS,CAACE,GAAG,CAAC;QAC9BklB,UAAUplB,SAAS,CAACC,MAAM,CAAC;QAE3B,qBAAqB;QACrBoY,UAAU9S,WAAW,GAAG;QACxB8S,UAAUrY,SAAS,CAACC,MAAM,CAAC,iBAAiB;QAC5CoY,UAAUrY,SAAS,CAACE,GAAG,CAAC,iBAAiB;QAEzC,qCAAqC;QACrC4kB,cAAcxM,aAAa,EAAEtY,UAAUC,OAAO;QAC9C8kB,UAAU/kB,SAAS,CAACC,MAAM,CAAC;QAC3BhE,SAASsC,cAAc,CAAC,wBAAwByB,UAAUE,IAAI;QAE9Df,iBAAiB,2BAA2B,QAAQiE;IACtD;AACF;AAEA,uCAAuC;AACvC,SAASmiB,cAAcC,IAAgB;IACrC,MAAMlnB,SAASrC,SAASsC,cAAc,CACpC;IAEF,IAAI,CAACD,UAAU,CAACA,OAAOmnB,aAAa,EAAE;IAEtC,IAAI;QACF,4CAA4C;QAC5CnnB,OAAOmnB,aAAa,CAACC,WAAW,CAC9B;YACEhgB,MAAM;YACN8f,MAAMA;QACR,GACA;QAGFrmB,iBAAiB,CAAC,YAAY,EAAEqmB,KAAK5nB,WAAW,IAAI,EAAE,QAAQ0H;IAChE,EAAE,OAAO/E,OAAgB;QACvBD,QAAQC,KAAK,CAAC,8BAA8BA;IAC9C;AACF;AAEA,+BAA+B;AAC/B,SAASolB;IACP,MAAMrnB,SAASrC,SAASsC,cAAc,CACpC;IAEF,IAAI,CAACD,UAAU,CAACA,OAAOmnB,aAAa,EAAE;IAEtC,IAAI;QACF,yCAAyC;QACzCnnB,OAAOmnB,aAAa,CAACC,WAAW,CAC9B;YACEhgB,MAAM;QACR,GACA;QAGFvG,iBAAiB,qBAAqB,QAAQmG;IAChD,EAAE,OAAO/E,OAAgB;QACvBD,QAAQC,KAAK,CAAC,2BAA2BA;IAC3C;AACF;AAWA,oDAAoD;AACpD,IAAIqlB,eAA+B;IAAC;QAAEjlB,IAAI;QAAQ+E,MAAM;QAAQhJ,MAAM;QAAQmpB,UAAU;IAAK;CAAE;AAC/F,IAAIC,mBAA2B;AAE/B,MAAMC,qBAAqB,CAACplB;IAC1B,IAAIA,OAAO,QAAQ,QAAQ,qBAAqB;IAEhD,4CAA4C;IAC5C,MAAMqlB,WAAWJ,aAAaK,MAAM,CAAC1E,CAAAA,IAAKA,EAAEsE,QAAQ,KAAKllB;IACzDqlB,SAAS7X,OAAO,CAAC+X,CAAAA,QAASH,mBAAmBG,MAAMvlB,EAAE;IAErD,mBAAmB;IACnBilB,eAAeA,aAAaK,MAAM,CAAC1E,CAAAA,IAAKA,EAAE5gB,EAAE,KAAKA;IAEjD,kFAAkF;IAClF,IAAI,CAACilB,aAAaO,IAAI,CAAC5E,CAAAA,IAAKA,EAAE5gB,EAAE,KAAKmlB,mBAAmB;QACtDM,mBAAmB;IACrB,OAAO;QACLC;IACF;AACF;AACCzqB,OAAemqB,kBAAkB,GAAGA;AAErC,MAAMM,iBAAiB;IACrB,MAAMrV,YAAY/U,SAASsC,cAAc,CAAC;IAC1C,IAAI,CAACyS,WAAW;IAEhB,kBAAkB;IAClBA,UAAUlS,SAAS,GAAG;IAEtB,iDAAiD;IACjD8mB,aAAazX,OAAO,CAAC,CAACmY,MAAMlY;QAC1B,yCAAyC;QACzC,MAAMmY,UAAUtqB,SAASC,aAAa,CAAC;QACvC,MAAMsqB,WAAWF,KAAK3lB,EAAE,KAAKmlB;QAE7B,8BAA8B;QAC9B,MAAMW,gBAAgB;QACtB,MAAMC,kBAAkB;QAExBH,QAAQ7U,SAAS,GAAG,CAAC,iFAAiF,EAAE8U,WAAWC,gBAAgBC,iBAAiB;QAEpJ,qBAAqB;QACrB,IAAI/V,OAAO;QACX,IAAI2V,KAAK5gB,IAAI,KAAK,QAAQiL,OAAO,CAAC,oTAAoT,CAAC;aAClV,IAAI2V,KAAK5gB,IAAI,KAAK,WAAWiL,OAAO,CAAC,8TAA8T,CAAC;aACpWA,OAAO,CAAC,0IAA0I,CAAC;QAExJ,uBAAuB;QACvB,MAAMgW,YAAY1qB,SAASC,aAAa,CAAC;QACzC,MAAM0qB,YAAYN,KAAK5gB,IAAI,KAAK;QAChC,mFAAmF;QACnF,MAAMmhB,eAAeD,YAAY,wBAAwB;QACzD,aAAa;QACb,MAAME,YAAYN,WAAW,eAAe;QAE5CG,UAAUjV,SAAS,GAAG,CAAC,oCAAoC,EAAEmV,aAAa,CAAC,EAAEC,UAAU,8GAA8G,CAAC;QACtMH,UAAU7nB,SAAS,GAAG,GAAG6R,KAAK,OAAO,EAAE2V,KAAK5pB,IAAI,CAAC,OAAO,CAAC;QACzDiqB,UAAUlU,OAAO,GAAG,IAAM2T,mBAAmBE,KAAK3lB,EAAE;QACpD4lB,QAAQ/pB,WAAW,CAACmqB;QAEpB,0BAA0B;QAC1B,IAAIC,WAAW;YACb,MAAMG,SAAS9qB,SAASC,aAAa,CAAC;YACtC,MAAM8qB,eAAeR,WAAW,mCAAmC;YAEnEO,OAAOrV,SAAS,GAAG,CAAC,yKAAyK,EAAEsV,cAAc;YAC7M,aAAa;YACbD,OAAOjoB,SAAS,GAAG,CAAC,6VAA6V,CAAC;YAClXioB,OAAO/nB,YAAY,CAAC,cAAc,CAAC,OAAO,EAAEsnB,KAAK5pB,IAAI,EAAE;YACvDqqB,OAAOnU,KAAK,GAAG;YAEfmU,OAAOtU,OAAO,GAAG,CAACpS;gBAChBA,EAAEqS,eAAe;gBACjB,IAAIuU,QAAQ,CAAC,OAAO,EAAEX,KAAK5pB,IAAI,CAAC,wCAAwC,CAAC,GAAG;oBAC1EqpB,mBAAmBO,KAAK3lB,EAAE;gBAC5B;YACF;YACA4lB,QAAQ/pB,WAAW,CAACuqB;QACtB;QAEA/V,UAAUxU,WAAW,CAAC+pB;QAEtB,0BAA0B;QAC1B,IAAInY,QAAQwX,aAAaziB,MAAM,GAAG,GAAG;YACnC,MAAMwU,OAAO1b,SAASC,aAAa,CAAC;YACpCyb,KAAKjG,SAAS,GAAG;YACjBV,UAAUxU,WAAW,CAACmb;QACxB;QAEA,8DAA8D;QAC9D,IAAI2O,KAAK3lB,EAAE,KAAKmlB,kBAAkB;YAChC,MAAMnO,OAAO1b,SAASC,aAAa,CAAC;YACpCyb,KAAKjG,SAAS,GAAG;YACjBV,UAAUxU,WAAW,CAACmb;YAEtB,MAAMuP,SAASjrB,SAASC,aAAa,CAAC;YACtCgrB,OAAOxV,SAAS,GAAG;YACnBwV,OAAOpoB,SAAS,GAAG;YACnBooB,OAAOtU,KAAK,GAAG;YACf5B,UAAUxU,WAAW,CAAC0qB;QACxB;IACF;AACF;AAEA,MAAMd,qBAAqB,CAACzlB;IAC1BmlB,mBAAmBnlB;IACnB,MAAM2lB,OAAOV,aAAaO,IAAI,CAAC5E,CAAAA,IAAKA,EAAE5gB,EAAE,KAAKA;IAC7C,IAAI,CAAC2lB,MAAM;IAEXD;IAEA,4BAA4B;IAC5B,MAAMc,UAAUlrB,SAASsC,cAAc,CAAC;IACxC,MAAM6oB,UAAUnrB,SAASsC,cAAc,CAAC;IAExC,IAAI,CAAC4oB,WAAW,CAACC,SAAS;IAE1B,mDAAmD;IACnD,IAAId,KAAK5gB,IAAI,KAAK,WAAW;QAC3ByhB,QAAQnnB,SAAS,CAACE,GAAG,CAAC;QACtBknB,QAAQpnB,SAAS,CAACC,MAAM,CAAC;QACzBsQ,mBAAmB,mBAAmB;IACxC,OAYK,IAAI+V,KAAK5gB,IAAI,KAAK,QAAQ;QAC7B,gDAAgD;QAChDyhB,QAAQnnB,SAAS,CAACC,MAAM,CAAC;QACzBmnB,QAAQpnB,SAAS,CAACE,GAAG,CAAC;IACxB,OACK;QACH,8BAA8B;QAC9BinB,QAAQnnB,SAAS,CAACE,GAAG,CAAC;QACtBknB,QAAQpnB,SAAS,CAACE,GAAG,CAAC;IACtB,2CAA2C;IAC7C;AACF;AAEA,MAAMmnB,iBAAiB,CAAC7B;IACtB,IAAIA,SAAS,WAAW;QACtB,yCAAyC;QACzC,MAAM8B,YAAY,CAAC,QAAQ,EAAEzhB,KAAKD,GAAG,IAAI;QACzCggB,aAAaznB,IAAI,CAAC;YAChBwC,IAAI2mB;YACJ5hB,MAAM;YACNhJ,MAAM;YACNmpB,UAAUC;QACZ;QACAM,mBAAmBkB;IACrB,OAAO;QACL,qCAAqC;QACrC,4CAA4C;QAC5C,4CAA4C;QAC5C,MAAM3O,UAAUiN,aAAaO,IAAI,CAAC5E,CAAAA,IAAKA,EAAE5gB,EAAE,KAAKmlB;QAChD,IAAInN,WAAWA,QAAQkN,QAAQ,EAAE;YAC/BO,mBAAmBzN,QAAQkN,QAAQ;QACrC,OAAO;YACLO,mBAAmB;QACrB;IACF;AACF;AACCxqB,OAAeyrB,cAAc,GAAGA;AAEjC,MAAM9W,kBAAkB,OAAO3R;IAC7B2oB,mBAAmB3oB;AACrB;AAEA,MAAM2oB,qBAAqB,OAAO3oB;IAChC,IAAI,CAACuI,YAAY;QACfhI,iBAAiB,6CAA6C,WAAWsI;QACzE;IACF;IAEA,MAAM9I,MAAMC;IACZ,IAAIuY,eAAe;IAEnB,IAAIxY,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIK,YAAY,CAAC,aAAa;QAC9BL,IAAIqB,SAAS,CAACE,GAAG,CAAC,cAAc;QAChCvB,IAAIG,SAAS,GAAG,CAAC,8VAA8V,CAAC;IAClX;IAEA,IAAI;QACF,MAAMO,MAAM,MAAMtC,MAAM,CAAC,+BAA+B,EAAEkb,mBAAmB9Q,aAAa;QAC1F,MAAM+F,OAAO,MAAM7N,IAAI+V,IAAI;QAC3B,MAAMtQ,SAAS7I,SAASsC,cAAc,CAAC;QACvC,IAAIuG,UAAUoI,KAAKmW,MAAM,EAAE;YACzB,IAAInW,KAAKmW,MAAM,CAAClgB,MAAM,KAAK,GAAG;gBAC5B2B,OAAOhG,SAAS,GAAG;YACrB,OAAO;gBACLgG,OAAOhG,SAAS,GAAG;gBACnBoO,KAAKmW,MAAM,CAAClV,OAAO,CAAC,CAACmV;oBACnB,MAAMzK,MAAM5c,SAASC,aAAa,CAAC;oBACnC2c,IAAIrU,KAAK,GAAG8e,EAAEC,IAAI;oBAAE1K,IAAItT,WAAW,GAAG+d,EAAE5mB,IAAI;oBAAEoI,OAAOtI,WAAW,CAACqc;gBACnE;YACF;QACF;QACA,IAAIla,KAAKQ,iBAAiB,2BAA2B,WAAWiE;IAClE,EAAE,OAAO/C,GAAG;QACVC,QAAQC,KAAK,CAACF;QACd,IAAI1B,KAAKQ,iBAAiB,8BAA8B;IAC1D,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAI8B,eAAe,CAAC;YACpB9B,IAAIqB,SAAS,CAACC,MAAM,CAAC,cAAc;YACnCtB,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AAEA,MAAMqQ,mBAAmB,OAAOC;AAC9B,OAAO;AACT;AACA,MAAMC,oBAAoB,WAAc;AACxC,MAAMC,iBAAiB;IACrB,MAAMC,gBAAgB3rB,SAASsC,cAAc,CAAC;IAC9C,IAAIspB,aAAa;IAEjB,IAAID,iBAAiBA,cAAcpjB,KAAK,EAAE;QACxCqjB,aAAaD,cAAcpjB,KAAK;IAClC;IAEA,IAAI,CAACqjB,YAAY;QACf1oB,iBAAiB,qCAAqC;QACtD;IACF;IAEA,+BAA+B;IAC/B,MAAMR,MAAM1C,SAASsC,cAAc,CAAC;IACpC,IAAI4Y,eAAe;IACnB,IAAIxY,KAAK;QACPwY,eAAexY,IAAIG,SAAS;QAC5BH,IAAII,QAAQ,GAAG;QACfJ,IAAIG,SAAS,GAAG,CAAC,2VAA2V,CAAC;IAC/W;IAEA,IAAI;QACF,MAAMtD,gBAAgBqsB;QACtB1oB,iBAAiB,qCAAqC;IACxD,EAAE,OAAOkB,GAAG;QACVC,QAAQC,KAAK,CAACF;QACdlB,iBAAiB,gCAAgC;IACnD,SAAU;QACR,IAAIR,KAAK;YACPA,IAAII,QAAQ,GAAG;YACfJ,IAAIG,SAAS,GAAGqY;QAClB;IACF;AACF;AACCvb,OAAe+rB,cAAc,GAAGA;AAGjC,uBAAuB;AACvB,MAAMG,qBAAqB;IACzB,MAAM/U,QAAQ9W,SAASC,aAAa,CAAC;IACrC6W,MAAMpS,EAAE,GAAG;IACXoS,MAAMrB,SAAS,GAAG;IAClBqB,MAAMjU,SAAS,GAAG,CAAC;;;;;;EAMnB,CAAC;IACD7C,SAASsD,IAAI,CAAC/C,WAAW,CAACuW;IAE1B,MAAMgV,aAAa;QACjB,IAAI;YACF,MAAMhT,WAAW,MAAMhY,MAAM;YAC7B,MAAMmQ,OAAO,MAAM6H,SAASK,IAAI;YAChC,MAAM4S,YAAY/rB,SAASsC,cAAc,CAAC;YAC1C,IAAIypB,WAAWA,UAAUziB,WAAW,GAAG2H,KAAKxL,OAAO;YACnD,IAAIwL,KAAKtN,MAAM,KAAK,aAAa;gBAC/BmT,MAAM9S,MAAM;gBACZ;YACF,OAAO,IAAIiN,KAAKtN,MAAM,KAAK,UAAU;gBACnC,IAAIooB,WAAW;oBACbA,UAAUtW,SAAS,GAAG;oBACtBsW,UAAUziB,WAAW,GAAG,CAAC,OAAO,EAAE2H,KAAKxL,OAAO,CAAC,2BAA2B,CAAC;gBAC7E;gBACA;YACF;YACA8B,WAAWukB,YAAY;QACzB,EAAE,OAAO1nB,GAAG;YACVmD,WAAWukB,YAAY;QACzB;IACF;IACA,MAAMA;AACR;AAEA,aAAa;AACbnsB,OAAOQ,MAAM,GAAG;IACd,IAAI;QAAE,MAAM0rB;IAAsB,EAAE,OAAOznB,GAAG;QAAEC,QAAQC,KAAK,CAACF;IAAI;IAElE,MAAMqC,YAAYzG,SAASsC,cAAc,CAAC;IAC1C,IAAImE,WAAW;QACb,cAAc;QACd,MAAMulB,WAAWllB,aAAamlB,OAAO,CAACjlB;QACtC,IAAIglB,UAAU;YACZvlB,UAAU5D,SAAS,GAAGmpB;YACtBnlB,gBAAgBmlB,UAAU,qCAAqC;YAC/DvlB,UAAUmE,SAAS,GAAGnE,UAAU6T,YAAY;QAC9C;IACF;IAEA,IAAI;QACF,MAAM4R,eAAe,MAAMpU,eAAiC;QAC5D,MAAMqU,mBAAmB,MAAMrU,eAAqC;QACpE/M,UAAUmhB,aAAanhB,OAAO;QAC9B,MAAMmZ,eAAelkB,SAASsC,cAAc,CAAC;QAC7C,IAAI4hB,cAAcA,aAAa3b,KAAK,GAAGwC;QACvCC,cAAcmhB,iBAAiBnhB,WAAW;QAC1CC,kBAAkBkhB,iBAAiBlhB,eAAe;QAClD,MAAMkQ,oBAAoBnb,SAASsC,cAAc,CAAC;QAClD,IAAI6Y,mBAAmBA,kBAAkB5S,KAAK,GAAG,GAAGyC,YAAY,UAAU,EAAEC,iBAAiB;QAE7F,aAAa;QACb,MAAM0Q;QACN,MAAMyQ,YAAYtlB,aAAamlB,OAAO,CAAC;QACvC,IAAIG,WAAW;YACb,MAAMvjB,SAAS7I,SAASsC,cAAc,CAAC;YACvC,IAAI+pB,SAAS;YACb,IAAK,IAAIpnB,IAAI,GAAGA,IAAI4D,OAAOkP,OAAO,CAAC7Q,MAAM,EAAEjC,IAAK;gBAC9C,IAAI4D,OAAOkP,OAAO,CAAC9S,EAAE,CAACsD,KAAK,KAAK6jB,WAAW;oBAAEC,SAAS;oBAAM;gBAAO;YACrE;YACA,IAAIA,QAAQ;gBACVxjB,OAAON,KAAK,GAAG6jB;gBACflhB,aAAakhB;gBACb7P;YACF;QACF;IAEA,wDAAwD;IACxD,MAAM;IAER,EAAE,OAAOnY,GAAG;QAAEC,QAAQC,KAAK,CAACF;IAAI;AAClC;AAMA,UAAU;AACTzE,OAAe4S,UAAU,GAAGA;AAC5B5S,OAAeskB,OAAO,GAAGA;AACzBtkB,OAAeob,eAAe,GAAGA;AACjCpb,OAAe0b,YAAY,GAAGA;AAC9B1b,OAAemd,aAAa,GAAGA;AAC/Bnd,OAAemc,UAAU,GAAGA;AAC5Bnc,OAAegc,eAAe,GAAGA;AACjChc,OAAe0kB,cAAc,GAAGA;AAChC1kB,OAAeslB,cAAc,GAAGA;AAChCtlB,OAAeulB,gBAAgB,GAAGA;AAClCvlB,OAAegmB,sBAAsB,GAAGA;AACxChmB,OAAemmB,qBAAqB,GAAGA;AACvCnmB,OAAe2mB,yBAAyB,GAAGA;AAC3C3mB,OAAeinB,eAAe,GAAGA;AACjCjnB,OAAeqnB,qBAAqB,GAAGA;AACvCrnB,OAAesnB,iBAAiB,GAAGA;AACnCtnB,OAAeoU,eAAe,GAAGA;AACjCpU,OAAe4nB,qBAAqB,GAAGA;AACvC5nB,OAAe8nB,cAAc,GAAGA;AAChC9nB,OAAeunB,YAAY,GAAGA;AAC9BvnB,OAAe2U,eAAe,GAAGA;AACjC3U,OAAe6f,eAAe,GAAGA;AACjC7f,OAAeud,UAAU,GAAGA;AAC5Bvd,OAAeqd,iBAAiB,GAAGA;AACnCrd,OAAeupB,qBAAqB,GAAGA;AACvCvpB,OAAe2pB,aAAa,GAAGA;AAC/B3pB,OAAe+pB,WAAW,GAAGA;AAC7B/pB,OAAeoS,gBAAgB,GAAGA;AAClCpS,OAAe8rB,iBAAiB,GAAGA;AACnC9rB,OAAe+rB,cAAc,GAAGA;AAChC/rB,OAAeN,gBAAgB,GAAGC;AAClCK,OAAe2Q,iBAAiB,GAAGA;AACnC3Q,OAAeuD,gBAAgB,GAAGA;AAClCvD,OAAe4rB,gBAAgB,GAAGA;AAClC5rB,OAAe6G,QAAQ,GAAGA;AAC1B7G,OAAeuJ,kBAAkB,GAAGA;AACpCvJ,OAAeyJ,WAAW,GAAGA;AAC7BzJ,OAAe4K,oBAAoB,GAAGA;AACtC5K,OAAe+K,kBAAkB,GAAGA;AACpC/K,OAAekL,iBAAiB,GAAGA;AACnClL,OAAemL,kBAAkB,GAAGA;AACpCnL,OAAeif,WAAW,GAAGA;AAC7Bjf,OAAesc,aAAa,GAAGA;AAGhC,MAAMjb,OAAO;IACX,iDAAiD;IACjD,MAAMorB,YAAYtlB,aAAamlB,OAAO,CAAC;IACvC,IAAIG,WAAW;QACblhB,aAAakhB;IACf;IACA7P;IAEA,wEAAwE;IACxE,MAAMjB,iBAAiBtb,SAASsC,cAAc,CAAC;IAC/C,IAAIgZ,gBAAgB;QAClB,UAAU;QACV,MAAMgR,gBAAgBxlB,aAAamlB,OAAO,CAAC;QAC3C,IAAIK,eAAe;YACjB,yBAAyB;YACzB,IAAID,SAAS;YACb,IAAK,IAAIpnB,IAAI,GAAGA,IAAIqW,eAAevD,OAAO,CAAC7Q,MAAM,EAAEjC,IAAK;gBACtD,IAAIqW,eAAevD,OAAO,CAAC9S,EAAE,CAACsD,KAAK,KAAK+jB,eAAe;oBACrDD,SAAS;oBACT;gBACF;YACF;YACA,IAAIA,QAAQ;gBACV/Q,eAAe/S,KAAK,GAAG+jB;gBACvBjoB,QAAQe,GAAG,CAAC,uCAAuCknB;YACrD,OAAO;gBACLjoB,QAAQ2I,IAAI,CAAC,+CAA+Csf;YAC9D;QACF;QAEA,iBAAiB;QACjBhR,eAAezD,gBAAgB,CAAC,UAAU,CAACzT;YACzC,MAAMmoB,SAASnoB,EAAEmoB,MAAM;YACvBzlB,aAAaiG,OAAO,CAAC,wBAAwBwf,OAAOhkB,KAAK;QAC3D;IACF;IAEA,kCAAkC;IAClC,MAAM+e,OAAO3nB,OAAO6B,QAAQ,CAACkR,QAAQ;IACrC,IAAI8Z,cAAc;IAClB,IAAIlF,SAAS,OAAOA,SAAS,IAAI;QAC/B,MAAM9U,WAAW8U,KAAKxM,SAAS,CAAC,GAAGxU,WAAW,IAAI,uBAAuB;QACzE,6BAA6B;QAC7B,MAAMwM,QAAQ;YAAC;YAAS;YAAY;YAAW;YAAc;YAAO;YAAS;SAAO;QACpF,IAAIA,MAAMvM,QAAQ,CAACiM,WAAW;YAC5Bga,cAAcha;QAChB;IACF;IAEA,sCAAsC;IACtC7S,OAAO8sB,UAAU,GAAG,CAACC;QACnB,IAAIA,MAAMC,KAAK,IAAID,MAAMC,KAAK,CAAC9Z,IAAI,EAAE;YACnCN,WAAWma,MAAMC,KAAK,CAAC9Z,IAAI,EAAE;QAC/B,OAAO;YACL,sEAAsE;YACtE,0BAA0B;YAC1B,MAAMkO,IAAIphB,OAAO6B,QAAQ,CAACkR,QAAQ,CAACoI,SAAS,CAAC,GAAGxU,WAAW,MAAM;YACjEiM,WAAWwO,GAAG;QAChB;IACF;IAEA,iEAAiE;IACjExO,WAAWia,aAAa;IAExB,MAAMI,aAAa;QACjB;YAAEloB,IAAI;YAAamoB,UAAU;YAAoBC,SAAS,IAAMva,WAAW;QAAS;QACpF;YAAE7N,IAAI;YAAWmoB,UAAU;YAAkBC,SAAS,IAAMva,WAAW;QAAO;QAC9E;YAAE7N,IAAI;YAAgBmoB,UAAU;YAAuBC,SAAS,IAAMva,WAAW;QAAY;QAC7F;YAAE7N,IAAI;YAAemoB,UAAU;YAAsBC,SAAS,IAAMva,WAAW;QAAW;QAC1F;YAAE7N,IAAI;YAAkBmoB,UAAU;YAAyBC,SAAS,IAAMva,WAAW;QAAc;QACnG;YAAE7N,IAAI;YAAamoB,UAAU;YAAoBC,SAAS,IAAMva,WAAW;QAAS;QACpF;YAAE7N,IAAI;YAAYmoB,UAAU;YAAmBC,SAAS,IAAMva,WAAW;QAAQ;KAClF;IAEDqa,WAAW1a,OAAO,CAAC,CAAC,EAAExN,EAAE,EAAEmoB,QAAQ,EAAEC,OAAO,EAAE;QAC3C,MAAMC,SAAS/sB,SAASsC,cAAc,CAACoC;QACvC,IAAIqoB,QAAQA,OAAOlV,gBAAgB,CAAC,SAASiV;QAE7C,MAAME,eAAehtB,SAASsC,cAAc,CAACuqB;QAC7C,IAAIG,cAAc;YAChBA,aAAanV,gBAAgB,CAAC,SAAS;gBACrCiV;gBACAvY,mBAAmB;YACrB;QACF;IACF;IAEA,MAAM0Y,kBAAkBjtB,SAASsC,cAAc,CAAC;IAChD,IAAI2qB,iBAAiBA,gBAAgBpV,gBAAgB,CAAC,SAASwD;IAE/D,2BAA2B;IAC3B,MAAM6R,eAAeltB,SAASsC,cAAc,CAAC;IAC7C,IAAI4qB,cAAc;QAChB,MAAMC,MAAMD,aAAanlB,YAAY,CAAC;QACtC,IAAIolB,KAAK;YACPjqB,iBAAiBiqB,KAAK,SAAS3hB;QACjC;IACF;IAEA,2EAA2E;IAC3ExL,SAAS6X,gBAAgB,CAAC,oBAAoB;QAC5C,IAAI,CAAC7X,SAAS4f,MAAM,IAAI3T,gBAAgBK,iBAAiB;YACvD,IAAI,CAACH,iBAAiB;gBACpBwS;YACF,OAAO;gBACLvS,oBAAoB;YACtB;QACF;IACF;IAEA,mCAAmC;IACnC,MAAMghB,kBAAkBptB,SAASsC,cAAc,CAAC;IAChD,IAAI8qB,iBAAiB;QACnBA,gBAAgBvV,gBAAgB,CAAC,UAAUoR;IAC7C;IAEA,MAAMoE,iBAAiBrtB,SAASsC,cAAc,CAAC;IAC/C,IAAI+qB,gBAAgB;QAClBA,eAAexV,gBAAgB,CAAC,UAAUoR;IAC5C;IAEA,4BAA4B;IAC5B;QAAC;QAAW;QAAa;QAAS;QAAS;KAAc,CAAC/W,OAAO,CAACob;IAElE,6BAA6B;IAC7B3tB,OAAOkY,gBAAgB,CAAC,UAAU0V;IAElCC;IACAC;IACAC;IACAC;IACAC;AACF;AAEA,gFAAgF;AAChF,MAAMD,wBAAwB;IAC5B,MAAME,YAAY7tB,SAASsC,cAAc,CAAC;IAC1C,MAAMwrB,eAAe9tB,SAASsC,cAAc,CAAC;IAE7C,IAAI,CAACurB,aAAa,CAACC,cAAc;IAEjC,MAAMC,cAAc;QAClB,MAAMC,YAAYH,UAAUlG,OAAO;QACnCmG,aAAahrB,QAAQ,GAAG,CAACkrB;QACzB,IAAI,CAACA,WAAW;YACdF,aAAa/pB,SAAS,CAACE,GAAG,CAAC,sBAAsB,cAAc;YAC/D6pB,aAAa/qB,YAAY,CAAC,iBAAiB;QAC7C,OAAO;YACL+qB,aAAa/pB,SAAS,CAACC,MAAM,CAAC,sBAAsB,cAAc;YAClE8pB,aAAatpB,eAAe,CAAC;QAC/B;IACF;IAEAqpB,UAAUhW,gBAAgB,CAAC,UAAUkW;IACrCA,eAAe,mBAAmB;AACpC;AAEA,MAAMR,eAAe;IACnB,MAAMU,SAASjuB,SAASsC,cAAc,CAAC;IACvC,IAAI,CAAC2rB,QAAQ;IAEb,IAAItuB,OAAOuuB,OAAO,GAAG,IAAI;QACvB,IAAID,OAAOlqB,SAAS,CAAC8Q,QAAQ,CAAC,UAAU;YACtCoZ,OAAOlqB,SAAS,CAACC,MAAM,CAAC;YACxBiqB,OAAOlqB,SAAS,CAACE,GAAG,CAAC;QACvB;IACF,OAAO;QACL,IAAIgqB,OAAOlqB,SAAS,CAAC8Q,QAAQ,CAAC,eAAe;YAC3CoZ,OAAOlqB,SAAS,CAACC,MAAM,CAAC;YACxBiqB,OAAOlqB,SAAS,CAACE,GAAG,CAAC;QACvB;IACF;AACF;AAEA,6CAA6C;AAC7C,MAAMqpB,6BAA6B,CAAC7lB;IAClC,MAAME,KAAK3H,SAASsC,cAAc,CAACmF;IACnC,IAAIE,IAAI;QACN,8DAA8D;QAC9D,IAAI,CAACA,GAAG5D,SAAS,CAAC8Q,QAAQ,CAAC,sBAAsB;YAC/ClN,GAAG5D,SAAS,CAACE,GAAG,CAAC,qBAAqB;QACxC;QAEA0D,GAAGkQ,gBAAgB,CAAC,QAAQ;YAC1B,IAAIgF,MAAMlV,GAAGY,KAAK;YAClB,6BAA6B;YAC7BsU,MAAMA,IAAI9S,OAAO,CAAC,MAAM;YACxB,2BAA2B;YAC3B8S,MAAMA,IAAI9S,OAAO,CAAC,QAAQ;YAC1B8S,MAAMA,IAAIhV,IAAI;YAEd,IAAIgV,QAAQlV,GAAGY,KAAK,IAAIsU,IAAI3V,MAAM,GAAG,GAAG;gBACtCS,GAAGY,KAAK,GAAGsU;gBAEX,iEAAiE;gBACjE,oBAAoB;gBACpB,MAAMsR,kBAAkBxmB,GAAG8N,SAAS;gBACpC9N,GAAG5D,SAAS,CAACE,GAAG,CAAC,oBAAoB,UAAU,kBAAkB;gBAEjE,gCAAgC;gBAChC,MAAMmqB,SAASzmB,GAAGI,YAAY,CAAC;gBAC/B,MAAMsmB,SAASD,SAASpuB,SAASsC,cAAc,CAAC8rB,UAAU;gBAE1D,IAAIC,QAAQ;oBACV,sEAAsE;oBACtE,IAAI,CAACA,OAAO7jB,OAAO,CAAC0Q,YAAY,EAAE;wBAChCmT,OAAO7jB,OAAO,CAAC0Q,YAAY,GAAGmT,OAAO/kB,WAAW,IAAI;wBACpD+kB,OAAO7jB,OAAO,CAAC8jB,aAAa,GAAGD,OAAO5Y,SAAS;oBACjD;oBAEA,kCAAkC;oBAClC,IAAI4Y,OAAO7jB,OAAO,CAAC+jB,YAAY,EAAE;wBAC/BrhB,aAAawJ,SAAS2X,OAAO7jB,OAAO,CAAC+jB,YAAY,EAAE;oBACrD;oBAEA,qBAAqB;oBACrBF,OAAO/kB,WAAW,GAAG;oBACrB+kB,OAAO5Y,SAAS,GAAG;oBACnB4Y,OAAO7lB,KAAK,CAAC4H,OAAO,GAAG;oBAEvB,gDAAgD;oBAChD,MAAMiG,UAAU1W,OAAO4H,UAAU,CAAC;wBAChCI,GAAG5D,SAAS,CAACC,MAAM,CAAC,oBAAoB,UAAU,kBAAkB;wBAEpE,qBAAqB;wBACrBqqB,OAAO7lB,KAAK,CAAC4H,OAAO,GAAG;wBAEvB7I,WAAW;4BACT,6BAA6B;4BAC7B8mB,OAAO/kB,WAAW,GAAG+kB,OAAO7jB,OAAO,CAAC0Q,YAAY,IAAI;4BACpDmT,OAAO5Y,SAAS,GAAG4Y,OAAO7jB,OAAO,CAAC8jB,aAAa,IAAI;4BACnDD,OAAO7lB,KAAK,CAAC4H,OAAO,GAAG;4BAEvB,0BAA0B;4BAC1B,OAAOie,OAAO7jB,OAAO,CAAC0Q,YAAY;4BAClC,OAAOmT,OAAO7jB,OAAO,CAAC8jB,aAAa;4BACnC,OAAOD,OAAO7jB,OAAO,CAAC+jB,YAAY;wBACpC,GAAG;oBACL,GAAG;oBAEHF,OAAO7jB,OAAO,CAAC+jB,YAAY,GAAGlY,QAAQlV,QAAQ;gBAChD,OAAO;oBACL,2CAA2C;oBAC3CoG,WAAW;wBACTI,GAAG5D,SAAS,CAACC,MAAM,CAAC,oBAAoB,UAAU,kBAAkB;oBACtE,GAAG;gBACL;YACF;QACF;IACF;AACF;AAEA,yBAAyB;AACzB,MAAMwqB,oBAAoB;IACxB,MAAMpV,SAASpZ,SAASsC,cAAc,CAAC;IACvC,IAAI8W,QAAQ;QACV,iEAAiE;QACjE,IAAI;YACFA,OAAOqV,QAAQ,CAAC;gBAAE9lB,KAAKyQ,OAAOkB,YAAY;gBAAEoU,UAAU;YAAS;QACjE,EAAE,OAAOtqB,GAAG;YACV,8BAA8B;YAC9BgV,OAAOxO,SAAS,GAAGwO,OAAOkB,YAAY;QACxC;IACF;AACF;AACC3a,OAAe6uB,iBAAiB,GAAGA;AAEpC,sBAAsB;AACtB,MAAMG,iBAAiB;IACrB,MAAMvV,SAASpZ,SAASsC,cAAc,CAAC;IACvC,IAAI8W,QAAQ;QACV,IAAI;YACFA,OAAOqV,QAAQ,CAAC;gBAAE9lB,KAAK;gBAAG+lB,UAAU;YAAS;QAC/C,EAAE,OAAOtqB,GAAG;YACVgV,OAAOxO,SAAS,GAAG;QACrB;IACF;AACF;AACCjL,OAAegvB,cAAc,GAAGA;AAEjC,MAAMnB,wBAAwB;IAC5B,MAAMpU,SAASpZ,SAASsC,cAAc,CAAC;IACvC,MAAMssB,YAAY5uB,SAASsC,cAAc,CAAC;IAC1C,MAAMusB,SAAS7uB,SAASsC,cAAc,CAAC;IAEvC,IAAI,CAAC8W,QAAQ;IAEb,MAAM0V,kBAAkB;QACtB,gCAAgC;QAChC,IAAIF,WAAW;YACb,MAAMG,mBAAmB3V,OAAOkB,YAAY,GAAGlB,OAAOxO,SAAS,GAAGwO,OAAOzH,YAAY;YACrF,iFAAiF;YACjF,MAAMqd,mBAAmBD,mBAAmB;YAE5C,IAAIC,kBAAkB;gBACpBJ,UAAU7qB,SAAS,CAACC,MAAM,CAAC,aAAa,iBAAiB;gBACzD4qB,UAAU7qB,SAAS,CAACE,GAAG,CAAC,eAAe,iBAAiB;YAC1D,OAAO;gBACL2qB,UAAU7qB,SAAS,CAACE,GAAG,CAAC,aAAa,iBAAiB;gBACtD2qB,UAAU7qB,SAAS,CAACC,MAAM,CAAC,eAAe,iBAAiB;YAC7D;QACF;QAEA,6BAA6B;QAC7B,IAAI6qB,QAAQ;YACV,MAAMI,gBAAgB7V,OAAOxO,SAAS,GAAG;YAEzC,IAAIqkB,eAAe;gBACjBJ,OAAO9qB,SAAS,CAACC,MAAM,CAAC,aAAa,iBAAiB;gBACtD6qB,OAAO9qB,SAAS,CAACE,GAAG,CAAC,eAAe,iBAAiB;YACvD,OAAO;gBACL4qB,OAAO9qB,SAAS,CAACE,GAAG,CAAC,aAAa,iBAAiB;gBACnD4qB,OAAO9qB,SAAS,CAACC,MAAM,CAAC,eAAe,iBAAiB;YAC1D;QACF;IACF;IAEA,IAAIkrB,UAAU;IACd9V,OAAOvB,gBAAgB,CAAC,UAAU;QAChC,IAAI,CAACqX,SAAS;YACZvvB,OAAOoW,qBAAqB,CAAC;gBAC3B+Y;gBACAI,UAAU;YACZ;YACAA,UAAU;QACZ;IACF;AACF;AAEA,MAAMxB,sBAAsB;IAC1B1tB,SAAS6X,gBAAgB,CAAC,SAAS,CAACzT;QAClC,gEAAgE;QAChE,MAAMmoB,SAAS,AAACnoB,EAAEmoB,MAAM,CAAiB4C,OAAO,CAAC;QACjD,IAAI,CAAC5C,QAAQ;QAEb,MAAM1oB,OAAO0oB,OAAOjjB,WAAW,EAAEzB;QACjC,IAAI,CAAChE,MAAM;QAEX,iCAAiC;QACjCO,EAAEkT,cAAc;QAEhB,MAAMnT,YAAY;YAChBjB,iBAAiB,gBAAgB,WAAWmG;YAE5C,kBAAkB;YAClBkjB,OAAOxoB,SAAS,CAACE,GAAG,CAAC,gBAAgB;YACrCsoB,OAAOxoB,SAAS,CAACC,MAAM,CAAC,qBAAqB;YAE7CuD,WAAW;gBACTglB,OAAOxoB,SAAS,CAACC,MAAM,CAAC,gBAAgB;gBACxCuoB,OAAOxoB,SAAS,CAACE,GAAG,CAAC,qBAAqB;YAC5C,GAAG;QACL;QAEA,IAAI+D,UAAUC,SAAS,IAAID,UAAUC,SAAS,CAACC,SAAS,EAAE;YACxDF,UAAUC,SAAS,CAACC,SAAS,CAACrE,MAAMsE,IAAI,CAAChE,WAAWiE,KAAK,CAAC,IAAMC,iBAAiBxE,MAAM,gBAAgBM;QACzG,OAAO;YACLkE,iBAAiBxE,MAAM,gBAAgBM;QACzC;IACF;AACF;AAEA,8BAA8B;AAE9B,IAAIirB,sBAA2C;AAC/C,IAAIC,oBAAmC;AAEtC1vB,OAAe2vB,kBAAkB,GAAG;IACnC,MAAM7a,OAAOzU,SAASsC,cAAc,CAAC;IACrC,MAAMI,MAAM1C,SAASsC,cAAc,CAAC;IAEpC,IAAI,CAACmS,MAAM;IAEX,MAAM8a,YAAY;QAChB9a,KAAK1Q,SAAS,CAACE,GAAG,CAAC;QACnB,IAAIvB,KAAKA,IAAIK,YAAY,CAAC,iBAAiB;QAE3C,IAAIssB,sBAAsB,MAAM;YAC9BniB,aAAamiB;YACbA,oBAAoB;QACtB;QAEA,IAAID,qBAAqB;YACvBA;YACAA,sBAAsB;QACxB;IACF;IAEA,MAAMxa,WAAWH,KAAK1Q,SAAS,CAAC8Q,QAAQ,CAAC;IAEzC,IAAID,UAAU;QACZH,KAAK1Q,SAAS,CAACC,MAAM,CAAC;QACtB,IAAItB,KAAKA,IAAIK,YAAY,CAAC,iBAAiB;QAE3C,MAAMysB,eAAe,CAACprB;YACpB,IAAI,CAACqQ,KAAKI,QAAQ,CAACzQ,EAAEmoB,MAAM,KACzB,CAAC7pB,KAAKmS,SAASzQ,EAAEmoB,MAAM,GAAW;gBAClCgD;YACF;QACF;QAEA,MAAME,aAAa,CAACrrB;YAClB,IAAIA,EAAEiT,GAAG,KAAK,UAAU;gBACtBkY;gBACA7sB,KAAKkG;YACP;QACF;QAEA,yDAAyD;QACzDymB,oBAAoB1vB,OAAO4H,UAAU,CAAC;YACpC8nB,oBAAoB;YACpBrvB,SAAS6X,gBAAgB,CAAC,SAAS2X;YACnCxvB,SAAS6X,gBAAgB,CAAC,WAAW4X;QACvC,GAAG;QAEHL,sBAAsB;YACpBpvB,SAASiX,mBAAmB,CAAC,SAASuY;YACtCxvB,SAASiX,mBAAmB,CAAC,WAAWwY;QAC1C;IAEF,OAAO;QACLF;IACF;AACF;AAEC5vB,OAAe+vB,cAAc,GAAG,OAAOC;IACtC,IAAI,CAACA,YAAY;IAEjB,IAAI;QACF,MAAMjwB;IACR,EAAE,OAAO0E,GAAG;QACV;IACF;IAEA,8BAA8B;IAC9B,IAAI4J,WAAWC,IAAI,EAAE;QACnBD,WAAWC,IAAI,CAACC,MAAM,GAAGyhB;IAC3B;IAEA,wBAAwB;IACxB,MAAMC,UAAU;QACd;QACA;QACA;QACA;QACA;QACA;KACD;IAEDA,QAAQ1d,OAAO,CAACxN,CAAAA;QACd,MAAMiD,KAAK3H,SAASsC,cAAc,CAACoC;QACnC,IAAIiD,MAAM,AAACA,GAAWsJ,IAAI,EAAE;YAC1BzR,OAAOqwB,QAAQ,CAACloB,IAAI;gBAAE,eAAegoB;YAAW,GAAUvnB,KAAK,CAACa,CAAAA;gBAC9D5E,QAAQ2I,IAAI,CAAC,CAAC,0BAA0B,EAAEtI,GAAG,CAAC,CAAC,EAAEuE;YACnD;QACF;IACF;IAEA,8CAA8C;IAC9C,MAAMlI,QAAQf,SAASsC,cAAc,CAAC;IACtC,IAAIvB,SAASA,MAAMwH,KAAK,KAAKonB,YAAY;QACvC5uB,MAAMwH,KAAK,GAAGonB;IAChB;IAEAzsB,iBAAiB,CAAC,qBAAqB,EAAEysB,WAAWlU,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,QAAQtU;AAC/E;AAGCxH,OAAemwB,qBAAqB,GAAG,CAACzM;IACvC,MAAMC,QAAQtjB,SAASsC,cAAc,CAAC;IACtC,MAAMihB,OAAOvjB,SAASsC,cAAc,CAAC;IACrC,MAAMytB,YAAY/vB,SAASsC,cAAc,CAAC;IAC1C,MAAM0tB,YAAYhwB,SAASsC,cAAc,CAAC;IAE1C,IAAI,CAACghB,SAAS,CAACyM,aAAa,CAACC,WAAW;IAExC,8BAA8B;IAC9B,MAAMtM,oBAAoB;QAAC;QAAiB;KAAgB;IAC5D,MAAMC,sBAAsB;QAAC;QAAiB;QAAuB;KAAc;IAEnF,IAAIN,QAAQ,UAAU;QACpBC,MAAM9a,KAAK,CAACob,SAAS,GAAG;QACxB,IAAIL,MAAMA,KAAK/a,KAAK,CAACob,SAAS,GAAG;QAEjC,0BAA0B;QAC1BmM,UAAUhsB,SAAS,CAACC,MAAM,IAAI2f;QAC9BoM,UAAUhsB,SAAS,CAACE,GAAG,IAAIyf;QAC3BqM,UAAUhtB,YAAY,CAAC,iBAAiB;QAExC,4BAA4B;QAC5BitB,UAAUjsB,SAAS,CAACC,MAAM,IAAI0f;QAC9BsM,UAAUjsB,SAAS,CAACE,GAAG,IAAI0f;QAC3BqM,UAAUjtB,YAAY,CAAC,iBAAiB;QAExC,+BAA+B;QAC/B,MAAMhC,QAAQf,SAASsC,cAAc,CAAC;QACtC,IAAIvB,SAASsiB,QAAQ,UAAU9b,WAAW,IAAMxG,MAAM6H,KAAK,IAAI,MAAM,sBAAsB;IAC7F,OAAO;QACL0a,MAAM9a,KAAK,CAACob,SAAS,GAAG;QACxB,IAAIL,MAAMA,KAAK/a,KAAK,CAACob,SAAS,GAAG;QAEjC,0BAA0B;QAC1BoM,UAAUjsB,SAAS,CAACC,MAAM,IAAI2f;QAC9BqM,UAAUjsB,SAAS,CAACE,GAAG,IAAIyf;QAC3BsM,UAAUjtB,YAAY,CAAC,iBAAiB;QAExC,4BAA4B;QAC5BgtB,UAAUhsB,SAAS,CAACC,MAAM,IAAI0f;QAC9BqM,UAAUhsB,SAAS,CAACE,GAAG,IAAI0f;QAC3BoM,UAAUhtB,YAAY,CAAC,iBAAiB;QAExC,+BAA+B;QAC/B,MAAM8F,SAAS7I,SAASsC,cAAc,CAAC;QACvC,wEAAwE;QACxE,IAAIuG,UAAUwa,QAAQ,UAAU9b,WAAW,IAAMsB,OAAOD,KAAK,IAAI,MAAM,sBAAsB;IAC/F;AACF;AAEA,MAAM6kB,oBAAoB;IACxB,MAAMwC,WAAW;QACf;YAAElvB,OAAO;YAAkB2B,KAAK;YAAmBwtB,QAAQ;gBAAC;aAAU;QAAC;QACvE;YAAEnvB,OAAO;YAAW2B,KAAK;YAAcwtB,QAAQ;gBAAC;aAAU;QAAC;QAC3D;YAAEnvB,OAAO;YAAkB2B,KAAK;YAAmBwtB,QAAQ;gBAAC;gBAAW;aAAW;QAAC;QACnF;YAAEnvB,OAAO;YAA0B2B,KAAK;YAA4BwtB,QAAQ;gBAAC;aAAU;QAAC;QACxF;YAAEnvB,OAAO;YAAc2B,KAAK;YAAewtB,QAAQ;gBAAC;aAAU;QAAC;QAC/D;YAAEnvB,OAAO;YAAiB2B,KAAK;YAAqBwtB,QAAQ;gBAAC;aAAU;QAAC;KACzE;IAEDD,SAAS/d,OAAO,CAAC,CAAC,EAAEnR,KAAK,EAAE2B,GAAG,EAAEwtB,MAAM,EAAE;QACtC,MAAMC,UAAUnwB,SAASsC,cAAc,CAACvB;QACxC,MAAMqvB,QAAQpwB,SAASsC,cAAc,CAACI;QACtC,IAAI,CAACytB,WAAW,CAACC,OAAO;QAExB,IAAIF,OAAO3pB,QAAQ,CAAC,YAAY;YAC9B4pB,QAAQtY,gBAAgB,CAAC,WAAW,CAACzT;gBACnC,IAAI,AAACA,EAAoBiT,GAAG,KAAK,SAAS;oBACxCjT,EAAEkT,cAAc,IAAI,iCAAiC;oBACrD8Y,MAAM/lB,KAAK;gBACb;YACF;QACF;QAEA,IAAI6lB,OAAO3pB,QAAQ,CAAC,aAAa;YAC/B4pB,QAAQtY,gBAAgB,CAAC,YAAY;gBACnCuY,MAAM/lB,KAAK;YACb;QACF;IACF;AACF;AAEA,MAAMujB,wBAAwB;IAC5B,MAAMyC,WAAWrwB,SAASsC,cAAc,CAAC;IACzC,MAAMvB,QAAQf,SAASsC,cAAc,CAAC;IACtC,MAAMguB,cAActwB,SAASsC,cAAc,CAAC;IAC5C,MAAMiuB,UAAUvwB,SAASsC,cAAc,CAAC;IAExC,IAAI,CAAC+tB,YAAY,CAACtvB,OAAO;IAEzB,MAAMyvB,WAAW;QACf,IAAIzvB,MAAMoiB,KAAK,IAAIpiB,MAAMoiB,KAAK,CAAC,EAAE,EAAE;YACjC,IAAImN,aAAa;gBACf,+DAA+D;gBAC/DA,YAAYztB,SAAS,GAAG,CAAC;;4BAEL,EAAE9B,MAAMoiB,KAAK,CAAC,EAAE,CAAC1iB,IAAI,CAAC;;;;;;;QAO1C,CAAC;gBACD6vB,YAAYvsB,SAAS,CAACC,MAAM,CAAC;gBAE7B,sCAAsC;gBACtC,MAAMysB,YAAYzwB,SAASsC,cAAc,CAAC;gBAC1C,IAAImuB,WAAW;oBACbA,UAAU5Y,gBAAgB,CAAC,SAAS,CAACzT;wBACnCA,EAAEkT,cAAc;wBAChBlT,EAAEqS,eAAe;wBACjB1V,MAAMwH,KAAK,GAAG,IAAI,mBAAmB;wBACrC+nB,YAAYvsB,SAAS,CAACE,GAAG,CAAC;wBAC1BqsB,YAAYztB,SAAS,GAAG;wBACxB,mBAAmB;wBACnBK,iBAAiB,0BAA0B,QAAQmG;oBACrD;gBACF;YACF;QACF;IACF;IAEAtI,MAAM8W,gBAAgB,CAAC,UAAU2Y;IAEjC,IAAIE,cAAc;IAElB;QAAC;QAAa;QAAY;QAAa;KAAO,CAACxe,OAAO,CAACye,CAAAA;QACrDN,SAASxY,gBAAgB,CAAC8Y,WAAW,CAACvsB;YACpCA,EAAEkT,cAAc;YAChBlT,EAAEqS,eAAe;QACnB;IACF;IAEA4Z,SAASxY,gBAAgB,CAAC,aAAa;QACrC6Y;QACA,IAAIA,gBAAgB,GAAG;YACrBL,SAAStsB,SAAS,CAACE,GAAG,CAAC;YACvB,IAAIssB,SAAS;gBACXA,QAAQxsB,SAAS,CAACC,MAAM,CAAC,aAAa;gBACtCusB,QAAQxsB,SAAS,CAACE,GAAG,CAAC,eAAe;YACvC;QACF;IACF;IAEAosB,SAASxY,gBAAgB,CAAC,aAAa;QACrC6Y;QACA,IAAIA,gBAAgB,GAAG;YACrBL,SAAStsB,SAAS,CAACC,MAAM,CAAC;YAC1B,IAAIusB,SAAS;gBACXA,QAAQxsB,SAAS,CAACC,MAAM,CAAC,eAAe;gBACxCusB,QAAQxsB,SAAS,CAACE,GAAG,CAAC,aAAa;YACrC;QACF;IACF;IAEAosB,SAASxY,gBAAgB,CAAC,QAAQ,CAACzT;QACjCssB,cAAc;QACdL,SAAStsB,SAAS,CAACC,MAAM,CAAC;QAC1B,IAAIusB,SAAS;YACXA,QAAQxsB,SAAS,CAACC,MAAM,CAAC,eAAe;YACxCusB,QAAQxsB,SAAS,CAACE,GAAG,CAAC,aAAa;QACrC;QAEA,MAAM2sB,KAAKxsB,EAAEysB,YAAY;QACzB,IAAID,MAAMA,GAAGzN,KAAK,EAAE;YAClBpiB,MAAMoiB,KAAK,GAAGyN,GAAGzN,KAAK;YACtBqN;QACF;IACF;AACF;AAEA,oBAAoB;AACnB7wB,OAAemxB,gBAAgB,GAAG,CAACC,aAAqBruB;IACvD,MAAMqS,YAAY/U,SAASsC,cAAc,CAACyuB;IAC1C,IAAI,CAAChc,WAAW;IAEhB,QAAQ;IACR,MAAMic,aAAa,CAAC,uPAAuP,CAAC;IAC5Q,MAAMC,eAAe,CAAC,gPAAgP,CAAC;IAEvQ,MAAMC,WAAW;QACf,mDAAmD;QACnD,IAAIlxB,SAASmxB,iBAAiB,KAAKpc,WAAW;YAC5CrS,IAAIG,SAAS,GAAGouB;YAChBvuB,IAAIK,YAAY,CAAC,cAAc;YAC/BL,IAAIK,YAAY,CAAC,SAAS;YAC1B,8DAA8D;YAC9DgS,UAAUhR,SAAS,CAACE,GAAG,CAAC,YAAY,QAAQ;QAC9C,OAAO;YACLvB,IAAIG,SAAS,GAAGmuB;YAChBtuB,IAAIK,YAAY,CAAC,cAAc;YAC/BL,IAAIK,YAAY,CAAC,SAAS;YAC1BgS,UAAUhR,SAAS,CAACC,MAAM,CAAC,YAAY,QAAQ;QACjD;IACF;IAEA,2CAA2C;IAC3C,IAAI,CAAC,AAAC+Q,UAAkBqc,mBAAmB,EAAE;QAC3CpxB,SAAS6X,gBAAgB,CAAC,oBAAoBqZ;QAC7Cnc,UAAkBqc,mBAAmB,GAAG;IAC3C;IAEA,IAAI,CAACpxB,SAASmxB,iBAAiB,EAAE;QAC/Bpc,UAAUsc,iBAAiB,GAAGjpB,KAAK,CAACa,CAAAA;YAClC5E,QAAQC,KAAK,CAAC,CAAC,6CAA6C,EAAE2E,IAAIxD,OAAO,EAAE;QAC7E;IACF,OAAO;QACLzF,SAASsxB,cAAc;IACzB;AACF;AAEA,IAAItxB,SAASuxB,UAAU,KAAK,WAAW;IACrCvxB,SAAS6X,gBAAgB,CAAC,oBAAoB7W;AAChD,OAAO;IACLA;AACF;AACCrB,OAAe6xB,eAAe,GAAG1Z;AACjCnY,OAAesY,aAAa,GAAGvL;AAEhC,MAAM+kB,aAAa;IACjB/kB,eAAe,IAAID;IACnBvB,aAAa;IACbH,UAAU;IACVC,cAAc;IACdC,kBAAkB;IAClBG,kBAAkB;IAClBC,kBAAkB,EAAE;IACpBC,oBAAoB;IACpBC,mBAAmB;IACnBoe,eAAe;QAAC;YAAEjlB,IAAI;YAAQ+E,MAAM;YAAQhJ,MAAM;YAAQmpB,UAAU;QAAK;KAAE;IAC3EC,mBAAmB;IACnB5iB,aAAaC,MAAM,GAAG;IACtBL,gBAAgB;AAClB;AACClH,OAAe+xB,WAAW,GAAGD;AAE9B,SAASzwB,IAAI,EAAE8W,cAAc,EAAEpL,YAAY,EAAEuX,OAAO,EAAEtI,eAAe,EAAE0I,cAAc,EAAEY,cAAc,EAAEwM,UAAU,GAAG"}