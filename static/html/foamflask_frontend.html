<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FOAMFlask</title>

  <!-- Resource hints for better performance -->
  <link rel="preconnect" href="https://cdn.tailwindcss.com" />
  <link rel="preconnect" href="https://cdn.plot.ly" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="dns-prefetch" href="https://cdn.tailwindcss.com" />

  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon" />

  <style>
    :root {
      --font-sans:
        Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto,
        "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji",
        "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    }

    body {
      font-family: var(--font-sans);
      scrollbar-gutter: stable;
    }
  </style>
  <link rel="dns-prefetch" href="https://cdn.plot.ly" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            clifford: "#da373d",
          },
        },
      },
    };
  </script>

  <!-- Performance optimizations for plots -->
  <style>
    /* Optimize plot containers for smooth scrolling */
    #plotsContainer,
    #aeroContainer {
      contain: layout style paint;
      will-change: auto;
      content-visibility: auto;
    }

    #pressure-plot,
    #velocity-plot,
    #turbulence-plot,
    #residuals-plot,
    #cp-plot,
    #velocity-profile-plot {
      contain: layout style paint;
      /* transform: translateZ(0);
      backface-visibility: hidden; */
      content-visibility: auto;
    }

    /* Reduce repaints during scroll */
    .js-plotly-plot {
      will-change: auto;
    }

    /* Optimize output container */
    #output {
      contain: strict;
      content-visibility: auto;
    }

    /* Reduce layout thrashing */
    .grid {
      contain: layout style;
    }
  </style>

  <style>
    /* Modebar container styles */
    .modebar-container {
      position: absolute;
      top: 355px !important;
      right: 550px !important;
      z-index: 1001;
    }

    /* Modebar styles */
    .modebar {
      opacity: 0;
      transition: opacity 0.2s ease-in-out;
      transform: scale(1.5);
      transform-origin: bottom left;
      pointer-events: none;
      border: none;
      position: relative;
    }

    /* Show modebar on plot hover */
    .plot-container:hover .modebar,
    .js-plotly-plot:hover .modebar,
    .plotly-graph-div:hover .modebar,
    .plot-container:hover .modebar-container .modebar,
    .js-plotly-plot:hover .modebar-container .modebar,
    .plotly-graph-div:hover .modebar-container .modebar {
      opacity: 1;
      pointer-events: auto;
      z-index: 1000;
    }

    /* Notification styles */
    .notification {
      animation: slideIn 0.3s ease-out;
      box-shadow:
        0 4px 6px -1px rgba(0, 0, 0, 0.1),
        0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .notification.fade-out {
      animation: fadeOut 0.3s ease-in forwards;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
      }

      to {
        opacity: 0;
      }
    }

    /* Page transition */
    /* Page transition rules removed */

    /* Glassmorphism Utilities - Mixed */
    .glass {
      /* Clear Liquid Glass */
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(0px);
      -webkit-backdrop-filter: blur(0px);

      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.6);

      box-shadow:
        0 4px 30px rgba(0, 0, 0, 0.1),
        inset 0 0 10px rgba(255, 255, 255, 0.3);

      position: relative;
      overflow: hidden;
    }

    .glass-panel {
      /* Matte Liquid Panel */
      background: rgba(255, 255, 255, 0.55);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);

      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.5);

      box-shadow:
        0 4px 6px -1px rgba(0, 0, 0, 0.05),
        0 2px 4px -1px rgba(0, 0, 0, 0.03);

      position: relative;
      overflow: hidden;
    }

    .glass-plot {
      /* Matte Liquid Panel */
      background: rgba(255, 255, 255, 0.904);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);

      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.5);

      box-shadow:
        0 4px 6px -1px rgba(0, 0, 0, 0.05),
        0 2px 4px -1px rgba(0, 0, 0, 0.03);

      position: relative;
      overflow: hidden;
    }

    /* Enhanced Shine */
    .glass::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100%;
      background: linear-gradient(135deg,
          rgba(255, 255, 255, 0.4) 0%,
          rgba(255, 255, 255, 0.05) 40%,
          transparent 100%);
      pointer-events: none;
      z-index: 1;
    }

    .glass-panel::before,
    .glass::after,
    .glass-panel::after {
      display: none;
    }
  </style>
</head>

<!-- Background color -->

<body
  class="bg-[linear-gradient(180deg,hsla(192,100%,86%,1)_0%,hsla(292,37%,88%,1)_100%)] text-black min-h-screen bg-fixed">
  <!-- Skip to content link -->
  <a href="#main-content"
    class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 focus:px-4 focus:py-2 focus:bg-white focus:text-cyan-600 focus:shadow-lg focus:rounded-md focus:font-medium focus:outline-none focus:ring-2 focus:ring-cyan-500">
    Skip to main content
  </a>

  <!-- Notification Container -->
  <div id="notificationContainer"
    class="fixed top-20 left-1/2 -translate-x-1/2 z-50 flex flex-col gap-2 pointer-events-none"></div>

  <template id="notification-template">
    <div class="notification pointer-events-auto px-4 py-3 rounded-lg shadow-lg max-w-sm overflow-hidden relative">
      <div class="relative z-10">
        <div class="flex items-start justify-between gap-3">
          <div class="flex items-center gap-3">
            <span class="text-2xl font-bold icon-slot"></span>
            <span class="text-sm font-medium message-slot leading-tight py-1"></span>
          </div>
          <!-- Close Button -->
          <button class="close-btn text-white/60 hover:text-white transition-colors p-1 rounded hover:bg-white/10"
            aria-label="Close notification">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>
      <!-- Progress Bar -->
      <div class="progress-bar h-1 bg-white bg-opacity-50 absolute bottom-0 left-0 hidden"></div>
    </div>
  </template>

  <!-- Navbar -->
  <nav class="glass sticky top-0 z-40 rounded-none transform transition-transform duration-300" id="navbar">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-10">
        <div class="flex items-center">
          <img src="{{ url_for('static', filename='icons/logo.svg') }}" alt="FOAMFlask Logo"
            class="h-8 w-8 rounded-md mr-2" />
          <h1 class="text-2xl font-bold text-black">FOAMFlask</h1>
          <!-- Active Case Badge -->
          <div id="activeCaseBadge"
            class="hidden md:flex items-center ml-4 px-3 py-1 bg-cyan-50/50 border border-cyan-200 rounded-full text-xs transition-all opacity-0">
            <span class="text-cyan-900/60 font-medium mr-1.5">Active Case:</span>
            <span id="activeCaseName" class="text-cyan-800 font-bold tracking-wide"></span>
          </div>
        </div>

        <!-- Desktop Menu -->
        <div class="hidden md:flex space-x-1 relative isolate">
          <!-- Navigation Sliding Pill -->
          <div id="nav-pill"
            class="absolute top-0 bottom-0 rounded-md bg-cyan-700 transition-all duration-300 ease-in-out -z-10"
            style="opacity: 0"></div>

          <button id="nav-setup" aria-current="page"
            class="px-4 py-1 rounded-md text-sm font-medium transition-colors nav-btn text-gray-900 bg-transparent">
            Setup
          </button>
          <button id="nav-geometry"
            class="px-4 py-1 rounded-md text-sm font-medium transition-colors nav-btn text-gray-900 hover:bg-gray-100/50 bg-transparent">
            Geometry
          </button>
          <button id="nav-meshing"
            class="px-4 py-1 rounded-md text-sm font-medium transition-colors nav-btn text-gray-900 hover:bg-gray-100/50 bg-transparent">
            Meshing
          </button>
          <button id="nav-visualizer"
            class="px-4 py-1 rounded-md text-sm font-medium transition-colors nav-btn text-gray-900 hover:bg-gray-100/50 bg-transparent">
            Visualizer
          </button>
          <button id="nav-run"
            class="px-4 py-1 rounded-md text-sm font-medium transition-colors nav-btn text-gray-900 hover:bg-gray-100/50 bg-transparent">
            Run/Log
          </button>
          <button id="nav-plots"
            class="px-4 py-1 rounded-md text-sm font-medium transition-colors nav-btn text-gray-900 hover:bg-gray-100/50 bg-transparent">
            Plots
          </button>
          <button id="nav-post"
            class="px-4 py-1 rounded-md text-sm font-medium transition-colors nav-btn text-gray-900 hover:bg-gray-100/50 bg-transparent">
            Post
          </button>
        </div>

        <!-- Mobile Menu Button -->
        <div class="flex items-center md:hidden">
          <button type="button" onclick="toggleMobileMenu()" id="mobile-menu-btn"
            class="inline-flex items-center justify-center p-2 rounded-md text-gray-900 hover:text-cyan-800 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-cyan-500"
            aria-controls="mobile-menu" aria-expanded="false">
            <span class="sr-only">Open main menu</span>
            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke="currentColor" aria-hidden="true">
              <path id="mobile-menu-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Menu, show/hide based on menu state. -->
    <div class="hidden md:hidden border-t border-gray-200" id="mobile-menu">
      <div class="px-2 pt-2 pb-3 space-y-1">
        <button id="mobile-nav-setup"
          class="block w-full text-left px-3 py-2 rounded-md text-base font-medium bg-cyan-700 text-white nav-btn">
          Setup
        </button>
        <button id="mobile-nav-geometry"
          class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 hover:text-cyan-800 hover:bg-gray-50 nav-btn">
          Geometry
        </button>
        <button id="mobile-nav-meshing"
          class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 hover:text-cyan-800 hover:bg-gray-50 nav-btn">
          Meshing
        </button>
        <button id="mobile-nav-visualizer"
          class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 hover:text-cyan-800 hover:bg-gray-50 nav-btn">
          Visualizer
        </button>
        <button id="mobile-nav-run"
          class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 hover:text-cyan-800 hover:bg-gray-50 nav-btn">
          Run/Log
        </button>
        <button id="mobile-nav-plots"
          class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 hover:text-cyan-800 hover:bg-gray-50 nav-btn">
          Plots
        </button>
        <button id="mobile-nav-post"
          class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 hover:text-cyan-800 hover:bg-gray-50 nav-btn">
          Post
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content Area -->
  <div id="main-content" class="px-4 py-2 sm:px-6 outline-none" tabindex="-1">
    <!-- Setup Page -->
    <div id="page-setup" class="page max-w-4xl mx-auto glass rounded-lg p-6 flex flex-col gap-6 hidden">
      <!-- Active Case Selection -->
      <div class="glass-panel rounded-lg p-4">
        <h2 class="text-xl font-bold mb-2 text-black">Active Case</h2>
        <p class="text-sm text-cyan-700 mb-3">
          Select the case you want to work on. This selection applies to
          Geometry, Meshing, and Run tabs.
        </p>
        <div class="flex flex-col sm:flex-row gap-2 items-center">
          <select id="caseSelect" aria-label="Select Active Case"
            class="border border-cyan-300 rounded px-3 py-2 flex-1 w-full font-medium focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
            onchange="selectCase(this.value)">
            <option value="">-- Select a Case --</option>
          </select>
          <button id="refreshCaseListBtn" onclick="refreshCaseList(this)"
            class="bg-cyan-100 hover:bg-cyan-200 text-cyan-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 px-4 py-2 rounded transition-colors flex items-center gap-1"
            title="Refresh List" aria-label="Refresh case list">
            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
            </svg>
            Refresh
          </button>
        </div>
      </div>

      <!-- Case Management Grid -->
      <!-- Case Management Tabs -->
      <div class="glass-panel rounded-lg shadow-lg overflow-hidden">
        <!-- Tab Content -->
        <div class="p-6">
          <!-- Tab Navigation -->
          <div role="tablist" aria-label="Case Creation Options"
            class="relative flex p-1 bg-gray-50/80 border border-gray-200/60 backdrop-blur-sm gap-1 rounded-lg mb-6 isolate">
            <!-- Sliding Pill -->
            <div id="case-creation-bg-pill"
              class="absolute top-1 bottom-1 left-1 w-[calc(50%-0.375rem)] bg-cyan-50 shadow-sm ring-1 ring-cyan-200 rounded-md transition-transform duration-300 ease-in-out -z-10">
            </div>

            <button id="tab-btn-create" onclick="switchCaseCreationTab('create')" role="tab" aria-selected="true"
              aria-controls="tab-content-create"
              class="flex-1 py-2 px-4 rounded-md text-sm font-semibold text-cyan-800 transition-colors duration-200 focus:outline-none bg-transparent">
              Create Blank Case
            </button>
            <button id="tab-btn-import" onclick="switchCaseCreationTab('import')" role="tab" aria-selected="false"
              aria-controls="tab-content-import"
              class="flex-1 py-2 px-4 rounded-md text-sm font-medium text-black hover:text-black transition-colors duration-200 focus:outline-none bg-transparent">
              Import Tutorial
            </button>
          </div>

          <!-- Slider Mask -->
          <div class="overflow-hidden">
            <!-- Slider Track -->
            <div id="case-creation-track" class="flex transition-transform duration-300 ease-in-out">
              <!-- Create New Case Tab Pane -->
              <div class="w-full flex-shrink-0">
                <div id="tab-content-create" role="tabpanel" aria-labelledby="tab-btn-create"
                  class="flex flex-col gap-4">
                  <div class="mb-2">
                    <h3 class="text-xl font-bold mb-2 text-black">
                      Create New Case
                    </h3>
                    <p class="text-sm text-gray-900">
                      Initialize a blank case with standard structure (0,
                      constant, system).
                    </p>
                  </div>

                  <form class="flex flex-col gap-1 w-full" onsubmit="
                        event.preventDefault();
                        createNewCase();
                      ">
                    <div class="mb-1">
                      <label for="newCaseName" class="text-sm font-medium text-gray-900">
                        Case Name
                        <span class="text-red-500" title="Required">*</span>
                      </label>
                      <p id="caseNameHelp" class="text-xs text-gray-500 mt-1">
                        Alphanumeric characters, underscores, and dashes only.
                      </p>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2">
                      <input type="text" id="newCaseName" placeholder="e.g. my_case" required pattern="^[a-zA-Z0-9_-]+$"
                        title="Alphanumeric characters, underscores, and dashes only (no spaces)"
                        aria-describedby="caseNameHelp"
                        class="border border-gray-300 rounded-lg px-4 py-2 flex-1 w-full focus:outline-none focus:ring-2 focus:valid:ring-green-500 focus:valid:border-green-500 focus:invalid:ring-red-500 focus:invalid:border-red-500 invalid:border-red-500 invalid:text-red-600 transition-all" />
                      <button type="submit" id="createCaseBtn"
                        class="bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-500/30 text-white px-6 py-2 rounded-lg font-medium transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2 whitespace-nowrap">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd"
                            d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                            clip-rule="evenodd" />
                        </svg>
                        Create Case
                      </button>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Import Tutorial Tab Pane -->
              <div class="w-full flex-shrink-0">
                <div id="tab-content-import" role="tabpanel" aria-labelledby="tab-btn-import"
                  class="flex flex-col gap-4">
                  <div class="mb-2">
                    <h3 class="text-xl font-bold mb-2 text-black">
                      Import Tutorial
                    </h3>
                    <p class="text-sm text-gray-900">
                      Clone an official OpenFOAM tutorial into your workspace.
                    </p>
                  </div>

                  <div class="flex flex-col gap-1 w-full">
                    <label for="tutorialSelect" class="text-sm font-medium text-gray-900">
                      Select Tutorial Source
                    </label>
                    <div class="flex flex-col sm:flex-row gap-2">
                      <div class="relative flex-1 w-full">
                        <select id="tutorialSelect"
                          class="appearance-none border border-gray-300 rounded-lg px-4 py-2 pr-8 text-sm w-full focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-all bg-white"
                          aria-label="Select Tutorial">
                          {{ options|safe }}
                        </select>
                        <div
                          class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-900">
                          <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                          </svg>
                        </div>
                      </div>
                      <button id="loadTutorialBtn"
                        class="bg-cyan-500 hover:bg-cyan-600 focus:outline-none focus:ring-4 focus:ring-cyan-500/30 text-white px-6 py-2 rounded-lg font-medium transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2 whitespace-nowrap">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd"
                            d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                            clip-rule="evenodd" />
                        </svg>
                        Import Tutorial
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Advanced Configuration (Collapsible) -->
      <details class="group border-t pt-4">
        <summary
          class="flex justify-between items-center cursor-pointer text-gray-900 font-medium hover:text-cyan-700 hover:bg-gray-50 p-2 rounded transition-colors list-none [&::-webkit-details-marker]:hidden">
          <span>Advanced Configuration (Case Root, Docker)</span>
          <svg xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 text-gray-500 transition-transform duration-200 group-open:rotate-180" viewBox="0 0 20 20"
            fill="currentColor">
            <path fill-rule="evenodd"
              d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
              clip-rule="evenodd" />
          </svg>
        </summary>
        <div class="mt-4 space-y-4 pl-2">
          <!-- Case Directory -->
          <div class="flex flex-col sm:flex-row sm:items-center gap-2">
            <label for="caseDir" class="w-32 font-medium text-gray-900">Case Root:</label>
            <div class="relative flex-1">
              <input type="text" id="caseDir" name="caseDir"
                class="border border-gray-300 rounded px-3 py-2 w-full pr-8 text-gray-900" />
              <button onclick="copyInputToClipboard('caseDir', this)"
                class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-cyan-600 focus:outline-none focus:text-cyan-600 transition-colors p-1 rounded"
                title="Copy Path" aria-label="Copy Case Root Path">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
              </button>
            </div>
            <button id="setRootBtn" type="button" onclick="setCase(this)"
              class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded flex items-center justify-center min-w-[100px]">
              Set Root
            </button>
            <button id="openRootBtn" type="button" onclick="openCaseRoot(this)"
              class="bg-cyan-600 hover:bg-cyan-700 text-white px-3 py-2 rounded flex items-center justify-center transition-colors"
              title="Open Case Root in File Explorer">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                  d="M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 002 2H4a2 2 0 01-2-2V5zm3 1h6v4H5V6zm6 6H5v2h6v-2z"
                  clip-rule="evenodd" />
                <path d="M15 7h1a2 2 0 012 2v5.5a1.5 1.5 0 01-3 0V7z" />
              </svg>
              <span class="ml-2">Open</span>
            </button>
          </div>

          <!-- Docker Config -->
          <div class="flex flex-col sm:flex-row sm:items-center gap-2">
            <label for="dockerImage" class="w-32 font-medium text-gray-900">Docker Image:</label>
            <div class="relative flex-1">
              <input type="text" id="dockerImage" name="dockerImage"
                class="border border-gray-300 rounded px-3 py-2 w-full pr-8" />
              <button onclick="copyInputToClipboard('dockerImage', this)"
                class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-cyan-600 focus:outline-none focus:text-cyan-600 transition-colors p-1 rounded"
                title="Copy Docker Image" aria-label="Copy Docker Image">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
              </button>
            </div>
            <input type="text" id="openfoamVersion" name="openfoamVersion" placeholder="Version"
              class="border border-gray-300 rounded px-3 py-2 w-24" aria-label="OpenFOAM Version" />
            <button id="setDockerConfigBtn" type="button" onclick="
                  setDockerConfig(
                    document.getElementById('dockerImage').value,
                    document.getElementById('openfoamVersion').value,
                    this,
                  )
                "
              class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded flex items-center justify-center min-w-[90px]">
              Update
            </button>
          </div>
        </div>
      </details>
    </div>

    <!-- Geometry Page -->
    <div id="page-geometry" class="page hidden max-w-7xl mx-auto glass rounded-lg p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-black">Geometry Management</h2>
      </div>

      <div class="flex flex-col lg:flex-row gap-6">
        <!-- Left Sidebar: Controls -->
        <div class="w-full lg:w-1/3 flex flex-col gap-4 glass-panel rounded-lg p-4">
          <!-- Geometry Tabs -->
          <div role="tablist" aria-label="Geometry Sources"
            class="relative flex p-1 bg-gray-50/80 border border-gray-200/60 rounded-lg gap-1 mb-4 isolate">
            <!-- Sliding Pill -->
            <div id="geometry-bg-pill"
              class="absolute top-1 bottom-1 left-1 w-[calc(50%-0.375rem)] bg-cyan-50 shadow-sm ring-1 ring-cyan-200 rounded-md transition-transform duration-300 ease-in-out -z-10">
            </div>

            <button onclick="switchGeometryTab('upload')" id="tab-btn-geo-upload" role="tab" aria-selected="true"
              aria-controls="tab-geo-upload"
              class="flex-1 py-2 px-4 rounded-md text-sm font-semibold text-cyan-800 transition-colors duration-200 focus:outline-none bg-transparent">
              Upload File
            </button>
            <button onclick="switchGeometryTab('resources')" id="tab-btn-geo-resources" role="tab" aria-selected="false"
              aria-controls="tab-geo-resources"
              class="flex-1 py-2 px-4 rounded-md text-sm font-medium text-black hover:text-black transition-colors duration-200 focus:outline-none bg-transparent">
              From Resources
            </button>
          </div>

          <!-- Slider Mask -->
          <div class="overflow-hidden">
            <!-- Slider Track -->
            <div id="geometry-track" class="flex transition-transform duration-300 ease-in-out">
              <!-- Tab Content: Upload -->
              <div class="w-full flex-shrink-0 px-1">
                <div id="tab-geo-upload" role="tabpanel" aria-labelledby="tab-btn-geo-upload"
                  class="flex flex-col gap-2">
                  <label for="geometryUpload" class="text-sm font-medium">Upload Geometry File (stl, obj,
                    obj.gz)</label>
                  <p id="geometryUploadHelp" class="text-xs text-gray-600 mb-2">
                    Max file size: 500MB
                  </p>
                  <input type="file" id="geometryUpload" accept=".stl,.obj,.obj.gz"
                    aria-describedby="geometryUploadHelp"
                    class="block w-full text-sm text-gray-900 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-50 file:text-cyan-700 hover:file:bg-cyan-100" />
                  <button id="uploadGeometryBtn" onclick="uploadGeometry(this)"
                    class="bg-cyan-600 hover:bg-cyan-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 text-white px-4 py-2 rounded text-sm transition-colors flex items-center justify-center gap-2">
                    Upload
                  </button>
                </div>
              </div>

              <!-- Tab Content: Resources -->
              <div class="w-full flex-shrink-0 px-1">
                <div id="tab-geo-resources" role="tabpanel" aria-labelledby="tab-btn-geo-resources"
                  class="flex flex-col gap-2">
                  <div class="flex justify-between items-center">
                    <label for="resourceGeometrySelect" class="text-sm font-medium">Select Resource Geometry</label>
                    <button id="refreshResourceGeometryBtn" onclick="loadResourceGeometries(true)"
                      class="text-xs text-cyan-600 hover:text-cyan-800 flex items-center gap-1 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-cyan-500 rounded px-1"
                      aria-label="Refresh resource list">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                      </svg>
                      Refresh
                    </button>
                  </div>
                  <select id="resourceGeometrySelect"
                    class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm rounded-md bg-white bg-opacity-80">
                    <option value="" disabled selected>Loading...</option>
                  </select>
                  <button id="fetchResourceGeometryBtn" onclick="fetchResourceGeometry(this)"
                    class="bg-cyan-600 hover:bg-cyan-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 text-white px-4 py-2 rounded text-sm transition-colors flex items-center justify-center gap-2">
                    Fetch & Import
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Geometry List -->
          <div class="flex flex-col gap-2 mt-4">
            <div class="flex justify-between items-center">
              <label for="geometrySelect" class="text-sm font-medium">Available Geometries</label>
              <button id="refreshGeometryBtn" onclick="refreshGeometryList(this)"
                class="text-xs text-cyan-600 hover:text-cyan-800 flex items-center gap-1 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-cyan-500 rounded px-1"
                aria-label="Refresh geometry list">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Refresh
              </button>
            </div>
            <select id="geometrySelect" class="border border-gray-300 rounded px-3 py-2 w-full" size="5">
              <!-- Populated by JS -->
            </select>
            <div class="flex gap-2">
              <button id="viewGeometryBtn" onclick="loadGeometryView()"
                class="bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 text-white px-4 py-2 rounded flex-1 text-sm">
                View
              </button>
              <button id="deleteGeometryBtn" onclick="deleteGeometry(this)"
                class="bg-red-500 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 text-white px-4 py-2 rounded flex-1 text-sm">
                Delete
              </button>
            </div>
          </div>

          <!-- Info Panel -->
          <div id="geometryInfo" class="hidden glass-panel rounded p-3 mt-4">
            <h3 class="font-semibold text-black mb-2">Geometry Info</h3>
            <div id="geometryInfoContent" class="text-sm text-cyan-800 space-y-1">
              <div class="mt-2 border border-gray-200 rounded-md overflow-hidden bg-white shadow-sm">
                <div class="bg-cyan-50 px-3 py-2 border-b border-cyan-100 flex justify-between items-center">
                  <span class="text-xs font-bold text-cyan-900 uppercase tracking-wider">Geometry Bounds</span>
                  <span class="text-[10px] bg-white text-cyan-600 px-1.5 py-0.5 rounded border border-cyan-200">World
                    Coords</span>
                </div>
                <div class="p-2 space-y-1.5">
                  <!-- X Axis -->
                  <div class="flex items-center text-xs">
                    <div class="w-4 flex-shrink-0 font-bold text-red-500">
                      X
                    </div>
                    <div class="flex-1 font-mono text-black text-[11px] whitespace-nowrap">
                      <span class="text-gray-600">min</span>
                      <button type="button" id="geo-bound-x-min"
                        class="copyable-value cursor-pointer hover:bg-cyan-100 hover:text-cyan-800 px-1 rounded transition-colors"
                        title="Click to copy value" aria-label="Copy X minimum"></button>
                      <span class="text-gray-500 mx-1">|</span>
                      <span class="text-gray-600">max</span>
                      <button type="button" id="geo-bound-x-max"
                        class="copyable-value cursor-pointer hover:bg-cyan-100 hover:text-cyan-800 px-1 rounded transition-colors"
                        title="Click to copy value" aria-label="Copy X maximum"></button>
                    </div>
                    <div
                      class="ml-1 bg-gray-100 text-black px-1.5 py-0.5 rounded text-[10px] font-mono border border-gray-200"
                      title="Length">
                      Δ
                      <button type="button" id="geo-bound-x-len"
                        class="copyable-value cursor-pointer hover:bg-gray-300 px-1 rounded transition-colors"
                        title="Click to copy length" aria-label="Copy X length"></button>
                    </div>
                  </div>
                  <!-- Y Axis -->
                  <div class="flex items-center text-xs">
                    <div class="w-4 flex-shrink-0 font-bold text-green-500">
                      Y
                    </div>
                    <div class="flex-1 font-mono text-black text-[11px] whitespace-nowrap">
                      <span class="text-gray-600">min</span>
                      <button type="button" id="geo-bound-y-min"
                        class="copyable-value cursor-pointer hover:bg-cyan-100 hover:text-cyan-800 px-1 rounded transition-colors"
                        title="Click to copy value" aria-label="Copy Y minimum"></button>
                      <span class="text-gray-500 mx-1">|</span>
                      <span class="text-gray-600">max</span>
                      <button type="button" id="geo-bound-y-max"
                        class="copyable-value cursor-pointer hover:bg-cyan-100 hover:text-cyan-800 px-1 rounded transition-colors"
                        title="Click to copy value" aria-label="Copy Y maximum"></button>
                    </div>
                    <div
                      class="ml-1 bg-gray-100 text-black px-1.5 py-0.5 rounded text-[10px] font-mono border border-gray-200"
                      title="Length">
                      Δ
                      <button type="button" id="geo-bound-y-len"
                        class="copyable-value cursor-pointer hover:bg-gray-300 px-1 rounded transition-colors"
                        title="Click to copy length" aria-label="Copy Y length"></button>
                    </div>
                  </div>
                  <!-- Z Axis -->
                  <div class="flex items-center text-xs">
                    <div class="w-4 flex-shrink-0 font-bold text-cyan-500">
                      Z
                    </div>
                    <div class="flex-1 font-mono text-black text-[11px] whitespace-nowrap">
                      <span class="text-gray-600">min</span>
                      <button type="button" id="geo-bound-z-min"
                        class="copyable-value cursor-pointer hover:bg-cyan-100 hover:text-cyan-800 px-1 rounded transition-colors"
                        title="Click to copy value" aria-label="Copy Z minimum"></button>
                      <span class="text-gray-500 mx-1">|</span>
                      <span class="text-gray-600">max</span>
                      <button type="button" id="geo-bound-z-max"
                        class="copyable-value cursor-pointer hover:bg-cyan-100 hover:text-cyan-800 px-1 rounded transition-colors"
                        title="Click to copy value" aria-label="Copy Z maximum"></button>
                    </div>
                    <div
                      class="ml-1 bg-gray-100 text-black px-1.5 py-0.5 rounded text-[10px] font-mono border border-gray-200"
                      title="Length">
                      Δ
                      <button type="button" id="geo-bound-z-len"
                        class="copyable-value cursor-pointer hover:bg-gray-300 px-1 rounded transition-colors"
                        title="Click to copy length" aria-label="Copy Z length"></button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column: Viewer -->
        <div class="w-full lg:w-2/3 rounded-lg overflow-hidden relative" style="min-height: 500px">
          <iframe id="geometryInteractive" class="w-full h-full border-0" title="Interactive Geometry Viewer"></iframe>
          <div id="geometryPlaceholder" class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div class="flex flex-col items-center justify-center h-full p-8 text-center">
              <div class="text-gray-600 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                    d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                </svg>
              </div>
              <h3 class="text-lg font-medium text-black mb-2">
                No Geometry Loaded
              </h3>
              <p class="text-gray-900">
                Select a geometry file and click "View" to visualize
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Meshing Page -->
    <div id="page-meshing" class="page hidden max-w-7xl mx-auto glass rounded-lg p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold" style="color: black">
          Meshing Configuration
        </h2>
      </div>

      <div class="mb-6 text-black text-sm">
        <p class="text-black text-sm" style="color: black !important; opacity: 1">
          Using blockMesh followed by snappyHexMesh in OpenFOAM creates a
          structured background mesh with blockMesh, then refines and snaps it
          to complex geometry (like STL files) using snappyHexMesh, a common
          workflow for detailed, automated meshing, especially for boundary
          layers, by starting simple and adding complexity.
        </p>
      </div>

      <div class="flex flex-col gap-6">
        <!-- BlockMesh Config -->
        <div class="glass-panel rounded-lg p-4 shadow-sm">
          <button
            class="w-full text-left text-lg font-semibold mb-3 border-b pb-2 flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded"
            onclick="toggleSection('blockMeshSection')" aria-expanded="true" aria-controls="blockMeshSection">
            <span>blockMesh
              <span class="text-sm font-normal text-gray-900 ml-2">The Foundation</span></span>
            <span id="blockMeshSectionToggle" class="text-sm transition-transform duration-200">▼</span>
          </button>
          <div id="blockMeshSection" class="block space-y-3">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-900">Bounds (Min / Max)</label>
                <div class="grid grid-cols-2 gap-2">
                  <input type="text" id="bmMin" placeholder="-1 -1 -1" aria-describedby="bmBoundsHelp"
                    class="border rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                    aria-label="BlockMesh Min Bounds" />
                  <input type="text" id="bmMax" placeholder="1 1 1" aria-describedby="bmBoundsHelp"
                    class="border rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                    aria-label="BlockMesh Max Bounds" />
                </div>
                <p id="bmBoundsHelp" class="text-xs text-gray-500 mt-1">
                  Format: x y z (Space-separated coordinates)
                </p>
                <button onclick="fillBoundsFromGeometry(this)"
                  class="text-xs text-cyan-600 hover:text-cyan-800 mt-1 focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded px-1 transition-colors">
                  Auto-fill from selected Geometry
                </button>
              </div>
              <div>
                <label for="bmCells" class="block text-sm font-medium text-gray-900">Cells (x y z)</label>
                <input type="text" id="bmCells" value="20 20 20" aria-describedby="bmCellsHelp"
                  class="border rounded px-2 py-1 text-sm w-full focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500" />
                <p id="bmCellsHelp" class="text-xs text-gray-500 mt-1">
                  Format: 20 20 20 (Space-separated integers)
                </p>
              </div>
              <div>
                <label for="bmGrading" class="block text-sm font-medium text-gray-900">Grading (x y z)</label>
                <input type="text" id="bmGrading" value="1 1 1" aria-describedby="bmGradingHelp"
                  class="border rounded px-2 py-1 text-sm w-full focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500" />
                <p id="bmGradingHelp" class="text-xs text-gray-500 mt-1">
                  Format: 1 1 1 (Space-separated expansion ratios)
                </p>
              </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-2 pt-2">
              <button id="genBlockMeshBtn" onclick="generateBlockMeshDict(this)"
                class="bg-cyan-500 hover:bg-cyan-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 text-white px-4 py-2 rounded w-full sm:flex-1 flex items-center justify-center gap-2">
                Generate blockMeshDict
              </button>
              <button id="runBlockMeshBtn" onclick="runMeshingCommand('blockMesh', this)"
                class="bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 text-white px-4 py-2 rounded w-full sm:flex-1 flex items-center justify-center gap-2">
                Run blockMesh
              </button>
            </div>
          </div>
        </div>

        <!-- SnappyHexMesh Config -->
        <div class="glass-panel rounded-lg p-4 shadow-sm">
          <h3 class="text-lg font-semibold mb-3 border-b pb-2">
            SnappyHexMesh
            <span class="text-sm font-normal text-gray-900 ml-2">The Refinement</span>
          </h3>

          <div class="flex flex-col lg:flex-row gap-6">
            <!-- Left: Global Settings -->
            <div class="w-full lg:w-1/2 flex flex-col gap-4">
              <!-- Basic Global Settings -->
              <div class="bg-cyan-50 p-3 rounded border border-cyan-200">
                <h4 class="font-medium text-cyan-900 mb-2">
                  Global Settings
                </h4>
                <div class="grid grid-cols-2 gap-3">
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" id="shmCastellated" checked class="rounded text-cyan-600" />
                    <span class="text-sm">Castellated Mesh</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" id="shmSnap" checked class="rounded text-cyan-600" />
                    <span class="text-sm">Snap</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" id="shmLayers" class="rounded text-cyan-600" />
                    <span class="text-sm">Add Layers</span>
                  </label>
                </div>
                <div class="mt-3">
                  <label for="shmLocation" class="block text-sm font-medium text-gray-900">Location In Mesh (x y
                    z)</label>
                  <input type="text" id="shmLocation" value="0 0 0" class="border rounded px-2 py-1 text-sm w-full"
                    placeholder="e.g. 0.1 0.1 0.1" aria-describedby="shmLocationHelp" />
                  <p id="shmLocationHelp" class="text-xs text-gray-500 mt-1">
                    Point inside the mesh region (Space-separated)
                  </p>
                </div>
              </div>

              <!-- Advanced Settings (Collapsible) -->
              <details class="group border rounded bg-gray-50">
                <summary
                  class="flex justify-between items-center px-3 py-2 cursor-pointer text-sm font-medium text-gray-900 hover:bg-gray-100 list-none [&::-webkit-details-marker]:hidden">
                  <span>Advanced Global Settings</span>
                  <svg xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4 text-gray-500 transition-transform duration-200 group-open:rotate-180"
                    viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                      d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                      clip-rule="evenodd" />
                  </svg>
                </summary>
                <div class="p-3 space-y-3">
                  <!-- Quality -->
                  <div>
                    <h5 class="text-xs font-bold text-gray-900 uppercase tracking-wide mb-1">
                      Mesh Quality
                    </h5>
                    <div class="grid grid-cols-2 gap-2">
                      <div>
                        <label for="shmMaxNonOrtho" class="block text-xs text-black">Max Non-Ortho</label>
                        <input type="number" id="shmMaxNonOrtho" value="65"
                          class="border rounded px-2 py-1 text-sm w-full" />
                      </div>
                      <div>
                        <label for="shmMinTriangleTwist" class="block text-xs text-black">Min Triangle Twist</label>
                        <input type="number" id="shmMinTriangleTwist" value="-1"
                          class="border rounded px-2 py-1 text-sm w-full" />
                      </div>
                    </div>
                  </div>

                  <!-- Layers Global -->
                  <div>
                    <h5 class="text-xs font-bold text-gray-900 uppercase tracking-wide mb-1">
                      Layer Addition Global
                    </h5>
                    <div class="grid grid-cols-2 gap-2">
                      <div>
                        <label for="shmLayerFeatureAngle" class="block text-xs text-black">Feature Angle</label>
                        <input type="number" id="shmLayerFeatureAngle" value="130"
                          class="border rounded px-2 py-1 text-sm w-full" />
                      </div>
                      <div>
                        <label for="shmExpansionRatio" class="block text-xs text-black">Expansion Ratio</label>
                        <input type="number" id="shmExpansionRatio" value="1.2" step="0.1"
                          class="border rounded px-2 py-1 text-sm w-full" />
                      </div>
                      <div>
                        <label for="shmFinalThickness" class="block text-xs text-black">Final Thickness</label>
                        <input type="number" id="shmFinalThickness" value="0.3" step="0.1"
                          class="border rounded px-2 py-1 text-sm w-full" />
                      </div>
                      <div>
                        <label for="shmMinThickness" class="block text-xs text-black">Min Thickness</label>
                        <input type="number" id="shmMinThickness" value="0.1" step="0.01"
                          class="border rounded px-2 py-1 text-sm w-full" />
                      </div>
                    </div>
                  </div>
                </div>
              </details>
            </div>

            <!-- Right: Object Settings -->
            <div class="w-full lg:w-1/2 flex flex-col gap-4 border-l pl-0 lg:pl-6 border-gray-200">
              <h4 class="font-medium text-black">Object Settings</h4>

              <div class="flex flex-col gap-2 h-48">
                <label for="shmObjectList" class="text-sm text-black">Loaded Geometry Objects</label>
                <select id="shmObjectList" class="border border-gray-300 rounded px-2 py-2 flex-1 w-full" size="5"
                  onchange="selectShmObject()">
                  <!-- Populated by JS -->
                </select>
              </div>

              <!-- Selected Object Properties -->
              <div id="shmObjectProps" class="glass-panel p-3 rounded hidden">
                <div class="flex justify-between items-center mb-2">
                  <h5 class="font-semibold text-sm" id="shmSelectedObjectName">
                    Object Name
                  </h5>
                </div>
                <div class="space-y-3">
                  <div>
                    <label class="block text-xs font-medium text-gray-900">Refinement Level (Min / Max)</label>
                    <div class="flex items-center gap-2">
                      <input type="number" id="shmObjRefMin" min="0" max="10"
                        class="border rounded px-2 py-1 text-sm w-20" onchange="updateShmObjectConfig()"
                        aria-label="Min Refinement Level" />
                      <span class="text-gray-900">-</span>
                      <input type="number" id="shmObjRefMax" min="0" max="10"
                        class="border rounded px-2 py-1 text-sm w-20" onchange="updateShmObjectConfig()"
                        aria-label="Max Refinement Level" />
                    </div>
                  </div>
                  <div>
                    <label for="shmObjLayers" class="block text-xs font-medium text-gray-900">Number of Surface
                      Layers</label>
                    <input type="number" id="shmObjLayers" min="0" max="10"
                      class="border rounded px-2 py-1 text-sm w-full" onchange="updateShmObjectConfig()" />
                    <p class="text-xs text-gray-900 mt-1">
                      Requires "Add Layers" to be enabled globally.
                    </p>
                  </div>
                </div>
              </div>
              <div id="shmObjectPlaceholder"
                class="text-sm text-gray-600 italic p-4 text-center border border-dashed rounded">
                Select an object to configure its properties.
              </div>
            </div>
          </div>

          <div class="flex flex-col sm:flex-row gap-2 pt-4 border-t mt-4">
            <button id="genSnappyHexMeshBtn" onclick="generateSnappyHexMeshDict(this)"
              class="bg-cyan-500 hover:bg-cyan-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 text-white px-4 py-2 rounded w-full sm:flex-1 flex items-center justify-center gap-2">
              Generate snappyHexMeshDict
            </button>
            <button id="runSnappyHexMeshBtn" onclick="runMeshingCommand('snappyHexMesh', this)"
              class="bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 text-white px-4 py-2 rounded w-full sm:flex-1 flex items-center justify-center gap-2">
              Run snappyHexMesh
            </button>
          </div>
        </div>
      </div>

      <!-- Meshing Output -->
      <div class="mt-6">
        <div class="flex justify-between items-center mb-1">
          <h3 class="text-sm font-semibold">Meshing Output</h3>
          <div class="flex gap-3">
            <button onclick="clearMeshingOutput()"
              class="text-xs text-red-500 hover:text-red-700 flex items-center gap-1 focus:outline-none focus:underline"
              aria-label="Clear meshing output">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              Clear
            </button>
            <button onclick="copyMeshingOutput(this)"
              class="text-xs text-cyan-600 hover:text-cyan-800 flex items-center gap-1 focus:outline-none focus:underline"
              aria-label="Copy meshing output">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              Copy
            </button>
          </div>
        </div>
        <div id="meshingOutput" class="bg-gray-900 text-green-400 font-mono text-xs p-3 rounded h-40 overflow-auto"
          tabindex="0" role="log" aria-label="Meshing Output Log">
          Ready...
        </div>
      </div>
    </div>

    <!-- Run Page -->
    <div id="page-run" class="page hidden max-w-4xl mx-auto glass rounded-lg p-6 flex flex-col gap-6">
      <!-- Run Commands Section -->
      <div class="my-4">
        <h3 class="text-xl font-semibold mb-2 text-black">
          Run OpenFOAM Commands
        </h3>
        <div class="flex flex-col sm:flex-row gap-2">
          <button id="runAllrunBtn" onclick="runCommand('./Allrun', this)"
            class="bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 text-white px-4 py-2 rounded w-full sm:flex-1 flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"
              aria-hidden="true">
              <path fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"
                clip-rule="evenodd" />
            </svg>
            Allrun
          </button>
          <button id="runAllcleanBtn" onclick="confirmRunCommand('./Allclean', this)"
            class="bg-red-500 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 text-white px-4 py-2 rounded w-full sm:flex-1 flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"
              aria-hidden="true">
              <path fill-rule="evenodd"
                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                clip-rule="evenodd" />
            </svg>
            Allclean
          </button>
          <button id="runBlockMeshBtnRun" onclick="runCommand('blockMesh', this)"
            class="bg-cyan-500 hover:bg-cyan-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 text-white px-4 py-2 rounded w-full sm:flex-1 flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"
              aria-hidden="true">
              <path
                d="M3 4a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm8-1a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1V4zM3 13a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H4a1 1 0 01-1-1v-4zm9-1a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
            </svg>
            blockMesh
          </button>
          <button id="runSimpleFoamBtn" onclick="runCommand('simpleFoam', this)"
            class="bg-purple-500 hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 text-white px-4 py-2 rounded w-full sm:flex-1 flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"
              aria-hidden="true">
              <path fill-rule="evenodd"
                d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"
                clip-rule="evenodd" />
            </svg>
            simpleFoam
          </button>
          <button id="runPimpleFoamBtn" onclick="runCommand('pimpleFoam', this)"
            class="bg-orange-500 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 text-white px-4 py-2 rounded w-full sm:flex-1 flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"
              aria-hidden="true">
              <path fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                clip-rule="evenodd" />
            </svg>
            pimpleFoam
          </button>
        </div>
      </div>

      <!-- Console Log -->
      <div class="flex flex-col relative group">
        <div class="flex justify-between items-center mb-2">
          <h2 class="text-xl font-semibold flex items-center">
            Console Log
            <div class="relative group ml-1">
              <button type="button" aria-describedby="console-log-tooltip"
                class="text-cyan-500 cursor-help focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded-full w-6 h-6 flex items-center justify-center text-sm"
                aria-label="Information about Console Log">
                ℹ️
              </button>
              <div id="console-log-tooltip" role="tooltip"
                class="invisible group-hover:visible group-focus-within:visible opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity duration-200 absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded whitespace-nowrap z-10 pointer-events-none">
                Output from OpenFOAM is viewed here
              </div>
            </div>
          </h2>
          <div class="flex gap-2">
            <button onclick="clearLog()"
              class="text-sm bg-red-100 hover:bg-red-200 text-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 px-3 py-1 rounded transition-colors flex items-center gap-1"
              aria-label="Clear console log" title="Clear console output">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              Clear
            </button>
            <button onclick="copyLogToClipboard(this)"
              class="text-sm bg-gray-200 hover:bg-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 px-3 py-1 rounded transition-colors flex items-center gap-1"
              aria-label="Copy console log to clipboard">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              Copy Log
            </button>
          </div>
        </div>
        <div id="output" class="glass-plot rounded p-4 h-64 sm:h-80 overflow-auto text-sm font-mono" tabindex="0"
          role="log" aria-label="Console Output Log"></div>

        <!-- Scroll to Bottom Button -->
        <button id="scrollToBottomBtn" onclick="scrollToLogBottom()"
          class="absolute bottom-4 right-6 bg-cyan-600/90 hover:bg-cyan-700 text-white rounded-full p-2 shadow-lg transition-all duration-300 opacity-0 translate-y-2 pointer-events-none focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 z-10"
          aria-label="Scroll to bottom of log" title="Scroll to bottom">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z"
              clip-rule="evenodd" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Visualizer Page -->
    <div id="page-visualizer" class="page hidden max-w-7xl mx-auto glass rounded-lg p-6">
      <div class="flex flex-col gap-4">
        <!-- Header -->
        <div class="flex justify-between items-center">
          <h2 class="text-2xl font-bold text-black">
            VTK Mesh Visualization
          </h2>
        </div>

        <div class="mb-6 text-black text-sm">
          <p class="text-black text-sm">
            Generate VTK files to view mesh structure and inspect its
            properties.
          </p>
        </div>

        <!-- Main Two-Column Layout -->
        <div class="flex flex-col lg:flex-row gap-6">
          <!-- Left Sidebar: Controls -->
          <div class="w-full lg:w-1/3 flex flex-col gap-4 glass-panel rounded-lg p-4">
            <!-- Mesh Selection -->
            <div class="flex flex-col gap-2">
              <!-- Buttons are Hidden when Mesh files have been found/loaded-->
              <div id="meshActionButtons" class="flex gap-2 transition-all duration-300 ease-in-out">
                <button id="runFoamToVTKBtn" onclick="runFoamToVTK(this)"
                  class="bg-teal-500 hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 text-white px-4 py-2 rounded text-sm transition-opacity duration-300">
                  Generate VTK files (foamToVTK)
                </button>
                <button id="refreshMeshListBtn" onclick="refreshMeshList(this)"
                  class="bg-gray-500 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 text-white px-4 py-2 rounded text-sm transition-opacity duration-300 flex items-center gap-1"
                  aria-label="Refresh mesh list">
                  <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                  </svg>
                  Refresh List
                </button>
              </div>

              <select id="meshSelect" class="border border-gray-300 rounded px-3 py-2 w-full"
                aria-label="Select Mesh File">
                <option value="">-- Select a mesh file --</option>
              </select>
              <button id="loadMeshBtn" onclick="loadMeshVisualization()"
                class="bg-cyan-600 hover:bg-cyan-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 text-white px-4 py-2 rounded w-full flex items-center justify-center gap-2">
                Load Mesh
              </button>
            </div>

            <!-- Mesh Controls -->
            <div id="meshControls" class="hidden flex flex-col gap-3 bg-white p-3 rounded border border-gray-300">
              <div class="flex items-center gap-2">
                <input type="checkbox" id="showEdges" checked class="rounded" />
                <label for="showEdges" class="text-sm cursor-pointer">Show Edges</label>
              </div>

              <div class="flex items-center gap-2">
                <label for="meshColor" class="text-sm">Color:</label>
                <select id="meshColor" class="border border-gray-300 rounded px-2 py-1 text-sm flex-1">
                  <option value="lightblue">Light Blue</option>
                  <option value="white">White</option>
                  <option value="gray">Gray</option>
                  <option value="red">Red</option>
                  <option value="green">Green</option>
                  <option value="blue">Blue</option>
                </select>
              </div>

              <div class="flex items-center gap-2">
                <label for="cameraPosition" class="text-sm">View:</label>
                <select id="cameraPosition" class="border border-gray-300 rounded px-2 py-1 text-sm flex-1">
                  <option value="">Auto</option>
                  <option value="xy">XY Plane</option>
                  <option value="xz">XZ Plane</option>
                  <option value="yz">YZ Plane</option>
                  <option value="iso">Isometric</option>
                </select>
              </div>

              <div class="flex gap-2">
                <button onclick="updateMeshView()" id="updateViewBtn"
                  class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm w-1/2">
                  Update View
                </button>
                <button onclick="toggleInteractiveMode()" id="toggleInteractiveBtn"
                  class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-sm w-1/2">
                  Interactive Mode
                </button>
              </div>
              <div id="interactiveModeHint"
                class="hidden mt-3 text-[11px] text-black bg-gray-50 p-3 rounded-md border border-gray-200 shadow-sm">
                <div class="font-semibold text-gray-900 mb-2 border-b border-gray-200 pb-1">
                  How to Interact?
                </div>
                <div class="grid grid-cols-[auto_1fr] gap-x-3 gap-y-2 items-center">
                  <!-- Rotate -->
                  <div class="flex justify-center">
                    <svg class="w-4 h-5" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="1" y="1" width="12" height="18" rx="6" stroke="#9CA3AF" stroke-width="1.5" />
                      <path d="M7 1V8H1.5C1.5 4.5 3.5 1 7 1Z" fill="#3B82F6" />
                      <line x1="7" y1="1" x2="7" y2="8" stroke="#9CA3AF" stroke-width="1.5" />
                    </svg>
                  </div>
                  <span>Rotate</span>

                  <!-- Axis Rotate -->
                  <div class="flex items-center gap-1 justify-center">
                    <kbd
                      class="px-1.5 py-0.5 rounded bg-white border border-gray-300 font-sans text-[10px] text-gray-900 shadow-sm">Ctrl</kbd>
                    <span class="text-gray-600 text-[10px]">+</span>
                    <svg class="w-4 h-5" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="1" y="1" width="12" height="18" rx="6" stroke="#9CA3AF" stroke-width="1.5" />
                      <path d="M7 1V8H1.5C1.5 4.5 3.5 1 7 1Z" fill="#3B82F6" />
                      <line x1="7" y1="1" x2="7" y2="8" stroke="#9CA3AF" stroke-width="1.5" />
                    </svg>
                  </div>
                  <span>Axis Rotate</span>

                  <!-- Zoom -->
                  <div class="flex justify-center">
                    <svg class="w-4 h-5" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="1" y="1" width="12" height="18" rx="6" stroke="#9CA3AF" stroke-width="1.5" />
                      <rect x="6" y="3" width="2" height="4" rx="1" fill="#EF4444" />
                    </svg>
                  </div>
                  <span>Zoom</span>

                  <!-- Pan -->
                  <div class="flex items-center gap-1 justify-center">
                    <kbd
                      class="px-1.5 py-0.5 rounded bg-white border border-gray-300 font-sans text-[10px] text-gray-900 shadow-sm">Shift</kbd>
                    <span class="text-gray-600 text-[10px]">+</span>
                    <svg class="w-4 h-5" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="1" y="1" width="12" height="18" rx="6" stroke="#9CA3AF" stroke-width="1.5" />
                      <path d="M7 1V8H1.5C1.5 4.5 3.5 1 7 1Z" fill="#3B82F6" />
                      <line x1="7" y1="1" x2="7" y2="8" stroke="#9CA3AF" stroke-width="1.5" />
                    </svg>
                  </div>
                  <span>Pan</span>
                </div>
              </div>
            </div>

            <!-- Mesh Info -->
            <div id="meshInfo" class="hidden bg-cyan-50 border border-cyan-200 rounded p-3">
              <h3 class="font-semibold text-black mb-2">Mesh Information</h3>
              <div id="meshInfoContent" class="text-sm text-cyan-800 grid grid-cols-2 gap-2"></div>
            </div>
          </div>

          <!-- Right Column: Interactive Geometry Viewer -->
          <div class="w-full lg:w-2/3 rounded-lg overflow-hidden relative" style="min-height: 400px">
            <!-- Camera Controls -->
            <div id="cameraControls"
              class="absolute bottom-4 right-4 z-10 flex flex-col gap-2 opacity-0 hover:opacity-100 focus-within:opacity-100 transition-opacity duration-300 pointer-events-auto">
              <button onclick="setCameraView('xy')"
                class="bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md backdrop-blur-sm"
                title="Top View (XY)" aria-label="Top View (XY)">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
              </button>
              <button onclick="setCameraView('xz')"
                class="bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md backdrop-blur-sm"
                title="Front View (XZ)" aria-label="Front View (XZ)">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
                </svg>
              </button>
              <button onclick="setCameraView('yz')"
                class="bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md backdrop-blur-sm"
                title="Side View (YZ)" aria-label="Side View (YZ)">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
              </button>
              <button onclick="setCameraView('iso')"
                class="bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md backdrop-blur-sm"
                title="Isometric View" aria-label="Isometric View">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
              </button>
              <button onclick="resetCamera()"
                class="bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md backdrop-blur-sm"
                title="Reset Camera" aria-label="Reset Camera">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
              </button>
            </div>

            <!-- Viewer -->
            <div id="meshPlaceholder" class="flex flex-col items-center justify-center h-full p-8 text-center">
              <div class="text-gray-900 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                    d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                </svg>
              </div>
              <h3 class="text-lg font-medium text-black mb-2">
                No Mesh Loaded
              </h3>
              <p class="text-gray-900">
                Select a mesh file and click "Load Mesh" to visualize
              </p>
            </div>
            <img id="meshImage" class="hidden w-full h-auto" alt="Mesh Visualization" />
            <iframe id="meshInteractive" class="hidden w-full border-0" style="height: 800px"
              title="Interactive Mesh Viewer"></iframe>
          </div>
        </div>
      </div>
    </div>

    <!-- Plots Page -->
    <div id="page-plots" class="page hidden max-w-7xl mx-auto glass rounded-lg p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-black">Realtime Plots</h2>
        <div class="flex gap-2 relative">
          <!-- Font Settings Button -->
          <div class="relative">
            <button onclick="toggleFontSettings()" id="fontSettingsBtn"
              class="bg-gray-100 hover:bg-gray-200 text-gray-900 border border-gray-300 px-4 py-2 rounded flex items-center gap-2 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                  d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
                  clip-rule="evenodd" />
              </svg>
              Font
            </button>

            <!-- MegaMenu Popup -->
            <div id="fontSettingsMenu"
              class="hidden absolute glass-panel right-0 mt-2 w-80 origin-top-right rounded-xl shadow-2xl z-50 p-4 flex flex-col gap-4 bg-white/40 border-cyan-300">
              <div class="flex justify-between items-center pb-2">
                <h3 class="font-semibold text-black">Plot Appearance</h3>
                <button onclick="toggleFontSettings()" class="text-gray-900 hover:text-gray-900"
                  aria-label="Close font settings">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                      d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                      clip-rule="evenodd" />
                  </svg>
                </button>
              </div>

              <!-- Presets -->
              <div>
                <label class="text-xs text-black font-medium mb-2 block uppercase tracking-wider">Presets</label>
                <div class="grid grid-cols-2 gap-2">
                  <button onclick="changePlotFont('Inter, sans-serif')"
                    class="text-sm p-2 rounded glass-panel hover:bg-cyan-500/10 hover:border-cyan-500/50 transition-all text-left font-['Inter']">
                    Inter
                  </button>
                  <button onclick="changePlotFont('Roboto, sans-serif')"
                    class="text-sm p-2 rounded glass-panel hover:bg-cyan-500/10 hover:border-cyan-500/50 transition-all text-left font-['Roboto']">
                    Roboto
                  </button>
                  <button onclick="changePlotFont('Open Sans, sans-serif')"
                    class="text-sm p-2 rounded glass-panel hover:bg-cyan-500/10 hover:border-cyan-500/50 transition-all text-left font-['Open_Sans']">
                    Open Sans
                  </button>
                  <button onclick="changePlotFont('Lato, sans-serif')"
                    class="text-sm p-2 rounded glass-panel hover:bg-cyan-500/10 hover:border-cyan-500/50 transition-all text-left font-['Lato']">
                    Lato
                  </button>
                  <button onclick="changePlotFont('Montserrat, sans-serif')"
                    class="text-sm p-2 rounded glass-panel hover:bg-cyan-500/10 hover:border-cyan-500/50 transition-all text-left font-['Montserrat']">
                    Montserrat
                  </button>
                  <button onclick="changePlotFont('Computer Modern Serif, serif')"
                    class="text-sm p-2 rounded glass-panel hover:bg-cyan-500/10 hover:border-cyan-500/50 transition-all text-left font-serif">
                    Times New Roman / Computer Modern Serif
                  </button>
                </div>
              </div>

              <!-- Custom Font -->
              <div>
                <label for="customFontInput"
                  class="text-xs text-black font-medium mb-1 block uppercase tracking-wider">Custom Font Family</label>
                <div class="flex gap-2">
                  <input type="text" id="customFontInput" placeholder="e.g. Courier New"
                    class="w-full text-sm border border-gray-300 rounded px-2 py-1 bg-white/60 focus:ring-2 focus:ring-cyan-500 focus:outline-none placeholder-gray-400"
                    onchange="changePlotFont(this.value)" />
                </div>
              </div>
            </div>
          </div>

          <!-- Show Aero Plots Button -->
          <button onclick="toggleAeroPlots()" id="toggleAeroBtn"
            class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded shadow-sm">
            Show Aero Plots
          </button>
        </div>
      </div>

      <!-- Main Plots Container -->
      <div id="plotsContainer" class="w-full relative">
        <div id="plotsLoading" role="status" aria-live="polite"
          class="absolute inset-0 flex flex-col items-center justify-center glass z-50 hidden transition-opacity duration-300">
          <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-cyan-500 mb-3"></div>
          <span class="text-lg font-semibold text-gray-900">Loading Plot Data...</span>
        </div>

        <div
          class="grid grid-flow-row-dense grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2 mb-2 w-full auto-rows-min">
          <!-- Pressure Plot -->
          <div
            class="w-full glass-plot p-2 rounded-xl hover:shadow-lg transition-shadow duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-opacity-50 relative group">
            <div id="pressure-plot" class="w-full p-1" style="min-height: 300px"></div>

            <button onclick="
                  downloadPlotData('pressure-plot', 'pressure_data.csv');
                  showNotification(
                    'Downloading pressure data...',
                    'info',
                    3000,
                  );
                "
              class="absolute bottom-3 right-3 bg-cyan-600 hover:bg-cyan-600 text-white px-3 py-1 rounded text-sm opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity duration-200 z-10"
              title="Download Pressure Data as CSV">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
              CSV
            </button>

            <button onclick="
                  downloadPlotAsPNG('pressure-plot', 'pressure_plot.png')
                "
              class="absolute bottom-3 right-20 bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity duration-200 z-10"
              title="Download Plot as PNG">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              PNG
            </button>
          </div>

          <!-- Velocity Plot -->
          <div
            class="w-full glass-plot p-2 rounded-xl hover:shadow-lg transition-shadow duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-opacity-50 relative group">
            <div id="velocity-plot" class="w-full p-2" style="min-height: 300px"></div>

            <button onclick="downloadPlotData('velocity-plot', 'velocity_data.csv')"
              class="absolute bottom-3 right-3 bg-cyan-600 hover:bg-cyan-600 text-white px-3 py-1 rounded text-sm opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity duration-200 z-10"
              title="Download Velocity Data as separate CSV">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
              CSV
            </button>

            <button onclick="
                  downloadPlotAsPNG('velocity-plot', 'velocity_plot.png')
                "
              class="absolute bottom-3 right-20 bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity duration-200 z-10"
              title="Download Plot as PNG">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              PNG
            </button>
          </div>

          <!-- Turbulence Plot -->
          <div
            class="w-full glass-plot p-2 rounded-xl hover:shadow-lg transition-shadow duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-opacity-50 relative group">
            <div id="turbulence-plot" class="w-full p-2" style="min-height: 300px"></div>

            <button onclick="
                  downloadPlotData('turbulence-plot', 'turbulence_data.csv')
                "
              class="absolute bottom-3 right-3 bg-cyan-600 hover:bg-cyan-600 text-white px-3 py-1 rounded text-sm opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity duration-200 z-10"
              title="Download Turbulence Data as CSV">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
              CSV
            </button>

            <button onclick="
                  downloadPlotAsPNG('turbulence-plot', 'turbulence_plot.png')
                "
              class="absolute bottom-3 right-20 bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity duration-200 z-10"
              title="Download Plot as PNG">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              PNG
            </button>
          </div>

          <!-- Residuals Plot -->
          <div
            class="w-full glass-plot p-2 rounded-xl hover:shadow-lg transition-shadow duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-opacity-50 relative group">
            <div id="residuals-plot" class="w-full p-2" style="min-height: 300px"></div>

            <button onclick="
                  downloadPlotData('residuals-plot', 'residuals_data.csv')
                "
              class="absolute bottom-3 right-3 bg-cyan-600 hover:bg-cyan-600 text-white px-3 py-1 rounded text-sm opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity duration-200 z-10"
              title="Download Residuals Data as CSV">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
              CSV
            </button>

            <button onclick="
                  downloadPlotAsPNG('residuals-plot', 'residuals_plot.png')
                "
              class="absolute bottom-3 right-20 bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity duration-200 z-10"
              title="Download Plot as PNG">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              PNG
            </button>
          </div>
        </div>
      </div>

      <!-- Aerodynamic Plots Container (optional) -->
      <div id="aeroContainer" class="hidden mt-4 w-full">
        <h3 class="text-xl font-semibold mb-2 text-black">
          Aerodynamic Analysis
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
          <div class="w-full overflow-hidden">
            <div id="cp-plot" class="w-full p-2"></div>
          </div>
          <div class="w-full overflow-hidden">
            <div id="velocity-profile-plot" class="w-full p-2"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Post Processing Page -->
    <div id="page-post" class="page hidden max-w-7xl mx-auto glass shadow-lg rounded-lg p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-black">Post Processing</h2>
      </div>

      <!-- Pipeline Visualization (Metro Map) -->
      <div id="post-pipeline-view" class="mb-6 p-4 glass-panel rounded-lg flex items-center overflow-x-auto">
        <!-- Pipeline steps will be injected here by JS -->
        <div class="text-gray-500 text-sm italic">
          Pipeline empty. Select a function below to start.
        </div>
      </div>

      <!-- Landing View: Feature Selection Grid -->
      <div id="post-landing-view" class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <!-- Contour Card (Active) -->
        <button id="card-contour" onclick="switchPostView('contour')"
          class="glass-panel p-4 text-left hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 group border border-cyan-200 bg-white/40 flex flex-col h-full">
          <div class="flex items-start justify-between mb-3">
            <div
              class="p-2 rounded-lg bg-cyan-100 text-cyan-600 group-hover:bg-cyan-600 group-hover:text-white transition-colors duration-300">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
              </svg>
            </div>
            <span
              class="text-[10px] font-semibold px-1.5 py-0.5 rounded bg-green-100 text-green-800 border border-green-200">Active</span>
          </div>
          <h3 class="text-lg font-bold text-gray-900 mb-1 group-hover:text-cyan-700">
            Contour
          </h3>
          <p class="text-xs text-gray-600 flex-grow">
            Generate isosurfaces for scalar fields like Pressure and Velocity.
          </p>
        </button>

        <!-- Slice Card (Coming Soon) -->
        <div
          class="glass-panel p-4 text-left opacity-75 border border-gray-200 bg-gray-50/50 cursor-not-allowed flex flex-col h-full">
          <div class="flex items-start justify-between mb-3">
            <div class="p-2 rounded-lg bg-gray-200 text-gray-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" />
              </svg>
            </div>
            <span
              class="text-[10px] font-semibold px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 border border-gray-300">Soon</span>
          </div>
          <h3 class="text-lg font-bold text-gray-500 mb-1">Slice</h3>
          <p class="text-xs text-gray-500 flex-grow">
            Cut through the mesh with a plane to inspect internal values.
          </p>
        </div>

        <!-- Streamline Card (Coming Soon) -->
        <div
          class="glass-panel p-4 text-left opacity-75 border border-gray-200 bg-gray-50/50 cursor-not-allowed flex flex-col h-full">
          <div class="flex items-start justify-between mb-3">
            <div class="p-2 rounded-lg bg-gray-200 text-gray-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
            </div>
            <span
              class="text-[10px] font-semibold px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 border border-gray-300">Soon</span>
          </div>
          <h3 class="text-lg font-bold text-gray-500 mb-1">Streamline</h3>
          <p class="text-xs text-gray-500 flex-grow">
            Visualize flow trajectories and particle paths.
          </p>
        </div>

        <!-- Surface Projection Card (Coming Soon) -->
        <div
          class="glass-panel p-4 text-left opacity-75 border border-gray-200 bg-gray-50/50 cursor-not-allowed flex flex-col h-full">
          <div class="flex items-start justify-between mb-3">
            <div class="p-2 rounded-lg bg-gray-200 text-gray-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
              </svg>
            </div>
            <span
              class="text-[10px] font-semibold px-1.5 py-0.5 rounded bg-gray-200 text-gray-600 border border-gray-300">Soon</span>
          </div>
          <h3 class="text-lg font-bold text-gray-500 mb-1">
            Surface Projection
          </h3>
          <p class="text-xs text-gray-500 flex-grow">
            Project scalar values onto boundary surfaces.
          </p>
        </div>
      </div>

      <!-- Contour Visualization Section (Hidden by default) -->
      <div id="post-contour-view" class="hidden mb-8 animate-[slideIn_0.3s_ease-out]">
        <div class="flex items-center gap-2 mb-4">
          <button onclick="switchPostView('landing')"
            class="p-2 rounded-full hover:bg-gray-100 text-gray-600 hover:text-cyan-700 transition-colors"
            aria-label="Back to selection">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd"
                d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
                clip-rule="evenodd" />
            </svg>
          </button>
          <h3 class="text-xl font-semibold">Contour Visualization</h3>
        </div>

        <div class="flex flex-col lg:flex-row gap-6">
          <!-- Left Sidebar: Controls -->
          <div class="w-full lg:w-1/3 flex flex-col gap-4 bg-gray-50 border border-gray-200 rounded-lg p-4">
            <!-- VTK File Selection -->
            <div class="flex flex-col gap-2">
              <div class="flex justify-between items-center">
                <label for="vtkFileSelect" class="text-sm font-medium">Select VTK File</label>
                <button id="refreshPostVTKBtn" onclick="refreshPostList(this)"
                  class="text-xs text-cyan-600 hover:text-cyan-800 flex items-center gap-1 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-cyan-500 rounded px-1"
                  aria-label="Refresh VTK file list">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                  Refresh
                </button>
              </div>
              <select id="vtkFileSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                <option value="">-- Select a VTK file --</option>
              </select>
            </div>

            <!-- File Browser (Optional) -->
            <div class="border border-gray-200 rounded-lg overflow-hidden">
              <button type="button" onclick="
                    this.nextElementSibling.classList.toggle('hidden');
                    this.querySelector('svg').classList.toggle('rotate-180');
                  "
                class="w-full flex items-center justify-between px-4 py-2 text-sm font-medium text-left text-gray-900 bg-gray-50 hover:bg-gray-100 focus:outline-none">
                <span>Load custom VTK file</span>
                <svg class="w-4 h-4 transform transition-transform duration-200" fill="none" stroke="currentColor"
                  viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="p-4 bg-white hidden">
                <div class="flex flex-col gap-2">
                  <div class="flex flex-col sm:flex-row gap-2 w-full">
                    <div class="flex-1 min-w-0">
                      <input type="file" id="vtkFileBrowser" accept=".vtk,.vtp,.vtu,.vtm,.pvtu"
                        aria-label="Upload custom VTK file"
                        class="w-full border border-gray-300 rounded px-3 py-2 text-sm truncate" />
                    </div>
                    <button onclick="loadCustomVTKFile()"
                      class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm font-medium whitespace-nowrap w-full sm:w-auto">
                      Load File
                    </button>
                  </div>
                  <small class="text-gray-900 text-xs">Supported: .vtk, .vtp, .vtu, .vtm, .pvtu</small>
                </div>
              </div>
            </div>

            <!-- Load Selected VTK Button -->
            <button id="loadContourVTKBtn" onclick="loadContourVTK()"
              class="bg-cyan-600 hover:bg-cyan-600 text-white px-4 py-2 rounded w-full font-medium">
              Load for Contour
            </button>

            <!-- VTK File Info -->
            <div id="vtkFileInfo" class="hidden bg-green-50 border border-green-200 rounded p-3">
              <h3 class="font-semibold text-black mb-2">
                VTK File Information
              </h3>
              <div id="vtkFileInfoContent" class="text-sm text-green-800 space-y-1"></div>
            </div>

            <!-- Scalar Field Selection -->
            <div class="flex flex-col gap-2">
              <label for="scalarField" class="text-sm font-medium">Scalar Field</label>
              <select id="scalarField"
                class="border border-gray-300 rounded px-3 py-2 [&_.point-data-option]:text-cyan-500 [&_.cell-data-option]:text-green-500">
                <style>
                  option.point-data-option {
                    color: #d946ef;
                  }

                  option.cell-data-option {
                    color: #10b981;
                  }

                  #scalarField option {
                    padding: 4px 8px;
                  }
                </style>
              </select>
            </div>

            <!-- Color Map Selection -->
            <div class="flex flex-col gap-2">
              <label for="colorMap" class="text-sm font-medium">Color Map</label>
              <select id="colorMap" class="border border-gray-300 rounded px-3 py-2">
                <option value="viridis">Viridis</option>
                <option value="plasma">Plasma</option>
                <option value="inferno">Inferno</option>
                <option value="magma">Magma</option>
                <option value="cividis">Cividis</option>
                <option value="coolwarm">Coolwarm</option>
              </select>
            </div>

            <!-- Range Selection -->
            <fieldset class="mt-2 w-full border-0 p-0 m-0 min-w-0">
              <legend class="text-sm font-medium mb-2 block">
                Scalar Range
              </legend>
              <div class="grid grid-cols-2 gap-2 w-full">
                <div class="w-full">
                  <input type="number" id="rangeMin" placeholder="Min"
                    class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-shadow"
                    step="0.0001" value="122.34" aria-label="Scalar Field Range Minimum" />
                </div>
                <div class="w-full">
                  <input type="number" id="rangeMax" placeholder="Max"
                    class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-shadow"
                    step="0.0001" value="168.2177" aria-label="Scalar Field Range Maximum" />
                </div>
              </div>
            </fieldset>

            <!-- Number of Isosurfaces -->
            <div class="flex flex-col gap-2">
              <label for="numIsosurfaces" class="text-sm font-medium">Number of Isosurfaces
                <span class="text-gray-900">(Optional)</span></label>
              <input type="number" id="numIsosurfaces" placeholder="Leave empty for default (10)" min="1" max="40"
                class="border border-gray-300 rounded px-3 py-2" />
            </div>

            <!-- Show Isovalue Widget Toggle -->
            <div class="flex items-center gap-2 mt-2">
              <input type="checkbox" id="showIsovalueWidget"
                class="w-4 h-4 text-cyan-600 bg-gray-100 border-gray-300 rounded focus:ring-cyan-500" checked />
              <label for="showIsovalueWidget" class="text-sm font-medium text-gray-900">Enable Interactive
                Slider</label>
            </div>

            <!-- Interactive Slider (Visible by default) -->
            <div id="isovalueSliderContainer" class="mt-2">
              <label for="isovalueSlider" class="block text-sm font-medium text-gray-700">Isovalue</label>
              <div class="flex items-center gap-2">
                <input type="range" id="isovalueSlider"
                  class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                <span id="isovalueDisplay" class="text-sm text-gray-600 w-16 text-right">0</span>
              </div>
            </div>

            <!-- Generate Contours Button -->
            <button id="generateContoursBtn" onclick="generateContours()"
              class="bg-cyan-600 hover:bg-cyan-600 text-white px-4 py-2 rounded w-full mt-2">
              Generate Contours
            </button>

            <!-- Contour Info -->
            <div id="contourInfo" class="hidden bg-cyan-50 border border-cyan-200 rounded p-3 mt-4">
              <h3 class="font-semibold text-black mb-2">
                Contour Information
              </h3>
              <div id="contourInfoContent" class="text-sm text-cyan-800 grid grid-cols-2 gap-2"></div>
            </div>
          </div>

          <!-- Right Column: Contour Viewer -->
          <div class="w-full lg:w-2/3 rounded-lg overflow-hidden relative" style="min-height: 600px">
            <!-- Camera Controls -->
            <div id="contourCameraControls"
              class="absolute bottom-4 right-4 z-10 flex flex-col gap-2 opacity-0 hover:opacity-100 focus-within:opacity-100 transition-opacity duration-300 pointer-events-auto">
              <button onclick="setCameraView('xy')"
                class="bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md backdrop-blur-sm"
                title="Top View (XY)" aria-label="Top View (XY)">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
              </button>
              <button onclick="setCameraView('xz')"
                class="bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md backdrop-blur-sm"
                title="Front View (XZ)" aria-label="Front View (XZ)">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
                </svg>
              </button>
              <button onclick="setCameraView('yz')"
                class="bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md backdrop-blur-sm"
                title="Side View (YZ)" aria-label="Side View (YZ)">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
              </button>
              <button onclick="setCameraView('iso')"
                class="bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md backdrop-blur-sm"
                title="Isometric View" aria-label="Isometric View">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
              </button>
              <button onclick="resetCamera()"
                class="bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md backdrop-blur-sm"
                title="Reset Camera" aria-label="Reset Camera">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
              </button>
            </div>

            <!-- Viewer -->
            <div id="contourPlaceholder" class="flex flex-col items-center justify-center h-full p-8 text-center">
              <div class="text-gray-900 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                    d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                </svg>
              </div>
              <h3 class="text-lg font-medium text-black mb-2">
                No Contour Loaded
              </h3>
              <p class="text-gray-900">
                Click "Generate Contours" to visualize the data
              </p>
            </div>
            <div id="contourViewer" class="hidden w-full h-full"></div>
          </div>
        </div>
      </div>

      <div id="post-processing-content" class="hidden">
        <!-- Other post-processing content will be loaded here by refreshPostList() -->
      </div>
    </div>
  </div>
  <!-- End Main Content Area -->

  <!-- Plotly.js - Load synchronously to ensure it's available when needed -->
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <script>
    // Initialize after both DOM and Plotly are loaded
    document.addEventListener("DOMContentLoaded", function () {
      // Check if Plotly is loaded
      if (typeof Plotly === "undefined") {
        console.error("Plotly.js not loaded!");
        return;
      }

      // Initialize modebar styling
      const observer = new MutationObserver(() => {
        document.querySelectorAll(".modebar").forEach((bar) => {
          bar.style.backgroundColor = "transparent";
          bar.style.boxShadow = "none";
        });
      });

      // Observe the document for Plotly plot creation
      observer.observe(document.body, { childList: true, subtree: true });

      // Initialize plots if we're on the plots page
      if (
        document.getElementById("page-plots") &&
        !document.getElementById("page-plots").classList.contains("hidden")
      ) {
        if (typeof startPlotUpdates === "function") {
          startPlotUpdates();
        }
      }
    });
  </script>

  <!-- JS loading (compiled from TypeScript) -->
  <!-- Load isosurface module first (required by foamflask_frontend.js) -->
  <script type="module" src="{{ url_for('static', filename='js/frontend/isosurface.js') }}?v=9"></script>

  <!-- Main frontend script -->
  <script type="module" src="{{ url_for('static', filename='js/foamflask_frontend.js') }}"></script>

  <footer class="py-4 glass border-t border-gray-200/50 mt-8 rounded-none">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div
        class="flex flex-col md:flex-row justify-between items-center text-sm text-black font-medium space-y-2 md:space-y-0">
        <div class="text-center md:text-left">
          <div class="text-black font-medium">FOAMFlask &copy; 2025</div>
          <div class="text-xs mt-1 text-black font-medium">
            Licensed under
            <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank" rel="noopener noreferrer"
              class="text-black underline decoration-cyan-700 hover:text-cyan-900">GNU GPLv3</a>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <span>Powered by:</span>

          <a href="https://pyvista.org/" target="_blank" rel="noopener noreferrer"
            class="flex items-center text-cyan-800 hover:text-cyan-900 transition-colors">
            <img src="{{ url_for('static', filename='icons/Pyvista-logo.avif') }}" alt="PyVista" class="h-8 w-auto" />
          </a>
          <span class="text-black">|</span>

          <a href="https://plotly.com/" target="_blank" rel="noopener noreferrer"
            class="flex items-center text-cyan-800 hover:text-cyan-900 transition-colors">
            <img src="{{ url_for('static', filename='icons/Plotly-logo.avif') }}" alt="Plotly" class="h-8 w-auto" />
          </a>
          <span class="text-black">|</span>

          <a href="https://docker.com/" target="_blank" rel="noopener noreferrer"
            class="flex items-center text-cyan-600 hover:text-cyan-800 transition-colors">
            <img src="{{ url_for('static', filename='icons/docker-logo.avif') }}" alt="Docker" class="h-8 w-auto" />
          </a>
        </div>
      </div>
    </div>
  </footer>
</body>

</html>